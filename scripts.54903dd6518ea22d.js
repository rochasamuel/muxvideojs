!function(Mr,Ft){"object"==typeof exports&&"object"==typeof module?module.exports=Ft():"function"==typeof define&&define.amd?define([],Ft):"object"==typeof exports?exports.videojs=Ft():Mr.videojs=Ft()}(this,function(){return(()=>{var Mr={480:(ge,Le,Ee)=>{"use strict";var ke=Ee(697);ge.exports=function(K,j){return void 0===j&&(j=!1),function(U,L,F){if(U)K(U);else if(L.statusCode>=400&&L.statusCode<=599){var I=F;if(j)if(ke.TextDecoder){var R=function Q(K){return void 0===K&&(K=""),K.toLowerCase().split(";").reduce(function(j,U){var L=U.split("="),I=L[1];return"charset"===L[0].trim()?I.trim():j},"utf-8")}(L.headers&&L.headers["content-type"]);try{I=new TextDecoder(R).decode(F)}catch{}}else I=String.fromCharCode.apply(null,new Uint8Array(F));K({cause:I})}else K(null,F)}}},424:(ge,Le,Ee)=>{"use strict";var ke=Ee(697),Se=Ee(110),Q=Ee(988);F.httpHandler=Ee(480);var K=function(_){var b={};return _&&_.trim().split("\n").forEach(function(k){var x=k.indexOf(":"),T=k.slice(0,x).trim().toLowerCase(),C=k.slice(x+1).trim();typeof b[T]>"u"?b[T]=C:Array.isArray(b[T])?b[T].push(C):b[T]=[b[T],C]}),b};function L(_,b,k){var x=_;return Q(b)?(k=b,"string"==typeof _&&(x={uri:_})):x=Se({},b,{uri:_}),x.callback=k,x}function F(_,b,k){return I(b=L(_,b,k))}function I(_){if(typeof _.callback>"u")throw new Error("callback argument missing");var b=!1,k=function(d,n,p){b||(b=!0,_.callback(d,n,p))};function T(){var d=void 0;if(d=o.response?o.response:o.responseText||function R(_){try{if("document"===_.responseType)return _.responseXML;if(""===_.responseType&&(!_.responseXML||"parsererror"!==_.responseXML.documentElement.nodeName))return _.responseXML}catch{}return null}(o),h)try{d=JSON.parse(d)}catch{}return d}function C(d){return clearTimeout(m),d instanceof Error||(d=new Error(""+(d||"Unknown XMLHttpRequest Error"))),d.statusCode=0,k(d,c)}function E(){if(!f){var d;clearTimeout(m);var n=c,p=null;return 0!==(d=_.useXDR&&void 0===o.status?200:1223===o.status?204:o.status)?(n={body:T(),statusCode:d,method:A,headers:{},url:u,rawRequest:o},o.getAllResponseHeaders&&(n.headers=K(o.getAllResponseHeaders()))):p=new Error("Internal XMLHttpRequest Error"),k(p,n,n.body)}}var o=_.xhr||null;o||(o=_.cors||_.useXDR?new F.XDomainRequest:new F.XMLHttpRequest);var g,f,m,u=o.url=_.uri||_.url,A=o.method=_.method||"GET",v=_.body||_.data,a=o.headers=_.headers||{},s=!!_.sync,h=!1,c={body:void 0,headers:{},statusCode:0,method:A,url:u,rawRequest:o};if("json"in _&&!1!==_.json&&(h=!0,a.accept||a.Accept||(a.Accept="application/json"),"GET"!==A&&"HEAD"!==A&&(a["content-type"]||a["Content-Type"]||(a["Content-Type"]="application/json"),v=JSON.stringify(!0===_.json?v:_.json))),o.onreadystatechange=function x(){4===o.readyState&&setTimeout(E,0)},o.onload=E,o.onerror=C,o.onprogress=function(){},o.onabort=function(){f=!0},o.ontimeout=C,o.open(A,u,!s,_.username,_.password),s||(o.withCredentials=!!_.withCredentials),!s&&_.timeout>0&&(m=setTimeout(function(){if(!f){f=!0,o.abort("timeout");var d=new Error("XMLHttpRequest timeout");d.code="ETIMEDOUT",C(d)}},_.timeout)),o.setRequestHeader)for(g in a)a.hasOwnProperty(g)&&o.setRequestHeader(g,a[g]);else if(_.headers&&!function U(_){for(var b in _)if(_.hasOwnProperty(b))return!1;return!0}(_.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in _&&(o.responseType=_.responseType),"beforeSend"in _&&"function"==typeof _.beforeSend&&_.beforeSend(o),o.send(v||null),o}ge.exports=F,ge.exports.default=F,F.XMLHttpRequest=ke.XMLHttpRequest||function D(){},F.XDomainRequest="withCredentials"in new F.XMLHttpRequest?F.XMLHttpRequest:ke.XDomainRequest,function j(_,b){for(var k=0;k<_.length;k++)b(_[k])}(["get","put","post","patch","head","delete"],function(_){F["delete"===_?"del":_]=function(b,k,x){return(k=L(b,k,x)).method=_.toUpperCase(),I(k)}})},675:(ge,Le,Ee)=>{var Q,ke=typeof Ee.g<"u"?Ee.g:typeof window<"u"?window:{},Se=Ee(893);typeof document<"u"?Q=document:(Q=ke["__GLOBAL_DOCUMENT_CACHE@4"])||(Q=ke["__GLOBAL_DOCUMENT_CACHE@4"]=Se),ge.exports=Q},697:(ge,Le,Ee)=>{var ke;ke=typeof window<"u"?window:typeof Ee.g<"u"?Ee.g:typeof self<"u"?self:{},ge.exports=ke},199:function(ge){var Ee;typeof window<"u"&&(Ee=()=>(()=>{var Le={"./src/config.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{enableStreamingMode:()=>n,hlsDefaultConfig:()=>m,mergeConfig:()=>d});var U=j("./src/controller/abr-controller.ts"),L=j("./src/controller/audio-stream-controller.ts"),F=j("./src/controller/audio-track-controller.ts"),I=j("./src/controller/subtitle-stream-controller.ts"),R=j("./src/controller/subtitle-track-controller.ts"),D=j("./src/controller/buffer-controller.ts"),_=j("./src/controller/timeline-controller.ts"),b=j("./src/controller/cap-level-controller.ts"),k=j("./src/controller/fps-controller.ts"),x=j("./src/controller/eme-controller.ts"),T=j("./src/controller/cmcd-controller.ts"),C=j("./src/utils/xhr-loader.ts"),E=j("./src/utils/fetch-loader.ts"),o=j("./src/utils/cues.ts"),g=j("./src/utils/mediakeys-helper.ts"),f=j("./src/utils/logger.ts");function u(){return u=Object.assign?Object.assign.bind():function(p){for(var S=1;S<arguments.length;S++){var y=arguments[S];for(var P in y)Object.prototype.hasOwnProperty.call(y,P)&&(p[P]=y[P])}return p},u.apply(this,arguments)}function A(p,S){var y=Object.keys(p);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(p);S&&(P=P.filter(function(M){return Object.getOwnPropertyDescriptor(p,M).enumerable})),y.push.apply(y,P)}return y}function v(p){for(var S=1;S<arguments.length;S++){var y=null!=arguments[S]?arguments[S]:{};S%2?A(Object(y),!0).forEach(function(P){a(p,P,y[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(y)):A(Object(y)).forEach(function(P){Object.defineProperty(p,P,Object.getOwnPropertyDescriptor(y,P))})}return p}function a(p,S,y){return S=function s(p){var S=function h(p,S){if("object"!=typeof p||null===p)return p;var y=p[Symbol.toPrimitive];if(void 0!==y){var P=y.call(p,S||"default");if("object"!=typeof P)return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===S?String:Number)(p)}(p,"string");return"symbol"==typeof S?S:String(S)}(S),S in p?Object.defineProperty(p,S,{value:y,enumerable:!0,configurable:!0,writable:!0}):p[S]=y,p}var m=v(v({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:C.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:U.default,bufferController:D.default,capLevelController:b.default,fpsController:k.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:g.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},function c(){return{cueHandler:o.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:I.SubtitleStreamController,subtitleTrackController:R.default,timelineController:_.TimelineController,audioStreamController:L.default,audioTrackController:F.default,emeController:x.default,cmcdController:T.default});function d(p,S){if((S.liveSyncDurationCount||S.liveMaxLatencyDurationCount)&&(S.liveSyncDuration||S.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==S.liveMaxLatencyDurationCount&&(void 0===S.liveSyncDurationCount||S.liveMaxLatencyDurationCount<=S.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==S.liveMaxLatencyDuration&&(void 0===S.liveSyncDuration||S.liveMaxLatencyDuration<=S.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return u({},p,S)}function n(p){var S=p.loader;S!==E.default&&S!==C.default?(f.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),p.progressive=!1):(0,E.fetchSupported)()&&(p.loader=E.default,p.progressive=!0,p.enableSoftwareAES=!0,f.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>C});var U=j("./src/polyfills/number.ts"),L=j("./src/utils/ewma-bandwidth-estimator.ts"),F=j("./src/events.ts"),I=j("./src/errors.ts"),R=j("./src/types/loader.ts"),D=j("./src/utils/logger.ts");function _(E,o){for(var g=0;g<o.length;g++){var f=o[g];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(E,k(f.key),f)}}function k(E){var o=function x(E,o){if("object"!=typeof E||null===E)return E;var g=E[Symbol.toPrimitive];if(void 0!==g){var f=g.call(E,o||"default");if("object"!=typeof f)return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(E)}(E,"string");return"symbol"==typeof o?o:String(o)}const C=function(){function E(g){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=g;var f=g.config;this.bwEstimator=new L.default(f.abrEwmaSlowVoD,f.abrEwmaFastVoD,f.abrEwmaDefaultEstimate),this.registerListeners()}var o=E.prototype;return o.registerListeners=function(){var g=this.hls;g.on(F.Events.FRAG_LOADING,this.onFragLoading,this),g.on(F.Events.FRAG_LOADED,this.onFragLoaded,this),g.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(F.Events.ERROR,this.onError,this)},o.unregisterListeners=function(){var g=this.hls;g.off(F.Events.FRAG_LOADING,this.onFragLoading,this),g.off(F.Events.FRAG_LOADED,this.onFragLoaded,this),g.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(F.Events.ERROR,this.onError,this)},o.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},o.onFragLoading=function(g,f){var A,u=f.frag;u.type!==R.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=u,this.partCurrent=null!=(A=f.part)?A:null,this.timer=self.setInterval(this.onCheck,100))},o.onLevelLoaded=function(g,f){var u=this.hls.config;f.details.live?this.bwEstimator.update(u.abrEwmaSlowLive,u.abrEwmaFastLive):this.bwEstimator.update(u.abrEwmaSlowVoD,u.abrEwmaFastVoD)},o._abandonRulesCheck=function(){var g=this.fragCurrent,f=this.partCurrent,u=this.hls,A=u.autoLevelEnabled,v=u.media;if(g&&v){var a=f?f.stats:g.stats,s=f?f.duration:g.duration;if(a.aborted||a.loaded&&a.loaded===a.total||0===g.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(A&&!v.paused&&v.playbackRate&&v.readyState){var h=u.mainForwardBufferInfo;if(null!==h){var m=performance.now()-a.loading.start,c=Math.abs(v.playbackRate);if(!(m<=500*s/c)){var d=a.loaded&&a.loading.first,n=this.bwEstimator.getEstimate(),p=u.levels,S=u.minAutoLevel,P=a.total||Math.max(a.loaded,Math.round(s*p[g.level].maxBitrate/8)),M=d?1e3*a.loaded/m:0,B=M?(P-a.loaded)/M:8*P/n,G=h.len/c;if(!(B<=G)){var q,N=Number.POSITIVE_INFINITY;for(q=g.level-1;q>S;q--){var H=p[q].maxBitrate;if((N=M?s*H/(6.4*M):s*H/n)<G)break}N>=B||(D.logger.warn("Fragment "+g.sn+(f?" part "+f.index:"")+" of level "+g.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+q+"\n      Current BW estimate: "+((0,U.isFiniteNumber)(n)?(n/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+B.toFixed(3)+" s\n      Estimated load time for the next fragment: "+N.toFixed(3)+" s\n      Time to underbuffer: "+G.toFixed(3)+" s"),u.nextLoadLevel=q,d&&this.bwEstimator.sample(m,a.loaded),this.clearTimer(),(g.loader||g.keyLoader)&&(this.fragCurrent=this.partCurrent=null,g.abortRequests()),u.trigger(F.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:g,part:f,stats:a}))}}}}}},o.onFragLoaded=function(g,f){var u=f.frag,A=f.part;if(u.type===R.PlaylistLevelType.MAIN&&(0,U.isFiniteNumber)(u.sn)){var v=A?A.stats:u.stats,a=A?A.duration:u.duration;if(this.clearTimer(),this.lastLoadedFragLevel=u.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[u.level],h=(s.loaded?s.loaded.bytes:0)+v.loaded,m=(s.loaded?s.loaded.duration:0)+a;s.loaded={bytes:h,duration:m},s.realBitrate=Math.round(8*h/m)}u.bitrateTest&&this.onFragBuffered(F.Events.FRAG_BUFFERED,{stats:v,frag:u,part:A,id:u.type})}},o.onFragBuffered=function(g,f){var u=f.frag,A=f.part,v=A?A.stats:u.stats;if(!v.aborted&&u.type===R.PlaylistLevelType.MAIN&&"initSegment"!==u.sn){var a=v.parsing.end-v.loading.start;this.bwEstimator.sample(a,v.loaded),v.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=u.bitrateTest?a/1e3:0}},o.onError=function(g,f){var u;if((null===(u=f.frag)||void 0===u?void 0:u.type)===R.PlaylistLevelType.MAIN){if(f.type===I.ErrorTypes.KEY_SYSTEM_ERROR)return void this.clearTimer();switch(f.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:case I.ErrorDetails.KEY_LOAD_ERROR:case I.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}}},o.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},o.getNextABRAutoLevel=function(){var g=this.fragCurrent,f=this.partCurrent,u=this.hls,A=u.maxAutoLevel,v=u.config,a=u.minAutoLevel,s=u.media,h=f?f.duration:g?g.duration:0,m=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():v.abrEwmaDefaultEstimate,d=u.mainForwardBufferInfo,n=(d?d.len:0)/m,p=this.findBestLevel(c,a,A,n,v.abrBandWidthFactor,v.abrBandWidthUpFactor);if(p>=0)return p;D.logger.trace((n?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var S=h?Math.min(h,v.maxStarvationDelay):v.maxStarvationDelay,y=v.abrBandWidthFactor,P=v.abrBandWidthUpFactor;if(!n){var M=this.bitrateTestDelay;M&&(S=(h?Math.min(h,v.maxLoadingDelay):v.maxLoadingDelay)-M,D.logger.trace("bitrate test took "+Math.round(1e3*M)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*S)+" ms"),y=P=1)}return p=this.findBestLevel(c,a,A,n+S,y,P),Math.max(p,0)},o.findBestLevel=function(g,f,u,A,v,a){for(var s,h=this.fragCurrent,m=this.partCurrent,c=this.lastLoadedFragLevel,d=this.hls.levels,n=d[c],p=!(null==n||null===(s=n.details)||void 0===s||!s.live),S=n?.codecSet,y=m?m.duration:h?h.duration:0,P=u;P>=f;P--){var M=d[P];if(M&&(!S||M.codecSet===S)){var N,B=M.details,G=(m?B?.partTarget:B?.averagetargetduration)||y,q=d[P].maxBitrate,H=q*G/(N=P<=c?v*g:a*g);if(D.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+P+"/"+Math.round(N)+"/"+q+"/"+G+"/"+A+"/"+H),N>q&&(0===H||!(0,U.isFiniteNumber)(H)||p&&!this.bitrateTestDelay||H<A))return P}}return-1},function b(E,o,g){o&&_(E.prototype,o),g&&_(E,g),Object.defineProperty(E,"prototype",{writable:!1})}(E,[{key:"nextAutoLevel",get:function(){var g=this._nextAutoLevel;if(-1!==g&&!this.bwEstimator.canEstimate())return g;var u=this.getNextABRAutoLevel();return-1!==g&&this.hls.levels[u].loadError?g:(-1!==g&&(u=Math.min(g,u)),u)},set:function(g){this._nextAutoLevel=g}}]),E}()},"./src/controller/audio-stream-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>a});var U=j("./src/polyfills/number.ts"),L=j("./src/controller/base-stream-controller.ts"),F=j("./src/events.ts"),I=j("./src/utils/buffer-helper.ts"),R=j("./src/controller/fragment-tracker.ts"),D=j("./src/types/level.ts"),_=j("./src/types/loader.ts"),b=j("./src/loader/fragment.ts"),k=j("./src/demux/chunk-cache.ts"),x=j("./src/demux/transmuxer-interface.ts"),T=j("./src/types/transmuxer.ts"),C=j("./src/controller/fragment-finders.ts"),E=j("./src/utils/discontinuities.ts"),o=j("./src/errors.ts");function g(){return g=Object.assign?Object.assign.bind():function(s){for(var h=1;h<arguments.length;h++){var m=arguments[h];for(var c in m)Object.prototype.hasOwnProperty.call(m,c)&&(s[c]=m[c])}return s},g.apply(this,arguments)}function u(s,h){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,c){return m.__proto__=c,m})(s,h)}const a=function(s){function h(c,d,n){var p;return(p=s.call(this,c,d,n,"[audio-stream-controller]")||this).videoBuffer=null,p.videoTrackCC=-1,p.waitingVideoCC=-1,p.audioSwitch=!1,p.trackId=-1,p.waitingData=null,p.mainDetails=null,p.bufferFlushed=!1,p.cachedTrackLoadedData=null,p._registerListeners(),p}!function f(s,h){s.prototype=Object.create(h.prototype),s.prototype.constructor=s,u(s,h)}(h,s);var m=h.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var c=this.hls;c.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(F.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),c.on(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),c.on(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),c.on(F.Events.ERROR,this.onError,this),c.on(F.Events.BUFFER_RESET,this.onBufferReset,this),c.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this),c.on(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),c.on(F.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m._unregisterListeners=function(){var c=this.hls;c.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(F.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),c.off(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),c.off(F.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),c.off(F.Events.ERROR,this.onError,this),c.off(F.Events.BUFFER_RESET,this.onBufferReset,this),c.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),c.off(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),c.off(F.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m.onInitPtsFound=function(c,d){var n=d.frag,S=d.initPTS;if("main"===d.id){var y=n.cc;this.initPTS[n.cc]=S,this.log("InitPTS for cc: "+y+" found from main: "+S),this.videoTrackCC=y,this.state===L.State.WAITING_INIT_PTS&&this.tick()}},m.startLoad=function(c){if(!this.levels)return this.startPosition=c,void(this.state=L.State.STOPPED);var d=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,d>0&&-1===c?(this.log("Override startPosition with lastCurrentTime @"+d.toFixed(3)),c=d,this.state=L.State.IDLE):(this.loadedmetadata=!1,this.state=L.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=c,this.tick()},m.doTick=function(){switch(this.state){case L.State.IDLE:this.doTickIdle();break;case L.State.WAITING_TRACK:var c,d=this.levels,p=null==d||null===(c=d[this.trackId])||void 0===c?void 0:c.details;if(p){if(this.waitForCdnTuneIn(p))break;this.state=L.State.WAITING_INIT_PTS}break;case L.State.FRAG_LOADING_WAITING_RETRY:var S,y=performance.now(),P=this.retryDate;(!P||y>=P||null!==(S=this.media)&&void 0!==S&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=L.State.IDLE);break;case L.State.WAITING_INIT_PTS:var M=this.waitingData;if(M){var B=M.frag,G=M.part,N=M.cache,q=M.complete;if(void 0!==this.initPTS[B.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=L.State.FRAG_LOADING;var V={frag:B,part:G,payload:N.flush(),networkDetails:null};this._handleFragmentLoadProgress(V),q&&s.prototype._handleFragmentLoadComplete.call(this,V)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Y=this.getLoadPosition(),X=I.BufferHelper.bufferInfo(this.mediaBuffer,Y,this.config.maxBufferHole);(0,C.fragmentWithinToleranceTest)(X.end,this.config.maxFragLookUpTolerance,B)<0&&(this.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+X.end+" is needed"),this.clearWaitingFragment())}}else this.state=L.State.IDLE}this.onTickEnd()},m.clearWaitingFragment=function(){var c=this.waitingData;c&&(this.fragmentTracker.removeFragment(c.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=L.State.IDLE)},m.resetLoadingState=function(){this.clearWaitingFragment(),s.prototype.resetLoadingState.call(this)},m.onTickEnd=function(){var c=this.media;!c||!c.readyState||(this.lastCurrentTime=c.currentTime)},m.doTickIdle=function(){var c=this.hls,d=this.levels,n=this.media,p=this.trackId;if(d&&d[p]&&(n||!this.startFragRequested&&c.config.startFragPrefetch)){var P=d[p].details;if(!P||P.live&&this.levelLastLoaded!==p||this.waitForCdnTuneIn(P))return void(this.state=L.State.WAITING_TRACK);var M=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&M&&(this.bufferFlushed=!1,this.afterBufferFlushed(M,b.ElementaryStreamTypes.AUDIO,_.PlaylistLevelType.AUDIO));var B=this.getFwdBufferInfo(M,_.PlaylistLevelType.AUDIO);if(null!==B){var G=this.audioSwitch;if(!G&&this._streamEnded(B,P))return c.trigger(F.Events.BUFFER_EOS,{type:"audio"}),void(this.state=L.State.ENDED);var N=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,_.PlaylistLevelType.MAIN);if(!(B.len>=this.getMaxBufferLength(N?.len))||G){var Y=P.fragments[0].start,X=B.end;if(G&&n){var Z=this.getLoadPosition();X=Z,P.PTSKnown&&Z<Y&&(B.end>Y||B.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=Y+.05)}if(!(N&&X>N.end+P.targetduration)&&(N&&N.len||!B.len)){var te=this.getNextFragment(X,P);if(!te)return void(this.bufferFlushed=!0);this.loadFragment(te,P,X)}}}}},m.getMaxBufferLength=function(c){var d=s.prototype.getMaxBufferLength.call(this);return c?Math.max(d,c):d},m.onMediaDetaching=function(){this.videoBuffer=null,s.prototype.onMediaDetaching.call(this)},m.onAudioTracksUpdated=function(c,d){var n=d.audioTracks;this.resetTransmuxer(),this.levels=n.map(function(p){return new D.Level(p)})},m.onAudioTrackSwitching=function(c,d){var n=!!d.url;this.trackId=d.id;var p=this.fragCurrent;p&&p.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(100):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=L.State.IDLE):this.state=L.State.STOPPED,this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},m.onLevelLoaded=function(c,d){this.mainDetails=d.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(F.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},m.onAudioTrackLoaded=function(c,d){var n;if(null!=this.mainDetails){var p=this.levels,S=d.details,y=d.id;if(p){this.log("Track "+y+" loaded ["+S.startSN+","+S.endSN+"],duration:"+S.totalduration);var P=p[y],M=0;if(S.live||null!==(n=P.details)&&void 0!==n&&n.live){var B=this.mainDetails;if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed||!B)return;!P.details&&S.hasProgramDateTime&&B.hasProgramDateTime?((0,E.alignMediaPlaylistByPDT)(S,B),M=S.fragments[0].start):M=this.alignPlaylists(S,P.details)}P.details=S,this.levelLastLoaded=y,!this.startFragRequested&&(this.mainDetails||!S.live)&&this.setStartPosition(P.details,M),this.state===L.State.WAITING_TRACK&&!this.waitForCdnTuneIn(S)&&(this.state=L.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+y)}else this.cachedTrackLoadedData=d},m._handleFragmentLoadProgress=function(c){var d,n=c.frag,p=c.part,S=c.payload,y=this.config,P=this.trackId,M=this.levels;if(M){var B=M[P];console.assert(B,"Audio track is defined on fragment load progress");var G=B.details;console.assert(G,"Audio track details are defined on fragment load progress");var N=y.defaultAudioCodec||B.audioCodec||"mp4a.40.2",q=this.transmuxer;q||(q=this.transmuxer=new x.default(this.hls,_.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var H=this.initPTS[n.cc],V=null===(d=n.initSegment)||void 0===d?void 0:d.data;if(void 0!==H){var X=p?p.index:-1,te=new T.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,S.byteLength,X,-1!==X);q.push(S,V,N,"",n,p,G.totalduration,!1,te,H)}else this.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+G.startSN+" ,"+G.endSN+"],track "+P),(this.waitingData=this.waitingData||{frag:n,part:p,cache:new k.default,complete:!1}).cache.push(new Uint8Array(S)),this.waitingVideoCC=this.videoTrackCC,this.state=L.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},m._handleFragmentLoadComplete=function(c){this.waitingData?this.waitingData.complete=!0:s.prototype._handleFragmentLoadComplete.call(this,c)},m.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},m.onBufferCreated=function(c,d){var n=d.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),d.tracks.video&&(this.videoBuffer=d.tracks.video.buffer||null)},m.onFragBuffered=function(c,d){var S,n=d.frag,p=d.part;n.type===_.PlaylistLevelType.AUDIO?this.fragContextChanged(n)?this.warn("Fragment "+n.sn+(p?" p: "+p.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==n.sn&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(F.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,p)):this.loadedmetadata||n.type!==_.PlaylistLevelType.MAIN||null!==(S=this.videoBuffer||this.media)&&void 0!==S&&S.buffered.length&&(this.loadedmetadata=!0)},m.onError=function(c,d){if(d.type!==o.ErrorTypes.KEY_SYSTEM_ERROR)switch(d.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.FRAG_PARSING_ERROR:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.AUDIO,d);break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==L.State.ERROR&&this.state!==L.State.STOPPED&&(this.state=d.fatal?L.State.ERROR:L.State.IDLE,this.warn(d.details+" while loading frag, switching to "+this.state+" state"));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===d.parent&&(this.state===L.State.PARSING||this.state===L.State.PARSED)){var n=!0,p=this.getFwdBufferInfo(this.mediaBuffer,_.PlaylistLevelType.AUDIO);p&&p.len>.5&&(n=!this.reduceMaxBufferLength(p.len)),n&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(_.PlaylistLevelType.AUDIO,d)},m.onBufferFlushed=function(c,d){d.type===b.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===L.State.ENDED&&(this.state=L.State.IDLE))},m._handleTransmuxComplete=function(c){var d,n="audio",p=this.hls,S=c.remuxResult,y=c.chunkMeta,P=this.getCurrentContext(y);if(!P)return this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(y.level);var M=P.frag,B=P.part,G=P.level.details,N=S.audio,q=S.text,H=S.id3,V=S.initSegment;if(!this.fragContextChanged(M)&&G){if(this.state=L.State.PARSING,this.audioSwitch&&N&&this.completeAudioSwitch(),null!=V&&V.tracks&&(this._bufferInitSegment(V.tracks,M,y),p.trigger(F.Events.FRAG_PARSING_INIT_SEGMENT,{frag:M,id:n,tracks:V.tracks})),N){var Y=N.startPTS,X=N.endPTS,Z=N.startDTS,te=N.endDTS;B&&(B.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:Y,endPTS:X,startDTS:Z,endDTS:te}),M.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,Y,X,Z,te),this.bufferFragmentData(N,M,B,y)}if(null!=H&&null!==(d=H.samples)&&void 0!==d&&d.length){var re=g({id:n,frag:M,details:G},H);p.trigger(F.Events.FRAG_PARSING_METADATA,re)}if(q){var ne=g({id:n,frag:M,details:G},q);p.trigger(F.Events.FRAG_PARSING_USERDATA,ne)}}},m._bufferInitSegment=function(c,d,n){if(this.state===L.State.PARSING){c.video&&delete c.video;var p=c.audio;if(p){p.levelCodec=p.codec,p.id="audio",this.log("Init audio buffer, container:"+p.container+", codecs[parsed]=["+p.codec+"]"),this.hls.trigger(F.Events.BUFFER_CODECS,c);var S=p.initSegment;null!=S&&S.byteLength&&this.hls.trigger(F.Events.BUFFER_APPENDING,{type:"audio",frag:d,part:null,chunkMeta:n,parent:d.type,data:S}),this.tick()}}},m.loadFragment=function(c,d,n){var p=this.fragmentTracker.getState(c);this.fragCurrent=c,(this.audioSwitch||p===R.FragmentState.NOT_LOADED||p===R.FragmentState.PARTIAL)&&("initSegment"===c.sn?this._loadInitSegment(c,d):d.live&&!(0,U.isFiniteNumber)(this.initPTS[c.cc])?(this.log("Waiting for video PTS in continuity counter "+c.cc+" of live stream before loading audio fragment "+c.sn+" of level "+this.trackId),this.state=L.State.WAITING_INIT_PTS):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,c,d,n)))},m.completeAudioSwitch=function(){var c=this.hls,n=this.trackId;this.media&&(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,c.trigger(F.Events.AUDIO_TRACK_SWITCHED,{id:n})},h}(L.default)},"./src/controller/audio-track-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>C});var U=j("./src/events.ts"),L=j("./src/errors.ts"),F=j("./src/controller/base-playlist-controller.ts"),I=j("./src/types/loader.ts");function R(E,o){for(var g=0;g<o.length;g++){var f=o[g];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(E,_(f.key),f)}}function _(E){var o=function b(E,o){if("object"!=typeof E||null===E)return E;var g=E[Symbol.toPrimitive];if(void 0!==g){var f=g.call(E,o||"default");if("object"!=typeof f)return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(E)}(E,"string");return"symbol"==typeof o?o:String(o)}function x(E,o){return(x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,f){return g.__proto__=f,g})(E,o)}const C=function(E){function o(f){var u;return(u=E.call(this,f,"[audio-track-controller]")||this).tracks=[],u.groupId=null,u.tracksInGroup=[],u.trackId=-1,u.trackName="",u.selectDefaultTrack=!0,u.registerListeners(),u}!function k(E,o){E.prototype=Object.create(o.prototype),E.prototype.constructor=E,x(E,o)}(o,E);var g=o.prototype;return g.registerListeners=function(){var f=this.hls;f.on(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(U.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(U.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(U.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),f.on(U.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.on(U.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){var f=this.hls;f.off(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(U.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(U.Events.LEVEL_LOADING,this.onLevelLoading,this),f.off(U.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),f.off(U.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.off(U.Events.ERROR,this.onError,this)},g.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,E.prototype.destroy.call(this)},g.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},g.onManifestParsed=function(f,u){this.tracks=u.audioTracks||[]},g.onAudioTrackLoaded=function(f,u){var A=u.id,v=u.details,a=this.tracksInGroup[A];if(a){var s=a.details;a.details=u.details,this.log("audioTrack "+A+" loaded ["+v.startSN+"-"+v.endSN+"]"),A===this.trackId&&(this.retryCount=0,this.playlistLoaded(A,u,s))}else this.warn("Invalid audio track id "+A)},g.onLevelLoading=function(f,u){this.switchLevel(u.level)},g.onLevelSwitching=function(f,u){this.switchLevel(u.level)},g.switchLevel=function(f){var u=this.hls.levels[f];if(null!=u&&u.audioGroupIds){var A=u.audioGroupIds[u.urlId];if(this.groupId!==A){this.groupId=A;var v=this.tracks.filter(function(s){return!A||s.groupId===A});this.selectDefaultTrack&&!v.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=v;var a={audioTracks:v};this.log("Updating audio tracks, "+v.length+' track(s) found in "'+A+'" group-id'),this.hls.trigger(U.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},g.onError=function(f,u){E.prototype.onError.call(this,f,u),!u.fatal&&u.context&&u.context.type===I.PlaylistContextType.AUDIO_TRACK&&u.context.id===this.trackId&&u.context.groupId===this.groupId&&this.retryLoadingOrFail(u)},g.setAudioTrack=function(f){var u=this.tracksInGroup;if(f<0||f>=u.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var A=u[this.trackId];this.log("Now switching to audio-track index "+f);var v=u[f],a=v.id,s=v.groupId,h=void 0===s?"":s,m=v.name,c=v.type,d=v.url;if(this.trackId=f,this.trackName=m,this.selectDefaultTrack=!1,this.hls.trigger(U.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:h,name:m,type:c,url:d}),!v.details||v.details.live){var n=this.switchParams(v.url,A?.details);this.loadPlaylist(n)}}},g.selectInitialTrack=function(){console.assert(this.tracksInGroup.length,"Initial audio track should be selected when tracks are known");var A=this.findTrackId(this.trackName)||this.findTrackId();-1!==A?this.setAudioTrack(A):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(U.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},g.findTrackId=function(f){for(var u=this.tracksInGroup,A=0;A<u.length;A++){var v=u[A];if((!this.selectDefaultTrack||v.default)&&(!f||f===v.name))return v.id}return-1},g.loadPlaylist=function(f){E.prototype.loadPlaylist.call(this);var u=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(u)){var A=u.id,v=u.groupId,a=u.url;if(f)try{a=f.addDirectives(a)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+A),this.clearTimer(),this.hls.trigger(U.Events.AUDIO_TRACK_LOADING,{url:a,id:A,groupId:v,deliveryDirectives:f||null})}},function D(E,o,g){o&&R(E.prototype,o),g&&R(E,g),Object.defineProperty(E,"prototype",{writable:!1})}(o,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(f){this.selectDefaultTrack=!1,this.setAudioTrack(f)}}]),o}(F.default)},"./src/controller/base-playlist-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>R});var U=j("./src/types/level.ts"),L=j("./src/controller/level-helper.ts"),F=j("./src/utils/logger.ts"),I=j("./src/errors.ts"),R=function(){function D(b,k){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=F.logger.log.bind(F.logger,k+":"),this.warn=F.logger.warn.bind(F.logger,k+":"),this.hls=b}var _=D.prototype;return _.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},_.onError=function(b,k){k.fatal&&(k.type===I.ErrorTypes.NETWORK_ERROR||k.type===I.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},_.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},_.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},_.stopLoad=function(){this.canLoad=!1,this.clearTimer()},_.switchParams=function(b,k){var x=k?.renditionReports;if(x)for(var T=0;T<x.length;T++){var C=x[T],E=void 0;try{E=new self.URL(C.URI,k.url).href}catch(u){F.logger.warn("Could not construct new URL for Rendition Report: "+u),E=C.URI||""}if(E===b.slice(-E.length)){var o=parseInt(C["LAST-MSN"])||k?.lastPartSn,g=parseInt(C["LAST-PART"])||k?.lastPartIndex;if(this.hls.config.lowLatencyMode){var f=Math.min(k.age-k.partTarget,k.targetduration);g>=0&&f>k.partTarget&&(g+=1)}return new U.HlsUrlParameters(o,g>=0?g:void 0,U.HlsSkip.No)}}},_.loadPlaylist=function(b){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},_.shouldLoadTrack=function(b){return this.canLoad&&b&&!!b.url&&(!b.details||b.details.live)},_.playlistLoaded=function(b,k,x){var T=this,C=k.details,E=k.stats,o=self.performance.now(),g=E.loading.first?Math.max(0,o-E.loading.first):0;if(C.advancedDateTime=Date.now()-g,C.live||null!=x&&x.live){if(C.reloaded(x),x&&this.log("live playlist "+b+" "+(C.advanced?"REFRESHED "+C.lastPartSn+"-"+C.lastPartIndex:"MISSED")),x&&C.fragments.length>0&&(0,L.mergeDetails)(x,C),!this.canLoad||!C.live)return;var f,u=void 0,A=void 0;if(C.canBlockReload&&C.endSN&&C.advanced){var v=this.hls.config.lowLatencyMode,a=C.lastPartSn,s=C.endSN,h=C.lastPartIndex,c=a===s;-1!==h?(u=c?s+1:a,A=c?v?0:h:h+1):u=s+1;var n=C.age,S=Math.min(n+C.ageHeader-C.partTarget,1.5*C.targetduration);if(S>0){if(x&&S>x.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+x.tuneInGoal+" to: "+S+" with playlist age: "+C.age),S=0;else{var y=Math.floor(S/C.targetduration);u+=y,void 0!==A&&(A+=Math.round(S%C.targetduration/C.partTarget)),this.log("CDN Tune-in age: "+C.ageHeader+"s last advanced "+n.toFixed(2)+"s goal: "+S+" skip sn "+y+" to part "+A)}C.tuneInGoal=S}if(f=this.getDeliveryDirectives(C,k.deliveryDirectives,u,A),v||!c)return void this.loadPlaylist(f)}else f=this.getDeliveryDirectives(C,k.deliveryDirectives,u,A);var M=this.hls.mainForwardBufferInfo,N=(0,L.computeReloadInterval)(C,1e3*(C.edge-(M?M.end-M.len:0)));C.updated?o>this.requestScheduled+N&&(this.requestScheduled=E.loading.start):this.requestScheduled=-1,this.requestScheduled=void 0!==u&&C.canBlockReload?E.loading.first+N-(1e3*C.partTarget||1e3):(-1===this.requestScheduled?o:this.requestScheduled)+N;var q=this.requestScheduled-o;q=Math.max(0,q),this.log("reload live playlist "+b+" in "+Math.round(q)+" ms"),this.timer=self.setTimeout(function(){return T.loadPlaylist(f)},q)}else this.clearTimer()},_.getDeliveryDirectives=function(b,k,x,T){var C=(0,U.getSkipValue)(b,x);return null!=k&&k.skip&&b.deltaUpdateFailed&&(x=k.msn,T=k.part,C=U.HlsSkip.No),new U.HlsUrlParameters(x,T,C)},_.retryLoadingOrFail=function(b){var C,k=this,x=this.hls.config,T=this.retryCount<x.levelLoadingMaxRetry;if(T)if(this.requestScheduled=-1,this.retryCount++,b.details.indexOf("LoadTimeOut")>-1&&null!==(C=b.context)&&void 0!==C&&C.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+b.details+'"'),this.loadPlaylist();else{var E=Math.min(Math.pow(2,this.retryCount)*x.levelLoadingRetryDelay,x.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return k.loadPlaylist()},E),this.warn("retry playlist loading #"+this.retryCount+" in "+E+' ms after "'+b.details+'"')}else this.warn('cannot recover from error "'+b.details+'"'),this.clearTimer(),b.fatal=!0;return T},D}()},"./src/controller/base-stream-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{State:()=>c,default:()=>d});var U=j("./src/polyfills/number.ts"),L=j("./src/task-loop.ts"),F=j("./src/controller/fragment-tracker.ts"),I=j("./src/utils/buffer-helper.ts"),R=j("./src/utils/logger.ts"),D=j("./src/events.ts"),_=j("./src/errors.ts"),b=j("./src/types/transmuxer.ts"),k=j("./src/utils/mp4-tools.ts"),x=j("./src/utils/discontinuities.ts"),T=j("./src/controller/fragment-finders.ts"),C=j("./src/controller/level-helper.ts"),E=j("./src/loader/fragment-loader.ts"),o=j("./src/crypt/decrypter.ts"),g=j("./src/utils/time-ranges.ts"),f=j("./src/types/loader.ts");function u(n,p){for(var S=0;S<p.length;S++){var y=p[S];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(n,v(y.key),y)}}function v(n){var p=function a(n,p){if("object"!=typeof n||null===n)return n;var S=n[Symbol.toPrimitive];if(void 0!==S){var y=S.call(n,p||"default");if("object"!=typeof y)return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===p?String:Number)(n)}(n,"string");return"symbol"==typeof p?p:String(p)}function m(n,p){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,y){return S.__proto__=y,S})(n,p)}var c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},d=function(n){function p(y,P,M,B){var G;return(G=n.call(this)||this).hls=void 0,G.fragPrevious=null,G.fragCurrent=null,G.fragmentTracker=void 0,G.transmuxer=null,G._state=c.STOPPED,G.media=null,G.mediaBuffer=null,G.config=void 0,G.bitrateTest=!1,G.lastCurrentTime=0,G.nextLoadPosition=0,G.startPosition=0,G.loadedmetadata=!1,G.fragLoadError=0,G.retryDate=0,G.levels=null,G.fragmentLoader=void 0,G.keyLoader=void 0,G.levelLastLoaded=null,G.startFragRequested=!1,G.decrypter=void 0,G.initPTS=[],G.onvseeking=null,G.onvended=null,G.logPrefix="",G.log=void 0,G.warn=void 0,G.logPrefix=B,G.log=R.logger.log.bind(R.logger,B+":"),G.warn=R.logger.warn.bind(R.logger,B+":"),G.hls=y,G.fragmentLoader=new E.default(y.config),G.keyLoader=M,G.fragmentTracker=P,G.config=y.config,G.decrypter=new o.default(y.config),y.on(D.Events.LEVEL_SWITCHING,G.onLevelSwitching,function s(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(G)),G}!function h(n,p){n.prototype=Object.create(p.prototype),n.prototype.constructor=n,m(n,p)}(p,n);var S=p.prototype;return S.doTick=function(){this.onTickEnd()},S.onTickEnd=function(){},S.startLoad=function(y){},S.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var y=this.fragCurrent;y&&(y.abortRequests(),this.fragmentTracker.removeFragment(y)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED},S._streamEnded=function(y,P){if(P.live||y.nextStart||!y.end||!this.media)return!1;var M=P.partList;if(null!=M&&M.length){var B=M[M.length-1];return I.BufferHelper.isBuffered(this.media,B.start+B.duration/2)}return this.fragmentTracker.isEndListAppended(P.fragments[P.fragments.length-1].type)},S.getLevelDetails=function(){var y;if(this.levels&&null!==this.levelLastLoaded)return null===(y=this.levels[this.levelLastLoaded])||void 0===y?void 0:y.details},S.onMediaAttached=function(y,P){var M=this.media=this.mediaBuffer=P.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),M.addEventListener("seeking",this.onvseeking),M.addEventListener("ended",this.onvended);var B=this.config;this.levels&&B.autoStartLoad&&this.state===c.STOPPED&&this.startLoad(B.startPosition)},S.onMediaDetaching=function(){var y=this.media;null!=y&&y.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),y&&this.onvseeking&&this.onvended&&(y.removeEventListener("seeking",this.onvseeking),y.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},S.onMediaSeeking=function(){var y=this.config,P=this.fragCurrent,M=this.media,G=this.state,N=M?M.currentTime:0,q=I.BufferHelper.bufferInfo(this.mediaBuffer||M,N,y.maxBufferHole);if(this.log("media seeking to "+((0,U.isFiniteNumber)(N)?N.toFixed(3):N)+", state: "+G),this.state===c.ENDED)this.resetLoadingState();else if(P){var H=y.maxFragLookUpTolerance,V=P.start-H,Y=P.start+P.duration+H;if(!q.len||Y<q.start||V>q.end){var X=N>Y;(N<V||X)&&(X&&P.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),P.abortRequests()),this.resetLoadingState())}}M&&(this.lastCurrentTime=N),!this.loadedmetadata&&!q.len&&(this.nextLoadPosition=this.startPosition=N),this.tickImmediate()},S.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},S.onLevelSwitching=function(y,P){this.fragLoadError=0},S.onHandlerDestroying=function(){this.stopLoad(),n.prototype.onHandlerDestroying.call(this)},S.onHandlerDestroyed=function(){this.state=c.STOPPED,this.hls.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,n.prototype.onHandlerDestroyed.call(this)},S.loadFragment=function(y,P,M){this._loadFragForPlayback(y,P,M)},S._loadFragForPlayback=function(y,P,M){var B=this;this._doFragLoad(y,P,M,function(N){if(B.fragContextChanged(y))return B.warn("Fragment "+y.sn+(N.part?" p: "+N.part.index:"")+" of level "+y.level+" was dropped during download."),void B.fragmentTracker.removeFragment(y);y.stats.chunkCount++,B._handleFragmentLoadProgress(N)}).then(function(N){if(N){B.fragLoadError=0;var q=B.state;if(B.fragContextChanged(y))return void((q===c.FRAG_LOADING||!B.fragCurrent&&q===c.PARSING)&&(B.fragmentTracker.removeFragment(y),B.state=c.IDLE));"payload"in N&&(B.log("Loaded fragment "+y.sn+" of level "+y.level),B.hls.trigger(D.Events.FRAG_LOADED,N)),B._handleFragmentLoadComplete(N)}}).catch(function(N){B.state===c.STOPPED||B.state===c.ERROR||(B.warn(N),B.resetFragmentLoading(y))})},S.flushMainBuffer=function(y,P,M){if(void 0===M&&(M=null),y-P){var B={startOffset:y,endOffset:P,type:M};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,B)}},S._loadInitSegment=function(y,P){var M=this;this._doFragLoad(y,P).then(function(B){if(!B||M.fragContextChanged(y)||!M.levels)throw new Error("init load aborted");return B}).then(function(B){var G=M.hls,N=B.payload,q=y.decryptdata;if(N&&N.byteLength>0&&q&&q.key&&q.iv&&"AES-128"===q.method){var H=self.performance.now();return M.decrypter.decrypt(new Uint8Array(N),q.key.buffer,q.iv.buffer).then(function(V){var Y=self.performance.now();return G.trigger(D.Events.FRAG_DECRYPTED,{frag:y,payload:V,stats:{tstart:H,tdecrypt:Y}}),B.payload=V,B})}return B}).then(function(B){var G=M.fragCurrent,N=M.hls,q=M.levels;if(!q)throw new Error("init load aborted, missing levels");console.assert(q[y.level].details,"Level details are defined when init segment is loaded");var V=y.stats;M.state=c.IDLE,M.fragLoadError=0,y.data=new Uint8Array(B.payload),V.parsing.start=V.buffering.start=self.performance.now(),V.parsing.end=V.buffering.end=self.performance.now(),B.frag===G&&N.trigger(D.Events.FRAG_BUFFERED,{stats:V,frag:G,part:null,id:y.type}),M.tick()}).catch(function(B){M.state===c.STOPPED||M.state===c.ERROR||(M.warn(B),M.resetFragmentLoading(y))})},S.fragContextChanged=function(y){var P=this.fragCurrent;return!y||!P||y.level!==P.level||y.sn!==P.sn||y.urlId!==P.urlId},S.fragBufferedComplete=function(y,P){var M,B,G=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+y.type+" sn: "+y.sn+(P?" part: "+P.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+y.level+" "+(G?g.default.toString(I.BufferHelper.getBuffered(G)):"(detached)")),this.state=c.IDLE,G&&(!this.loadedmetadata&&y.type==f.PlaylistLevelType.MAIN&&G.buffered.length&&(null===(M=this.fragCurrent)||void 0===M?void 0:M.sn)===(null===(B=this.fragPrevious)||void 0===B?void 0:B.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},S.seekToStartPos=function(){},S._handleFragmentLoadComplete=function(y){var P=this.transmuxer;if(P){var M=y.frag,B=y.part,G=y.partsLoaded,N=!G||0===G.length||G.some(function(H){return!H}),q=new b.ChunkMetadata(M.level,M.sn,M.stats.chunkCount+1,0,B?B.index:-1,!N);P.flush(q)}},S._handleFragmentLoadProgress=function(y){},S._doFragLoad=function(y,P,M,B){var G,N=this;if(void 0===M&&(M=null),!this.levels)throw new Error("frag load aborted, missing levels");var q=null;if(!y.encrypted||null!==(G=y.decryptdata)&&void 0!==G&&G.key?!y.encrypted&&P.encryptedFragments.length&&this.keyLoader.loadClear(y,P.encryptedFragments):(this.log("Loading key for "+y.sn+" of ["+P.startSN+"-"+P.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+y.level),this.state=c.KEY_LOADING,this.fragCurrent=y,q=this.keyLoader.load(y).then(function(Z){if(!N.fragContextChanged(Z.frag))return N.hls.trigger(D.Events.KEY_LOADED,Z),Z}),this.hls.trigger(D.Events.KEY_LOADING,{frag:y}),this.throwIfFragContextChanged("KEY_LOADING")),M=Math.max(y.start,M||0),this.config.lowLatencyMode&&P){var H=P.partList;if(H&&B){M>y.end&&P.fragmentHint&&(y=P.fragmentHint);var V=this.getNextPart(H,y,M);if(V>-1){var Y=H[V];return this.log("Loading part sn: "+y.sn+" p: "+Y.index+" cc: "+y.cc+" of playlist ["+P.startSN+"-"+P.endSN+"] parts [0-"+V+"-"+(H.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+y.level+", target: "+parseFloat(M.toFixed(3))),this.nextLoadPosition=Y.start+Y.duration,this.state=c.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:y,part:H[V],targetBufferTime:M}),this.throwIfFragContextChanged("FRAG_LOADING parts"),q?q.then(function(Z){return!Z||N.fragContextChanged(Z.frag)?null:N.doFragPartsLoad(y,H,V,B)}).catch(function(Z){return N.handleFragLoadError(Z)}):this.doFragPartsLoad(y,H,V,B).catch(function(Z){return N.handleFragLoadError(Z)})}if(!y.url||this.loadedEndOfParts(H,M))return Promise.resolve(null)}}this.log("Loading fragment "+y.sn+" cc: "+y.cc+" "+(P?"of ["+P.startSN+"-"+P.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+y.level+", target: "+parseFloat(M.toFixed(3))),(0,U.isFiniteNumber)(y.sn)&&!this.bitrateTest&&(this.nextLoadPosition=y.start+y.duration),this.state=c.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:y,targetBufferTime:M}),this.throwIfFragContextChanged("FRAG_LOADING");var X=this.config.progressive;return X&&q?q.then(function(Z){return!Z||N.fragContextChanged(Z?.frag)?null:N.fragmentLoader.load(y,B)}).catch(function(Z){return N.handleFragLoadError(Z)}):Promise.all([this.fragmentLoader.load(y,X?B:void 0),q]).then(function(Z){var te=Z[0];return!X&&te&&B&&B(te),te}).catch(function(Z){return N.handleFragLoadError(Z)})},S.throwIfFragContextChanged=function(y){if(null===this.fragCurrent)throw new Error("frag load aborted, context changed in "+y)},S.doFragPartsLoad=function(y,P,M,B){var G=this;return new Promise(function(N,q){var H=[];!function Y(X){var Z=P[X];G.fragmentLoader.loadPart(y,Z,B).then(function(te){H[Z.index]=te;var re=te.part;G.hls.trigger(D.Events.FRAG_LOADED,te);var ne=P[X+1];if(!ne||ne.fragment!==y)return N({frag:y,part:re,partsLoaded:H});Y(X+1)}).catch(q)}(M)})},S.handleFragLoadError=function(y){if("data"in y){var P=y.data;y.data&&P.details===_.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(P.frag,P.part):this.hls.trigger(D.Events.ERROR,P)}else this.hls.trigger(D.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,err:y,fatal:!0});return null},S._handleTransmuxerFlush=function(y){var P=this.getCurrentContext(y);if(P&&this.state===c.PARSING){var M=P.frag,B=P.part,G=P.level,N=self.performance.now();M.stats.parsing.end=N,B&&(B.stats.parsing.end=N),this.updateLevelTiming(M,B,G,y.partial)}else!this.fragCurrent&&this.state!==c.STOPPED&&this.state!==c.ERROR&&(this.state=c.IDLE)},S.getCurrentContext=function(y){var P=this.levels,M=y.level,B=y.sn,G=y.part;if(!P||!P[M])return this.warn("Levels object was unset while buffering fragment "+B+" of level "+M+". The current chunk will not be buffered."),null;var N=P[M],q=G>-1?(0,C.getPartWith)(N,B,G):null,H=q?q.fragment:(0,C.getFragmentWithSN)(N,B,this.fragCurrent);return H?{frag:H,part:q,level:N}:null},S.bufferFragmentData=function(y,P,M,B){if(y&&this.state===c.PARSING){var G=y.data1,N=y.data2,q=G;G&&N&&(q=(0,k.appendUint8Array)(G,N)),q&&q.length&&(this.hls.trigger(D.Events.BUFFER_APPENDING,{type:y.type,frag:P,part:M,chunkMeta:B,parent:P.type,data:q}),y.dropped&&y.independent&&!M&&this.flushBufferGap(P))}},S.flushBufferGap=function(y){var P=this.media;if(P){if(!I.BufferHelper.isBuffered(P,P.currentTime))return void this.flushMainBuffer(0,y.start);var M=P.currentTime,B=I.BufferHelper.bufferInfo(P,M,0),N=Math.min(2*this.config.maxFragLookUpTolerance,.25*y.duration),q=Math.max(Math.min(y.start-N,B.end-N),M+N);y.start-q>N&&this.flushMainBuffer(q,y.start)}},S.getFwdBufferInfo=function(y,P){var M=this.config,B=this.getLoadPosition();if(!(0,U.isFiniteNumber)(B))return null;var G=I.BufferHelper.bufferInfo(y,B,M.maxBufferHole);if(0===G.len&&void 0!==G.nextStart){var N=this.fragmentTracker.getBufferedFrag(B,P);if(N&&G.nextStart<N.end)return I.BufferHelper.bufferInfo(y,B,Math.max(G.nextStart,M.maxBufferHole))}return G},S.getMaxBufferLength=function(y){var M,P=this.config;return M=y?Math.max(8*P.maxBufferSize/y,P.maxBufferLength):P.maxBufferLength,Math.min(M,P.maxMaxBufferLength)},S.reduceMaxBufferLength=function(y){var P=this.config;return P.maxMaxBufferLength>=(y||P.maxBufferLength)&&(P.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+P.maxMaxBufferLength+"s"),!0)},S.getNextFragment=function(y,P){var M=P.fragments,B=M.length;if(!B)return null;var q,G=this.config,N=M[0].start;if(P.live){var H=G.initialLiveManifestSize;if(B<H)return this.warn("Not enough fragments to start playback (have: "+B+", need: "+H+")"),null;!P.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(q=this.getInitialLiveFragment(P,M),this.startPosition=q?this.hls.liveSyncPosition||q.start:y)}else y<=N&&(q=M[0]);return q||(q=this.getFragmentAtPosition(y,G.lowLatencyMode?P.partEnd:P.fragmentEnd,P)),this.mapToInitFragWhenRequired(q)},S.mapToInitFragWhenRequired=function(y){return null==y||!y.initSegment||null!=y&&y.initSegment.data||this.bitrateTest?y:y.initSegment},S.getNextPart=function(y,P,M){for(var B=-1,G=!1,N=!0,q=0,H=y.length;q<H;q++){var V=y[q];if(N=N&&!V.independent,B>-1&&M<V.start)break;var Y=V.loaded;Y?B=-1:(G||V.independent||N)&&V.fragment===P&&(B=q),G=Y}return B},S.loadedEndOfParts=function(y,P){var M=y[y.length-1];return M&&P>M.start&&M.loaded},S.getInitialLiveFragment=function(y,P){var M=this.fragPrevious,B=null;if(M){if(y.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+M.programDateTime),B=(0,T.findFragmentByPDT)(P,M.endProgramDateTime,this.config.maxFragLookUpTolerance)),!B){var G=M.sn+1;if(G>=y.startSN&&G<=y.endSN){var N=P[G-y.startSN];M.cc===N.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(B=N).sn)}B||(B=(0,T.findFragWithCC)(P,M.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+B.sn)}}else{var q=this.hls.liveSyncPosition;null!==q&&(B=this.getFragmentAtPosition(q,this.bitrateTest?y.fragmentEnd:y.edge,y))}return B},S.getFragmentAtPosition=function(y,P,M){var X,B=this.config,G=this.fragPrevious,N=M.fragments,q=M.endSN,H=M.fragmentHint,V=B.maxFragLookUpTolerance,Y=!!(B.lowLatencyMode&&M.partList&&H);if(Y&&H&&!this.bitrateTest&&(N=N.concat(H),q=H.sn),X=y<P?(0,T.findFragmentByPTS)(G,N,y,y>P-V?0:V):N[N.length-1]){var te=X.sn-M.startSN;if(this.fragmentTracker.getState(X)===F.FragmentState.OK&&(G=X),G&&X.sn===G.sn&&!Y&&G&&X.level===G.level){var ne=N[te+1];X.sn<q&&this.fragmentTracker.getState(ne)!==F.FragmentState.OK?(this.log("SN "+X.sn+" just loaded, load next one: "+ne.sn),X=ne):X=null}}return X},S.synchronizeToLiveEdge=function(y){var P=this.config,M=this.media;if(M){var B=this.hls.liveSyncPosition,G=M.currentTime,q=y.edge,H=G>=y.fragments[0].start-P.maxFragLookUpTolerance&&G<=q;null!==B&&M.duration>B&&(G<B||!H)&&(!H&&M.readyState<4||G<q-(void 0!==P.liveMaxLatencyDuration?P.liveMaxLatencyDuration:P.liveMaxLatencyDurationCount*y.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=B),M.readyState&&(this.warn("Playback: "+G.toFixed(3)+" is located too far from the end of live sliding playlist: "+q+", reset currentTime to : "+B.toFixed(3)),M.currentTime=B))}},S.alignPlaylists=function(y,P){var B=this.levelLastLoaded,G=this.fragPrevious,N=null!==B?this.levels[B]:null,q=y.fragments.length;if(!q)return this.warn("No fragments in live playlist"),0;var H=y.fragments[0].start,V=!P,Y=y.alignedSliding&&(0,U.isFiniteNumber)(H);if(V||!Y&&!H){(0,x.alignStream)(G,N,y);var X=y.fragments[0].start;return this.log("Live playlist sliding: "+X.toFixed(2)+" start-sn: "+(P?P.startSN:"na")+"->"+y.startSN+" prev-sn: "+(G?G.sn:"na")+" fragments: "+q),X}return H},S.waitForCdnTuneIn=function(y){return y.live&&y.canBlockReload&&y.partTarget&&y.tuneInGoal>Math.max(y.partHoldBack,3*y.partTarget)},S.setStartPosition=function(y,P){var M=this.startPosition;if(M<P&&(M=-1),-1===M||-1===this.lastCurrentTime){var B=y.startTimeOffset;(0,U.isFiniteNumber)(B)?(M=P+B,B<0&&(M+=y.totalduration),M=Math.min(Math.max(P,M),P+y.totalduration),this.log("Start time offset "+B+" found in playlist, adjust startPosition to "+M),this.startPosition=M):y.live?M=this.hls.liveSyncPosition||P:this.startPosition=M=0,this.lastCurrentTime=M}this.nextLoadPosition=M},S.getLoadPosition=function(){var y=this.media,P=0;return this.loadedmetadata&&y?P=y.currentTime:this.nextLoadPosition&&(P=this.nextLoadPosition),P},S.handleFragLoadAborted=function(y,P){this.transmuxer&&"initSegment"!==y.sn&&y.stats.aborted&&(this.warn("Fragment "+y.sn+(P?" part"+P.index:"")+" of level "+y.level+" was aborted"),this.resetFragmentLoading(y))},S.resetFragmentLoading=function(y){(!this.fragCurrent||!this.fragContextChanged(y)&&this.state!==c.FRAG_LOADING_WAITING_RETRY)&&(this.state=c.IDLE)},S.onFragmentOrKeyLoadError=function(y,P){if(P.fatal)return this.stopLoad(),void(this.state=c.ERROR);var M=this.config;if(P.chunkMeta){var B=this.getCurrentContext(P.chunkMeta);B&&(P.frag=B.frag,P.levelRetry=!0,this.fragLoadError=M.fragLoadingMaxRetry)}var G=P.frag;if(G&&G.type===y){var N=this.fragCurrent;if(console.assert(N&&G.sn===N.sn&&G.level===N.level&&G.urlId===N.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=M.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var q=Math.min(Math.pow(2,this.fragLoadError)*M.fragLoadingRetryDelay,M.fragLoadingMaxRetryTimeout);this.warn("Fragment "+G.sn+" of "+y+" "+G.level+" failed to load, retrying in "+q+"ms"),this.retryDate=self.performance.now()+q,this.fragLoadError++,this.state=c.FRAG_LOADING_WAITING_RETRY}else P.levelRetry?(y===f.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=c.IDLE):(R.logger.error(P.details+" reaches max retry, redispatch as fatal ..."),P.fatal=!0,this.hls.stopLoad(),this.state=c.ERROR)}},S.afterBufferFlushed=function(y,P,M){if(y){var B=I.BufferHelper.getBuffered(y);this.fragmentTracker.detectEvictedFragments(P,B,M),this.state===c.ENDED&&this.resetLoadingState()}},S.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE},S.resetStartWhenNotLoaded=function(y){if(!this.loadedmetadata){this.startFragRequested=!1;var P=this.levels?this.levels[y].details:null;null!=P&&P.live?(this.startPosition=-1,this.setStartPosition(P,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},S.updateLevelTiming=function(y,P,M,B){var G=this,N=M.details;console.assert(!!N,"level.details must be defined"),Object.keys(y.elementaryStreams).reduce(function(H,V){var Y=y.elementaryStreams[V];if(Y){var X=Y.endPTS-Y.startPTS;if(X<=0)return G.warn("Could not parse fragment "+y.sn+" "+V+" duration reliably ("+X+")"),H||!1;var Z=B?0:(0,C.updateFragPTSDTS)(N,y,Y.startPTS,Y.endPTS,Y.startDTS,Y.endDTS);return G.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:N,level:M,drift:Z,type:V,frag:y,start:Y.startPTS,end:Y.endPTS}),!0}return H},!1)||(this.warn("Found no media in fragment "+y.sn+" of level "+M.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=c.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:y,part:P})},S.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function A(n,p,S){p&&u(n.prototype,p),S&&u(n,S),Object.defineProperty(n,"prototype",{writable:!1})}(p,[{key:"state",get:function(){return this._state},set:function(y){var P=this._state;P!==y&&(this._state=y,this.log(P+"->"+y))}}]),p}(L.default)},"./src/controller/buffer-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>T});var U=j("./src/polyfills/number.ts"),L=j("./src/events.ts"),F=j("./src/utils/logger.ts"),I=j("./src/errors.ts"),R=j("./src/utils/buffer-helper.ts"),D=j("./src/utils/mediasource-helper.ts"),_=j("./src/loader/fragment.ts"),b=j("./src/controller/buffer-operation-queue.ts"),k=(0,D.getMediaSource)(),x=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function C(o){var g=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var f=g.hls,u=g.media,A=g.mediaSource;F.logger.log("[buffer-controller]: Media source opened"),u&&(g.updateMediaElementDuration(),f.trigger(L.Events.MEDIA_ATTACHED,{media:u})),A&&A.removeEventListener("sourceopen",g._onMediaSourceOpen),g.checkPendingTracks()},this._onMediaSourceClose=function(){F.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){F.logger.log("[buffer-controller]: Media source ended")},this.hls=o,this._initSourceBuffer(),this.registerListeners()}var E=C.prototype;return E.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},E.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},E.registerListeners=function(){var o=this.hls;o.on(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(L.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(L.Events.BUFFER_RESET,this.onBufferReset,this),o.on(L.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.on(L.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.on(L.Events.BUFFER_EOS,this.onBufferEos,this),o.on(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.on(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.on(L.Events.FRAG_PARSED,this.onFragParsed,this),o.on(L.Events.FRAG_CHANGED,this.onFragChanged,this)},E.unregisterListeners=function(){var o=this.hls;o.off(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),o.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(L.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(L.Events.BUFFER_RESET,this.onBufferReset,this),o.off(L.Events.BUFFER_APPENDING,this.onBufferAppending,this),o.off(L.Events.BUFFER_CODECS,this.onBufferCodecs,this),o.off(L.Events.BUFFER_EOS,this.onBufferEos,this),o.off(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),o.off(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this),o.off(L.Events.FRAG_PARSED,this.onFragParsed,this),o.off(L.Events.FRAG_CHANGED,this.onFragChanged,this)},E._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new b.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},E.onManifestParsed=function(o,g){var f=2;(g.audio&&!g.video||!g.altAudio)&&(f=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=f,this.details=null,F.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},E.onMediaAttaching=function(o,g){var f=this.media=g.media;if(f&&k){var u=this.mediaSource=new k;u.addEventListener("sourceopen",this._onMediaSourceOpen),u.addEventListener("sourceended",this._onMediaSourceEnded),u.addEventListener("sourceclose",this._onMediaSourceClose),f.src=self.URL.createObjectURL(u),this._objectUrl=f.src}},E.onMediaDetaching=function(){var o=this.media,g=this.mediaSource,f=this._objectUrl;if(g){if(F.logger.log("[buffer-controller]: media source detaching"),"open"===g.readyState)try{g.endOfStream()}catch(u){F.logger.warn("[buffer-controller]: onMediaDetaching: "+u.message+" while calling endOfStream")}this.onBufferReset(),g.removeEventListener("sourceopen",this._onMediaSourceOpen),g.removeEventListener("sourceended",this._onMediaSourceEnded),g.removeEventListener("sourceclose",this._onMediaSourceClose),o&&(f&&self.URL.revokeObjectURL(f),o.src===f?(o.removeAttribute("src"),o.load()):F.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(L.Events.MEDIA_DETACHED,void 0)},E.onBufferReset=function(){var o=this;this.getSourceBufferTypes().forEach(function(g){var f=o.sourceBuffer[g];try{f&&(o.removeBufferListeners(g),o.mediaSource&&o.mediaSource.removeSourceBuffer(f),o.sourceBuffer[g]=void 0)}catch(u){F.logger.warn("[buffer-controller]: Failed to reset the "+g+" buffer",u)}}),this._initSourceBuffer()},E.onBufferCodecs=function(o,g){var f=this,u=this.getSourceBufferTypes().length;Object.keys(g).forEach(function(A){if(u){var v=f.tracks[A];if(v&&"function"==typeof v.buffer.changeType){var a=g[A],s=a.id,h=a.codec,m=a.levelCodec,c=a.container,d=a.metadata,n=(v.levelCodec||v.codec).replace(x,"$1"),p=(m||h).replace(x,"$1");n!==p&&(f.appendChangeType(A,c+";codecs="+(m||h)),F.logger.log("[buffer-controller]: switching codec "+n+" to "+p),f.tracks[A]={buffer:v.buffer,codec:h,container:c,levelCodec:m,metadata:d,id:s})}}else f.pendingTracks[A]=g[A]}),!u&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},E.appendChangeType=function(o,g){var f=this,u=this.operationQueue,A={execute:function(){var v=f.sourceBuffer[o];v&&(F.logger.log("[buffer-controller]: changing "+o+" sourceBuffer type to "+g),v.changeType(g)),u.shiftAndExecuteNext(o)},onStart:function(){},onComplete:function(){},onError:function(v){F.logger.warn("[buffer-controller]: Failed to change "+o+" SourceBuffer type",v)}};u.append(A,o)},E.onBufferAppending=function(o,g){var f=this,u=this.hls,A=this.operationQueue,v=this.tracks,a=g.data,s=g.type,h=g.frag,m=g.part,c=g.chunkMeta,d=c.buffering[s],n=self.performance.now();d.start=n;var p=h.stats.buffering,S=m?m.stats.buffering:null;0===p.start&&(p.start=n),S&&0===S.start&&(S.start=n);var P=!1;"audio"===s&&"audio/mpeg"===v.audio?.container&&(P=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var M=h.start;A.append({execute:function(){if(d.executeStart=self.performance.now(),P){var G=f.sourceBuffer[s];if(G){var N=M-G.timestampOffset;Math.abs(N)>=.1&&(F.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+M+" (delta: "+N+") sn: "+h.sn+")"),G.timestampOffset=M)}}f.appendExecutor(a,s)},onStart:function(){},onComplete:function(){var G=self.performance.now();d.executeEnd=d.end=G,0===p.first&&(p.first=G),S&&0===S.first&&(S.first=G);var N=f.sourceBuffer,q={};for(var H in N)q[H]=R.BufferHelper.getBuffered(N[H]);f.appendError=0,f.hls.trigger(L.Events.BUFFER_APPENDED,{type:s,frag:h,part:m,chunkMeta:c,parent:h.type,timeRanges:q})},onError:function(G){F.logger.error("[buffer-controller]: Error encountered while trying to append to the "+s+" SourceBuffer",G);var N={type:I.ErrorTypes.MEDIA_ERROR,parent:h.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:G,fatal:!1};G.code===DOMException.QUOTA_EXCEEDED_ERR?N.details=I.ErrorDetails.BUFFER_FULL_ERROR:(f.appendError++,N.details=I.ErrorDetails.BUFFER_APPEND_ERROR,f.appendError>u.config.appendErrorMaxRetry&&(F.logger.error("[buffer-controller]: Failed "+u.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),N.fatal=!0,u.stopLoad())),u.trigger(L.Events.ERROR,N)}},s)},E.onBufferFlushing=function(o,g){var f=this,u=this.operationQueue,A=function(v){return{execute:f.removeExecutor.bind(f,v,g.startOffset,g.endOffset),onStart:function(){},onComplete:function(){f.hls.trigger(L.Events.BUFFER_FLUSHED,{type:v})},onError:function(a){F.logger.warn("[buffer-controller]: Failed to remove from "+v+" SourceBuffer",a)}}};g.type?u.append(A(g.type),g.type):this.getSourceBufferTypes().forEach(function(v){u.append(A(v),v)})},E.onFragParsed=function(o,g){var f=this,u=g.frag,A=g.part,v=[],a=A?A.elementaryStreams:u.elementaryStreams;a[_.ElementaryStreamTypes.AUDIOVIDEO]?v.push("audiovideo"):(a[_.ElementaryStreamTypes.AUDIO]&&v.push("audio"),a[_.ElementaryStreamTypes.VIDEO]&&v.push("video")),0===v.length&&F.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+u.type+" level: "+u.level+" sn: "+u.sn),this.blockBuffers(function(){var h=self.performance.now();u.stats.buffering.end=h,A&&(A.stats.buffering.end=h),f.hls.trigger(L.Events.FRAG_BUFFERED,{frag:u,part:A,stats:A?A.stats:u.stats,id:u.type})},v)},E.onFragChanged=function(o,g){this.flushBackBuffer()},E.onBufferEos=function(o,g){var f=this;this.getSourceBufferTypes().reduce(function(A,v){var a=f.sourceBuffer[v];return a&&(!g.type||g.type===v)&&(a.ending=!0,a.ended||(a.ended=!0,F.logger.log("[buffer-controller]: "+v+" sourceBuffer now EOS"))),A&&!(a&&!a.ended)},!0)&&(F.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){f.getSourceBufferTypes().forEach(function(v){var a=f.sourceBuffer[v];a&&(a.ending=!1)});var A=f.mediaSource;A&&"open"===A.readyState?(F.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),A.endOfStream()):A&&F.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+A.readyState)}))},E.onLevelUpdated=function(o,g){var f=g.details;!f.fragments.length||(this.details=f,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},E.flushBackBuffer=function(){var o=this.hls,g=this.details,f=this.media,u=this.sourceBuffer;if(f&&null!==g){var A=this.getSourceBufferTypes();if(A.length){var v=g.live&&null!==o.config.liveBackBufferLength?o.config.liveBackBufferLength:o.config.backBufferLength;if((0,U.isFiniteNumber)(v)&&!(v<0)){var a=f.currentTime,s=g.levelTargetDuration,h=Math.max(v,s),m=Math.floor(a/s)*s-h;A.forEach(function(c){var d=u[c];if(d){var n=R.BufferHelper.getBuffered(d);if(n.length>0&&m>n.start(0)){if(o.trigger(L.Events.BACK_BUFFER_REACHED,{bufferEnd:m}),g.live)o.trigger(L.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:m});else if(d.ended&&n.end(n.length-1)-a<2*s)return void F.logger.info("[buffer-controller]: Cannot flush "+c+" back buffer while SourceBuffer is in ended state");o.trigger(L.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:m,type:c})}}})}}}},E.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var o=this.details,g=this.hls,u=this.mediaSource,A=o.fragments[0].start+o.totalduration,v=this.media.duration,a=(0,U.isFiniteNumber)(u.duration)?u.duration:0;o.live&&g.config.liveDurationInfinity?(F.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),u.duration=1/0,this.updateSeekableRange(o)):(A>a&&A>v||!(0,U.isFiniteNumber)(v))&&(F.logger.log("[buffer-controller]: Updating Media Source duration to "+A.toFixed(3)),u.duration=A)}},E.updateSeekableRange=function(o){var g=this.mediaSource,f=o.fragments;if(f.length&&o.live&&null!=g&&g.setLiveSeekableRange){var A=Math.max(0,f[0].start),v=Math.max(A,A+o.totalduration);g.setLiveSeekableRange(A,v)}},E.checkPendingTracks=function(){var o=this.bufferCodecEventsExpected,g=this.operationQueue,f=this.pendingTracks,u=Object.keys(f).length;if(u&&!o||2===u){this.createSourceBuffers(f),this.pendingTracks={};var A=this.getSourceBufferTypes();if(0===A.length)return void this.hls.trigger(L.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});A.forEach(function(v){g.executeNext(v)})}},E.createSourceBuffers=function(o){var g=this.sourceBuffer,f=this.mediaSource;if(!f)throw Error("createSourceBuffers called when mediaSource was null");var u=0;for(var A in o)if(!g[A]){var v=o[A];if(!v)throw Error("source buffer exists for track "+A+", however track does not");var a=v.levelCodec||v.codec,s=v.container+";codecs="+a;F.logger.log("[buffer-controller]: creating sourceBuffer("+s+")");try{var h=g[A]=f.addSourceBuffer(s),m=A;this.addBufferListener(m,"updatestart",this._onSBUpdateStart),this.addBufferListener(m,"updateend",this._onSBUpdateEnd),this.addBufferListener(m,"error",this._onSBUpdateError),this.tracks[A]={buffer:h,codec:a,container:v.container,levelCodec:v.levelCodec,metadata:v.metadata,id:v.id},u++}catch(c){F.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+c.message),this.hls.trigger(L.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,mimeType:s})}}u&&this.hls.trigger(L.Events.BUFFER_CREATED,{tracks:this.tracks})},E._onSBUpdateStart=function(o){this.operationQueue.current(o).onStart()},E._onSBUpdateEnd=function(o){var g=this.operationQueue;g.current(o).onComplete(),g.shiftAndExecuteNext(o)},E._onSBUpdateError=function(o,g){F.logger.error("[buffer-controller]: "+o+" SourceBuffer error",g),this.hls.trigger(L.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var f=this.operationQueue.current(o);f&&f.onError(g)},E.removeExecutor=function(o,g,f){var u=this.media,A=this.mediaSource,v=this.operationQueue,s=this.sourceBuffer[o];if(!u||!A||!s)return F.logger.warn("[buffer-controller]: Attempting to remove from the "+o+" SourceBuffer, but it does not exist"),void v.shiftAndExecuteNext(o);var h=(0,U.isFiniteNumber)(u.duration)?u.duration:1/0,m=(0,U.isFiniteNumber)(A.duration)?A.duration:1/0,c=Math.max(0,g),d=Math.min(f,h,m);d>c&&!s.ending?(s.ended=!1,F.logger.log("[buffer-controller]: Removing ["+c+","+d+"] from the "+o+" SourceBuffer"),console.assert(!s.updating,o+" sourceBuffer must not be updating"),s.remove(c,d)):v.shiftAndExecuteNext(o)},E.appendExecutor=function(o,g){var f=this.operationQueue,A=this.sourceBuffer[g];if(!A)return F.logger.warn("[buffer-controller]: Attempting to append to the "+g+" SourceBuffer, but it does not exist"),void f.shiftAndExecuteNext(g);A.ended=!1,console.assert(!A.updating,g+" sourceBuffer must not be updating"),A.appendBuffer(o)},E.blockBuffers=function(o,g){var f=this;if(void 0===g&&(g=this.getSourceBufferTypes()),!g.length)return F.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(o);var u=this.operationQueue,A=g.map(function(v){return u.appendBlocker(v)});Promise.all(A).then(function(){o(),g.forEach(function(v){var a=f.sourceBuffer[v];(!a||!a.updating)&&u.shiftAndExecuteNext(v)})})},E.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},E.addBufferListener=function(o,g,f){var u=this.sourceBuffer[o];if(u){var A=f.bind(this,o);this.listeners[o].push({event:g,listener:A}),u.addEventListener(g,A)}},E.removeBufferListeners=function(o){var g=this.sourceBuffer[o];!g||this.listeners[o].forEach(function(f){g.removeEventListener(f.event,f.listener)})},C}()},"./src/controller/buffer-operation-queue.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>L});var U=j("./src/utils/logger.ts"),L=function(){function F(R){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=R}var I=F.prototype;return I.append=function(R,D){var _=this.queues[D];_.push(R),1===_.length&&this.buffers[D]&&this.executeNext(D)},I.insertAbort=function(R,D){this.queues[D].unshift(R),this.executeNext(D)},I.appendBlocker=function(R){var D,_=new Promise(function(k){D=k});return this.append({execute:D,onStart:function(){},onComplete:function(){},onError:function(){}},R),_},I.executeNext=function(R){var b=this.buffers[R],k=this.queues[R];if(k.length){var x=k[0];try{x.execute()}catch(T){U.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),x.onError(T),(!b||!b.updating)&&(k.shift(),this.executeNext(R))}}},I.shiftAndExecuteNext=function(R){this.queues[R].shift(),this.executeNext(R)},I.current=function(R){return this.queues[R][0]},F}()},"./src/controller/cap-level-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>_});var U=j("./src/events.ts");function L(b,k){for(var x=0;x<k.length;x++){var T=k[x];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(b,I(T.key),T)}}function I(b){var k=function R(b,k){if("object"!=typeof b||null===b)return b;var x=b[Symbol.toPrimitive];if(void 0!==x){var T=x.call(b,k||"default");if("object"!=typeof T)return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===k?String:Number)(b)}(b,"string");return"symbol"==typeof k?k:String(k)}const _=function(){function b(x){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=x,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var k=b.prototype;return k.setStreamController=function(x){this.streamController=x},k.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},k.registerListeners=function(){var x=this.hls;x.on(U.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),x.on(U.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),x.on(U.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.on(U.Events.BUFFER_CODECS,this.onBufferCodecs,this),x.on(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},k.unregisterListener=function(){var x=this.hls;x.off(U.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),x.off(U.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),x.off(U.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.off(U.Events.BUFFER_CODECS,this.onBufferCodecs,this),x.off(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},k.onFpsDropLevelCapping=function(x,T){b.isLevelAllowed(T.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(T.droppedLevel)},k.onMediaAttaching=function(x,T){this.media=T.media instanceof HTMLVideoElement?T.media:null,this.clientRect=null},k.onManifestParsed=function(x,T){var C=this.hls;this.restrictedLevels=[],this.firstLevel=T.firstLevel,C.config.capLevelToPlayerSize&&T.video&&this.startCapping()},k.onBufferCodecs=function(x,T){this.hls.config.capLevelToPlayerSize&&T.video&&this.startCapping()},k.onMediaDetaching=function(){this.stopCapping()},k.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var x=this.hls.levels;if(x.length){var T=this.hls;T.autoLevelCapping=this.getMaxLevel(x.length-1),T.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=T.autoLevelCapping}}},k.getMaxLevel=function(x){var T=this,C=this.hls.levels;if(!C.length)return-1;var E=C.filter(function(o,g){return b.isLevelAllowed(g,T.restrictedLevels)&&g<=x});return this.clientRect=null,b.getMaxLevelByMediaSize(E,this.mediaWidth,this.mediaHeight)},k.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},k.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},k.getDimensions=function(){if(this.clientRect)return this.clientRect;var x=this.media,T={width:0,height:0};if(x){var C=x.getBoundingClientRect();T.width=C.width,T.height=C.height,!T.width&&!T.height&&(T.width=C.right-C.left||x.width||0,T.height=C.bottom-C.top||x.height||0)}return this.clientRect=T,T},b.isLevelAllowed=function(x,T){return void 0===T&&(T=[]),-1===T.indexOf(x)},b.getMaxLevelByMediaSize=function(x,T,C){if(!x||!x.length)return-1;for(var o=x.length-1,g=0;g<x.length;g+=1){var f=x[g];if((f.width>=T||f.height>=C)&&(u=f,!(A=x[g+1])||u.width!==A.width||u.height!==A.height)){o=g;break}}var u,A;return o},function F(b,k,x){k&&L(b.prototype,k),x&&L(b,x),Object.defineProperty(b,"prototype",{writable:!1})}(b,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var x=1;if(!this.hls.config.ignoreDevicePixelRatio)try{x=self.devicePixelRatio}catch{}return x}}]),b}()},"./src/controller/cmcd-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>E});var U=j("./src/events.ts"),L=j("./src/types/cmcd.ts"),F=j("./src/utils/buffer-helper.ts"),I=j("./src/utils/logger.ts");function R(o,g){for(var f=0;f<g.length;f++){var u=g[f];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,_(u.key),u)}}function D(o,g,f){return g&&R(o.prototype,g),f&&R(o,f),Object.defineProperty(o,"prototype",{writable:!1}),o}function _(o){var g=function b(o,g){if("object"!=typeof o||null===o)return o;var f=o[Symbol.toPrimitive];if(void 0!==f){var u=f.call(o,g||"default");if("object"!=typeof u)return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(o)}(o,"string");return"symbol"==typeof g?g:String(g)}function k(o,g){var f=typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(f)return(f=f.call(o)).next.bind(f);if(Array.isArray(o)||(f=function x(o,g){if(o){if("string"==typeof o)return T(o,g);var f=Object.prototype.toString.call(o).slice(8,-1);if("Object"===f&&o.constructor&&(f=o.constructor.name),"Map"===f||"Set"===f)return Array.from(o);if("Arguments"===f||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return T(o,g)}}(o))||g&&o&&"number"==typeof o.length){f&&(o=f);var u=0;return function(){return u>=o.length?{done:!0}:{done:!1,value:o[u++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(o,g){(null==g||g>o.length)&&(g=o.length);for(var f=0,u=new Array(g);f<g;f++)u[f]=o[f];return u}function C(){return C=Object.assign?Object.assign.bind():function(o){for(var g=1;g<arguments.length;g++){var f=arguments[g];for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&(o[u]=f[u])}return o},C.apply(this,arguments)}var E=function(){function o(f){var u=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){u.initialized&&(u.starved=!0),u.buffering=!0},this.onPlaying=function(){u.initialized||(u.initialized=!0),u.buffering=!1},this.applyPlaylistData=function(a){try{u.apply(a,{ot:L.CMCDObjectType.MANIFEST,su:!u.initialized})}catch(s){I.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(a){try{var s=a.frag,h=u.hls.levels[s.level],m=u.getObjectType(s),c={d:1e3*s.duration,ot:m};(m===L.CMCDObjectType.VIDEO||m===L.CMCDObjectType.AUDIO||m==L.CMCDObjectType.MUXED)&&(c.br=h.bitrate/1e3,c.tb=u.getTopBandwidth(m)/1e3,c.bl=u.getBufferLength(m)),u.apply(a,c)}catch(d){I.logger.warn("Could not generate segment CMCD data.",d)}},this.hls=f;var A=this.config=f.config,v=A.cmcd;null!=v&&(A.pLoader=this.createPlaylistLoader(),A.fLoader=this.createFragmentLoader(),this.sid=v.sessionId||o.uuid(),this.cid=v.contentId,this.useHeaders=!0===v.useHeaders,this.registerListeners())}var g=o.prototype;return g.registerListeners=function(){var f=this.hls;f.on(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(U.Events.MEDIA_DETACHED,this.onMediaDetached,this),f.on(U.Events.BUFFER_CREATED,this.onBufferCreated,this)},g.unregisterListeners=function(){var f=this.hls;f.off(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(U.Events.MEDIA_DETACHED,this.onMediaDetached,this),f.off(U.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},g.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},g.onMediaAttached=function(f,u){this.media=u.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},g.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},g.onBufferCreated=function(f,u){var A,v;this.audioBuffer=null===(A=u.tracks.audio)||void 0===A?void 0:A.buffer,this.videoBuffer=null===(v=u.tracks.video)||void 0===v?void 0:v.buffer},g.createData=function(){var f;return{v:L.CMCDVersion,sf:L.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(f=this.media)||void 0===f?void 0:f.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},g.apply=function(f,u){if(void 0===u&&(u={}),C(u,this.createData()),this.starved&&(u.ot===L.CMCDObjectType.INIT||u.ot===L.CMCDObjectType.VIDEO||u.ot===L.CMCDObjectType.MUXED)&&(u.bs=!0,u.su=!0,this.starved=!1),null==u.su&&(u.su=this.buffering),this.useHeaders){var v=o.toHeaders(u);if(!Object.keys(v).length)return;f.headers||(f.headers={}),C(f.headers,v)}else{var a=o.toQuery(u);if(!a)return;f.url=o.appendQueryToUri(f.url,a)}},g.getObjectType=function(f){var u=f.type;return"subtitle"===u?L.CMCDObjectType.TIMED_TEXT:"initSegment"===f.sn?L.CMCDObjectType.INIT:"audio"===u?L.CMCDObjectType.AUDIO:"main"===u?this.hls.audioTracks.length?L.CMCDObjectType.VIDEO:L.CMCDObjectType.MUXED:void 0},g.getTopBandwidth=function(f){var A,u=0,v=this.hls;if(f===L.CMCDObjectType.AUDIO)A=v.audioTracks;else{var a=v.maxAutoLevel;A=v.levels.slice(0,a>-1?a+1:v.levels.length)}for(var m,h=k(A);!(m=h()).done;){var c=m.value;c.bitrate>u&&(u=c.bitrate)}return u>0?u:NaN},g.getBufferLength=function(f){var u=this.hls.media,A=f===L.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return A&&u?1e3*F.BufferHelper.bufferInfo(A,u.currentTime,this.config.maxBufferHole).len:NaN},g.createPlaylistLoader=function(){var u=this.applyPlaylistData,A=this.config.pLoader||this.config.loader;return function(){function v(s){this.loader=void 0,this.loader=new A(s)}var a=v.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(s,h,m){u(s),this.loader.load(s,h,m)},D(v,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),v}()},g.createFragmentLoader=function(){var u=this.applyFragmentData,A=this.config.fLoader||this.config.loader;return function(){function v(s){this.loader=void 0,this.loader=new A(s)}var a=v.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(s,h,m){u(s),this.loader.load(s,h,m)},D(v,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),v}()},o.uuid=function(){var f=URL.createObjectURL(new Blob),u=f.toString();return URL.revokeObjectURL(f),u.slice(u.lastIndexOf("/")+1)},o.serialize=function(f){for(var d,u=[],v=function(M){return Math.round(M)},a=function(M){return 100*v(M/100)},h={br:v,d:v,bl:a,dl:a,mtp:a,nor:function(M){return encodeURIComponent(M)},rtp:a,tb:v},c=k(Object.keys(f||{}).sort());!(d=c()).done;){var n=d.value,p=f[n];if(M=p,!(Number.isNaN(M)||null==M||""===M||!1===M||"v"===n&&1===p||"pr"==n&&1===p)){var S=h[n];S&&(p=S(p));var P,y=typeof p;P="ot"===n||"sf"===n||"st"===n?n+"="+p:"boolean"===y?n:"number"===y?n+"="+p:n+"="+JSON.stringify(p),u.push(P)}}var M;return u.join(",")},o.toHeaders=function(f){for(var A={},v=["Object","Request","Session","Status"],a=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},h=0,m=Object.keys(f);h<m.length;h++){var c=m[h];a[null!=s[c]?s[c]:1][c]=f[c]}for(var n=0;n<a.length;n++){var p=o.serialize(a[n]);p&&(A["CMCD-"+v[n]]=p)}return A},o.toQuery=function(f){return"CMCD="+encodeURIComponent(o.serialize(f))},o.appendQueryToUri=function(f,u){if(!u)return f;var A=f.includes("?")?"&":"?";return""+f+A+u},o}()},"./src/controller/eme-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>m});var U=j("./src/events.ts"),L=j("./src/errors.ts"),F=j("./src/utils/logger.ts"),I=j("./src/utils/mediakeys-helper.ts"),R=j("./src/utils/keysystem-util.ts"),D=j("./src/utils/numeric-encoding-utils.ts"),_=j("./src/loader/level-key.ts"),b=j("./src/utils/hex.ts"),k=j("./src/utils/mp4-tools.ts"),x=j("./node_modules/eventemitter3/index.js"),T=j.n(x);function E(c){var d="function"==typeof Map?new Map:void 0;return E=function(n){if(null===n||!function f(c){return-1!==Function.toString.call(c).indexOf("[native code]")}(n))return n;if("function"!=typeof n)throw new TypeError("Super expression must either be null or a function");if(typeof d<"u"){if(d.has(n))return d.get(n);d.set(n,p)}function p(){return o(n,arguments,A(this).constructor)}return p.prototype=Object.create(n.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),u(p,n)},E(c)}function o(c,d,n){return(o=function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(p,S,y){var P=[null];P.push.apply(P,S);var B=new(Function.bind.apply(p,P));return y&&u(B,y.prototype),B}).apply(null,arguments)}function u(c,d){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,p){return n.__proto__=p,n})(c,d)}function A(c){return(A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)})(c)}var a="[eme]",s=function(){function c(n){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=c.CDMCleanupPromise?[c.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=F.logger.debug.bind(F.logger,a),this.log=F.logger.log.bind(F.logger,a),this.warn=F.logger.warn.bind(F.logger,a),this.error=F.logger.error.bind(F.logger,a),this.hls=n,this.config=n.config,this.registerListeners()}var d=c.prototype;return d.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},d.registerListeners=function(){this.hls.on(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(U.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(U.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},d.unregisterListeners=function(){this.hls.off(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(U.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(U.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},d.getLicenseServerUrl=function(n){var p=this.config,y=p.widevineLicenseUrl,P=p.drmSystems[n];if(P)return P.licenseUrl;if(n===I.KeySystems.WIDEVINE&&y)return y;throw new Error('no license server URL configured for key-system "'+n+'"')},d.getServerCertificateUrl=function(n){var S=this.config.drmSystems[n];if(S)return S.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+n+'"]')},d.attemptKeySystemAccess=function(n){var p=this,S=this.hls.levels,y=function(B,G,N){return!!B&&N.indexOf(B)===G},P=S.map(function(B){return B.audioCodec}).filter(y),M=S.map(function(B){return B.videoCodec}).filter(y);return P.length+M.length===0&&M.push("avc1.42e01e"),new Promise(function(B,G){!function q(H){var V=H.shift();p.getMediaKeysPromise(V,P,M).then(function(Y){return B({keySystem:V,mediaKeys:Y})}).catch(function(Y){H.length?q(H):G(Y instanceof h?Y:new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:Y,fatal:!0},Y.message))})}(n)})},d.requestMediaKeySystemAccess=function(n,p){var S=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof S){var y="Configured requestMediaKeySystemAccess is not a function "+S;return null===I.requestMediaKeySystemAccess&&"http:"===self.location.protocol&&(y="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(y))}return S(n,p)},d.getMediaKeysPromise=function(n,p,S){var y=this,P=(0,I.getSupportedMediaKeySystemConfigurations)(n,p,S,this.config.drmSystemOptions),M=this.keySystemAccessPromises[n],B=M?.keySystemAccess;if(!B){this.log('Requesting encrypted media "'+n+'" key-system access with config: '+JSON.stringify(P)),B=this.requestMediaKeySystemAccess(n,P);var G=this.keySystemAccessPromises[n]={keySystemAccess:B};return B.catch(function(N){y.log('Failed to obtain access to key-system "'+n+'": '+N)}),B.then(function(N){y.log('Access for key-system "'+N.keySystem+'" obtained');var q=y.fetchServerCertificate(n);return y.log('Create media-keys for "'+n+'"'),G.mediaKeys=N.createMediaKeys().then(function(H){return y.log('Media-keys created for "'+n+'"'),q.then(function(V){return V?y.setMediaKeysServerCertificate(H,n,V):H})}),G.mediaKeys.catch(function(H){y.error('Failed to create media-keys for "'+n+'"}: '+H)}),G.mediaKeys})}return B.then(function(){return M.mediaKeys})},d.createMediaKeySessionContext=function(n){var p=n.decryptdata,S=n.keySystem,y=n.mediaKeys;console.assert(!!y,"mediaKeys is defined"),this.log('Creating key-system session "'+S+'" keyId: '+b.default.hexDump(p.keyId||[]));var P=y.createSession(),M={decryptdata:p,keySystem:S,mediaKeys:y,mediaKeysSession:P,keyStatus:"status-pending"};return this.mediaKeySessions.push(M),M},d.renewKeySession=function(n){var p=n.decryptdata;if(p.pssh){var S=this.createMediaKeySessionContext(n),y=this.getKeyIdString(p);this.keyIdToKeySessionPromise[y]=this.generateRequestWithPreferredKeySession(S,"cenc",p.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(n)},d.getKeyIdString=function(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(null===n.keyId)throw new Error("keyId is null");return b.default.hexDump(n.keyId)},d.updateKeySession=function(n,p){var S,y=n.mediaKeysSession;return this.log('Updating key-session "'+y.sessionId+'" for keyID '+b.default.hexDump((null===(S=n.decryptdata)||void 0===S?void 0:S.keyId)||[])+"\n      } (data length: "+(p&&p.byteLength)+")"),y.update(p)},d.selectKeySystemFormat=function(n){var p=Object.keys(n.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+n.sn+" "+n.type+": "+n.level+") key formats "+p.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(p)),this.keyFormatPromise},d.getKeyFormatPromise=function(n){var p=this;return new Promise(function(S,y){var P=(0,I.getKeySystemsForConfig)(p.config),M=n.map(I.keySystemFormatToKeySystemDomain).filter(function(B){return!!B&&-1!==P.indexOf(B)});return p.getKeySystemSelectionPromise(M).then(function(B){var G=B.keySystem,N=(0,I.keySystemDomainToKeySystemFormat)(G);N?S(N):y(new Error('Unable to find format for key-system "'+G+'"'))}).catch(y)})},d.loadKey=function(n){var p=this,S=n.keyInfo.decryptdata,y=this.getKeyIdString(S),P="(keyId: "+y+' format: "'+S.keyFormat+'" method: '+S.method+" uri: "+S.uri+")";this.log("Starting session for key "+P);var M=this.keyIdToKeySessionPromise[y];return M||(M=this.keyIdToKeySessionPromise[y]=this.getKeySystemForKeyPromise(S).then(function(B){var G=B.keySystem,N=B.mediaKeys;return p.throwIfDestroyed(),p.log("Handle encrypted media sn: "+n.frag.sn+" "+n.frag.type+": "+n.frag.level+" using key "+P),p.attemptSetMediaKeys(G,N).then(function(){p.throwIfDestroyed();var q=p.createMediaKeySessionContext({keySystem:G,mediaKeys:N,decryptdata:S});return p.generateRequestWithPreferredKeySession(q,"cenc",S.pssh,"playlist-key")})})).catch(function(B){return p.handleError(B)}),M},d.throwIfDestroyed=function(n){if(void 0===n&&(n="Invalid state"),!this.hls)throw new Error("invalid state")},d.handleError=function(n){!this.hls||(this.error(n.message),this.hls.trigger(U.Events.ERROR,n instanceof h?n.data:{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:n,fatal:!0}))},d.getKeySystemForKeyPromise=function(n){var p=this.getKeyIdString(n),S=this.keyIdToKeySessionPromise[p];if(!S){var y=(0,I.keySystemFormatToKeySystemDomain)(n.keyFormat),P=y?[y]:(0,I.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(P)}return S},d.getKeySystemSelectionPromise=function(n){if(n.length||(n=(0,I.getKeySystemsForConfig)(this.config)),0===n.length)throw new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(n)},d._onMediaEncrypted=function(n){var p=this,S=n.initDataType,y=n.initData;if(this.debug('"'+n.type+'" event: init data type: "'+S+'"'),null!==y){var P,M;if("sinf"===S&&this.config.drmSystems[I.KeySystems.FAIRPLAY]){var B=(0,k.bin2str)(new Uint8Array(y));try{var G=(0,D.base64Decode)(JSON.parse(B).sinf),N=(0,k.parseSinf)(new Uint8Array(G));if(!N)return;P=N.subarray(8,24),M=I.KeySystems.FAIRPLAY}catch{return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var q=(0,k.parsePssh)(y);if(null===q)return;0===q.version&&q.systemId===I.KeySystemIds.WIDEVINE&&q.data&&(P=q.data.subarray(8,24)),M=(0,I.keySystemIdToKeySystemDomain)(q.systemId)}if(M&&P){for(var H=b.default.hexDump(P),V=this.keyIdToKeySessionPromise,Y=this.mediaKeySessions,X=V[H],Z=function(ne){var he=Y[ne],be=he.decryptdata;if(be.pssh||!be.keyId)return"continue";var me=b.default.hexDump(be.keyId);return H===me||-1!==be.uri.replace(/-/g,"").indexOf(H)?(X=V[me],delete V[me],be.pssh=new Uint8Array(y),be.keyId=P,X=V[H]=X.then(function(){return p.generateRequestWithPreferredKeySession(he,S,y,"encrypted-event-key-match")}),"break"):void 0},te=0;te<Y.length;te++){var re=Z(te);if("continue"!==re&&"break"===re)break}X||(X=V[H]=this.getKeySystemSelectionPromise([M]).then(function(ne){var he,be=ne.keySystem,me=ne.mediaKeys;p.throwIfDestroyed();var ye=new _.LevelKey("ISO-23001-7",H,null!=(he=(0,I.keySystemDomainToKeySystemFormat)(be))?he:"");return ye.pssh=new Uint8Array(y),ye.keyId=P,p.attemptSetMediaKeys(be,me).then(function(){p.throwIfDestroyed();var Te=p.createMediaKeySessionContext({decryptdata:ye,keySystem:be,mediaKeys:me});return p.generateRequestWithPreferredKeySession(Te,S,y,"encrypted-event-no-match")})})),X.catch(function(ne){return p.handleError(ne)})}}},d._onWaitingForKey=function(n){this.log('"'+n.type+'" event')},d.attemptSetMediaKeys=function(n,p){var S=this,y=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+n+'"');var P=Promise.all(y).then(function(){if(!S.media)throw new Error("Attempted to set mediaKeys without media element attached");return S.media.setMediaKeys(p)});return this.setMediaKeysQueue.push(P),P.then(function(){S.log('Media-keys set for "'+n+'"'),y.push(P),S.setMediaKeysQueue=S.setMediaKeysQueue.filter(function(M){return-1===y.indexOf(M)})})},d.generateRequestWithPreferredKeySession=function(n,p,S,y){var P,M,B=this,G=null===(P=this.config.drmSystems)||void 0===P||null===(M=P[n.keySystem])||void 0===M?void 0:M.generateRequest;if(G)try{var N=G.call(this.hls,p,S,n);if(!N)throw new Error("Invalid response from configured generateRequest filter");p=N.initDataType,S=n.decryptdata.pssh=N.initData?new Uint8Array(N.initData):null}catch(X){var q;if(this.warn(X.message),null!==(q=this.hls)&&void 0!==q&&q.config.debug)throw X}if(null===S)return this.log('Skipping key-session request for "'+y+'" (no initData)'),Promise.resolve(n);var H=this.getKeyIdString(n.decryptdata);this.log('Generating key-session request for "'+y+'": '+H+" (init data type: "+p+" length: "+(S?S.byteLength:null)+")");var V=new(T());n.mediaKeysSession.onmessage=function(X){var Z=n.mediaKeysSession;if(Z){var te=X.messageType,re=X.message;B.log('"'+te+'" message event for session "'+Z.sessionId+'" message size: '+re.byteLength),"license-request"===te||"license-renewal"===te?B.renewLicense(n,re).catch(function(ne){B.handleError(ne),V.emit("error",ne)}):"license-release"===te?n.keySystem===I.KeySystems.FAIRPLAY&&(B.updateKeySession(n,(0,R.strToUtf8array)("acknowledged")),B.removeSession(n)):B.warn('unhandled media key message type "'+te+'"')}else V.emit("error",new Error("invalid state"))},n.mediaKeysSession.onkeystatuseschange=function(X){if(n.mediaKeysSession){B.onKeyStatusChange(n);var te=n.keyStatus;V.emit("keyStatus",te),"expired"===te&&(B.warn(n.keySystem+" expired for key "+H),B.renewKeySession(n))}else V.emit("error",new Error("invalid state"))};var Y=new Promise(function(X,Z){V.on("error",Z),V.on("keyStatus",function(te){te.startsWith("usable")?X():"output-restricted"===te?Z(new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===te?Z(new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+te+'"')):"expired"===te?Z(new Error("key expired while generating request")):B.warn('unhandled key status change "'+te+'"')})});return n.mediaKeysSession.generateRequest(p,S).then(function(){var X;B.log('Request generated for key-session "'+(null===(X=n.mediaKeysSession)||void 0===X?void 0:X.sessionId)+'" keyId: '+H)}).catch(function(X){throw new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:X,fatal:!1},"Error generating key-session request: "+X)}).then(function(){return Y}).catch(function(X){throw V.removeAllListeners(),B.removeSession(n),X}).then(function(){return V.removeAllListeners(),n})},d.onKeyStatusChange=function(n){var p=this;n.mediaKeysSession.keyStatuses.forEach(function(S,y){p.log('key status change "'+S+'" for keyStatuses keyId: '+b.default.hexDump("buffer"in y?new Uint8Array(y.buffer,y.byteOffset,y.byteLength):new Uint8Array(y))+" session keyId: "+b.default.hexDump(new Uint8Array(n.decryptdata.keyId||[]))+" uri: "+n.decryptdata.uri),n.keyStatus=S})},d.fetchServerCertificate=function(n){var p=this;return new Promise(function(S,y){var P=p.getServerCertificateUrl(n);if(!P)return S();p.log('Fetching serverCertificate for "'+n+'"');var M=new XMLHttpRequest;M.open("GET",P,!0),M.responseType="arraybuffer",M.onreadystatechange=function(){M.readyState===XMLHttpRequest.DONE&&(200===M.status?S(M.response):y(new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:M},'"'+n+'" certificate request XHR failed ('+P+"). Status: "+M.status+" ("+M.statusText+")")))},M.send()})},d.setMediaKeysServerCertificate=function(n,p,S){var y=this;return new Promise(function(P,M){n.setServerCertificate(S).then(function(B){y.log("setServerCertificate "+(B?"success":"not supported by CDM")+" ("+S?.byteLength+') on "'+p+'"'),P(n)}).catch(function(B){M(new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:B,fatal:!0},B.message))})})},d.renewLicense=function(n,p){var S=this;return this.requestLicense(n,new Uint8Array(p)).then(function(y){return S.updateKeySession(n,new Uint8Array(y)).catch(function(P){throw new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:P,fatal:!0},P.message)})})},d.setupLicenseXHR=function(n,p,S,y){var P=this,M=this.config.licenseXhrSetup;return M?Promise.resolve().then(function(){if(!S.decryptdata)throw new Error("Key removed");return M.call(P.hls,n,p,S,y)}).catch(function(B){if(!S.decryptdata)throw B;return n.open("POST",p,!0),M.call(P.hls,n,p,S,y)}).then(function(B){return n.readyState||n.open("POST",p,!0),{xhr:n,licenseChallenge:B||y}}):(n.open("POST",p,!0),Promise.resolve({xhr:n,licenseChallenge:y}))},d.requestLicense=function(n,p){var S=this;return new Promise(function(y,P){var M=S.getLicenseServerUrl(n.keySystem);S.log("Sending license request to URL: "+M);var B=new XMLHttpRequest;B.responseType="arraybuffer",B.onreadystatechange=function(){if(!S.hls||!n.mediaKeysSession)return P(new Error("invalid state"));if(4===B.readyState)if(200===B.status){S._requestLicenseFailureCount=0;var G=B.response;S.log("License received "+(G instanceof ArrayBuffer?G.byteLength:G));var N=S.config.licenseResponseCallback;if(N)try{G=N.call(S.hls,B,M,n)}catch(H){S.error(H)}y(G)}else S._requestLicenseFailureCount++,S._requestLicenseFailureCount>3||B.status>=400&&B.status<500?P(new h({type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:B},"License Request XHR failed ("+M+"). Status: "+B.status+" ("+B.statusText+")")):(S.warn("Retrying license request, "+(3-S._requestLicenseFailureCount+1)+" attempts left"),S.requestLicense(n,p).then(y,P))},n.licenseXhr&&n.licenseXhr.readyState!==XMLHttpRequest.DONE&&n.licenseXhr.abort(),n.licenseXhr=B,S.setupLicenseXHR(B,M,n,p).then(function(G){G.xhr.send(G.licenseChallenge)})})},d.onMediaAttached=function(n,p){if(this.config.emeEnabled){var S=p.media;this.media=S,S.addEventListener("encrypted",this.onMediaEncrypted),S.addEventListener("waitingforkey",this.onWaitingForKey)}},d.onMediaDetached=function(){var n=this,p=this.media,S=this.mediaKeySessions;p&&(p.removeEventListener("encrypted",this.onMediaEncrypted),p.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},_.LevelKey.clearKeyUriToKeyIdMap();var y=S.length;c.CDMCleanupPromise=Promise.all(S.map(function(P){return n.removeSession(P)}).concat(p?.setMediaKeys(null).catch(function(P){n.log("Could not clear media keys: "+P+". media.src: "+p?.src)}))).then(function(){y&&(n.log("finished closing key sessions and clearing media keys"),S.length=0)}).catch(function(P){n.log("Could not close sessions and clear media keys: "+P+". media.src: "+p?.src)})},d.onManifestLoaded=function(n,p){var S=p.sessionKeys;if(S&&this.config.emeEnabled&&!this.keyFormatPromise){var y=S.reduce(function(P,M){return-1===P.indexOf(M.keyFormat)&&P.push(M.keyFormat),P},[]);this.log("Selecting key-system from session-keys "+y.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(y)}},d.removeSession=function(n){var p=this,S=n.mediaKeysSession,y=n.licenseXhr;if(S){this.log("Remove licenses and keys and close session "+S.sessionId),S.onmessage=null,S.onkeystatuseschange=null,y&&y.readyState!==XMLHttpRequest.DONE&&y.abort(),n.mediaKeysSession=n.decryptdata=n.licenseXhr=void 0;var P=this.mediaKeySessions.indexOf(n);return P>-1&&this.mediaKeySessions.splice(P,1),S.remove().catch(function(M){p.log("Could not remove session: "+M)}).then(function(){return S.close()}).catch(function(M){p.log("Could not close session: "+M)})}},c}();s.CDMCleanupPromise=void 0;var h=function(c){function d(n,p){var S;return(S=c.call(this,p)||this).data=void 0,S.data=n,n.err=n.error,S}return function C(c,d){c.prototype=Object.create(d.prototype),c.prototype.constructor=c,u(c,d)}(d,c),d}(E(Error));const m=s},"./src/controller/fps-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>I});var U=j("./src/events.ts"),L=j("./src/utils/logger.ts");const I=function(){function R(_){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=_,this.registerListeners()}var D=R.prototype;return D.setStreamController=function(_){this.streamController=_},D.registerListeners=function(){this.hls.on(U.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},D.unregisterListeners=function(){this.hls.off(U.Events.MEDIA_ATTACHING,this.onMediaAttaching)},D.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},D.onMediaAttaching=function(_,b){var k=this.hls.config;if(k.capLevelOnFPSDrop){var x=b.media instanceof self.HTMLVideoElement?b.media:null;this.media=x,x&&"function"==typeof x.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),k.fpsDroppedMonitoringPeriod)}},D.checkFPS=function(_,b,k){var x=performance.now();if(b){if(this.lastTime){var C=k-this.lastDroppedFrames,E=b-this.lastDecodedFrames,o=1e3*C/(x-this.lastTime),g=this.hls;if(g.trigger(U.Events.FPS_DROP,{currentDropped:C,currentDecoded:E,totalDroppedFrames:k}),o>0&&C>g.config.fpsDroppedMonitoringThreshold*E){var f=g.currentLevel;L.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===g.autoLevelCapping||g.autoLevelCapping>=f)&&(g.trigger(U.Events.FPS_DROP_LEVEL_CAPPING,{level:f-=1,droppedLevel:g.currentLevel}),g.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=x,this.lastDroppedFrames=k,this.lastDecodedFrames=b}},D.checkFPSInterval=function(){var _=this.media;if(_)if(this.isVideoPlaybackQualityAvailable){var b=_.getVideoPlaybackQuality();this.checkFPS(_,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(_,_.webkitDecodedFrameCount,_.webkitDroppedFrameCount)},R}()},"./src/controller/fragment-finders.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{findFragWithCC:()=>_,findFragmentByPDT:()=>F,findFragmentByPTS:()=>I,fragmentWithinToleranceTest:()=>R,pdtWithinToleranceTest:()=>D});var U=j("./src/polyfills/number.ts"),L=j("./src/utils/binary-search.ts");function F(b,k,x){if(null===k||!Array.isArray(b)||!b.length||!(0,U.isFiniteNumber)(k))return null;if(k<(b[0].programDateTime||0))return null;if(k>=(b[b.length-1].endProgramDateTime||0))return null;x=x||0;for(var E=0;E<b.length;++E){var o=b[E];if(D(k,x,o))return o}return null}function I(b,k,x,T){void 0===x&&(x=0),void 0===T&&(T=0);var C=null;if(b?C=k[b.sn-k[0].sn+1]||null:0===x&&0===k[0].start&&(C=k[0]),C&&0===R(x,T,C))return C;var E=L.default.search(k,R.bind(null,x,T));return!E||E===b&&C?C:E}function R(b,k,x){if(void 0===b&&(b=0),void 0===k&&(k=0),x.start<=b&&x.start+x.duration>b)return 0;var T=Math.min(k,x.duration+(x.deltaPTS?x.deltaPTS:0));return x.start+x.duration-T<=b?1:x.start-T>b&&x.start?-1:0}function D(b,k,x){var T=1e3*Math.min(k,x.duration+(x.deltaPTS?x.deltaPTS:0));return(x.endProgramDateTime||0)-T>b}function _(b,k){return L.default.search(b,function(x){return x.cc<k?1:x.cc>k?-1:0})}},"./src/controller/fragment-tracker.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{FragmentState:()=>F,FragmentTracker:()=>I});var F,_,U=j("./src/events.ts"),L=j("./src/types/loader.ts");(_=F||(F={})).NOT_LOADED="NOT_LOADED",_.APPENDING="APPENDING",_.PARTIAL="PARTIAL",_.OK="OK";var I=function(){function _(k){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=k,this._registerListeners()}var b=_.prototype;return b._registerListeners=function(){var k=this.hls;k.on(U.Events.BUFFER_APPENDED,this.onBufferAppended,this),k.on(U.Events.FRAG_BUFFERED,this.onFragBuffered,this),k.on(U.Events.FRAG_LOADED,this.onFragLoaded,this)},b._unregisterListeners=function(){var k=this.hls;k.off(U.Events.BUFFER_APPENDED,this.onBufferAppended,this),k.off(U.Events.FRAG_BUFFERED,this.onFragBuffered,this),k.off(U.Events.FRAG_LOADED,this.onFragLoaded,this)},b.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},b.getAppendedFrag=function(k,x){if(x===L.PlaylistLevelType.MAIN){var T=this.activeFragment,C=this.activeParts;if(!T)return null;if(C)for(var E=C.length;E--;){var o=C[E],g=o?o.end:T.appendedPTS;if(o.start<=k&&void 0!==g&&k<=g)return E>9&&(this.activeParts=C.slice(E-9)),o}else if(T.start<=k&&void 0!==T.appendedPTS&&k<=T.appendedPTS)return T}return this.getBufferedFrag(k,x)},b.getBufferedFrag=function(k,x){for(var T=this.fragments,C=Object.keys(T),E=C.length;E--;){var o=T[C[E]];if(o?.body.type===x&&o.buffered){var g=o.body;if(g.start<=k&&k<=g.end)return g}}return null},b.detectEvictedFragments=function(k,x,T){var C=this;this.timeRanges&&(this.timeRanges[k]=x),Object.keys(this.fragments).forEach(function(E){var o=C.fragments[E];if(o){if(!o.buffered&&!o.loaded)return void(o.body.type===T&&C.removeFragment(o.body));var g=o.range[k];!g||g.time.some(function(f){var u=!C.isTimeBuffered(f.startPTS,f.endPTS,x);return u&&C.removeFragment(o.body),u})}})},b.detectPartialFragments=function(k){var x=this,T=this.timeRanges,C=k.frag,E=k.part;if(T&&"initSegment"!==C.sn){var o=D(C),g=this.fragments[o];!g||(Object.keys(T).forEach(function(f){var u=C.elementaryStreams[f];u&&(g.range[f]=x.getBufferedTimes(C,E,null!==E||!0===u.partial,T[f]))}),g.loaded=null,Object.keys(g.range).length?(g.buffered=!0,g.body.endList&&(this.endListFragments[g.body.type]=g)):this.removeFragment(g.body))}},b.fragBuffered=function(k){var x=D(k),T=this.fragments[x];T&&(T.loaded=null,T.buffered=!0)},b.getBufferedTimes=function(k,x,T,C){for(var E={time:[],partial:T},o=x?x.start:k.start,g=x?x.end:k.end,f=k.minEndPTS||g,u=k.maxStartPTS||o,A=0;A<C.length;A++){var v=C.start(A)-this.bufferPadding,a=C.end(A)+this.bufferPadding;if(u>=v&&f<=a){E.time.push({startPTS:Math.max(o,C.start(A)),endPTS:Math.min(g,C.end(A))});break}if(o<a&&g>v)E.partial=!0,E.time.push({startPTS:Math.max(o,C.start(A)),endPTS:Math.min(g,C.end(A))});else if(g<=v)break}return E},b.getPartialFragment=function(k){var T,C,E,x=null,o=0,g=this.bufferPadding,f=this.fragments;return Object.keys(f).forEach(function(u){var A=f[u];!A||R(A)&&(E=A.body.end+g,k>=(C=A.body.start-g)&&k<=E&&(T=Math.min(k-C,E-k),o<=T&&(x=A.body,o=T)))}),x},b.isEndListAppended=function(k){var x=this.endListFragments[k];return void 0!==x&&(x.buffered||R(x))},b.getState=function(k){var x=D(k),T=this.fragments[x];return T?T.buffered?R(T)?F.PARTIAL:F.OK:F.APPENDING:F.NOT_LOADED},b.isTimeBuffered=function(k,x,T){for(var C,E,o=0;o<T.length;o++){if(C=T.start(o)-this.bufferPadding,E=T.end(o)+this.bufferPadding,k>=C&&x<=E)return!0;if(x<=C)return!1}return!1},b.onFragLoaded=function(k,x){var T=x.frag;if("initSegment"!==T.sn&&!T.bitrateTest&&!x.part){var E=D(T);this.fragments[E]={body:T,loaded:x,buffered:!1,range:Object.create(null)}}},b.onBufferAppended=function(k,x){var T=this,C=x.frag,E=x.part,o=x.timeRanges;if(C.type===L.PlaylistLevelType.MAIN)if(this.activeFragment!==C&&(this.activeFragment=C,C.appendedPTS=void 0),E){var g=this.activeParts;g||(this.activeParts=g=[]),g.push(E)}else this.activeParts=null;this.timeRanges=o,Object.keys(o).forEach(function(f){var u=o[f];if(T.detectEvictedFragments(f,u),!E&&C.type===L.PlaylistLevelType.MAIN){var A=C.elementaryStreams[f];if(!A)return;for(var v=0;v<u.length;v++){var a=u.end(v);C.appendedPTS=a<=A.endPTS&&a>A.startPTS?Math.max(a,C.appendedPTS||0):A.endPTS}}})},b.onFragBuffered=function(k,x){this.detectPartialFragments(x)},b.hasFragment=function(k){var x=D(k);return!!this.fragments[x]},b.removeFragmentsInRange=function(k,x,T){var C=this;Object.keys(this.fragments).forEach(function(E){var o=C.fragments[E];if(o&&o.buffered){var g=o.body;g.type===T&&g.start<x&&g.end>k&&C.removeFragment(g)}})},b.removeFragment=function(k){var x=D(k);k.stats.loaded=0,k.clearElementaryStreamInfo(),k.appendedPTS=void 0,delete this.fragments[x],k.endList&&delete this.endListFragments[k.type]},b.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},_}();function R(_){var b,k;return _.buffered&&((null===(b=_.range.video)||void 0===b?void 0:b.partial)||(null===(k=_.range.audio)||void 0===k?void 0:k.partial))}function D(_){return _.type+"_"+_.level+"_"+_.urlId+"_"+_.sn}},"./src/controller/gap-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{MAX_START_GAP_JUMP:()=>D,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>_,SKIP_BUFFER_RANGE_START:()=>b,STALL_MINIMUM_DURATION_MS:()=>R,default:()=>k});var U=j("./src/utils/buffer-helper.ts"),L=j("./src/errors.ts"),F=j("./src/events.ts"),I=j("./src/utils/logger.ts"),R=250,D=2,_=.1,b=.05,k=function(){function x(C,E,o,g){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=C,this.media=E,this.fragmentTracker=o,this.hls=g}var T=x.prototype;return T.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},T.poll=function(C,E){var o=this.config,g=this.media,f=this.stalled;if(null!==g){var u=g.currentTime,A=g.seeking,v=this.seeking&&!A,a=!this.seeking&&A;if(this.seeking=A,u!==C){if(this.moved=!0,null!==f){if(this.stallReported){var s=self.performance.now()-f;I.logger.warn("playback not stuck anymore @"+u+", after "+Math.round(s)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((a||v)&&(this.stalled=null),!(g.paused&&!A||g.ended||0===g.playbackRate)&&U.BufferHelper.getBuffered(g).length){var h=U.BufferHelper.bufferInfo(g,u,0),c=h.nextStart||0;if(h.len>0||c){if(A){var d=h.len>D,n=!c||E&&E.start<=u||c-u>D&&!this.fragmentTracker.getPartialFragment(u);if(d||n)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var p,S=Math.max(c,h.start||0)-u,y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=null==y||null===(p=y.details)||void 0===p?void 0:p.live;if(S>0&&S<=(P?2*y.details.targetduration:D))return void this._trySkipBufferHole(null)}var B=self.performance.now();if(null===f)return void(this.stalled=B);var G=B-f;if(A||!(G>=R)||(this._reportStall(h),this.media)){var N=U.BufferHelper.bufferInfo(g,u,o.maxBufferHole);this._tryFixBufferStall(N,G)}}}}},T._tryFixBufferStall=function(C,E){var o=this.config,f=this.media;if(null!==f){var A=this.fragmentTracker.getPartialFragment(f.currentTime);if(A&&(this._trySkipBufferHole(A)||!this.media))return;C.len>o.maxBufferHole&&E>1e3*o.highBufferWatchdogPeriod&&(I.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},T._reportStall=function(C){var E=this.hls,o=this.media;!this.stallReported&&o&&(this.stallReported=!0,I.logger.warn("Playback stalling at @"+o.currentTime+" due to low buffer ("+JSON.stringify(C)+")"),E.trigger(F.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:C.len}))},T._trySkipBufferHole=function(C){var E=this.config,o=this.hls,g=this.media;if(null===g)return 0;for(var f=g.currentTime,u=0,A=U.BufferHelper.getBuffered(g),v=0;v<A.length;v++){var a=A.start(v);if(f+E.maxBufferHole>=u&&f<a){var s=Math.max(a+b,g.currentTime+_);return I.logger.warn("skipping hole, adjusting currentTime from "+f+" to "+s),this.moved=!0,this.stalled=null,g.currentTime=s,C&&o.trigger(F.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+f+" to "+s,frag:C}),s}u=A.end(v)}return 0},T._tryNudgeBuffer=function(){var C=this.config,E=this.hls,o=this.media,g=this.nudgeRetry;if(null!==o){var f=o.currentTime;if(this.nudgeRetry++,g<C.nudgeMaxRetry){var u=f+(g+1)*C.nudgeOffset;I.logger.warn("Nudging 'currentTime' from "+f+" to "+u),o.currentTime=u,E.trigger(F.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else I.logger.error("Playhead still not moving while enough data buffered @"+f+" after "+C.nudgeMaxRetry+" nudges"),E.trigger(F.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},x}()},"./src/controller/id3-track-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>E});var U=j("./src/polyfills/number.ts"),L=j("./src/events.ts"),F=j("./src/utils/texttrack-utils.ts"),I=j("./src/demux/id3.ts"),R=j("./src/loader/date-range.ts"),D=j("./src/types/demuxer.ts");function b(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var k=function(){var o=b();try{new o(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function x(o,g){return o.getTime()/1e3-g}function T(o){return Uint8Array.from(o.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}const E=function(){function o(f){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=f,this._registerListeners()}var g=o.prototype;return g.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},g._registerListeners=function(){var f=this.hls;f.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(L.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),f.on(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.on(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},g._unregisterListeners=function(){var f=this.hls;f.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(L.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),f.off(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.off(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},g.onMediaAttached=function(f,u){this.media=u.media},g.onMediaDetaching=function(){!this.id3Track||((0,F.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},g.onManifestLoading=function(){this.dateRangeCuesAppended={}},g.createTrack=function(f){var u=this.getID3Track(f.textTracks);return u.mode="hidden",u},g.getID3Track=function(f){if(this.media){for(var u=0;u<f.length;u++){var A=f[u];if("metadata"===A.kind&&"id3"===A.label)return(0,F.sendAddTrackEvent)(A,this.media),A}return this.media.addTextTrack("metadata","id3")}},g.onFragParsingMetadata=function(f,u){if(this.media){var A=this.hls.config,v=A.enableEmsgMetadataCues,a=A.enableID3MetadataCues;if(v||a){var s=u.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=b(),m=0;m<s.length;m++){var c=s[m].type;if((c!==D.MetadataSchema.emsg||v)&&a){var d=I.getID3Frames(s[m].data);if(d){var n=s[m].pts,p=n+s[m].duration;p>k&&(p=k),p-n<=0&&(p=n+.25);for(var y=0;y<d.length;y++){var P=d[y];if(!I.isTimeStampFrame(P)){this.updateId3CueEnds(n);var M=new h(n,p,"");M.value=P,c&&(M.type=c),this.id3Track.addCue(M)}}}}}}}},g.updateId3CueEnds=function(f){var u,A=null===(u=this.id3Track)||void 0===u?void 0:u.cues;if(A)for(var v=A.length;v--;){var a=A[v];a.startTime<f&&a.endTime===k&&(a.endTime=f)}},g.onBufferFlushing=function(f,u){var a=u.type,s=this.id3Track,h=this.hls;if(h){var m=h.config,c=m.enableEmsgMetadataCues,d=m.enableID3MetadataCues;s&&(c||d)&&(0,F.removeCuesInRange)(s,u.startOffset,u.endOffset,"audio"===a?function(p){return p.type===D.MetadataSchema.audioId3&&d}:"video"===a?function(p){return p.type===D.MetadataSchema.emsg&&c}:function(p){return p.type===D.MetadataSchema.audioId3&&d||p.type===D.MetadataSchema.emsg&&c})}},g.onLevelUpdated=function(f,u){var A=this,v=u.details;if(this.media&&v.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,s=this.id3Track,h=v.dateRanges,m=Object.keys(h);if(s)for(var c=Object.keys(a).filter(function(B){return!m.includes(B)}),d=function(B){var G=c[B];Object.keys(a[G].cues).forEach(function(N){s.removeCue(a[G].cues[N])}),delete a[G]},n=c.length;n--;)d(n);var p=v.fragments[v.fragments.length-1];if(0!==m.length&&(0,U.isFiniteNumber)(p?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var S=p.programDateTime/1e3-p.start,y=b(),P=function(B){var G=m[B],N=h[G],q=a[G],H=q?.cues||{},V=q?.durationKnown||!1,Y=x(N.startDate,S),X=k,Z=N.endDate;if(Z)X=x(Z,S),V=!0;else if(N.endOnNext&&!V){var te=m.reduce(function(ye,Te){var Ce=h[Te];return Ce.class===N.class&&Ce.id!==Te&&Ce.startDate>N.startDate&&ye.push(Ce),ye},[]).sort(function(ye,Te){return ye.startDate.getTime()-Te.startDate.getTime()})[0];te&&(X=x(te.startDate,S),V=!0)}for(var re=Object.keys(N.attr),ne=0;ne<re.length;ne++){var he=re[ne];if(he!==R.DateRangeAttribute.ID&&he!==R.DateRangeAttribute.CLASS&&he!==R.DateRangeAttribute.START_DATE&&he!==R.DateRangeAttribute.DURATION&&he!==R.DateRangeAttribute.END_DATE&&he!==R.DateRangeAttribute.END_ON_NEXT){var be=H[he];if(be)V&&!q.durationKnown&&(be.endTime=X);else{var me=N.attr[he];be=new y(Y,X,""),(he===R.DateRangeAttribute.SCTE35_OUT||he===R.DateRangeAttribute.SCTE35_IN)&&(me=T(me)),be.value={key:he,data:me},be.type=D.MetadataSchema.dateRange,A.id3Track.addCue(be),H[he]=be}}}a[G]={cues:H,dateRange:N,durationKnown:V}},M=0;M<m.length;M++)P(M)}}},o}()},"./src/controller/latency-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>b});var U=j("./src/errors.ts"),L=j("./src/events.ts"),F=j("./src/utils/logger.ts");function I(k,x){for(var T=0;T<x.length;T++){var C=x[T];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(k,D(C.key),C)}}function D(k){var x=function _(k,x){if("object"!=typeof k||null===k)return k;var T=k[Symbol.toPrimitive];if(void 0!==T){var C=T.call(k,x||"default");if("object"!=typeof C)return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===x?String:Number)(k)}(k,"string");return"symbol"==typeof x?x:String(x)}var b=function(){function k(T){var C=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return C.timeupdate()},this.hls=T,this.config=T.config,this.registerListeners()}var x=k.prototype;return x.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},x.registerListeners=function(){this.hls.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(L.Events.ERROR,this.onError,this)},x.unregisterListeners=function(){this.hls.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(L.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(L.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(L.Events.ERROR,this.onError)},x.onMediaAttached=function(T,C){this.media=C.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},x.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},x.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},x.onLevelUpdated=function(T,C){var E=C.details;this.levelDetails=E,E.advanced&&this.timeupdate(),!E.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},x.onError=function(T,C){C.details===U.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,F.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},x.timeupdate=function(){var T=this.media,C=this.levelDetails;if(T&&C){this.currentTime=T.currentTime;var E=this.computeLatency();if(null!==E){this._latency=E;var o=this.config,f=o.maxLiveSyncPlaybackRate;if(o.lowLatencyMode&&1!==f){var u=this.targetLatency;if(null!==u){var A=E-u,v=Math.min(this.maxLatency,u+C.targetduration);if(C.live&&A<v&&A>.05&&this.forwardBufferLength>1){var s=Math.min(2,Math.max(1,f)),h=Math.round(2/(1+Math.exp(-.75*A-this.edgeStalled))*20)/20;T.playbackRate=Math.min(s,Math.max(1,h))}else 1!==T.playbackRate&&0!==T.playbackRate&&(T.playbackRate=1)}}}}},x.estimateLiveEdge=function(){var T=this.levelDetails;return null===T?null:T.edge+T.age},x.computeLatency=function(){var T=this.estimateLiveEdge();return null===T?null:T-this.currentTime},function R(k,x,T){x&&I(k.prototype,x),T&&I(k,T),Object.defineProperty(k,"prototype",{writable:!1})}(k,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var T=this.config,C=this.levelDetails;return void 0!==T.liveMaxLatencyDuration?T.liveMaxLatencyDuration:C?T.liveMaxLatencyDurationCount*C.targetduration:0}},{key:"targetLatency",get:function(){var T=this.levelDetails;if(null===T)return null;var o=T.targetduration,g=this.config,f=g.liveSyncDuration,v=this.hls.userConfig,a=g.lowLatencyMode&&T.partHoldBack||T.holdBack;return(v.liveSyncDuration||v.liveSyncDurationCount||0===a)&&(a=void 0!==f?f:g.liveSyncDurationCount*o),a+Math.min(1*this.stallCount,o)}},{key:"liveSyncPosition",get:function(){var T=this.estimateLiveEdge(),C=this.targetLatency,E=this.levelDetails;if(null===T||null===C||null===E)return null;var o=E.edge,u=o-(this.config.lowLatencyMode&&E.partTarget||E.targetduration);return Math.min(Math.max(o-E.totalduration,T-C-this.edgeStalled),u)}},{key:"drift",get:function(){var T=this.levelDetails;return null===T?1:T.drift}},{key:"edgeStalled",get:function(){var T=this.levelDetails;return null===T?0:Math.max(T.age-3*(this.config.lowLatencyMode&&T.partTarget||T.targetduration),0)}},{key:"forwardBufferLength",get:function(){var T=this.media,C=this.levelDetails;if(!T||!C)return 0;var E=T.buffered.length;return(E?T.buffered.end(E-1):C.edge)-this.currentTime}}]),k}()},"./src/controller/level-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>f});var U=j("./src/types/level.ts"),L=j("./src/events.ts"),F=j("./src/errors.ts"),I=j("./src/utils/codecs.ts"),R=j("./src/controller/level-helper.ts"),D=j("./src/controller/base-playlist-controller.ts"),_=j("./src/types/loader.ts");function b(){return b=Object.assign?Object.assign.bind():function(u){for(var A=1;A<arguments.length;A++){var v=arguments[A];for(var a in v)Object.prototype.hasOwnProperty.call(v,a)&&(u[a]=v[a])}return u},b.apply(this,arguments)}function k(u,A){for(var v=0;v<A.length;v++){var a=A[v];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(u,T(a.key),a)}}function T(u){var A=function C(u,A){if("object"!=typeof u||null===u)return u;var v=u[Symbol.toPrimitive];if(void 0!==v){var a=v.call(u,A||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===A?String:Number)(u)}(u,"string");return"symbol"==typeof A?A:String(A)}function o(u,A){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,a){return v.__proto__=a,v})(u,A)}var g=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),f=function(u){function A(a){var s;return(s=u.call(this,a,"[level-controller]")||this)._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}!function E(u,A){u.prototype=Object.create(A.prototype),u.prototype.constructor=u,o(u,A)}(A,u);var v=A.prototype;return v._registerListeners=function(){var a=this.hls;a.on(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(L.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(L.Events.ERROR,this.onError,this)},v._unregisterListeners=function(){var a=this.hls;a.off(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(L.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),a.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(L.Events.ERROR,this.onError,this)},v.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,u.prototype.destroy.call(this)},v.startLoad=function(){this._levels.forEach(function(s){s.loadError=0}),u.prototype.startLoad.call(this)},v.onManifestLoaded=function(a,s){var d,p,h=[],m=[],c=[],n={},S=!1,y=!1,P=!1;if(s.levels.forEach(function(N){var q=N.attrs;S=S||!(!N.width||!N.height),y=y||!!N.videoCodec,P=P||!!N.audioCodec,g&&N.audioCodec&&-1!==N.audioCodec.indexOf("mp4a.40.34")&&(N.audioCodec=void 0);var H=N.bitrate+"-"+N.attrs.RESOLUTION+"-"+N.attrs.CODECS;(p=n[H])?p.url.push(N.url):(p=new U.Level(N),n[H]=p,h.push(p)),q&&(q.AUDIO&&(0,R.addGroupId)(p,"audio",q.AUDIO),q.SUBTITLES&&(0,R.addGroupId)(p,"text",q.SUBTITLES))}),(S||y)&&P&&(h=h.filter(function(N){return!!N.videoCodec||!(!N.width||!N.height)})),h=h.filter(function(N){var q=N.audioCodec,H=N.videoCodec;return(!q||(0,I.isCodecSupportedInMp4)(q,"audio"))&&(!H||(0,I.isCodecSupportedInMp4)(H,"video"))}),s.audioTracks&&(m=s.audioTracks.filter(function(N){return!N.audioCodec||(0,I.isCodecSupportedInMp4)(N.audioCodec,"audio")}),(0,R.assignTrackIdsByGroup)(m)),s.subtitles&&(0,R.assignTrackIdsByGroup)(c=s.subtitles),h.length>0){d=h[0].bitrate,h.sort(function(N,q){return N.attrs["HDCP-LEVEL"]!==q.attrs["HDCP-LEVEL"]?(N.attrs["HDCP-LEVEL"]||"")>(q.attrs["HDCP-LEVEL"]||"")?1:-1:N.bitrate!==q.bitrate?N.bitrate-q.bitrate:N.attrs.SCORE!==q.attrs.SCORE?N.attrs.decimalFloatingPoint("SCORE")-q.attrs.decimalFloatingPoint("SCORE"):S&&N.height!==q.height?N.height-q.height:0}),this._levels=h;for(var M=0;M<h.length;M++)if(h[M].bitrate===d){this._firstLevel=M,this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+d);break}var G={levels:h,audioTracks:m,subtitleTracks:c,sessionData:s.sessionData,sessionKeys:s.sessionKeys,firstLevel:this._firstLevel,stats:s.stats,audio:P,video:y,altAudio:!(P&&!y)&&m.some(function(N){return!!N.url})};this.hls.trigger(L.Events.MANIFEST_PARSED,G),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(L.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})},v.onError=function(a,s){var h,m;if(u.prototype.onError.call(this,a,s),!s.fatal){var c=s.context,d=this._levels[this.currentLevelIndex];if(c&&(c.type===_.PlaylistContextType.AUDIO_TRACK&&d.audioGroupIds&&c.groupId===d.audioGroupIds[d.urlId]||c.type===_.PlaylistContextType.SUBTITLE_TRACK&&d.textGroupIds&&c.groupId===d.textGroupIds[d.urlId]))return void this.redundantFailover(this.currentLevelIndex);var S,n=!1,p=!0;switch(s.details){case F.ErrorDetails.FRAG_LOAD_ERROR:case F.ErrorDetails.FRAG_LOAD_TIMEOUT:case F.ErrorDetails.KEY_LOAD_ERROR:case F.ErrorDetails.KEY_LOAD_TIMEOUT:if(s.frag){var y=s.frag.type===_.PlaylistLevelType.MAIN?s.frag.level:this.currentLevelIndex,P=this._levels[y];P?(P.fragmentError++,P.fragmentError>this.hls.config.fragLoadingMaxRetry&&(S=y)):S=y}break;case F.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var M=d.attrs["HDCP-LEVEL"];M&&(this.hls.maxHdcpLevel=U.HdcpLevels[U.HdcpLevels.indexOf(M)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case F.ErrorDetails.FRAG_PARSING_ERROR:case F.ErrorDetails.KEY_SYSTEM_NO_SESSION:S=(null===(h=s.frag)||void 0===h?void 0:h.type)===_.PlaylistLevelType.MAIN?s.frag.level:this.currentLevelIndex,s.levelRetry=!1;break;case F.ErrorDetails.LEVEL_LOAD_ERROR:case F.ErrorDetails.LEVEL_LOAD_TIMEOUT:c&&(c.deliveryDirectives&&(p=!1),S=c.level),n=!0;break;case F.ErrorDetails.REMUX_ALLOC_ERROR:S=null!=(m=s.level)?m:this.currentLevelIndex,n=!0}void 0!==S&&this.recoverLevel(s,S,n,p)}},v.recoverLevel=function(a,s,h,m){var c=a.details,d=this._levels[s];if(d.loadError++,h){if(!this.retryLoadingOrFail(a))return void(this.currentLevelIndex=-1);a.levelRetry=!0}if(m){var p=d.url.length;if(p>1&&d.loadError<p)a.levelRetry=!0,this.redundantFailover(s);else if(-1===this.manualLevelIndex){for(var S=-1,y=this._levels,P=y.length;P--;){var M=(P+this.currentLevelIndex)%y.length;if(M!==this.currentLevelIndex&&0===y[M].loadError){S=M;break}}S>-1&&this.currentLevelIndex!==S?(this.warn(c+": switch to "+S),a.levelRetry=!0,this.hls.nextAutoLevel=S):!1===a.levelRetry&&(a.fatal=!0)}}},v.redundantFailover=function(a){var s=this._levels[a],h=s.url.length;if(h>1){var m=(s.urlId+1)%h;this.warn("Switching to redundant URL-id "+m),this._levels.forEach(function(c){c.urlId=m}),this.level=a}},v.onFragLoaded=function(a,s){var h=s.frag;if(void 0!==h&&h.type===_.PlaylistLevelType.MAIN){var m=this._levels[h.level];void 0!==m&&(m.fragmentError=0,m.loadError=0)}},v.onLevelLoaded=function(a,s){var h,n,m=s.level,c=s.details,d=this._levels[m];if(!d)return this.warn("Invalid level index "+m),void(null!==(n=s.deliveryDirectives)&&void 0!==n&&n.skip&&(c.deltaUpdateFailed=!0));m===this.currentLevelIndex?(0===d.fragmentError&&(d.loadError=0,this.retryCount=0),this.playlistLoaded(m,s,d.details)):null!==(h=s.deliveryDirectives)&&void 0!==h&&h.skip&&(c.deltaUpdateFailed=!0)},v.onAudioTrackSwitched=function(a,s){var h=this.hls.levels[this.currentLevelIndex];if(h&&h.audioGroupIds){for(var m=-1,c=this.hls.audioTracks[s.id].groupId,d=0;d<h.audioGroupIds.length;d++)if(h.audioGroupIds[d]===c){m=d;break}m!==h.urlId&&(h.urlId=m,this.startLoad())}},v.loadPlaylist=function(a){u.prototype.loadPlaylist.call(this);var s=this.currentLevelIndex,h=this._levels[s];if(this.canLoad&&h&&h.url.length>0){var m=h.urlId,c=h.url[m];if(a)try{c=a.addDirectives(c)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("Attempt loading level index "+s+(a?" at sn "+a.msn+" part "+a.part:"")+" with URL-id "+m+" "+c),this.clearTimer(),this.hls.trigger(L.Events.LEVEL_LOADING,{url:c,level:s,id:m,deliveryDirectives:a||null})}},v.removeLevel=function(a,s){var h=function(c,d){return d!==s},m=this._levels.filter(function(c,d){return d!==a||c.url.length>1&&void 0!==s&&(c.url=c.url.filter(h),c.audioGroupIds&&(c.audioGroupIds=c.audioGroupIds.filter(h)),c.textGroupIds&&(c.textGroupIds=c.textGroupIds.filter(h)),c.urlId=0,!0)}).map(function(c,d){var n=c.details;return null!=n&&n.fragments&&n.fragments.forEach(function(p){p.level=d}),c});this._levels=m,this.hls.trigger(L.Events.LEVELS_UPDATED,{levels:m})},function x(u,A,v){A&&k(u.prototype,A),v&&k(u,v),Object.defineProperty(u,"prototype",{writable:!1})}(A,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(a){var s,h=this._levels;if(0!==h.length&&(this.currentLevelIndex!==a||null===(s=h[a])||void 0===s||!s.details)){if(a<0||a>=h.length){var m=a<0;if(this.hls.trigger(L.Events.ERROR,{type:F.ErrorTypes.OTHER_ERROR,details:F.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:m,reason:"invalid level idx"}),m)return;a=Math.min(a,h.length-1)}this.clearTimer();var c=this.currentLevelIndex,d=h[c],n=h[a];this.log("switching to level "+a+" from "+c),this.currentLevelIndex=a;var p=b({},n,{level:a,maxBitrate:n.maxBitrate,uri:n.uri,urlId:n.urlId});delete p._urlId,this.hls.trigger(L.Events.LEVEL_SWITCHING,p);var S=n.details;if(!S||S.live){var y=this.switchParams(n.uri,d?.details);this.loadPlaylist(y)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)}}]),A}(D.default)},"./src/controller/level-helper.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{addGroupId:()=>R,addSliding:()=>g,adjustSliding:()=>o,assignTrackIdsByGroup:()=>D,computeReloadInterval:()=>f,getFragmentWithSN:()=>u,getPartWith:()=>A,mapFragmentIntersection:()=>E,mapPartIntersection:()=>C,mergeDetails:()=>x,updateFragPTSDTS:()=>k,updatePTS:()=>_});var U=j("./src/polyfills/number.ts"),L=j("./src/utils/logger.ts"),F=j("./src/loader/date-range.ts");function I(){return I=Object.assign?Object.assign.bind():function(v){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(v[h]=s[h])}return v},I.apply(this,arguments)}function R(v,a,s){switch(a){case"audio":v.audioGroupIds||(v.audioGroupIds=[]),v.audioGroupIds.push(s);break;case"text":v.textGroupIds||(v.textGroupIds=[]),v.textGroupIds.push(s)}}function D(v){var a={};v.forEach(function(s){var h=s.groupId||"";s.id=a[h]=a[h]||0,a[h]++})}function _(v,a,s){b(v[a],v[s])}function b(v,a){var s=a.startPTS;if((0,U.isFiniteNumber)(s)){var m,h=0;a.sn>v.sn?(h=s-v.start,m=v):(h=v.start-s,m=a),m.duration!==h&&(m.duration=h)}else a.start=a.sn>v.sn?v.cc===a.cc&&v.minEndPTS?v.start+(v.minEndPTS-v.start):v.start+v.duration:Math.max(v.start-a.duration,0)}function k(v,a,s,h,m,c){h-s<=0&&(L.logger.warn("Fragment should have a positive duration",a),h=s+a.duration,c=m+a.duration);var n=s,p=h,S=a.startPTS,y=a.endPTS;if((0,U.isFiniteNumber)(S)){var P=Math.abs(S-s);a.deltaPTS=(0,U.isFiniteNumber)(a.deltaPTS)?Math.max(P,a.deltaPTS):P,n=Math.max(s,S),s=Math.min(s,S),m=Math.min(m,a.startDTS),p=Math.min(h,y),h=Math.max(h,y),c=Math.max(c,a.endDTS)}a.duration=h-s;var M=s-a.start;a.start=a.startPTS=s,a.maxStartPTS=n,a.startDTS=m,a.endPTS=h,a.minEndPTS=p,a.endDTS=c;var B=a.sn;if(!v||B<v.startSN||B>v.endSN)return 0;var G,N=B-v.startSN,q=v.fragments;for(q[N]=a,G=N;G>0;G--)b(q[G],q[G-1]);for(G=N;G<q.length-1;G++)b(q[G],q[G+1]);return v.fragmentHint&&b(q[q.length-1],v.fragmentHint),v.PTSKnown=v.alignedSliding=!0,M}function x(v,a){for(var s=null,h=v.fragments,m=h.length-1;m>=0;m--){var c=h[m].initSegment;if(c){s=c;break}}v.fragmentHint&&delete v.fragmentHint.endPTS;var n,d=0;if(E(v,a,function(G,N){G.relurl&&(d=G.cc-N.cc),(0,U.isFiniteNumber)(G.startPTS)&&(0,U.isFiniteNumber)(G.endPTS)&&(N.start=N.startPTS=G.startPTS,N.startDTS=G.startDTS,N.appendedPTS=G.appendedPTS,N.maxStartPTS=G.maxStartPTS,N.endPTS=G.endPTS,N.endDTS=G.endDTS,N.minEndPTS=G.minEndPTS,N.duration=G.endPTS-G.startPTS,N.duration&&(n=N),a.PTSKnown=a.alignedSliding=!0),N.elementaryStreams=G.elementaryStreams,N.loader=G.loader,N.stats=G.stats,N.urlId=G.urlId,G.initSegment&&(N.initSegment=G.initSegment,s=G.initSegment)}),s&&(a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments).forEach(function(G){var N;(!G.initSegment||G.initSegment.relurl===(null===(N=s)||void 0===N?void 0:N.relurl))&&(G.initSegment=s)}),a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(G){return!G}),a.deltaUpdateFailed){L.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var S=a.skippedSegments;S--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=function T(v,a,s){var h=I({},v);return s&&s.forEach(function(m){delete h[m]}),Object.keys(a).forEach(function(m){var c=new F.DateRange(a[m].attr,h[m]);c.isValid?h[m]=c:L.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(a[m].attr)+'"')}),h}(v.dateRanges,a.dateRanges,a.recentlyRemovedDateranges));var y=a.fragments;if(d){L.logger.warn("discontinuity sliding from playlist, take drift into account");for(var P=0;P<y.length;P++)y[P].cc+=d}a.skippedSegments&&(a.startCC=a.fragments[0].cc),C(v.partList,a.partList,function(G,N){N.elementaryStreams=G.elementaryStreams,N.stats=G.stats}),n?k(a,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):o(v,a),y.length&&(a.totalduration=a.edge-y[0].start),a.driftStartTime=v.driftStartTime,a.driftStart=v.driftStart;var M=a.advancedDateTime;if(a.advanced&&M){var B=a.edge;a.driftStart||(a.driftStartTime=M,a.driftStart=B),a.driftEndTime=M,a.driftEnd=B}else a.driftEndTime=v.driftEndTime,a.driftEnd=v.driftEnd,a.advancedDateTime=v.advancedDateTime}function C(v,a,s){if(v&&a)for(var h=0,m=0,c=v.length;m<=c;m++){var d=v[m],n=a[m+h];d&&n&&d.index===n.index&&d.fragment.sn===n.fragment.sn?s(d,n):h--}}function E(v,a,s){for(var h=a.skippedSegments,m=Math.max(v.startSN,a.startSN)-a.startSN,c=(v.fragmentHint?1:0)+(h?a.endSN:Math.min(v.endSN,a.endSN))-a.startSN,d=a.startSN-v.startSN,n=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,p=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,S=m;S<=c;S++){var y=p[d+S],P=n[S];h&&!P&&S<h&&(P=a.fragments[S]=y),y&&P&&s(y,P)}}function o(v,a){var s=a.startSN+a.skippedSegments-v.startSN,h=v.fragments;s<0||s>=h.length||g(a,h[s].start)}function g(v,a){if(a){for(var s=v.fragments,h=v.skippedSegments;h<s.length;h++)s[h].start+=a;v.fragmentHint&&(v.fragmentHint.start+=a)}}function f(v,a){void 0===a&&(a=1/0);var s=1e3*v.targetduration;if(v.updated){var h=v.fragments;if(h.length&&4*s>a){var c=1e3*h[h.length-1].duration;c<s&&(s=c)}}else s/=2;return Math.round(s)}function u(v,a,s){if(!v||!v.details)return null;var h=v.details,m=h.fragments[a-h.startSN];return m||(m=h.fragmentHint)&&m.sn===a?m:a<h.startSN&&s&&s.sn===a?s:null}function A(v,a,s){if(!v||!v.details)return null;var h=v.details.partList;if(h)for(var m=h.length;m--;){var c=h[m];if(c.index===s&&c.fragment.sn===a)return c}return null}},"./src/controller/stream-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>a});var U=j("./src/polyfills/number.ts"),L=j("./src/controller/base-stream-controller.ts"),F=j("./src/is-supported.ts"),I=j("./src/events.ts"),R=j("./src/utils/buffer-helper.ts"),D=j("./src/controller/fragment-tracker.ts"),_=j("./src/types/loader.ts"),b=j("./src/loader/fragment.ts"),k=j("./src/demux/transmuxer-interface.ts"),x=j("./src/types/transmuxer.ts"),T=j("./src/controller/gap-controller.ts"),C=j("./src/errors.ts");function E(s,h){for(var m=0;m<h.length;m++){var c=h[m];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(s,g(c.key),c)}}function g(s){var h=function f(s,h){if("object"!=typeof s||null===s)return s;var m=s[Symbol.toPrimitive];if(void 0!==m){var c=m.call(s,h||"default");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===h?String:Number)(s)}(s,"string");return"symbol"==typeof h?h:String(h)}function A(s,h){return(A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,c){return m.__proto__=c,m})(s,h)}var a=function(s){function h(c,d,n){var p;return(p=s.call(this,c,d,n,"[stream-controller]")||this).audioCodecSwap=!1,p.gapController=null,p.level=-1,p._forceStartLoad=!1,p.altAudio=!1,p.audioOnly=!1,p.fragPlaying=null,p.onvplaying=null,p.onvseeked=null,p.fragLastKbps=0,p.couldBacktrack=!1,p.backtrackFragment=null,p.audioCodecSwitch=!1,p.videoBuffer=null,p._registerListeners(),p}!function u(s,h){s.prototype=Object.create(h.prototype),s.prototype.constructor=s,A(s,h)}(h,s);var m=h.prototype;return m._registerListeners=function(){var c=this.hls;c.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),c.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),c.on(I.Events.ERROR,this.onError,this),c.on(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),c.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.on(I.Events.BUFFER_CREATED,this.onBufferCreated,this),c.on(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),c.on(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),c.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m._unregisterListeners=function(){var c=this.hls;c.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),c.off(I.Events.ERROR,this.onError,this),c.off(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),c.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.off(I.Events.BUFFER_CREATED,this.onBufferCreated,this),c.off(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),c.off(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),c.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},m.startLoad=function(c){if(this.levels){var d=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var p=n.startLevel;-1===p&&(n.config.testBandwidth&&this.levels.length>1?(p=0,this.bitrateTest=!0):p=n.nextAutoLevel),this.level=n.nextLoadLevel=p,this.loadedmetadata=!1}d>0&&-1===c&&(this.log("Override startPosition with lastCurrentTime @"+d.toFixed(3)),c=d),this.state=L.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=c,this.tick()}else this._forceStartLoad=!0,this.state=L.State.STOPPED},m.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},m.doTick=function(){switch(this.state){case L.State.IDLE:this.doTickIdle();break;case L.State.WAITING_LEVEL:var c,d=this.levels,p=null==d||null===(c=d[this.level])||void 0===c?void 0:c.details;if(p&&(!p.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(p))break;this.state=L.State.IDLE;break}break;case L.State.FRAG_LOADING_WAITING_RETRY:var S,y=self.performance.now(),P=this.retryDate;(!P||y>=P||null!==(S=this.media)&&void 0!==S&&S.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=L.State.IDLE)}this.onTickEnd()},m.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},m.doTickIdle=function(){var c=this.hls,n=this.levels,y=c.nextLoadLevel;if(null!==this.levelLastLoaded&&(this.media||!this.startFragRequested&&c.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&n&&n[y]){var P=n[y],M=this.getMainFwdBufferInfo();if(null!==M){var B=this.getLevelDetails();if(B&&this._streamEnded(M,B)){var G={};return this.altAudio&&(G.type="video"),this.hls.trigger(I.Events.BUFFER_EOS,G),void(this.state=L.State.ENDED)}this.level=c.nextLoadLevel=y;var N=P.details;if(!N||this.state===L.State.WAITING_LEVEL||N.live&&this.levelLastLoaded!==y)return this.level=y,void(this.state=L.State.WAITING_LEVEL);if(!(M.len>=this.getMaxBufferLength(P.maxBitrate))){this.backtrackFragment&&this.backtrackFragment.start>M.end&&(this.backtrackFragment=null);var V=this.backtrackFragment?this.backtrackFragment.start:M.end,Y=this.getNextFragment(V,N);if(this.couldBacktrack&&!this.fragPrevious&&Y&&"initSegment"!==Y.sn&&this.fragmentTracker.getState(Y)!==D.FragmentState.OK){var X,Z=(null!=(X=this.backtrackFragment)?X:Y).sn,re=N.fragments[Z-N.startSN-1];re&&Y.cc===re.cc&&(Y=re,this.fragmentTracker.removeFragment(re))}else this.backtrackFragment&&M.len&&(this.backtrackFragment=null);if(Y&&this.fragmentTracker.getState(Y)===D.FragmentState.OK&&this.nextLoadPosition>V){var ne=this.audioOnly&&!this.altAudio?b.ElementaryStreamTypes.AUDIO:b.ElementaryStreamTypes.VIDEO,he=(ne===b.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;he&&this.afterBufferFlushed(he,ne,_.PlaylistLevelType.MAIN),Y=this.getNextFragment(this.nextLoadPosition,N)}!Y||(Y.initSegment&&!Y.initSegment.data&&!this.bitrateTest&&(Y=Y.initSegment),this.loadFragment(Y,N,V))}}}},m.loadFragment=function(c,d,n){var p,S=this.fragmentTracker.getState(c);this.fragCurrent=c,S===D.FragmentState.NOT_LOADED?"initSegment"===c.sn?this._loadInitSegment(c,d):this.bitrateTest?(this.log("Fragment "+c.sn+" of level "+c.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(c,d)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,c,d,n)):S===D.FragmentState.APPENDING?this.reduceMaxBufferLength(c.duration)&&this.fragmentTracker.removeFragment(c):0===(null===(p=this.media)||void 0===p?void 0:p.buffered.length)&&this.fragmentTracker.removeAllFragments()},m.getAppendedFrag=function(c){var d=this.fragmentTracker.getAppendedFrag(c,_.PlaylistLevelType.MAIN);return d&&"fragment"in d?d.fragment:d},m.getBufferedFrag=function(c){return this.fragmentTracker.getBufferedFrag(c,_.PlaylistLevelType.MAIN)},m.followingBufferedFrag=function(c){return c?this.getBufferedFrag(c.end+.5):null},m.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},m.nextLevelSwitch=function(){var c=this.levels,d=this.media;if(null!=d&&d.readyState){var n,p=this.getAppendedFrag(d.currentTime);if(p&&p.start>1&&this.flushMainBuffer(0,p.start-1),!d.paused&&c){var P=this.fragLastKbps;n=P&&this.fragCurrent?this.fragCurrent.duration*c[this.hls.nextLoadLevel].maxBitrate/(1e3*P)+1:0}else n=0;var M=this.getBufferedFrag(d.currentTime+n);if(M){var B=this.followingBufferedFrag(M);if(B){this.abortCurrentFrag();var N=B.duration,q=Math.max(M.end,(B.maxStartPTS?B.maxStartPTS:B.start)+Math.min(Math.max(N-this.config.maxFragLookUpTolerance,.5*N),.75*N));this.flushMainBuffer(q,Number.POSITIVE_INFINITY)}}}},m.abortCurrentFrag=function(){var c=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,c&&c.abortRequests(),this.state){case L.State.KEY_LOADING:case L.State.FRAG_LOADING:case L.State.FRAG_LOADING_WAITING_RETRY:case L.State.PARSING:case L.State.PARSED:this.state=L.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},m.flushMainBuffer=function(c,d){s.prototype.flushMainBuffer.call(this,c,d,this.altAudio?"video":null)},m.onMediaAttached=function(c,d){s.prototype.onMediaAttached.call(this,c,d);var n=d.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,n,this.fragmentTracker,this.hls)},m.onMediaDetaching=function(){var c=this.media;c&&this.onvplaying&&this.onvseeked&&(c.removeEventListener("playing",this.onvplaying),c.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},m.onMediaPlaying=function(){this.tick()},m.onMediaSeeked=function(){var c=this.media,d=c?c.currentTime:null;(0,U.isFiniteNumber)(d)&&this.log("Media seeked to "+d.toFixed(3)),this.tick()},m.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},m.onManifestParsed=function(c,d){var S,n=!1,p=!1;d.levels.forEach(function(y){(S=y.audioCodec)&&(-1!==S.indexOf("mp4a.40.2")&&(n=!0),-1!==S.indexOf("mp4a.40.5")&&(p=!0))}),this.audioCodecSwitch=n&&p&&!(0,F.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=d.levels,this.startFragRequested=!1},m.onLevelLoading=function(c,d){var n=this.levels;if(n&&this.state===L.State.IDLE){var p=n[d.level];(!p.details||p.details.live&&this.levelLastLoaded!==d.level||this.waitForCdnTuneIn(p.details))&&(this.state=L.State.WAITING_LEVEL)}},m.onLevelLoaded=function(c,d){var n,p=this.levels,S=d.level,y=d.details;if(p){this.log("Level "+S+" loaded ["+y.startSN+","+y.endSN+"], cc ["+y.startCC+", "+y.endCC+"] duration:"+y.totalduration);var M=this.fragCurrent;M&&(this.state===L.State.FRAG_LOADING||this.state===L.State.FRAG_LOADING_WAITING_RETRY)&&M.level!==d.level&&M.loader&&(this.state=L.State.IDLE,this.backtrackFragment=null,M.abortRequests());var B=p[S],G=0;if(y.live||null!==(n=B.details)&&void 0!==n&&n.live){if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed)return;G=this.alignPlaylists(y,B.details)}if(B.details=y,this.levelLastLoaded=S,this.hls.trigger(I.Events.LEVEL_UPDATED,{details:y,level:S}),this.state===L.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=L.State.IDLE}this.startFragRequested?y.live&&this.synchronizeToLiveEdge(y):this.setStartPosition(y,G),this.tick()}else this.warn("Levels were reset while loading level "+S)},m._handleFragmentLoadProgress=function(c){var d,n=c.frag,p=c.part,S=c.payload,y=this.levels;if(y){var P=y[n.level],M=P.details;if(M){var B=P.videoCodec,G=M.PTSKnown||!M.live,N=null===(d=n.initSegment)||void 0===d?void 0:d.data,q=this._getAudioCodec(P),H=this.transmuxer=this.transmuxer||new k.default(this.hls,_.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),V=p?p.index:-1,X=new x.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,S.byteLength,V,-1!==V);H.push(S,N,q,B,n,p,M.totalduration,G,X,this.initPTS[n.cc])}else this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},m.onAudioTrackSwitching=function(c,d){var n=this.altAudio,S=d.id;if(!d.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var y=this.fragCurrent;y&&(this.log("Switching to main audio track, cancel main fragment load"),y.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var P=this.hls;n&&P.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),P.trigger(I.Events.AUDIO_TRACK_SWITCHED,{id:S})}},m.onAudioTrackSwitched=function(c,d){var p=!!this.hls.audioTracks[d.id].url;if(p){var S=this.videoBuffer;S&&this.mediaBuffer!==S&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=S)}this.altAudio=p,this.tick()},m.onBufferCreated=function(c,d){var p,S,n=d.tracks,y=!1;for(var P in n){var M=n[P];if("main"===M.id){if(S=P,p=M,"video"===P){var B=n[P];B&&(this.videoBuffer=B.buffer)}}else y=!0}y&&p?(this.log("Alternate track found, use "+S+".buffered to schedule main fragment loading"),this.mediaBuffer=p.buffer):this.mediaBuffer=this.media},m.onFragBuffered=function(c,d){var n=d.frag,p=d.part;if(!n||n.type===_.PlaylistLevelType.MAIN){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(p?" p: "+p.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===L.State.PARSED&&(this.state=L.State.IDLE));var S=p?p.stats:n.stats;this.fragLastKbps=Math.round(8*S.total/(S.buffering.end-S.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,p)}},m.onError=function(c,d){if(d.type!==C.ErrorTypes.KEY_SYSTEM_ERROR)switch(d.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:case C.ErrorDetails.FRAG_PARSING_ERROR:case C.ErrorDetails.KEY_LOAD_ERROR:case C.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.MAIN,d);break;case C.ErrorDetails.LEVEL_LOAD_ERROR:case C.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==L.State.ERROR&&(d.fatal?(this.warn(""+d.details),this.state=L.State.ERROR):!d.levelRetry&&this.state===L.State.WAITING_LEVEL&&(this.state=L.State.IDLE));break;case C.ErrorDetails.BUFFER_FULL_ERROR:if("main"===d.parent&&(this.state===L.State.PARSING||this.state===L.State.PARSED)){var n=!0,p=this.getFwdBufferInfo(this.media,_.PlaylistLevelType.MAIN);p&&p.len>.5&&(n=!this.reduceMaxBufferLength(p.len)),n&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(_.PlaylistLevelType.MAIN,d)},m.checkBuffer=function(){var c=this.media,d=this.gapController;c&&d&&c.readyState&&(!this.loadedmetadata&&R.BufferHelper.getBuffered(c).length||d.poll(this.lastCurrentTime,this.state!==L.State.IDLE?this.fragCurrent:null),this.lastCurrentTime=c.currentTime)},m.onFragLoadEmergencyAborted=function(){this.state=L.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},m.onBufferFlushed=function(c,d){var n=d.type;(n!==b.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((n===b.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,n,_.PlaylistLevelType.MAIN)},m.onLevelsUpdated=function(c,d){this.levels=d.levels},m.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},m.seekToStartPos=function(){var c=this.media;if(c){var d=c.currentTime,n=this.startPosition;if(n>=0&&d<n){if(c.seeking)return void this.log("could not seek to "+n+", already seeking at "+d);var p=R.BufferHelper.getBuffered(c),y=(p.length?p.start(0):0)-n;y>0&&(y<this.config.maxBufferHole||y<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+y+" to match buffer start"),this.startPosition=n+=y),this.log("seek to target start position "+n+" from current time "+d),c.currentTime=n}}},m._getAudioCodec=function(c){var d=this.config.defaultAudioCodec||c.audioCodec;return this.audioCodecSwap&&d&&(this.log("Swapping audio codec"),d=-1!==d.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),d},m._loadBitrateTestFrag=function(c,d){var n=this;c.bitrateTest=!0,this._doFragLoad(c,d).then(function(p){var S=n.hls;if(p&&!S.nextLoadLevel&&!n.fragContextChanged(c)){n.fragLoadError=0,n.state=L.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var y=c.stats;y.parsing.start=y.parsing.end=y.buffering.start=y.buffering.end=self.performance.now(),S.trigger(I.Events.FRAG_LOADED,p),c.bitrateTest=!1}})},m._handleTransmuxComplete=function(c){var d,n="main",p=this.hls,S=c.remuxResult,y=c.chunkMeta,P=this.getCurrentContext(y);if(!P)return this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(y.level);var M=P.frag,B=P.part,G=P.level,N=S.video,q=S.text,H=S.id3,V=S.initSegment,Y=G.details,X=this.altAudio?void 0:S.audio;if(!this.fragContextChanged(M)){if(this.state=L.State.PARSING,V){V.tracks&&(this._bufferInitSegment(G,V.tracks,M,y),p.trigger(I.Events.FRAG_PARSING_INIT_SEGMENT,{frag:M,id:n,tracks:V.tracks}));var Z=V.initPTS,te=V.timescale;(0,U.isFiniteNumber)(Z)&&(this.initPTS[M.cc]=Z,p.trigger(I.Events.INIT_PTS_FOUND,{frag:M,id:n,initPTS:Z,timescale:te}))}if(N&&!1!==S.independent){if(Y){var re=N.startPTS,ne=N.endPTS,he=N.startDTS,be=N.endDTS;if(B)B.elementaryStreams[N.type]={startPTS:re,endPTS:ne,startDTS:he,endDTS:be};else if(N.firstKeyFrame&&N.independent&&1===y.id&&(this.couldBacktrack=!0),N.dropped&&N.independent){var me=this.getMainFwdBufferInfo();if((me?me.end:this.getLoadPosition())+this.config.maxBufferHole<(N.firstKeyFramePTS?N.firstKeyFramePTS:re)-this.config.maxBufferHole)return void this.backtrack(M);M.setElementaryStreamInfo(N.type,M.start,ne,M.start,be,!0)}M.setElementaryStreamInfo(N.type,re,ne,he,be),this.backtrackFragment&&(this.backtrackFragment=M),this.bufferFragmentData(N,M,B,y)}}else if(!1===S.independent)return void this.backtrack(M);if(X){var Ce=X.startPTS,ue=X.endPTS,ae=X.startDTS,ce=X.endDTS;B&&(B.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:Ce,endPTS:ue,startDTS:ae,endDTS:ce}),M.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,Ce,ue,ae,ce),this.bufferFragmentData(X,M,B,y)}Y&&null!=H&&null!==(d=H.samples)&&void 0!==d&&d.length&&p.trigger(I.Events.FRAG_PARSING_METADATA,{id:n,frag:M,details:Y,samples:H.samples}),Y&&q&&p.trigger(I.Events.FRAG_PARSING_USERDATA,{id:n,frag:M,details:Y,samples:q.samples})}},m._bufferInitSegment=function(c,d,n,p){var S=this;if(this.state===L.State.PARSING){this.audioOnly=!!d.audio&&!d.video,this.altAudio&&!this.audioOnly&&delete d.audio;var y=d.audio,P=d.video,M=d.audiovideo;if(y){var B=c.audioCodec,G=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(B&&(B=-1!==B.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==y.metadata.channelCount&&-1===G.indexOf("firefox")&&(B="mp4a.40.5")),-1!==G.indexOf("android")&&"audio/mpeg"!==y.container&&this.log("Android: force audio codec to "+(B="mp4a.40.2")),c.audioCodec&&c.audioCodec!==B&&this.log('Swapping manifest audio codec "'+c.audioCodec+'" for "'+B+'"'),y.levelCodec=B,y.id="main",this.log("Init audio buffer, container:"+y.container+", codecs[selected/level/parsed]=["+(B||"")+"/"+(c.audioCodec||"")+"/"+y.codec+"]")}P&&(P.levelCodec=c.videoCodec,P.id="main",this.log("Init video buffer, container:"+P.container+", codecs[level/parsed]=["+(c.videoCodec||"")+"/"+P.codec+"]")),M&&this.log("Init audiovideo buffer, container:"+M.container+", codecs[level/parsed]=["+(c.attrs.CODECS||"")+"/"+M.codec+"]"),this.hls.trigger(I.Events.BUFFER_CODECS,d),Object.keys(d).forEach(function(N){var H=d[N].initSegment;null!=H&&H.byteLength&&S.hls.trigger(I.Events.BUFFER_APPENDING,{type:N,data:H,frag:n,part:null,chunkMeta:p,parent:n.type})}),this.tick()}},m.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,_.PlaylistLevelType.MAIN)},m.backtrack=function(c){this.couldBacktrack=!0,this.backtrackFragment=c,this.resetTransmuxer(),this.flushBufferGap(c),this.fragmentTracker.removeFragment(c),this.fragPrevious=null,this.nextLoadPosition=c.start,this.state=L.State.IDLE},m.checkFragmentChanged=function(){var c=this.media,d=null;if(c&&c.readyState>1&&!1===c.seeking){var n=c.currentTime;if(R.BufferHelper.isBuffered(c,n)?d=this.getAppendedFrag(n):R.BufferHelper.isBuffered(c,n+.1)&&(d=this.getAppendedFrag(n+.1)),d){this.backtrackFragment=null;var p=this.fragPlaying,S=d.level;(!p||d.sn!==p.sn||p.level!==S||d.urlId!==p.urlId)&&(this.fragPlaying=d,this.hls.trigger(I.Events.FRAG_CHANGED,{frag:d}),(!p||p.level!==S)&&this.hls.trigger(I.Events.LEVEL_SWITCHED,{level:S}))}}},function o(s,h,m){h&&E(s.prototype,h),m&&E(s,m),Object.defineProperty(s,"prototype",{writable:!1})}(h,[{key:"nextLevel",get:function(){var c=this.nextBufferedFrag;return c?c.level:-1}},{key:"currentFrag",get:function(){var c=this.media;return c?this.fragPlaying||this.getAppendedFrag(c.currentTime):null}},{key:"currentProgramDateTime",get:function(){var c=this.media;if(c){var d=c.currentTime,n=this.currentFrag;if(n&&(0,U.isFiniteNumber)(d)&&(0,U.isFiniteNumber)(n.programDateTime))return new Date(n.programDateTime+1e3*(d-n.start))}return null}},{key:"currentLevel",get:function(){var c=this.currentFrag;return c?c.level:-1}},{key:"nextBufferedFrag",get:function(){var c=this.currentFrag;return c?this.followingBufferedFrag(c):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),h}(L.default)},"./src/controller/subtitle-stream-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{SubtitleStreamController:()=>u});var U=j("./src/events.ts"),L=j("./src/utils/buffer-helper.ts"),F=j("./src/controller/fragment-finders.ts"),I=j("./src/utils/discontinuities.ts"),R=j("./src/controller/level-helper.ts"),D=j("./src/controller/fragment-tracker.ts"),_=j("./src/controller/base-stream-controller.ts"),b=j("./src/types/loader.ts"),k=j("./src/types/level.ts");function x(v,a){for(var s=0;s<a.length;s++){var h=a[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(v,C(h.key),h)}}function C(v){var a=function E(v,a){if("object"!=typeof v||null===v)return v;var s=v[Symbol.toPrimitive];if(void 0!==s){var h=s.call(v,a||"default");if("object"!=typeof h)return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(v)}(v,"string");return"symbol"==typeof a?a:String(a)}function g(v,a){return(g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s})(v,a)}var u=function(v){function a(h,m,c){var d;return(d=v.call(this,h,m,c,"[subtitle-stream-controller]")||this).levels=[],d.currentTrackId=-1,d.tracksBuffered=[],d.mainDetails=null,d._registerListeners(),d}!function o(v,a){v.prototype=Object.create(a.prototype),v.prototype.constructor=v,g(v,a)}(a,v);var s=a.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var h=this.hls;h.on(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(U.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.on(U.Events.ERROR,this.onError,this),h.on(U.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(U.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),h.on(U.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),h.on(U.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),h.on(U.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.on(U.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var h=this.hls;h.off(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(U.Events.LEVEL_LOADED,this.onLevelLoaded,this),h.off(U.Events.ERROR,this.onError,this),h.off(U.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.off(U.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),h.off(U.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),h.off(U.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),h.off(U.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.off(U.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.startLoad=function(h){this.stopLoad(),this.state=_.State.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=h,this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(h,m){this.mainDetails=m.details},s.onSubtitleFragProcessed=function(h,m){var c=m.frag,d=m.success;if(this.fragPrevious=c,this.state=_.State.IDLE,d){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var p,S=c.start,y=0;y<n.length;y++)if(S>=n[y].start&&S<=n[y].end){p=n[y];break}var P=c.start+c.duration;p?p.end=P:n.push(p={start:S,end:P}),this.fragmentTracker.fragBuffered(c)}}},s.onBufferFlushing=function(h,m){var c=m.startOffset,d=m.endOffset;if(0===c&&d!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,p=this.levels;if(!p.length||!p[n]||!p[n].details)return;var P=d-p[n].details.targetduration;if(P<=0)return;m.endOffsetSubtitles=Math.max(0,P),this.tracksBuffered.forEach(function(M){for(var B=0;B<M.length;)if(M[B].end<=P)M.shift();else{if(!(M[B].start<P))break;M[B].start=P,B++}}),this.fragmentTracker.removeFragmentsInRange(c,P,b.PlaylistLevelType.SUBTITLE)}},s.onFragBuffered=function(h,m){var c;this.loadedmetadata||m.frag.type!==b.PlaylistLevelType.MAIN||null!==(c=this.media)&&void 0!==c&&c.buffered.length&&(this.loadedmetadata=!0)},s.onError=function(h,m){var c=m.frag;!c||c.type!==b.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=_.State.IDLE)},s.onSubtitleTracksUpdated=function(h,m){var c=this,d=m.subtitleTracks;this.tracksBuffered=[],this.levels=d.map(function(n){return new k.Level(n)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(n){c.tracksBuffered[n.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(h,m){if(this.currentTrackId=m.id,this.levels.length&&-1!==this.currentTrackId){var c=this.levels[this.currentTrackId];this.mediaBuffer=null!=c&&c.details?this.mediaBufferTimeRanges:null,c&&this.setInterval(500)}else this.clearInterval()},s.onSubtitleTrackLoaded=function(h,m){var c,d=m.details,n=m.id,p=this.currentTrackId,S=this.levels;if(S.length){var y=S[p];if(!(n>=S.length||n!==p)&&y){this.mediaBuffer=this.mediaBufferTimeRanges;var P=0;if(d.live||null!==(c=y.details)&&void 0!==c&&c.live){var M=this.mainDetails;if(d.deltaUpdateFailed||!M)return;var B=M.fragments[0];y.details?0===(P=this.alignPlaylists(d,y.details))&&B&&(0,R.addSliding)(d,P=B.start):d.hasProgramDateTime&&M.hasProgramDateTime?((0,I.alignMediaPlaylistByPDT)(d,M),P=d.fragments[0].start):B&&(0,R.addSliding)(d,P=B.start)}y.details=d,this.levelLastLoaded=n,!this.startFragRequested&&(this.mainDetails||!d.live)&&this.setStartPosition(y.details,P),this.tick(),d.live&&!this.fragCurrent&&this.media&&this.state===_.State.IDLE&&((0,F.findFragmentByPTS)(null,d.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0))}}},s._handleFragmentLoadComplete=function(h){var m=this,c=h.frag,d=h.payload,n=c.decryptdata,p=this.hls;if(!this.fragContextChanged(c)&&d&&d.byteLength>0&&n&&n.key&&n.iv&&"AES-128"===n.method){var S=performance.now();this.decrypter.decrypt(new Uint8Array(d),n.key.buffer,n.iv.buffer).then(function(y){var P=performance.now();p.trigger(U.Events.FRAG_DECRYPTED,{frag:c,payload:y,stats:{tstart:S,tdecrypt:P}})}).catch(function(y){m.warn(y.name+": "+y.message),m.state=_.State.IDLE})}},s.doTick=function(){if(this.media){if(this.state===_.State.IDLE){var h=this.currentTrackId,m=this.levels;if(!m.length||!m[h]||!m[h].details)return;var c=m[h].details,d=c.targetduration,n=this.config,p=this.getLoadPosition(),S=L.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],p-d,n.maxBufferHole),y=S.end,P=S.len,M=this.getFwdBufferInfo(this.media,b.PlaylistLevelType.MAIN);if(P>this.getMaxBufferLength(M?.len)+d)return;console.assert(c,"Subtitle track details are defined on idle subtitle stream controller tick");var G=c.fragments,N=G.length,H=null,V=this.fragPrevious;if(y<c.edge){var Y=n.maxFragLookUpTolerance;!(H=(0,F.findFragmentByPTS)(V,G,Math.max(G[0].start,y),Y))&&V&&V.start<G[0].start&&(H=G[0])}else H=G[N-1];if(!H)return;H=this.mapToInitFragWhenRequired(H),this.fragmentTracker.getState(H)===D.FragmentState.NOT_LOADED&&this.loadFragment(H,c,y)}}else this.state=_.State.IDLE},s.getMaxBufferLength=function(h){var m=v.prototype.getMaxBufferLength.call(this);return h?Math.max(m,h):m},s.loadFragment=function(h,m,c){this.fragCurrent=h,"initSegment"===h.sn?this._loadInitSegment(h,m):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,h,m,c))},function T(v,a,s){a&&x(v.prototype,a),s&&x(v,s),Object.defineProperty(v,"prototype",{writable:!1})}(a,[{key:"mediaBufferTimeRanges",get:function(){return new A(this.tracksBuffered[this.currentTrackId]||[])}}]),a}(_.default),A=function(v){this.buffered=void 0;var a=function(s,h,m){if((h>>>=0)>m-1)throw new DOMException("Failed to execute '"+s+"' on 'TimeRanges': The index provided ("+h+") is greater than the maximum bound ("+m+")");return v[h][s]};this.buffered={get length(){return v.length},end:function(s){return a("end",s,v.length)},start:function(s){return a("start",s,v.length)}}}},"./src/controller/subtitle-track-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>E});var U=j("./src/events.ts"),L=j("./src/utils/texttrack-utils.ts"),F=j("./src/controller/base-playlist-controller.ts"),I=j("./src/types/loader.ts");function R(o,g){for(var f=0;f<g.length;f++){var u=g[f];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(o,_(u.key),u)}}function _(o){var g=function b(o,g){if("object"!=typeof o||null===o)return o;var f=o[Symbol.toPrimitive];if(void 0!==f){var u=f.call(o,g||"default");if("object"!=typeof u)return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===g?String:Number)(o)}(o,"string");return"symbol"==typeof g?g:String(g)}function x(o,g){return(x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,u){return f.__proto__=u,f})(o,g)}function C(o){for(var g=[],f=0;f<o.length;f++){var u=o[f];"subtitles"===u.kind&&u.label&&g.push(o[f])}return g}const E=function(o){function g(u){var A;return(A=o.call(this,u,"[subtitle-track-controller]")||this).media=null,A.tracks=[],A.groupId=null,A.tracksInGroup=[],A.trackId=-1,A.selectDefaultTrack=!0,A.queuedDefaultTrack=-1,A.trackChangeListener=function(){return A.onTextTracksChanged()},A.asyncPollTrackChange=function(){return A.pollTrackChange(0)},A.useTextTrackPolling=!1,A.subtitlePollingInterval=-1,A._subtitleDisplay=!0,A.registerListeners(),A}!function k(o,g){o.prototype=Object.create(g.prototype),o.prototype.constructor=o,x(o,g)}(g,o);var f=g.prototype;return f.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,o.prototype.destroy.call(this)},f.registerListeners=function(){var u=this.hls;u.on(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(U.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(U.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(U.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.on(U.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.on(U.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var u=this.hls;u.off(U.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(U.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(U.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(U.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(U.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(U.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),u.off(U.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.off(U.Events.ERROR,this.onError,this)},f.onMediaAttached=function(u,A){this.media=A.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},f.pollTrackChange=function(u){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,u)},f.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),C(this.media.textTracks).forEach(function(A){(0,L.clearCurrentCues)(A)}),this.subtitleTrack=-1,this.media=null)},f.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},f.onManifestParsed=function(u,A){this.tracks=A.subtitleTracks},f.onSubtitleTrackLoaded=function(u,A){var v=A.id,a=A.details,h=this.tracksInGroup[this.trackId];if(h){var m=h.details;h.details=A.details,this.log("subtitle track "+v+" loaded ["+a.startSN+"-"+a.endSN+"]"),v===this.trackId&&(this.retryCount=0,this.playlistLoaded(v,A,m))}else this.warn("Invalid subtitle track id "+v)},f.onLevelLoading=function(u,A){this.switchLevel(A.level)},f.onLevelSwitching=function(u,A){this.switchLevel(A.level)},f.switchLevel=function(u){var A=this.hls.levels[u];if(null!=A&&A.textGroupIds){var v=A.textGroupIds[A.urlId];if(this.groupId!==v){var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(c){return!v||c.groupId===v});this.tracksInGroup=s;var h=this.findTrackId(a?.name)||this.findTrackId();this.groupId=v;var m={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+v+'" group-id'),this.hls.trigger(U.Events.SUBTITLE_TRACKS_UPDATED,m),-1!==h&&this.setSubtitleTrack(h,a)}}},f.findTrackId=function(u){for(var A=this.tracksInGroup,v=0;v<A.length;v++){var a=A[v];if((!this.selectDefaultTrack||a.default)&&(!u||u===a.name))return a.id}return-1},f.onError=function(u,A){o.prototype.onError.call(this,u,A),!A.fatal&&A.context&&A.context.type===I.PlaylistContextType.SUBTITLE_TRACK&&A.context.id===this.trackId&&A.context.groupId===this.groupId&&this.retryLoadingOrFail(A)},f.loadPlaylist=function(u){o.prototype.loadPlaylist.call(this);var A=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(A)){var v=A.id,a=A.groupId,s=A.url;if(u)try{s=u.addDirectives(s)}catch(h){this.warn("Could not construct new URL with HLS Delivery Directives: "+h)}this.log("Loading subtitle playlist for id "+v),this.hls.trigger(U.Events.SUBTITLE_TRACK_LOADING,{url:s,id:v,groupId:a,deliveryDirectives:u||null})}},f.toggleTrackModes=function(u){var A=this,v=this.media,a=this.trackId;if(v){var s=C(v.textTracks),h=s.filter(function(d){return d.groupId===A.groupId});if(-1===u)[].slice.call(s).forEach(function(d){d.mode="disabled"});else{var m=h[a];m&&(m.mode="disabled")}var c=h[u];c&&(c.mode=this.subtitleDisplay?"showing":"hidden")}},f.setSubtitleTrack=function(u,A){var v,a=this.tracksInGroup;if(this.media){if(this.trackId!==u&&this.toggleTrackModes(u),!(this.trackId===u&&(-1===u||null!==(v=a[u])&&void 0!==v&&v.details)||u<-1||u>=a.length)){this.clearTimer();var s=a[u];if(this.log("Switching to subtitle track "+u),this.trackId=u,s){var m=s.groupId;this.hls.trigger(U.Events.SUBTITLE_TRACK_SWITCH,{id:s.id,groupId:void 0===m?"":m,name:s.name,type:s.type,url:s.url});var S=this.switchParams(s.url,A?.details);this.loadPlaylist(S)}else this.hls.trigger(U.Events.SUBTITLE_TRACK_SWITCH,{id:u})}}else this.queuedDefaultTrack=u},f.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var u=-1,A=C(this.media.textTracks),v=0;v<A.length;v++)if("hidden"===A[v].mode)u=v;else if("showing"===A[v].mode){u=v;break}this.subtitleTrack!==u&&(this.subtitleTrack=u)}},function D(o,g,f){g&&R(o.prototype,g),f&&R(o,f),Object.defineProperty(o,"prototype",{writable:!1})}(g,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(u){this._subtitleDisplay=u,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(u){this.selectDefaultTrack=!1,this.setSubtitleTrack(u,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}}]),g}(F.default)},"./src/controller/timeline-controller.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{TimelineController:()=>T});var U=j("./src/polyfills/number.ts"),L=j("./src/events.ts"),F=j("./src/utils/cea-608-parser.ts"),I=j("./src/utils/output-filter.ts"),R=j("./src/utils/webvtt-parser.ts"),D=j("./src/utils/texttrack-utils.ts"),_=j("./src/utils/imsc1-ttml-parser.ts"),b=j("./src/utils/mp4-tools.ts"),k=j("./src/types/loader.ts"),x=j("./src/utils/logger.ts"),T=function(){function g(u){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=u,this.config=u.config,this.Cues=u.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var A=new I.default(this,"textTrack1"),v=new I.default(this,"textTrack2"),a=new I.default(this,"textTrack3"),s=new I.default(this,"textTrack4");this.cea608Parser1=new F.default(1,A,v),this.cea608Parser2=new F.default(3,a,s)}u.on(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(L.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.on(L.Events.FRAG_LOADING,this.onFragLoading,this),u.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(L.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),u.on(L.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),u.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.on(L.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),u.on(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var f=g.prototype;return f.destroy=function(){var u=this.hls;u.off(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.off(L.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.off(L.Events.FRAG_LOADING,this.onFragLoading,this),u.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),u.off(L.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),u.off(L.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),u.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.off(L.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),u.off(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},f.addCues=function(u,A,v,a,s){for(var h=!1,m=s.length;m--;){var c=s[m],d=E(c[0],c[1],A,v);if(d>=0&&(c[0]=Math.min(c[0],A),c[1]=Math.max(c[1],v),h=!0,d/(v-A)>.5))return}if(h||s.push([A,v]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[u],A,v,a);else{var p=this.Cues.newCue(null,A,v,a);this.hls.trigger(L.Events.CUES_PARSED,{type:"captions",cues:p,track:u})}},f.onInitPtsFound=function(u,A){var v=this,a=A.frag,m=A.timescale,c=this.unparsedVttFrags;"main"===A.id&&(this.initPTS[a.cc]=A.initPTS,this.timescale[a.cc]=m),c.length&&(this.unparsedVttFrags=[],c.forEach(function(d){v.onFragLoaded(L.Events.FRAG_LOADED,d)}))},f.getExistingTrack=function(u){var A=this.media;if(A)for(var v=0;v<A.textTracks.length;v++){var a=A.textTracks[v];if(a[u])return a}return null},f.createCaptionsTrack=function(u){this.config.renderTextTracksNatively?this.createNativeTrack(u):this.createNonNativeTrack(u)},f.createNativeTrack=function(u){if(!this.captionsTracks[u]){var v=this.captionsTracks,a=this.media,s=this.captionsProperties[u],h=s.label,m=s.languageCode,c=this.getExistingTrack(u);if(c)v[u]=c,(0,D.clearCurrentCues)(v[u]),(0,D.sendAddTrackEvent)(v[u],a);else{var d=this.createTextTrack("captions",h,m);d&&(d[u]=!0,v[u]=d)}}},f.createNonNativeTrack=function(u){if(!this.nonNativeCaptionsTracks[u]){var A=this.captionsProperties[u];if(A){var a={_id:u,label:A.label,kind:"captions",default:!!A.media&&!!A.media.default,closedCaptions:A.media};this.nonNativeCaptionsTracks[u]=a,this.hls.trigger(L.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[a]})}}},f.createTextTrack=function(u,A,v){var a=this.media;if(a)return a.addTextTrack(u,A,v)},f.onMediaAttaching=function(u,A){this.media=A.media,this._cleanTracks()},f.onMediaDetaching=function(){var u=this.captionsTracks;Object.keys(u).forEach(function(A){(0,D.clearCurrentCues)(u[A]),delete u[A]}),this.nonNativeCaptionsTracks={}},f.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},f._cleanTracks=function(){var u=this.media;if(u){var A=u.textTracks;if(A)for(var v=0;v<A.length;v++)(0,D.clearCurrentCues)(A[v])}},f.onSubtitleTracksUpdated=function(u,A){var v=this;this.textTracks=[];var a=A.subtitleTracks||[],s=a.some(function(d){return d.textCodec===_.IMSC1_CODEC});if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var h=this.tracks&&a&&this.tracks.length===a.length;if(this.tracks=a||[],this.config.renderTextTracksNatively){var m=this.media?this.media.textTracks:[];this.tracks.forEach(function(d,n){var p;if(n<m.length){for(var S=null,y=0;y<m.length;y++)if(C(m[y],d)){S=m[y];break}S&&(p=S)}if(p)(0,D.clearCurrentCues)(p);else{var P=v._captionsOrSubtitlesFromCharacteristics(d);(p=v.createTextTrack(P,d.name,d.lang))&&(p.mode="disabled")}p&&(p.groupId=d.groupId,v.textTracks.push(p))})}else if(!h&&this.tracks&&this.tracks.length){var c=this.tracks.map(function(d){return{label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}});this.hls.trigger(L.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}},f._captionsOrSubtitlesFromCharacteristics=function(u){var A;if(null!==(A=u.attrs)&&void 0!==A&&A.CHARACTERISTICS){var v=/transcribes-spoken-dialog/gi.test(u.attrs.CHARACTERISTICS),a=/describes-music-and-sound/gi.test(u.attrs.CHARACTERISTICS);if(v&&a)return"captions"}return"subtitles"},f.onManifestLoaded=function(u,A){var v=this;this.config.enableCEA708Captions&&A.captions&&A.captions.forEach(function(a){var s=/(?:CC|SERVICE)([1-4])/.exec(a.instreamId);if(s){var m=v.captionsProperties["textTrack"+s[1]];!m||(m.label=a.name,a.lang&&(m.languageCode=a.lang),m.media=a)}})},f.closedCaptionsForLevel=function(u){return this.hls.levels[u.level]?.attrs["CLOSED-CAPTIONS"]},f.onFragLoading=function(u,A){var v=this.cea608Parser1,a=this.cea608Parser2,s=this.lastSn;if(this.enabled&&v&&a&&A.frag.type===k.PlaylistLevelType.MAIN){var m,c,d=A.frag.sn,n=null!=(m=null==A||null===(c=A.part)||void 0===c?void 0:c.index)?m:-1;d===s+1||d===s&&n===this.lastPartIndex+1||(v.reset(),a.reset()),this.lastSn=d,this.lastPartIndex=n}},f.onFragLoaded=function(u,A){var v=A.frag,a=A.payload,s=this.initPTS,h=this.unparsedVttFrags;if(v.type===k.PlaylistLevelType.SUBTITLE)if(a.byteLength){if(!(0,U.isFiniteNumber)(s[v.cc]))return h.push(A),void(s.length&&this.hls.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:v,error:new Error("Missing initial subtitle PTS")}));var m=v.decryptdata;if(null==m||!m.encrypted||"stats"in A){var d=this.tracks[v.level],n=this.vttCCs;n[v.cc]||(n[v.cc]={start:v.start,prevCC:this.prevCC,new:!0},this.prevCC=v.cc),d&&d.textCodec===_.IMSC1_CODEC?this._parseIMSC1(v,a):this._parseVTTs(v,a,n)}}else this.hls.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:v,error:new Error("Empty subtitle payload")})},f._parseIMSC1=function(u,A){var v=this,a=this.hls;(0,_.parseIMSC1)(A,this.initPTS[u.cc],this.timescale[u.cc],function(s){v._appendCues(s,u.level),a.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:u})},function(s){x.logger.log("Failed to parse IMSC1: "+s),a.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u,error:s})})},f._parseVTTs=function(u,A,v){var a,s=this,h=this.hls,m=null!==(a=u.initSegment)&&void 0!==a&&a.data?(0,b.appendUint8Array)(u.initSegment.data,new Uint8Array(A)):A;(0,R.parseWebVTT)(m,this.initPTS[u.cc],this.timescale[u.cc],v,u.cc,u.start,function(c){s._appendCues(c,u.level),h.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:u})},function(c){s._fallbackToIMSC1(u,A),x.logger.log("Failed to parse VTT cue: "+c),h.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u,error:c})})},f._fallbackToIMSC1=function(u,A){var v=this,a=this.tracks[u.level];a.textCodec||(0,_.parseIMSC1)(A,this.initPTS[u.cc],this.timescale[u.cc],function(){a.textCodec=_.IMSC1_CODEC,v._parseIMSC1(u,A)},function(){a.textCodec="wvtt"})},f._appendCues=function(u,A){var v=this.hls;if(this.config.renderTextTracksNatively){var a=this.textTracks[A];if(!a||"disabled"===a.mode)return;u.forEach(function(m){return(0,D.addCueToTrack)(a,m)})}else{var s=this.tracks[A];if(!s)return;v.trigger(L.Events.CUES_PARSED,{type:"subtitles",cues:u,track:s.default?"default":"subtitles"+A})}},f.onFragDecrypted=function(u,A){var v=A.frag;if(v.type===k.PlaylistLevelType.SUBTITLE){if(!(0,U.isFiniteNumber)(this.initPTS[v.cc]))return void this.unparsedVttFrags.push(A);this.onFragLoaded(L.Events.FRAG_LOADED,A)}},f.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},f.onFragParsingUserdata=function(u,A){var v=this.cea608Parser1,a=this.cea608Parser2;if(this.enabled&&v&&a){var s=A.frag,h=A.samples;if(s.type!==k.PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(s))for(var m=0;m<h.length;m++){var c=h[m].bytes;if(c){var d=this.extractCea608Data(c);v.addData(h[m].pts,d[0]),a.addData(h[m].pts,d[1])}}}},f.onBufferFlushing=function(u,A){var v=A.startOffset,a=A.endOffset,s=A.endOffsetSubtitles,h=A.type,m=this.media;if(m&&!(m.currentTime<a)){if(!h||"video"===h){var c=this.captionsTracks;Object.keys(c).forEach(function(n){return(0,D.removeCuesInRange)(c[n],v,a)})}if(this.config.renderTextTracksNatively&&0===v&&void 0!==s){var d=this.textTracks;Object.keys(d).forEach(function(n){return(0,D.removeCuesInRange)(d[n],v,s)})}}},f.extractCea608Data=function(u){for(var A=[[],[]],v=31&u[0],a=2,s=0;s<v;s++){var h=u[a++],m=127&u[a++],c=127&u[a++];if((0!==m||0!==c)&&0!=(4&h)){var n=3&h;(0===n||1===n)&&(A[n].push(m),A[n].push(c))}}return A},g}();function C(g,f){return g&&g.label===f.name&&!(g.textTrack1||g.textTrack2)}function E(g,f,u,A){return Math.min(f,A)-Math.max(g,u)}},"./src/crypt/aes-crypto.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>U});var U=function(){function L(I,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=I,this.aesIV=R}return L.prototype.decrypt=function(I,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,I)},L}()},"./src/crypt/aes-decryptor.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>F,removePadding:()=>L});var U=j("./src/utils/typed-array.ts");function L(I){var R=I.byteLength,D=R&&new DataView(I.buffer).getUint8(R-1);return D?(0,U.sliceUint8)(I,0,R-D):I}var F=function(){function I(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=I.prototype;return R.uint8ArrayToUint32Array_=function(D){for(var _=new DataView(D),b=new Uint32Array(4),k=0;k<4;k++)b[k]=_.getUint32(4*k);return b},R.initTable=function(){var D=this.sBox,_=this.invSBox,b=this.subMix,k=b[0],x=b[1],T=b[2],C=b[3],E=this.invSubMix,o=E[0],g=E[1],f=E[2],u=E[3],A=new Uint32Array(256),v=0,a=0,s=0;for(s=0;s<256;s++)A[s]=s<128?s<<1:s<<1^283;for(s=0;s<256;s++){var h=a^a<<1^a<<2^a<<3^a<<4;D[v]=h=h>>>8^255&h^99,_[h]=v;var m=A[v],c=A[m],d=A[c],n=257*A[h]^16843008*h;k[v]=n<<24|n>>>8,x[v]=n<<16|n>>>16,T[v]=n<<8|n>>>24,C[v]=n,o[h]=(n=16843009*d^65537*c^257*m^16843008*v)<<24|n>>>8,g[h]=n<<16|n>>>16,f[h]=n<<8|n>>>24,u[h]=n,v?(v=m^A[A[A[d^m]]],a^=A[A[a]]):v=a=1}},R.expandKey=function(D){for(var _=this.uint8ArrayToUint32Array_(D),b=!0,k=0;k<_.length&&b;)b=_[k]===this.key[k],k++;if(!b){this.key=_;var x=this.keySize=_.length;if(4!==x&&6!==x&&8!==x)throw new Error("Invalid aes key size="+x);var C,E,m,c,T=this.ksRows=4*(x+6+1),o=this.keySchedule=new Uint32Array(T),g=this.invKeySchedule=new Uint32Array(T),f=this.sBox,u=this.rcon,A=this.invSubMix,v=A[0],a=A[1],s=A[2],h=A[3];for(C=0;C<T;C++)C<x?m=o[C]=_[C]:(c=m,C%x==0?(c=f[(c=c<<8|c>>>24)>>>24]<<24|f[c>>>16&255]<<16|f[c>>>8&255]<<8|f[255&c],c^=u[C/x|0]<<24):x>6&&C%x==4&&(c=f[c>>>24]<<24|f[c>>>16&255]<<16|f[c>>>8&255]<<8|f[255&c]),o[C]=m=(o[C-x]^c)>>>0);for(E=0;E<T;E++)C=T-E,c=3&E?o[C]:o[C-4],g[E]=E<4||C<=4?c:v[f[c>>>24]]^a[f[c>>>16&255]]^s[f[c>>>8&255]]^h[f[255&c]],g[E]=g[E]>>>0}},R.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},R.decrypt=function(D,_,b){for(var d,n,p,S,y,P,M,B,G,N,q,H,V,k=this.keySize+6,x=this.invKeySchedule,T=this.invSBox,C=this.invSubMix,E=C[0],o=C[1],g=C[2],f=C[3],u=this.uint8ArrayToUint32Array_(b),A=u[0],v=u[1],a=u[2],s=u[3],h=new Int32Array(D),m=new Int32Array(h.length),Y=this.networkToHostOrderSwap;_<h.length;){for(B=Y(h[_]),G=Y(h[_+1]),N=Y(h[_+2]),q=Y(h[_+3]),S=B^x[0],y=q^x[1],P=N^x[2],M=G^x[3],H=4,V=1;V<k;V++)d=E[y>>>24]^o[P>>16&255]^g[M>>8&255]^f[255&S]^x[H+1],n=E[P>>>24]^o[M>>16&255]^g[S>>8&255]^f[255&y]^x[H+2],p=E[M>>>24]^o[S>>16&255]^g[y>>8&255]^f[255&P]^x[H+3],S=E[S>>>24]^o[y>>16&255]^g[P>>8&255]^f[255&M]^x[H],y=d,P=n,M=p,H+=4;d=T[y>>>24]<<24^T[P>>16&255]<<16^T[M>>8&255]<<8^T[255&S]^x[H+1],n=T[P>>>24]<<24^T[M>>16&255]<<16^T[S>>8&255]<<8^T[255&y]^x[H+2],p=T[M>>>24]<<24^T[S>>16&255]<<16^T[y>>8&255]<<8^T[255&P]^x[H+3],m[_]=Y(T[S>>>24]<<24^T[y>>16&255]<<16^T[P>>8&255]<<8^T[255&M]^x[H]^A),m[_+1]=Y(p^v),m[_+2]=Y(n^a),m[_+3]=Y(d^s),A=B,v=G,a=N,s=q,_+=4}return m.buffer},I}()},"./src/crypt/decrypter.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>b});var U=j("./src/crypt/aes-crypto.ts"),L=j("./src/crypt/fast-aes-key.ts"),F=j("./src/crypt/aes-decryptor.ts"),I=j("./src/utils/logger.ts"),R=j("./src/utils/mp4-tools.ts"),D=j("./src/utils/typed-array.ts"),b=function(){function k(T,C){var o=(void 0===C?{}:C).removePKCS7Padding,g=void 0===o||o;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=T.enableSoftwareAES,this.removePKCS7Padding=g,g)try{var f=self.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch{}null===this.subtle&&(this.useSoftware=!0)}var x=k.prototype;return x.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},x.isSync=function(){return this.useSoftware},x.flush=function(){var T=this.currentResult,C=this.remainderData;if(!T||C)return I.logger.error("[softwareDecrypt] "+(C?"overflow bytes: "+C.byteLength:"no result")),this.reset(),null;var E=new Uint8Array(T);return this.reset(),this.removePKCS7Padding?(0,F.removePadding)(E):E},x.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},x.decrypt=function(T,C,E){var o=this;return this.useSoftware?new Promise(function(g,f){o.softwareDecrypt(new Uint8Array(T),C,E);var u=o.flush();u?g(u.buffer):f(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(T),C,E)},x.softwareDecrypt=function(T,C,E){var o=this.currentIV,g=this.currentResult,f=this.remainderData;this.logOnce("JS AES decrypt"),f&&(T=(0,R.appendUint8Array)(f,T),this.remainderData=null);var u=this.getValidChunk(T);if(!u.length)return null;o&&(E=o);var A=this.softwareDecrypter;A||(A=this.softwareDecrypter=new F.default),A.expandKey(C);var v=g;return this.currentResult=A.decrypt(u.buffer,0,E),this.currentIV=(0,D.sliceUint8)(u,-16).buffer,v||null},x.webCryptoDecrypt=function(T,C,E){var o=this,g=this.subtle;return(this.key!==C||!this.fastAesKey)&&(this.key=C,this.fastAesKey=new L.default(g,C)),this.fastAesKey.expandKey().then(function(f){return g?(o.logOnce("WebCrypto AES decrypt"),new U.default(g,new Uint8Array(E)).decrypt(T.buffer,f)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(f){return I.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+f.name+": "+f.message),o.onWebCryptoError(T,C,E)})},x.onWebCryptoError=function(T,C,E){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(T,C,E);var o=this.flush();if(o)return o.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},x.getValidChunk=function(T){var C=T,E=T.length-T.length%16;return E!==T.length&&(C=(0,D.sliceUint8)(T,0,E),this.remainderData=(0,D.sliceUint8)(T,E)),C},x.logOnce=function(T){!this.logEnabled||(I.logger.log("[decrypter]: "+T),this.logEnabled=!1)},k}()},"./src/crypt/fast-aes-key.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>U});var U=function(){function L(I,R){this.subtle=void 0,this.key=void 0,this.subtle=I,this.key=R}return L.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},L}()},"./src/demux/aacdemuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>b});var U=j("./src/demux/base-audio-demuxer.ts"),L=j("./src/demux/adts.ts"),F=j("./src/utils/logger.ts"),I=j("./src/demux/id3.ts");function D(k,x){return(D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,C){return T.__proto__=C,T})(k,x)}const b=function(k){function x(C,E){var o;return(o=k.call(this)||this).observer=void 0,o.config=void 0,o.observer=C,o.config=E,o}!function R(k,x){k.prototype=Object.create(x.prototype),k.prototype.constructor=k,D(k,x)}(x,k);var T=x.prototype;return T.resetInitSegment=function(C,E,o,g){k.prototype.resetInitSegment.call(this,C,E,o,g),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:E,duration:g,inputTimeScale:9e4,dropped:0}},x.probe=function(C){if(!C)return!1;for(var o=(I.getID3Data(C,0)||[]).length,g=C.length;o<g;o++)if(L.probe(C,o))return F.logger.log("ADTS sync word found !"),!0;return!1},T.canParse=function(C,E){return L.canParse(C,E)},T.appendFrame=function(C,E,o){L.initTrackConfig(C,this.observer,E,o,C.manifestCodec);var g=L.appendFrame(C,E,o,this.basePTS,this.frameIndex);if(g&&0===g.missing)return g},x}(U.default)},"./src/demux/adts.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{appendFrame:()=>g,canGetFrameLength:()=>b,canParse:()=>x,getAudioConfig:()=>I,getFrameDuration:()=>E,getFullFrameLength:()=>_,getHeaderLength:()=>D,initTrackConfig:()=>C,isHeader:()=>k,isHeaderPattern:()=>R,parseFrameHeader:()=>o,probe:()=>T});var U=j("./src/utils/logger.ts"),L=j("./src/errors.ts"),F=j("./src/events.ts");function I(f,u,A,v){var a,s,h,m,c=navigator.userAgent.toLowerCase(),d=v,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=1+((192&u[A+2])>>>6);var p=(60&u[A+2])>>>2;if(!(p>n.length-1))return h=(1&u[A+2])<<2,h|=(192&u[A+3])>>>6,U.logger.log("manifest codec:"+v+", ADTS type:"+a+", samplingIndex:"+p),/firefox/i.test(c)?p>=6?(a=5,m=new Array(4),s=p-3):(a=2,m=new Array(2),s=p):-1!==c.indexOf("android")?(a=2,m=new Array(2),s=p):(a=5,m=new Array(4),v&&(-1!==v.indexOf("mp4a.40.29")||-1!==v.indexOf("mp4a.40.5"))||!v&&p>=6?s=p-3:((v&&-1!==v.indexOf("mp4a.40.2")&&(p>=6&&1===h||/vivaldi/i.test(c))||!v&&1===h)&&(a=2,m=new Array(2)),s=p)),m[0]=a<<3,m[0]|=(14&p)>>1,m[1]|=(1&p)<<7,m[1]|=h<<3,5===a&&(m[1]|=(14&s)>>1,m[2]=(1&s)<<7,m[2]|=8,m[3]=0),{config:m,samplerate:n[p],channelCount:h,codec:"mp4a.40."+a,manifestCodec:d};f.trigger(F.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function R(f,u){return 255===f[u]&&240==(246&f[u+1])}function D(f,u){return 1&f[u+1]?7:9}function _(f,u){return(3&f[u+3])<<11|f[u+4]<<3|(224&f[u+5])>>>5}function b(f,u){return u+5<f.length}function k(f,u){return u+1<f.length&&R(f,u)}function x(f,u){return b(f,u)&&R(f,u)&&_(f,u)<=f.length-u}function T(f,u){if(k(f,u)){var A=D(f,u);if(u+A>=f.length)return!1;var v=_(f,u);if(v<=A)return!1;var a=u+v;return a===f.length||k(f,a)}return!1}function C(f,u,A,v,a){if(!f.samplerate){var s=I(u,A,v,a);if(!s)return;f.config=s.config,f.samplerate=s.samplerate,f.channelCount=s.channelCount,f.codec=s.codec,f.manifestCodec=s.manifestCodec,U.logger.log("parsed codec:"+f.codec+", rate:"+s.samplerate+", channels:"+s.channelCount)}}function E(f){return 9216e4/f}function o(f,u){var A=D(f,u);if(u+A<=f.length){var v=_(f,u)-A;if(v>0)return{headerLength:A,frameLength:v}}}function g(f,u,A,v,a){var c,h=v+a*E(f.samplerate),m=o(u,A);if(m){var n=m.headerLength,p=n+m.frameLength,S=Math.max(0,A+p-u.length);S?(c=new Uint8Array(p-n)).set(u.subarray(A+n,u.length),0):c=u.subarray(A+n,A+p);var y={unit:c,pts:h};return S||f.samples.push(y),{sample:y,length:p,missing:S}}var P=u.length-A;return(c=new Uint8Array(P)).set(u.subarray(A,u.length),0),{sample:{unit:c,pts:h},length:P,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>k,initPTSFn:()=>b});var U=j("./src/polyfills/number.ts"),L=j("./src/demux/id3.ts"),F=j("./src/types/demuxer.ts"),I=j("./src/demux/dummy-demuxed-track.ts"),R=j("./src/utils/mp4-tools.ts"),D=j("./src/utils/typed-array.ts"),_=function(){function x(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var T=x.prototype;return T.resetInitSegment=function(C,E,o,g){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},T.resetTimeStamp=function(C){this.initPTS=C,this.resetContiguity()},T.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},T.canParse=function(C,E){return!1},T.appendFrame=function(C,E,o){},T.demux=function(C,E){this.cachedData&&(C=(0,R.appendUint8Array)(this.cachedData,C),this.cachedData=null);var f,o=L.getID3Data(C,0),g=o?o.length:0,u=this._audioTrack,A=this._id3Track,v=o?L.getTimeStamp(o):void 0,a=C.length;for((null===this.basePTS||0===this.frameIndex&&(0,U.isFiniteNumber)(v))&&(this.basePTS=b(v,E,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),o&&o.length>0&&A.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:o,type:F.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});g<a;){if(this.canParse(C,g)){var s=this.appendFrame(u,C,g);s?(this.frameIndex++,this.lastPTS=s.sample.pts,f=g+=s.length):g=a}else L.canParse(C,g)?(o=L.getID3Data(C,g),A.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:o,type:F.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),f=g+=o.length):g++;if(g===a&&f!==a){var h=(0,D.sliceUint8)(C,f);this.cachedData=this.cachedData?(0,R.appendUint8Array)(this.cachedData,h):h}}return{audioTrack:u,videoTrack:(0,I.dummyTrack)(),id3Track:A,textTrack:(0,I.dummyTrack)()}},T.demuxSampleAes=function(C,E,o){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},T.flush=function(C){var E=this.cachedData;return E&&(this.cachedData=null,this.demux(E,0)),{audioTrack:this._audioTrack,videoTrack:(0,I.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,I.dummyTrack)()}},T.destroy=function(){},x}(),b=function(x,T,C){return(0,U.isFiniteNumber)(x)?90*x:9e4*T+(C||0)};const k=_},"./src/demux/chunk-cache.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>U});var U=function(){function F(){this.chunks=[],this.dataLength=0}var I=F.prototype;return I.push=function(R){this.chunks.push(R),this.dataLength+=R.length},I.flush=function(){var _,R=this.chunks;return R.length?(_=1===R.length?R[0]:function L(F,I){for(var R=new Uint8Array(I),D=0,_=0;_<F.length;_++){var b=F[_];R.set(b,D),D+=b.length}return R}(R,this.dataLength),this.reset(),_):new Uint8Array(0)},I.reset=function(){this.chunks.length=0,this.dataLength=0},F}()},"./src/demux/dummy-demuxed-track.ts":(Q,K,j)=>{"use strict";function U(L,F){return void 0===L&&(L=""),void 0===F&&(F=9e4),{type:L,id:-1,pid:-1,inputTimeScale:F,sequenceNumber:-1,samples:[],dropped:0}}j.r(K),j.d(K,{dummyTrack:()=>U})},"./src/demux/exp-golomb.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>F});var U=j("./src/utils/logger.ts");const F=function(){function I(D){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=D,this.bytesAvailable=D.byteLength,this.word=0,this.bitsAvailable=0}var R=I.prototype;return R.loadWord=function(){var D=this.data,_=this.bytesAvailable,b=D.byteLength-_,k=new Uint8Array(4),x=Math.min(4,_);if(0===x)throw new Error("no bytes available");k.set(D.subarray(b,b+x)),this.word=new DataView(k.buffer).getUint32(0),this.bitsAvailable=8*x,this.bytesAvailable-=x},R.skipBits=function(D){var _;D=Math.min(D,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>D?(this.word<<=D,this.bitsAvailable-=D):(D-=this.bitsAvailable,D-=(_=D>>3)<<3,this.bytesAvailable-=_,this.loadWord(),this.word<<=D,this.bitsAvailable-=D)},R.readBits=function(D){var _=Math.min(this.bitsAvailable,D),b=this.word>>>32-_;if(D>32&&U.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=_,this.bitsAvailable>0)this.word<<=_;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(_=D-_)>0&&this.bitsAvailable?b<<_|this.readBits(_):b},R.skipLZ=function(){var D;for(D=0;D<this.bitsAvailable;++D)if(this.word&2147483648>>>D)return this.word<<=D,this.bitsAvailable-=D,D;return this.loadWord(),D+this.skipLZ()},R.skipUEG=function(){this.skipBits(1+this.skipLZ())},R.skipEG=function(){this.skipBits(1+this.skipLZ())},R.readUEG=function(){var D=this.skipLZ();return this.readBits(D+1)-1},R.readEG=function(){var D=this.readUEG();return 1&D?1+D>>>1:-1*(D>>>1)},R.readBoolean=function(){return 1===this.readBits(1)},R.readUByte=function(){return this.readBits(8)},R.readUShort=function(){return this.readBits(16)},R.readUInt=function(){return this.readBits(32)},R.skipScalingList=function(D){for(var _=8,b=8,x=0;x<D;x++)0!==b&&(b=(_+this.readEG()+256)%256),_=0===b?_:b},R.readSPS=function(){var x,T,C,D=0,_=0,b=0,k=0,E=this.readUByte.bind(this),o=this.readBits.bind(this),g=this.readUEG.bind(this),f=this.readBoolean.bind(this),u=this.skipBits.bind(this),A=this.skipEG.bind(this),v=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);E();var s=E();if(o(5),u(3),E(),v(),100===s||110===s||122===s||244===s||44===s||83===s||86===s||118===s||128===s){var h=g();if(3===h&&u(1),v(),v(),u(1),f())for(T=3!==h?8:12,C=0;C<T;C++)f()&&a(C<6?16:64)}v();var m=g();if(0===m)g();else if(1===m)for(u(1),A(),A(),x=g(),C=0;C<x;C++)A();v(),u(1);var c=g(),d=g(),n=o(1);0===n&&u(1),u(1),f()&&(D=g(),_=g(),b=g(),k=g());var p=[1,1];if(f()&&f())switch(E()){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[E()<<8|E(),E()<<8|E()]}return{width:Math.ceil(16*(c+1)-2*D-2*_),height:(2-n)*(d+1)*16-(n?2:4)*(b+k),pixelRatio:p}},R.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},I}()},"./src/demux/id3.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{canParse:()=>R,decodeFrame:()=>x,getID3Data:()=>F,getID3Frames:()=>k,getTimeStamp:()=>D,isFooter:()=>L,isHeader:()=>U,isTimeStampFrame:()=>_,testables:()=>f,utf8ArrayToStr:()=>g});var u,U=function(v,a){return a+10<=v.length&&73===v[a]&&68===v[a+1]&&51===v[a+2]&&v[a+3]<255&&v[a+4]<255&&v[a+6]<128&&v[a+7]<128&&v[a+8]<128&&v[a+9]<128},L=function(v,a){return a+10<=v.length&&51===v[a]&&68===v[a+1]&&73===v[a+2]&&v[a+3]<255&&v[a+4]<255&&v[a+6]<128&&v[a+7]<128&&v[a+8]<128&&v[a+9]<128},F=function(v,a){for(var s=a,h=0;U(v,a);)h+=10,h+=I(v,a+6),L(v,a+10)&&(h+=10),a+=h;if(h>0)return v.subarray(s,s+h)},I=function(v,a){var s=0;return s=(127&v[a])<<21,s|=(127&v[a+1])<<14,(s|=(127&v[a+2])<<7)|127&v[a+3]},R=function(v,a){return U(v,a)&&I(v,a+6)+10<=v.length-a},D=function(v){for(var a=k(v),s=0;s<a.length;s++){var h=a[s];if(_(h))return o(h)}},_=function(v){return v&&"PRIV"===v.key&&"com.apple.streaming.transportStreamTimestamp"===v.info},b=function(v){var a=String.fromCharCode(v[0],v[1],v[2],v[3]),s=I(v,4);return{type:a,size:s,data:v.subarray(10,10+s)}},k=function(v){for(var a=0,s=[];U(v,a);){for(var h=I(v,a+6),m=(a+=10)+h;a+8<m;){var c=b(v.subarray(a)),d=x(c);d&&s.push(d),a+=c.size+10}L(v,a)&&(a+=10)}return s},x=function(v){return"PRIV"===v.type?T(v):"W"===v.type[0]?E(v):C(v)},T=function(v){if(!(v.size<2)){var a=g(v.data,!0),s=new Uint8Array(v.data.subarray(a.length+1));return{key:v.type,info:a,data:s.buffer}}},C=function(v){if(!(v.size<2)){if("TXXX"===v.type){var a=1,s=g(v.data.subarray(a),!0),h=g(v.data.subarray(a+=s.length+1));return{key:v.type,info:s,data:h}}var m=g(v.data.subarray(1));return{key:v.type,data:m}}},E=function(v){if("WXXX"===v.type){if(v.size<2)return;var a=1,s=g(v.data.subarray(a),!0),h=g(v.data.subarray(a+=s.length+1));return{key:v.type,info:s,data:h}}var m=g(v.data);return{key:v.type,data:m}},o=function(v){if(8===v.data.byteLength){var a=new Uint8Array(v.data),h=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return h/=45,1&a[3]&&(h+=47721858.84),Math.round(h)}},g=function(v,a){void 0===a&&(a=!1);var s=function A(){return!u&&typeof self.TextDecoder<"u"&&(u=new self.TextDecoder("utf-8")),u}();if(s){var h=s.decode(v);if(a){var m=h.indexOf("\0");return-1!==m?h.substring(0,m):h}return h.replace(/\0/g,"")}for(var d,n,p,c=v.length,S="",y=0;y<c;){if(0===(d=v[y++])&&a)return S;if(0!==d&&3!==d)switch(d>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(d);break;case 12:case 13:n=v[y++],S+=String.fromCharCode((31&d)<<6|63&n);break;case 14:n=v[y++],p=v[y++],S+=String.fromCharCode((15&d)<<12|(63&n)<<6|(63&p)<<0)}}return S},f={decodeTextFrame:C}},"./src/demux/mp3demuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>b});var U=j("./src/demux/base-audio-demuxer.ts"),L=j("./src/demux/id3.ts"),F=j("./src/utils/logger.ts"),I=j("./src/demux/mpegaudio.ts");function D(k,x){return(D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,C){return T.__proto__=C,T})(k,x)}var _=function(k){function x(){return k.apply(this,arguments)||this}!function R(k,x){k.prototype=Object.create(x.prototype),k.prototype.constructor=k,D(k,x)}(x,k);var T=x.prototype;return T.resetInitSegment=function(C,E,o,g){k.prototype.resetInitSegment.call(this,C,E,o,g),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:E,duration:g,inputTimeScale:9e4,dropped:0}},x.probe=function(C){if(!C)return!1;for(var o=(L.getID3Data(C,0)||[]).length,g=C.length;o<g;o++)if(I.probe(C,o))return F.logger.log("MPEG Audio sync word found !"),!0;return!1},T.canParse=function(C,E){return I.canParse(C,E)},T.appendFrame=function(C,E,o){if(null!==this.basePTS)return I.appendFrame(C,E,o,this.basePTS,this.frameIndex)},x}(U.default);const b=_},"./src/demux/mp4demuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>_});var U=j("./src/polyfills/number.ts"),L=j("./src/types/demuxer.ts"),F=j("./src/utils/mp4-tools.ts"),I=j("./src/demux/dummy-demuxed-track.ts"),R=/\/emsg[-/]ID3/i;const _=function(){function b(x,T){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=T}var k=b.prototype;return k.resetTimeStamp=function(){},k.resetInitSegment=function(x,T,C,E){var o=this.videoTrack=(0,I.dummyTrack)("video",1),g=this.audioTrack=(0,I.dummyTrack)("audio",1),f=this.txtTrack=(0,I.dummyTrack)("text",1);if(this.id3Track=(0,I.dummyTrack)("id3",1),this.timeOffset=0,x&&x.byteLength){var u=(0,F.parseInitSegment)(x);if(u.video){var A=u.video,a=A.timescale,s=A.codec;o.id=A.id,o.timescale=f.timescale=a,o.codec=s}if(u.audio){var h=u.audio,c=h.timescale,d=h.codec;g.id=h.id,g.timescale=c,g.codec=d}f.id=F.RemuxerTrackIdConfig.text,o.sampleDuration=0,o.duration=g.duration=E}},k.resetContiguity=function(){},b.probe=function(x){return x=x.length>16384?x.subarray(0,16384):x,(0,F.findBox)(x,["moof"]).length>0},k.demux=function(x,T){this.timeOffset=T;var C=x,E=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(C=(0,F.appendUint8Array)(this.remainderData,x));var g=(0,F.segmentValidRange)(C);this.remainderData=g.remainder,E.samples=g.valid||new Uint8Array}else E.samples=C;var f=this.extractID3Track(E,T);return o.samples=(0,F.parseSamples)(T,E),{videoTrack:E,audioTrack:this.audioTrack,id3Track:f,textTrack:this.txtTrack}},k.flush=function(){var x=this.timeOffset,T=this.videoTrack,C=this.txtTrack;T.samples=this.remainderData||new Uint8Array,this.remainderData=null;var E=this.extractID3Track(T,this.timeOffset);return C.samples=(0,F.parseSamples)(x,T),{videoTrack:T,audioTrack:(0,I.dummyTrack)(),id3Track:E,textTrack:(0,I.dummyTrack)()}},k.extractID3Track=function(x,T){var C=this.id3Track;if(x.samples.length){var E=(0,F.findBox)(x.samples,["emsg"]);E&&E.forEach(function(o){var g=(0,F.parseEmsg)(o);if(R.test(g.schemeIdUri)){var f=(0,U.isFiniteNumber)(g.presentationTime)?g.presentationTime/g.timeScale:T+g.presentationTimeDelta/g.timeScale,u=4294967295===g.eventDuration?Number.POSITIVE_INFINITY:g.eventDuration/g.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);var A=g.payload;C.samples.push({data:A,len:A.byteLength,dts:f,pts:f,type:L.MetadataSchema.emsg,duration:u})}})}return C},k.demuxSampleAes=function(x,T,C){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},k.destroy=function(){},b}()},"./src/demux/mpegaudio.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{appendFrame:()=>D,canParse:()=>x,isHeader:()=>k,isHeaderPattern:()=>b,parseHeader:()=>_,probe:()=>T});var U=null,L=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],F=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],I=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],R=[0,1,1,4];function D(C,E,o,g,f){if(!(o+24>E.length)){var u=_(E,o);if(u&&o+u.frameLength<=E.length){var v=g+f*(9e4*u.samplesPerFrame/u.sampleRate),a={unit:E.subarray(o,o+u.frameLength),pts:v,dts:v};return C.config=[],C.channelCount=u.channelCount,C.samplerate=u.sampleRate,C.samples.push(a),{sample:a,length:u.frameLength,missing:0}}}}function _(C,E){var o=C[E+1]>>3&3,g=C[E+1]>>1&3,f=C[E+2]>>4&15,u=C[E+2]>>2&3;if(1!==o&&0!==f&&15!==f&&3!==u){var v=C[E+3]>>6,s=1e3*L[14*(3===o?3-g:3===g?3:4)+f-1],m=F[3*(3===o?0:2===o?1:2)+u],c=3===v?1:2,d=I[o][g],n=R[g],p=8*d*n,S=Math.floor(d*s/m+(C[E+2]>>1&1))*n;if(null===U){var P=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);U=P?parseInt(P[1]):0}return!!U&&U<=87&&2===g&&s>=224e3&&0===v&&(C[E+3]=128|C[E+3]),{sampleRate:m,channelCount:c,frameLength:S,samplesPerFrame:p}}}function b(C,E){return 255===C[E]&&224==(224&C[E+1])&&0!=(6&C[E+1])}function k(C,E){return E+1<C.length&&b(C,E)}function x(C,E){return b(C,E)&&4<=C.length-E}function T(C,E){if(E+1<C.length&&b(C,E)){var g=_(C,E),f=4;null!=g&&g.frameLength&&(f=g.frameLength);var u=E+f;return u===C.length||k(C,u)}return!1}},"./src/demux/sample-aes.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>I});var U=j("./src/crypt/decrypter.ts"),L=j("./src/utils/mp4-tools.ts");const I=function(){function R(_,b,k){this.keyData=void 0,this.decrypter=void 0,this.keyData=k,this.decrypter=new U.default(b,{removePKCS7Padding:!1})}var D=R.prototype;return D.decryptBuffer=function(_){return this.decrypter.decrypt(_,this.keyData.key.buffer,this.keyData.iv.buffer)},D.decryptAacSample=function(_,b,k){var x=this,T=_[b].unit;if(!(T.length<=16)){var C=T.subarray(16,T.length-T.length%16),E=C.buffer.slice(C.byteOffset,C.byteOffset+C.length);this.decryptBuffer(E).then(function(o){var g=new Uint8Array(o);T.set(g,16),x.decrypter.isSync()||x.decryptAacSamples(_,b+1,k)})}},D.decryptAacSamples=function(_,b,k){for(;;b++){if(b>=_.length)return void k();if(!(_[b].unit.length<32||(this.decryptAacSample(_,b,k),this.decrypter.isSync())))return}},D.getAvcEncryptedData=function(_){for(var b=16*Math.floor((_.length-48)/160)+16,k=new Int8Array(b),x=0,T=32;T<_.length-16;T+=160,x+=16)k.set(_.subarray(T,T+16),x);return k},D.getAvcDecryptedUnit=function(_,b){for(var k=new Uint8Array(b),x=0,T=32;T<_.length-16;T+=160,x+=16)_.set(k.subarray(x,x+16),T);return _},D.decryptAvcSample=function(_,b,k,x,T){var C=this,E=(0,L.discardEPB)(T.data),o=this.getAvcEncryptedData(E);this.decryptBuffer(o.buffer).then(function(g){T.data=C.getAvcDecryptedUnit(E,g),C.decrypter.isSync()||C.decryptAvcSamples(_,b,k+1,x)})},D.decryptAvcSamples=function(_,b,k,x){if(_ instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;b++,k=0){if(b>=_.length)return void x();for(var T=_[b].units;!(k>=T.length);k++){var C=T[k];if(!(C.data.length<=48||1!==C.type&&5!==C.type||(this.decryptAvcSample(_,b,k,x,C),this.decrypter.isSync())))return}}},R}()},"./src/demux/transmuxer-interface.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>x});var U=j("./src/demux/webworkify-webpack.js"),L=j("./src/events.ts"),F=j("./src/demux/transmuxer.ts"),I=j("./src/utils/logger.ts"),R=j("./src/errors.ts"),D=j("./src/utils/mediasource-helper.ts"),_=j("./node_modules/eventemitter3/index.js"),k=(j.n(_),(0,D.getMediaSource)()||{isTypeSupported:function(){return!1}}),x=function(){function T(E,o,g,f){var u=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var A=E.config;this.hls=E,this.id=o,this.useWorker=!!A.enableWorker,this.onTransmuxComplete=g,this.onFlush=f;var v=function(m,c){(c=c||{}).frag=u.frag,c.id=u.id,u.hls.trigger(m,c)};this.observer=new _.EventEmitter,this.observer.on(L.Events.FRAG_DECRYPTED,v),this.observer.on(L.Events.ERROR,v);var a={mp4:k.isTypeSupported("video/mp4"),mpeg:k.isTypeSupported("audio/mpeg"),mp3:k.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){var h;I.logger.log("demuxing in webworker");try{h=this.worker=(0,U.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),h.addEventListener("message",this.onwmsg),h.onerror=function(m){u.useWorker=!1,I.logger.warn("Exception in webworker, fallback to inline"),u.hls.trigger(L.Events.ERROR,{type:R.ErrorTypes.OTHER_ERROR,details:R.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(m.message+"  ("+m.filename+":"+m.lineno+")")})},h.postMessage({cmd:"init",typeSupported:a,vendor:s,id:o,config:JSON.stringify(A)})}catch(m){I.logger.warn("Error in worker:",m),I.logger.error("Error while initializing DemuxerWorker, fallback to inline"),h&&self.URL.revokeObjectURL(h.objectURL),this.transmuxer=new F.default(this.observer,a,A,s,o),this.worker=null}}else this.transmuxer=new F.default(this.observer,a,A,s,o)}var C=T.prototype;return C.destroy=function(){var E=this.worker;if(E)E.removeEventListener("message",this.onwmsg),E.terminate(),this.worker=null,this.onwmsg=void 0;else{var o=this.transmuxer;o&&(o.destroy(),this.transmuxer=null)}var g=this.observer;g&&g.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},C.push=function(E,o,g,f,u,A,v,a,s,h){var m,c,d=this;s.transmuxing.start=self.performance.now();var n=this.transmuxer,p=this.worker,S=A?A.start:u.start,y=u.decryptdata,P=this.frag,M=!(P&&u.cc===P.cc),B=!(P&&s.level===P.level),G=P?s.sn-P.sn:-1,N=this.part?s.part-this.part.index:-1,H=!B&&(1===G||0===G&&(1===N||0===G&&s.id>1&&s.id===P?.stats.chunkCount&&N<=0)),V=self.performance.now();(B||G||0===u.stats.parsing.start)&&(u.stats.parsing.start=V),A&&(N||!H)&&(A.stats.parsing.start=V);var Y=!(P&&(null===(m=u.initSegment)||void 0===m?void 0:m.url)===(null===(c=P.initSegment)||void 0===c?void 0:c.url)),X=new F.TransmuxState(M,H,a,B,S,Y);if(!H||M||Y){I.logger.log("[transmuxer-interface, "+u.type+"]: Starting new transmux session for sn: "+s.sn+" p: "+s.part+" level: "+s.level+" id: "+s.id+"\n        discontinuity: "+M+"\n        trackSwitch: "+B+"\n        contiguous: "+H+"\n        accurateTimeOffset: "+a+"\n        timeOffset: "+S+"\n        initSegmentChange: "+Y);var Z=new F.TransmuxConfig(g,f,o,v,h);this.configureTransmuxer(Z)}if(this.frag=u,this.part=A,p)p.postMessage({cmd:"demux",data:E,decryptdata:y,chunkMeta:s,state:X},E instanceof ArrayBuffer?[E]:[]);else if(n){var te=n.push(E,y,s,X);(0,F.isPromise)(te)?(n.async=!0,te.then(function(re){d.handleTransmuxComplete(re)}).catch(function(re){d.transmuxerError(re,s,"transmuxer-interface push error")})):(n.async=!1,this.handleTransmuxComplete(te))}},C.flush=function(E){var o=this;E.transmuxing.start=self.performance.now();var g=this.transmuxer,f=this.worker;if(f)f.postMessage({cmd:"flush",chunkMeta:E});else if(g){var u=g.flush(E);(0,F.isPromise)(u)||g.async?((0,F.isPromise)(u)||(u=Promise.resolve(u)),u.then(function(v){o.handleFlushResult(v,E)}).catch(function(v){o.transmuxerError(v,E,"transmuxer-interface flush error")})):this.handleFlushResult(u,E)}},C.transmuxerError=function(E,o,g){!this.hls||this.hls.trigger(L.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:o,fatal:!1,error:E,err:E,reason:g})},C.handleFlushResult=function(E,o){var g=this;E.forEach(function(f){g.handleTransmuxComplete(f)}),this.onFlush(o)},C.onWorkerMessage=function(E){var o=E.data,g=this.hls;switch(o.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(o.data);break;case"flush":this.onFlush(o.data);break;case"workerLog":I.logger[o.data.logType]&&I.logger[o.data.logType](o.data.message);break;default:o.data=o.data||{},o.data.frag=this.frag,o.data.id=this.id,g.trigger(o.event,o.data)}},C.configureTransmuxer=function(E){var o=this.worker,g=this.transmuxer;o?o.postMessage({cmd:"configure",config:E}):g&&g.configure(E)},C.handleTransmuxComplete=function(E){E.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(E)},T}()},"./src/demux/transmuxer-worker.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>_});var U=j("./src/demux/transmuxer.ts"),L=j("./src/events.ts"),F=j("./src/utils/logger.ts"),I=j("./node_modules/eventemitter3/index.js"),D=(j.n(I),j("./src/errors.ts"));function _(C){var E=new I.EventEmitter,o=function(f,u){C.postMessage({event:f,data:u})};E.on(L.Events.FRAG_DECRYPTED,o),E.on(L.Events.ERROR,o),C.addEventListener("message",function(f){var u=f.data;switch(u.cmd){case"init":var A=JSON.parse(u.config);C.transmuxer=new U.default(E,u.typeSupported,A,u.vendor,u.id),(0,F.enableLogs)(A.debug,u.id),function(){var f=function(A){F.logger[A]=function(a){o("workerLog",{logType:A,message:a})}};for(var u in F.logger)f(u)}(),o("init",null);break;case"configure":C.transmuxer.configure(u.config);break;case"demux":var v=C.transmuxer.push(u.data,u.decryptdata,u.chunkMeta,u.state);(0,U.isPromise)(v)?(C.transmuxer.async=!0,v.then(function(m){b(C,m)}).catch(function(m){o(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:u.chunkMeta,fatal:!1,error:m,err:m,reason:"transmuxer-worker push error"})})):(C.transmuxer.async=!1,b(C,v));break;case"flush":var a=u.chunkMeta,s=C.transmuxer.flush(a);(0,U.isPromise)(s)||C.transmuxer.async?((0,U.isPromise)(s)||(s=Promise.resolve(s)),s.then(function(m){x(C,m,a)}).catch(function(m){o(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:u.chunkMeta,fatal:!1,error:m,err:m,reason:"transmuxer-worker flush error"})})):x(C,s,a)}})}function b(C,E){if(function T(C){return!(C.audio||C.video||C.text||C.id3||C.initSegment)}(E.remuxResult))return!1;var o=[],g=E.remuxResult,f=g.audio,u=g.video;return f&&k(o,f),u&&k(o,u),C.postMessage({event:"transmuxComplete",data:E},o),!0}function k(C,E){E.data1&&C.push(E.data1.buffer),E.data2&&C.push(E.data2.buffer)}function x(C,E,o){E.reduce(function(f,u){return b(C,u)||f},!1)||C.postMessage({event:"transmuxComplete",data:E[0]}),C.postMessage({event:"flush",data:o})}},"./src/demux/transmuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{TransmuxConfig:()=>u,TransmuxState:()=>A,default:()=>E,isPromise:()=>f});var T,U=j("./src/events.ts"),L=j("./src/errors.ts"),F=j("./src/crypt/decrypter.ts"),I=j("./src/demux/aacdemuxer.ts"),R=j("./src/demux/mp4demuxer.ts"),D=j("./src/demux/tsdemuxer.ts"),_=j("./src/demux/mp3demuxer.ts"),b=j("./src/remux/mp4-remuxer.ts"),k=j("./src/remux/passthrough-remuxer.ts"),x=j("./src/utils/logger.ts");try{T=self.performance.now.bind(self.performance)}catch{x.logger.debug("Unable to use Performance API on this environment"),T=self.Date.now}var C=[{demux:R.default,remux:k.default},{demux:D.default,remux:b.default},{demux:I.default,remux:b.default},{demux:_.default,remux:b.default}],E=function(){function v(s,h,m,c,d){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=s,this.typeSupported=h,this.config=m,this.vendor=c,this.id=d}var a=v.prototype;return a.configure=function(s){this.transmuxConfig=s,this.decrypter&&this.decrypter.reset()},a.push=function(s,h,m,c){var d=this,n=m.transmuxing;n.executeStart=T();var p=new Uint8Array(s),S=this.currentTransmuxState,y=this.transmuxConfig;c&&(this.currentTransmuxState=c);var P=c||S,M=P.contiguous,B=P.discontinuity,G=P.trackSwitch,N=P.accurateTimeOffset,q=P.timeOffset,H=P.initSegmentChange,V=y.audioCodec,Y=y.videoCodec,X=y.defaultInitPts,Z=y.duration,te=y.initSegmentData,re=function o(v,a){var s=null;return v.byteLength>0&&null!=a&&null!=a.key&&null!==a.iv&&null!=a.method&&(s=a),s}(p,h);if(re&&"AES-128"===re.method){var ne=this.getDecrypter();if(!ne.isSync())return this.decryptionPromise=ne.webCryptoDecrypt(p,re.key.buffer,re.iv.buffer).then(function(Te){var Ce=d.push(Te,null,m);return d.decryptionPromise=null,Ce}),this.decryptionPromise;var he=ne.softwareDecrypt(p,re.key.buffer,re.iv.buffer);if(!he)return n.executeEnd=T(),g(m);p=new Uint8Array(he)}var be=this.needsProbing(B,G);be&&this.configureTransmuxer(p),(B||G||H||be)&&this.resetInitSegment(te,V,Y,Z,h),(B||H||be)&&this.resetInitialTimestamp(X),M||this.resetContiguity();var me=this.transmux(p,re,q,N,m),ye=this.currentTransmuxState;return ye.contiguous=!0,ye.discontinuity=!1,ye.trackSwitch=!1,n.executeEnd=T(),me},a.flush=function(s){var h=this,m=s.transmuxing;m.executeStart=T();var c=this.decrypter,d=this.currentTransmuxState,n=this.decryptionPromise;if(n)return n.then(function(){return h.flush(s)});var p=[],S=d.timeOffset;if(c){var y=c.flush();y&&p.push(this.push(y,null,s))}var P=this.demuxer;if(!P||!this.remuxer)return this.observer.emit(U.Events.ERROR,U.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),m.executeEnd=T(),[g(s)];var B=P.flush(S);return f(B)?B.then(function(G){return h.flushRemux(p,G,s),p}):(this.flushRemux(p,B,s),p)},a.flushRemux=function(s,h,m){var c=h.audioTrack,d=h.videoTrack,n=h.id3Track,p=h.textTrack,S=this.currentTransmuxState,y=S.accurateTimeOffset,P=S.timeOffset;x.logger.log("[transmuxer.ts]: Flushed fragment "+m.sn+(m.part>-1?" p: "+m.part:"")+" of level "+m.level);var M=this.remuxer.remux(c,d,n,p,P,y,!0,this.id);s.push({remuxResult:M,chunkMeta:m}),m.transmuxing.executeEnd=T()},a.resetInitialTimestamp=function(s){var h=this.demuxer,m=this.remuxer;!h||!m||(h.resetTimeStamp(s),m.resetTimeStamp(s))},a.resetContiguity=function(){var s=this.demuxer,h=this.remuxer;!s||!h||(s.resetContiguity(),h.resetNextTimestamp())},a.resetInitSegment=function(s,h,m,c,d){var n=this.demuxer,p=this.remuxer;!n||!p||(n.resetInitSegment(s,h,m,c),p.resetInitSegment(s,h,m,d))},a.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},a.transmux=function(s,h,m,c,d){return h&&"SAMPLE-AES"===h.method?this.transmuxSampleAes(s,h,m,c,d):this.transmuxUnencrypted(s,m,c,d)},a.transmuxUnencrypted=function(s,h,m,c){var d=this.demuxer.demux(s,h,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(d.audioTrack,d.videoTrack,d.id3Track,d.textTrack,h,m,!1,this.id),chunkMeta:c}},a.transmuxSampleAes=function(s,h,m,c,d){var n=this;return this.demuxer.demuxSampleAes(s,h,m).then(function(p){return{remuxResult:n.remuxer.remux(p.audioTrack,p.videoTrack,p.id3Track,p.textTrack,m,c,!1,n.id),chunkMeta:d}})},a.configureTransmuxer=function(s){for(var n,h=this.config,m=this.observer,c=this.typeSupported,d=this.vendor,p=0,S=C.length;p<S;p++)if(C[p].demux.probe(s)){n=C[p];break}n||(x.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),n={demux:R.default,remux:k.default});var y=this.demuxer,P=this.remuxer,M=n.remux,B=n.demux;(!P||!(P instanceof M))&&(this.remuxer=new M(m,h,c,d)),(!y||!(y instanceof B))&&(this.demuxer=new B(m,h,c),this.probe=B.probe)},a.needsProbing=function(s,h){return!this.demuxer||!this.remuxer||s||h},a.getDecrypter=function(){var s=this.decrypter;return s||(s=this.decrypter=new F.default(this.config)),s},v}(),g=function(v){return{remuxResult:{},chunkMeta:v}};function f(v){return"then"in v&&v.then instanceof Function}var u=function(v,a,s,h,m){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=v,this.videoCodec=a,this.initSegmentData=s,this.duration=h,this.defaultInitPts=m},A=function(v,a,s,h,m,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=v,this.contiguous=a,this.accurateTimeOffset=s,this.trackSwitch=h,this.timeOffset=m,this.initSegmentChange=c}},"./src/demux/tsdemuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>A});var U=j("./src/demux/adts.ts"),L=j("./src/demux/mpegaudio.ts"),F=j("./src/demux/exp-golomb.ts"),I=j("./src/demux/sample-aes.ts"),R=j("./src/events.ts"),D=j("./src/utils/mp4-tools.ts"),_=j("./src/utils/logger.ts"),b=j("./src/errors.ts"),k=j("./src/types/demuxer.ts");function x(){return x=Object.assign?Object.assign.bind():function(v){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(v[h]=s[h])}return v},x.apply(this,arguments)}var T=188;function E(v,a,s,h){return{key:v,frame:!1,pts:a,dts:s,units:[],debug:h,length:0}}function o(v,a){return(31&v[a+10])<<8|v[a+11]}function g(v,a,s,h){var m={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},d=a+3+((15&v[a+1])<<8|v[a+2])-4;for(a+=12+((15&v[a+10])<<8|v[a+11]);a<d;){var p=(31&v[a+1])<<8|v[a+2];switch(v[a]){case 207:if(!h){_.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===m.audio&&(m.audio=p);break;case 21:-1===m.id3&&(m.id3=p);break;case 219:if(!h){_.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===m.avc&&(m.avc=p);break;case 3:case 4:!0!==s.mpeg&&!0!==s.mp3?_.logger.log("MPEG audio found, not supported in this browser"):-1===m.audio&&(m.audio=p,m.segmentCodec="mp3");break;case 36:_.logger.warn("Unsupported HEVC stream type found")}a+=5+((15&v[a+3])<<8|v[a+4])}return m}function f(v){var s,h,m,c,d,a=0,n=v.data;if(!v||0===v.size)return null;for(;n[0].length<19&&n.length>1;){var p=new Uint8Array(n[0].length+n[1].length);p.set(n[0]),p.set(n[1],n[0].length),n[0]=p,n.splice(1,1)}if(1===((s=n[0])[0]<<16)+(s[1]<<8)+s[2]){if((h=(s[4]<<8)+s[5])&&h>v.size-6)return null;var y=s[7];192&y&&(c=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&y?c-(d=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2)>54e5&&(_.logger.warn(Math.round((c-d)/9e4)+"s delta between PTS and DTS, align them"),c=d):d=c);var P=(m=s[8])+9;if(v.size<=P)return null;v.size-=P;for(var M=new Uint8Array(v.size),B=0,G=n.length;B<G;B++){var N=(s=n[B]).byteLength;if(P){if(P>N){P-=N;continue}s=s.subarray(P),N-=P,P=0}M.set(s,a),a+=N}return h&&(h-=m+3),{data:M,pts:c,dts:d,len:h}}return null}function u(v,a){if(v.units.length&&v.frame){if(void 0===v.pts){var s=a.samples,h=s.length;if(!h)return void a.dropped++;var m=s[h-1];v.pts=m.pts,v.dts=m.dts}a.samples.push(v)}v.debug.length&&_.logger.log(v.pts+"/"+v.dts+":"+v.debug)}const A=function(){function v(s,h,m){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=s,this.config=h,this.typeSupported=m}v.probe=function(s){var h=v.syncOffset(s);return h>0&&_.logger.warn("MPEG2-TS detected but first sync word found @ offset "+h),-1!==h},v.syncOffset=function(s){for(var h=Math.min(940,s.length-376)+1,m=0;m<h;){if(71===s[m]&&71===s[m+T])return m;m++}return-1},v.createTrack=function(s,h){return{container:"video"===s||"audio"===s?"video/mp2t":void 0,type:s,id:D.RemuxerTrackIdConfig[s],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===s?h:void 0}};var a=v.prototype;return a.resetInitSegment=function(s,h,m,c){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=v.createTrack("video"),this._audioTrack=v.createTrack("audio",c),this._id3Track=v.createTrack("id3"),this._txtTrack=v.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=h,this.videoCodec=m,this._duration=c},a.resetTimeStamp=function(){},a.resetContiguity=function(){var s=this._audioTrack,h=this._avcTrack,m=this._id3Track;s&&(s.pesData=null),h&&(h.pesData=null),m&&(m.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},a.demux=function(s,h,m,c){void 0===m&&(m=!1),void 0===c&&(c=!1),m||(this.sampleAes=null);var d,n=this._avcTrack,p=this._audioTrack,S=this._id3Track,y=this._txtTrack,P=n.pid,M=n.pesData,B=p.pid,G=S.pid,N=p.pesData,q=S.pesData,H=null,V=this.pmtParsed,Y=this._pmtId,X=s.length;if(this.remainderData&&(X=(s=(0,D.appendUint8Array)(this.remainderData,s)).length,this.remainderData=null),X<T&&!c)return this.remainderData=s,{audioTrack:p,videoTrack:n,id3Track:S,textTrack:y};var Z=Math.max(0,v.syncOffset(s));(X-=(X-Z)%T)<s.byteLength&&!c&&(this.remainderData=new Uint8Array(s.buffer,X,s.buffer.byteLength-X));for(var te=0,re=Z;re<X;re+=T)if(71===s[re]){var ne=!!(64&s[re+1]),he=((31&s[re+1])<<8)+s[re+2],me=void 0;if((48&s[re+3])>>4>1){if((me=re+5+s[re+4])===re+T)continue}else me=re+4;switch(he){case P:ne&&(M&&(d=f(M))&&this.parseAVCPES(n,y,d,!1),M={data:[],size:0}),M&&(M.data.push(s.subarray(me,re+T)),M.size+=re+T-me);break;case B:if(ne){if(N&&(d=f(N)))switch(p.segmentCodec){case"aac":this.parseAACPES(p,d);break;case"mp3":this.parseMPEGPES(p,d)}N={data:[],size:0}}N&&(N.data.push(s.subarray(me,re+T)),N.size+=re+T-me);break;case G:ne&&(q&&(d=f(q))&&this.parseID3PES(S,d),q={data:[],size:0}),q&&(q.data.push(s.subarray(me,re+T)),q.size+=re+T-me);break;case 0:ne&&(me+=s[me]+1),Y=this._pmtId=o(s,me);break;case Y:ne&&(me+=s[me]+1);var ye=g(s,me,this.typeSupported,m);(P=ye.avc)>0&&(n.pid=P),(B=ye.audio)>0&&(p.pid=B,p.segmentCodec=ye.segmentCodec),(G=ye.id3)>0&&(S.pid=G),null!==H&&!V&&(_.logger.log("unknown PID '"+H+"' in TS found"),H=null,re=Z-188),V=this.pmtParsed=!0;break;case 17:case 8191:break;default:H=he}}else te++;te>0&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+te+" TS packet/s that do not start with 0x47"}),n.pesData=M,p.pesData=N,S.pesData=q;var Te={audioTrack:p,videoTrack:n,id3Track:S,textTrack:y};return c&&this.extractRemainingSamples(Te),Te},a.flush=function(){var h,s=this.remainderData;return this.remainderData=null,h=s?this.demux(s,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(h),this.sampleAes?this.decrypt(h,this.sampleAes):h},a.extractRemainingSamples=function(s){var y,h=s.audioTrack,m=s.videoTrack,c=s.id3Track,d=s.textTrack,n=m.pesData,p=h.pesData,S=c.pesData;if(n&&(y=f(n))?(this.parseAVCPES(m,d,y,!0),m.pesData=null):m.pesData=n,p&&(y=f(p))){switch(h.segmentCodec){case"aac":this.parseAACPES(h,y);break;case"mp3":this.parseMPEGPES(h,y)}h.pesData=null}else null!=p&&p.size&&_.logger.log("last AAC PES packet truncated,might overlap between fragments"),h.pesData=p;S&&(y=f(S))?(this.parseID3PES(c,y),c.pesData=null):c.pesData=S},a.demuxSampleAes=function(s,h,m){var c=this.demux(s,m,!0,!this.config.progressive),d=this.sampleAes=new I.default(this.observer,this.config,h);return this.decrypt(c,d)},a.decrypt=function(s,h){return new Promise(function(m){var c=s.audioTrack,d=s.videoTrack;c.samples&&"aac"===c.segmentCodec?h.decryptAacSamples(c.samples,0,function(){d.samples?h.decryptAvcSamples(d.samples,0,0,function(){m(s)}):m(s)}):d.samples&&h.decryptAvcSamples(d.samples,0,0,function(){m(s)})})},a.destroy=function(){this._duration=0},a.parseAVCPES=function(s,h,m,c){var y,d=this,n=this.parseAVCNALu(s,m.data),S=this.avcSample,P=!1;m.data=null,S&&n.length&&!s.audFound&&(u(S,s),S=this.avcSample=E(!1,m.pts,m.dts,"")),n.forEach(function(M){switch(M.type){case 1:y=!0,S||(S=d.avcSample=E(!0,m.pts,m.dts,"")),S.frame=!0;var B=M.data;if(P&&B.length>4){var G=new F.default(B).readSliceType();(2===G||4===G||7===G||9===G)&&(S.key=!0)}break;case 5:y=!0,S||(S=d.avcSample=E(!0,m.pts,m.dts,"")),S.key=!0,S.frame=!0;break;case 6:y=!0,(0,D.parseSEIMessageFromNALu)(M.data,1,m.pts,h.samples);break;case 7:if(y=!0,P=!0,!s.sps){var q=new F.default(M.data).readSPS();s.width=q.width,s.height=q.height,s.pixelRatio=q.pixelRatio,s.sps=[M.data],s.duration=d._duration;for(var H=M.data.subarray(1,4),V="avc1.",Y=0;Y<3;Y++){var X=H[Y].toString(16);X.length<2&&(X="0"+X),V+=X}s.codec=V}break;case 8:y=!0,s.pps||(s.pps=[M.data]);break;case 9:y=!1,s.audFound=!0,S&&u(S,s),S=d.avcSample=E(!1,m.pts,m.dts,"");break;case 12:y=!0;break;default:y=!1,S&&(S.debug+="unknown NAL "+M.type+" ")}S&&y&&S.units.push(M)}),c&&S&&(u(S,s),this.avcSample=null)},a.getLastNalUnit=function(s){var h,c,m=this.avcSample;if((!m||0===m.units.length)&&(m=s[s.length-1]),null!==(h=m)&&void 0!==h&&h.units){var d=m.units;c=d[d.length-1]}return c},a.parseAVCNALu=function(s,h){var S,y,m=h.byteLength,c=s.naluState||0,d=c,n=[],p=0,M=-1,B=0;for(-1===c&&(M=0,B=31&h[0],c=0,p=1);p<m;)if(S=h[p++],c)if(1!==c)if(S)if(1===S){if(M>=0){var G={data:h.subarray(M,p-c-1),type:B};n.push(G)}else{var N=this.getLastNalUnit(s.samples);if(N&&(d&&p<=4-d&&N.state&&(N.data=N.data.subarray(0,N.data.byteLength-d)),(y=p-c-1)>0)){var q=new Uint8Array(N.data.byteLength+y);q.set(N.data,0),q.set(h.subarray(0,y),N.data.byteLength),N.data=q,N.state=0}}p<m?(M=p,B=31&h[p],c=0):c=-1}else c=0;else c=3;else c=S?0:2;else c=S?0:1;if(M>=0&&c>=0){var H={data:h.subarray(M,m),type:B,state:c};n.push(H)}if(0===n.length){var V=this.getLastNalUnit(s.samples);if(V){var Y=new Uint8Array(V.data.byteLength+h.byteLength);Y.set(V.data,0),Y.set(h,V.data.byteLength),V.data=Y}}return s.naluState=c,n},a.parseAACPES=function(s,h){var P,M,B,G,N,m=0,c=this.aacOverFlow,d=h.data;if(c){this.aacOverFlow=null;var n=c.missing,p=c.sample.unit.byteLength;if(-1===n){var S=new Uint8Array(p+d.byteLength);S.set(c.sample.unit,0),S.set(d,p),d=S}else{var y=p-n;c.sample.unit.set(d.subarray(0,n),y),s.samples.push(c.sample),m=c.missing}}for(P=m,M=d.length;P<M-1&&!U.isHeader(d,P);P++);if(P===m||(P<M-1?(B="AAC PES did not start with ADTS header,offset:"+P,G=!1):(B="no ADTS header found in AAC PES",G=!0),_.logger.warn("parsing error:"+B),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_PARSING_ERROR,fatal:G,reason:B}),!G)){if(U.initTrackConfig(s,this.observer,d,P,this.audioCodec),void 0!==h.pts)N=h.pts;else{if(!c)return void _.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var q=U.getFrameDuration(s.samplerate);N=c.sample.pts+q}for(var V,H=0;P<M;){if(P+=(V=U.appendFrame(s,d,P,N,H)).length,V.missing){this.aacOverFlow=V;break}for(H++;P<M-1&&!U.isHeader(d,P);P++);}}},a.parseMPEGPES=function(s,h){var m=h.data,c=m.length,d=0,n=0,p=h.pts;if(void 0!==p)for(;n<c;)if(L.isHeader(m,n)){var S=L.appendFrame(s,m,n,p,d);if(!S)break;n+=S.length,d++}else n++;else _.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},a.parseID3PES=function(s,h){if(void 0!==h.pts){var m=x({},h,{type:this._avcTrack?k.MetadataSchema.emsg:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});s.samples.push(m)}else _.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},v}()},"./src/demux/webworkify-webpack.js":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>T});var L=function(){var C=ENTRY_MODULE,E={},o=function f(u){var A=E[u];if(void 0!==A)return A.exports;var v=E[u]={exports:{}};return C[u].call(v.exports,v,v.exports,f),v.exports};o.m=C,o.n=function(f){var u=f&&f.__esModule?function(){return f.default}:function(){return f};return o.d(u,{a:u}),u},o.d=function(f,u){for(var A in u)o.o(u,A)&&!o.o(f,A)&&Object.defineProperty(f,A,{enumerable:!0,get:u[A]})},o.o=function(f,u){return Object.prototype.hasOwnProperty.call(f,u)},o.r=function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})};var g=o(ENTRY_MODULE);return g.default||g}.toString().split("ENTRY_MODULE"),F="[\\.|\\-|\\+|\\w|/|@]+",I="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+F+").*?\\)";function R(C){return(C+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function D(C){return!isNaN(1*C)}function _(C,E,o){var g={};g[o]=[];var f=E.toString().replace(/^"[^"]+"/,"function"),u=f.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||f.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!u)return g;for(var a,A=u[1],v=new RegExp("(\\\\n|\\W)"+R(A)+I,"g");a=v.exec(f);)"dll-reference"!==a[3]&&g[o].push(a[3]);for(v=new RegExp("\\("+R(A)+'\\("(dll-reference\\s('+F+'))"\\)\\)'+I,"g");a=v.exec(f);)C[a[2]]||(g[o].push(a[1]),C[a[2]]=j(a[1]).m),g[a[2]]=g[a[2]]||[],g[a[2]].push(a[4]);for(var s=Object.keys(g),h=0;h<s.length;h++)for(var m=0;m<g[s[h]].length;m++)D(g[s[h]][m])&&(g[s[h]][m]=1*g[s[h]][m]);return g}function b(C){return Object.keys(C).reduce(function(o,g){return o||C[g].length>0},!1)}function x(C,E,o,g){var f=C[g].map(function(u){return'"'+u+'": '+E[g][u].toString().replace(/^"[^"]+"/,"function")}).join(",");return L[0]+"{"+f+"}"+L[1]+'"'+o+'"'+L[2]}function T(C,E){var o={main:j.m},g=(E=E||{}).all?{main:Object.keys(o.main)}:function k(C,E){for(var o={main:[E]},g={main:[]},f={main:{}};b(o);)for(var u=Object.keys(o),A=0;A<u.length;A++){var v=u[A],s=o[v].pop();if(f[v]=f[v]||{},!f[v][s]&&C[v][s]){f[v][s]=!0,g[v]=g[v]||[],g[v].push(s);for(var h=_(C,C[v][s],v),m=Object.keys(h),c=0;c<m.length;c++)o[m[c]]=o[m[c]]||[],o[m[c]]=o[m[c]].concat(h[m[c]])}}return g}(o,C),f="";Object.keys(g).filter(function(s){return"main"!==s}).forEach(function(s){for(var h=0;g[s][h];)h++;g[s].push(h),o[s][h]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",f=f+"var "+s+" = ("+x(g,o,h,modules)+")();\n"}),f=f+"new (("+x(g,o,C,"main")+")())(self);";var u=new window.Blob([f],{type:"text/javascript"}),v=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),a=new window.Worker(v);return a.objectURL=v,a}},"./src/errors.ts":(Q,K,j)=>{"use strict";var U,F,L;j.r(K),j.d(K,{ErrorDetails:()=>L,ErrorTypes:()=>U}),(F=U||(U={})).NETWORK_ERROR="networkError",F.MEDIA_ERROR="mediaError",F.KEY_SYSTEM_ERROR="keySystemError",F.MUX_ERROR="muxError",F.OTHER_ERROR="otherError",function(F){F.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",F.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",F.KEY_SYSTEM_NO_SESSION="keySystemNoSession",F.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",F.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",F.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",F.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",F.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",F.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",F.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",F.MANIFEST_LOAD_ERROR="manifestLoadError",F.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",F.MANIFEST_PARSING_ERROR="manifestParsingError",F.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",F.LEVEL_EMPTY_ERROR="levelEmptyError",F.LEVEL_LOAD_ERROR="levelLoadError",F.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",F.LEVEL_SWITCH_ERROR="levelSwitchError",F.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",F.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",F.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",F.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",F.FRAG_LOAD_ERROR="fragLoadError",F.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",F.FRAG_DECRYPT_ERROR="fragDecryptError",F.FRAG_PARSING_ERROR="fragParsingError",F.REMUX_ALLOC_ERROR="remuxAllocError",F.KEY_LOAD_ERROR="keyLoadError",F.KEY_LOAD_TIMEOUT="keyLoadTimeOut",F.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",F.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",F.BUFFER_APPEND_ERROR="bufferAppendError",F.BUFFER_APPENDING_ERROR="bufferAppendingError",F.BUFFER_STALLED_ERROR="bufferStalledError",F.BUFFER_FULL_ERROR="bufferFullError",F.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",F.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",F.INTERNAL_EXCEPTION="internalException",F.INTERNAL_ABORTED="aborted",F.UNKNOWN="unknown"}(L||(L={}))},"./src/events.ts":(Q,K,j)=>{"use strict";var U,L;j.r(K),j.d(K,{Events:()=>U}),(L=U||(U={})).MEDIA_ATTACHING="hlsMediaAttaching",L.MEDIA_ATTACHED="hlsMediaAttached",L.MEDIA_DETACHING="hlsMediaDetaching",L.MEDIA_DETACHED="hlsMediaDetached",L.BUFFER_RESET="hlsBufferReset",L.BUFFER_CODECS="hlsBufferCodecs",L.BUFFER_CREATED="hlsBufferCreated",L.BUFFER_APPENDING="hlsBufferAppending",L.BUFFER_APPENDED="hlsBufferAppended",L.BUFFER_EOS="hlsBufferEos",L.BUFFER_FLUSHING="hlsBufferFlushing",L.BUFFER_FLUSHED="hlsBufferFlushed",L.MANIFEST_LOADING="hlsManifestLoading",L.MANIFEST_LOADED="hlsManifestLoaded",L.MANIFEST_PARSED="hlsManifestParsed",L.LEVEL_SWITCHING="hlsLevelSwitching",L.LEVEL_SWITCHED="hlsLevelSwitched",L.LEVEL_LOADING="hlsLevelLoading",L.LEVEL_LOADED="hlsLevelLoaded",L.LEVEL_UPDATED="hlsLevelUpdated",L.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",L.LEVELS_UPDATED="hlsLevelsUpdated",L.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",L.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",L.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",L.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",L.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",L.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",L.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",L.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",L.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",L.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",L.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",L.CUES_PARSED="hlsCuesParsed",L.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",L.INIT_PTS_FOUND="hlsInitPtsFound",L.FRAG_LOADING="hlsFragLoading",L.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",L.FRAG_LOADED="hlsFragLoaded",L.FRAG_DECRYPTED="hlsFragDecrypted",L.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",L.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",L.FRAG_PARSING_METADATA="hlsFragParsingMetadata",L.FRAG_PARSED="hlsFragParsed",L.FRAG_BUFFERED="hlsFragBuffered",L.FRAG_CHANGED="hlsFragChanged",L.FPS_DROP="hlsFpsDrop",L.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",L.ERROR="hlsError",L.DESTROYING="hlsDestroying",L.KEY_LOADING="hlsKeyLoading",L.KEY_LOADED="hlsKeyLoaded",L.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",L.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>h});var U=j("./node_modules/url-toolkit/src/url-toolkit.js"),F=(j.n(U),j("./src/loader/playlist-loader.ts")),I=j("./src/controller/id3-track-controller.ts"),R=j("./src/controller/latency-controller.ts"),D=j("./src/controller/level-controller.ts"),_=j("./src/controller/fragment-tracker.ts"),b=j("./src/loader/key-loader.ts"),k=j("./src/controller/stream-controller.ts"),x=j("./src/is-supported.ts"),T=j("./src/utils/logger.ts"),C=j("./src/config.ts"),E=j("./node_modules/eventemitter3/index.js"),g=(j.n(E),j("./src/events.ts")),f=j("./src/errors.ts"),u=j("./src/types/level.ts");function A(m,c){for(var d=0;d<c.length;d++){var n=c[d];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(m,a(n.key),n)}}function a(m){var c=function s(m,c){if("object"!=typeof m||null===m)return m;var d=m[Symbol.toPrimitive];if(void 0!==d){var n=d.call(m,c||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===c?String:Number)(m)}(m,"string");return"symbol"==typeof c?c:String(c)}var h=function(){function m(d){void 0===d&&(d={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new E.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=(0,C.mergeConfig)(m.DefaultConfig,d);this.userConfig=d,(0,T.enableLogs)(n.debug,"Hls instance"),this._autoLevelCapping=-1,n.progressive&&(0,C.enableStreamingMode)(n);var S=n.bufferController,y=n.capLevelController,P=n.fpsController,M=this.abrController=new(0,n.abrController)(this),B=this.bufferController=new S(this),G=this.capLevelController=new y(this),N=new P(this),q=new F.default(this),H=new I.default(this),V=this.levelController=new D.default(this),Y=new _.FragmentTracker(this),X=new b.default(this.config),Z=this.streamController=new k.default(this,Y,X);G.setStreamController(Z),N.setStreamController(Z);var te=[q,V,Z];this.networkControllers=te;var re=[M,B,G,N,H,Y];this.audioTrackController=this.createController(n.audioTrackController,te);var ne=n.audioStreamController;ne&&te.push(new ne(this,Y,X)),this.subtitleTrackController=this.createController(n.subtitleTrackController,te);var he=n.subtitleStreamController;he&&te.push(new he(this,Y,X)),this.createController(n.timelineController,re),X.emeController=this.emeController=this.createController(n.emeController,re),this.cmcdController=this.createController(n.cmcdController,re),this.latencyController=this.createController(R.default,re),this.coreComponents=re}m.isSupported=function(){return(0,x.isSupported)()};var c=m.prototype;return c.createController=function(d,n){if(d){var p=new d(this);return n&&n.push(p),p}return null},c.on=function(d,n,p){void 0===p&&(p=this),this._emitter.on(d,n,p)},c.once=function(d,n,p){void 0===p&&(p=this),this._emitter.once(d,n,p)},c.removeAllListeners=function(d){this._emitter.removeAllListeners(d)},c.off=function(d,n,p,S){void 0===p&&(p=this),this._emitter.off(d,n,p,S)},c.listeners=function(d){return this._emitter.listeners(d)},c.emit=function(d,n,p){return this._emitter.emit(d,n,p)},c.trigger=function(d,n){if(this.config.debug)return this.emit(d,d,n);try{return this.emit(d,d,n)}catch(p){T.logger.error("An internal error happened while handling event "+d+'. Error message: "'+p.message+'". Here is a stacktrace:',p),this.trigger(g.Events.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:d,error:p})}return!1},c.listenerCount=function(d){return this._emitter.listenerCount(d)},c.destroy=function(){T.logger.log("destroy"),this.trigger(g.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(d){return d.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(d){return d.destroy()}),this.coreComponents.length=0},c.attachMedia=function(d){T.logger.log("attachMedia"),this._media=d,this.trigger(g.Events.MEDIA_ATTACHING,{media:d})},c.detachMedia=function(){T.logger.log("detachMedia"),this.trigger(g.Events.MEDIA_DETACHING,void 0),this._media=null},c.loadSource=function(d){this.stopLoad();var n=this.media,p=this.url,S=this.url=U.buildAbsoluteURL(self.location.href,d,{alwaysNormalize:!0});T.logger.log("loadSource:"+S),n&&p&&p!==S&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(n)),this.trigger(g.Events.MANIFEST_LOADING,{url:d})},c.startLoad=function(d){void 0===d&&(d=-1),T.logger.log("startLoad("+d+")"),this.networkControllers.forEach(function(n){n.startLoad(d)})},c.stopLoad=function(){T.logger.log("stopLoad"),this.networkControllers.forEach(function(d){d.stopLoad()})},c.swapAudioCodec=function(){T.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},c.recoverMediaError=function(){T.logger.log("recoverMediaError");var d=this._media;this.detachMedia(),d&&this.attachMedia(d)},c.removeLevel=function(d,n){void 0===n&&(n=0),this.levelController.removeLevel(d,n)},function v(m,c,d){c&&A(m.prototype,c),d&&A(m,d),Object.defineProperty(m,"prototype",{writable:!1})}(m,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(d){T.logger.log("set currentLevel:"+d),this.loadLevel=d,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(d){T.logger.log("set nextLevel:"+d),this.levelController.manualLevel=d,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(d){T.logger.log("set loadLevel:"+d),this.levelController.manualLevel=d}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(d){this.levelController.nextLoadLevel=d}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(d){T.logger.log("set firstLevel:"+d),this.levelController.firstLevel=d}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(d){T.logger.log("set startLevel:"+d),-1!==d&&(d=Math.max(d,this.minAutoLevel)),this.levelController.startLevel=d}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(d){var n=!!d;n!==this.config.capLevelToPlayerSize&&(n?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=n)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(d){this._autoLevelCapping!==d&&(T.logger.log("set autoLevelCapping:"+d),this._autoLevelCapping=d)}},{key:"bandwidthEstimate",get:function(){var d=this.abrController.bwEstimator;return d?d.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(d){u.HdcpLevels.indexOf(d)>-1&&(this._maxHdcpLevel=d)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var d=this.levels,n=this.config.minAutoBitrate;if(!d)return 0;for(var p=d.length,S=0;S<p;S++)if(d[S].maxBitrate>=n)return S;return 0}},{key:"maxAutoLevel",get:function(){var S,d=this.levels,n=this.autoLevelCapping,p=this.maxHdcpLevel;if(S=-1===n&&d&&d.length?d.length-1:n,p)for(var y=S;y--;){var P=d[y].attrs["HDCP-LEVEL"];if(P&&P<=p)return y}return S}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(d){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,d)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var d=this.audioTrackController;return d?d.audioTracks:[]}},{key:"audioTrack",get:function(){var d=this.audioTrackController;return d?d.audioTrack:-1},set:function(d){var n=this.audioTrackController;n&&(n.audioTrack=d)}},{key:"subtitleTracks",get:function(){var d=this.subtitleTrackController;return d?d.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var d=this.subtitleTrackController;return d?d.subtitleTrack:-1},set:function(d){var n=this.subtitleTrackController;n&&(n.subtitleTrack=d)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var d=this.subtitleTrackController;return!!d&&d.subtitleDisplay},set:function(d){var n=this.subtitleTrackController;n&&(n.subtitleDisplay=d)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(d){this.config.lowLatencyMode=d}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.1"}},{key:"Events",get:function(){return g.Events}},{key:"ErrorTypes",get:function(){return f.ErrorTypes}},{key:"ErrorDetails",get:function(){return f.ErrorDetails}},{key:"DefaultConfig",get:function(){return m.defaultConfig?m.defaultConfig:C.hlsDefaultConfig},set:function(d){m.defaultConfig=d}}]),m}();h.defaultConfig=void 0},"./src/is-supported.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{changeTypeSupported:()=>I,isSupported:()=>F});var U=j("./src/utils/mediasource-helper.ts");function L(){return self.SourceBuffer||self.WebKitSourceBuffer}function F(){var R=(0,U.getMediaSource)();if(!R)return!1;var D=L();return!(!R||"function"!=typeof R.isTypeSupported||!R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||D&&(!D.prototype||"function"!=typeof D.prototype.appendBuffer||"function"!=typeof D.prototype.remove))}function I(){var R,D=L();return"function"==typeof(null==D||null===(R=D.prototype)||void 0===R?void 0:R.changeType)}},"./src/loader/date-range.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{DateRange:()=>x,DateRangeAttribute:()=>k});var k,T,U=j("./src/polyfills/number.ts"),L=j("./src/utils/attr-list.ts"),F=j("./src/utils/logger.ts");function I(){return I=Object.assign?Object.assign.bind():function(T){for(var C=1;C<arguments.length;C++){var E=arguments[C];for(var o in E)Object.prototype.hasOwnProperty.call(E,o)&&(T[o]=E[o])}return T},I.apply(this,arguments)}function R(T,C){for(var E=0;E<C.length;E++){var o=C[E];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(T,_(o.key),o)}}function _(T){var C=function b(T,C){if("object"!=typeof T||null===T)return T;var E=T[Symbol.toPrimitive];if(void 0!==E){var o=E.call(T,C||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===C?String:Number)(T)}(T,"string");return"symbol"==typeof C?C:String(C)}(T=k||(k={})).ID="ID",T.CLASS="CLASS",T.START_DATE="START-DATE",T.DURATION="DURATION",T.END_DATE="END-DATE",T.END_ON_NEXT="END-ON-NEXT",T.PLANNED_DURATION="PLANNED-DURATION",T.SCTE35_OUT="SCTE35-OUT",T.SCTE35_IN="SCTE35-IN";var x=function(){function T(C,E){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,E){var o=E.attr;for(var g in o)if(Object.prototype.hasOwnProperty.call(C,g)&&C[g]!==o[g]){F.logger.warn('DATERANGE tag attribute: "'+g+'" does not match for tags with ID: "'+C.ID+'"'),this._badValueForSameId=g;break}C=I(new L.AttrList({}),o,C)}if(this.attr=C,this._startDate=new Date(C[k.START_DATE]),k.END_DATE in this.attr){var f=new Date(this.attr[k.END_DATE]);(0,U.isFiniteNumber)(f.getTime())&&(this._endDate=f)}}return function D(T,C,E){C&&R(T.prototype,C),E&&R(T,E),Object.defineProperty(T,"prototype",{writable:!1})}(T,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var C=this.duration;return null!==C?new Date(this._startDate.getTime()+1e3*C):null}},{key:"duration",get:function(){if(k.DURATION in this.attr){var C=this.attr.decimalFloatingPoint(k.DURATION);if((0,U.isFiniteNumber)(C))return C}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return k.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(k.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(k.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,U.isFiniteNumber)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),T}()},"./src/loader/fragment-loader.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{LoadError:()=>E,default:()=>T});var U=j("./src/polyfills/number.ts"),L=j("./src/errors.ts");function I(o){var g="function"==typeof Map?new Map:void 0;return I=function(f){if(null===f||!function _(o){return-1!==Function.toString.call(o).indexOf("[native code]")}(f))return f;if("function"!=typeof f)throw new TypeError("Super expression must either be null or a function");if(typeof g<"u"){if(g.has(f))return g.get(f);g.set(f,u)}function u(){return R(f,arguments,k(this).constructor)}return u.prototype=Object.create(f.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),b(u,f)},I(o)}function R(o,g,f){return(R=function D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(u,A,v){var a=[null];a.push.apply(a,A);var h=new(Function.bind.apply(u,a));return v&&b(h,v.prototype),h}).apply(null,arguments)}function b(o,g){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,u){return f.__proto__=u,f})(o,g)}function k(o){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)})(o)}var x=Math.pow(2,17),T=function(){function o(f){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=f}var g=o.prototype;return g.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},g.abort=function(){this.loader&&this.loader.abort()},g.load=function(f,u){var A=this,v=f.url;if(!v)return Promise.reject(new E({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,networkDetails:null},"Fragment does not have a "+(v?"part list":"url")));this.abort();var a=this.config,s=a.fLoader,h=a.loader;return new Promise(function(m,c){A.loader&&A.loader.destroy();var d=A.loader=f.loader=s?new s(a):new h(a),n=C(f),p={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===f.sn?1/0:x};f.stats=d.stats,d.load(n,p,{onSuccess:function(S,y,P,M){A.resetLoader(f,d);var B=S.data;P.resetIV&&f.decryptdata&&(f.decryptdata.iv=new Uint8Array(B.slice(0,16)),B=B.slice(16)),m({frag:f,part:null,payload:B,networkDetails:M})},onError:function(S,y,P){A.resetLoader(f,d),c(new E({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,response:S,networkDetails:P}))},onAbort:function(S,y,P){A.resetLoader(f,d),c(new E({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:f,networkDetails:P}))},onTimeout:function(S,y,P){A.resetLoader(f,d),c(new E({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,networkDetails:P}))},onProgress:function(S,y,P,M){u&&u({frag:f,part:null,payload:P,networkDetails:M})}})})},g.loadPart=function(f,u,A){var v=this;this.abort();var a=this.config,s=a.fLoader,h=a.loader;return new Promise(function(m,c){v.loader&&v.loader.destroy();var d=v.loader=f.loader=s?new s(a):new h(a),n=C(f,u),p={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:x};u.stats=d.stats,d.load(n,p,{onSuccess:function(S,y,P,M){v.resetLoader(f,d),v.updateStatsFromPart(f,u);var B={frag:f,part:u,payload:S.data,networkDetails:M};A(B),m(B)},onError:function(S,y,P){v.resetLoader(f,d),c(new E({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:f,part:u,response:S,networkDetails:P}))},onAbort:function(S,y,P){f.stats.aborted=u.stats.aborted,v.resetLoader(f,d),c(new E({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:f,part:u,networkDetails:P}))},onTimeout:function(S,y,P){v.resetLoader(f,d),c(new E({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:f,part:u,networkDetails:P}))}})})},g.updateStatsFromPart=function(f,u){var A=f.stats,v=u.stats,a=v.total;if(A.loaded+=v.loaded,a){var s=Math.round(f.duration/u.duration),h=Math.min(Math.round(A.loaded/a),s),c=(s-h)*Math.round(A.loaded/h);A.total=A.loaded+c}else A.total=Math.max(A.loaded,A.total);var d=A.loading,n=v.loading;d.start?d.first+=n.first-n.start:(d.start=n.start,d.first=n.first),d.end=n.end},g.resetLoader=function(f,u){f.loader=null,this.loader===u&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),u.destroy()},o}();function C(o,g){void 0===g&&(g=null);var f=g||o,u={frag:o,part:g,responseType:"arraybuffer",url:f.url,headers:{},rangeStart:0,rangeEnd:0},A=f.byteRangeStartOffset,v=f.byteRangeEndOffset;if((0,U.isFiniteNumber)(A)&&(0,U.isFiniteNumber)(v)){var a,s=A,h=v;if("initSegment"===o.sn&&"AES-128"===(null===(a=o.decryptdata)||void 0===a?void 0:a.method)){var m=v-A;m%16&&(h=v+(16-m%16)),0!==A&&(u.resetIV=!0,s=A-16)}u.rangeStart=s,u.rangeEnd=h}return u}var E=function(o){function g(f){for(var u,A=arguments.length,v=new Array(A>1?A-1:0),a=1;a<A;a++)v[a-1]=arguments[a];return(u=o.call.apply(o,[this].concat(v))||this).data=void 0,u.data=f,u}return function F(o,g){o.prototype=Object.create(g.prototype),o.prototype.constructor=o,b(o,g)}(g,o),g}(I(Error))},"./src/loader/fragment.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{BaseSegment:()=>C,ElementaryStreamTypes:()=>T,Fragment:()=>E,Part:()=>o});var T,g,U=j("./src/polyfills/number.ts"),L=j("./node_modules/url-toolkit/src/url-toolkit.js"),I=(j.n(L),j("./src/loader/load-stats.ts"));function R(g,f){g.prototype=Object.create(f.prototype),g.prototype.constructor=g,D(g,f)}function D(g,f){return(D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,A){return u.__proto__=A,u})(g,f)}function _(g,f){for(var u=0;u<f.length;u++){var A=f[u];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(g,k(A.key),A)}}function b(g,f,u){return f&&_(g.prototype,f),u&&_(g,u),Object.defineProperty(g,"prototype",{writable:!1}),g}function k(g){var f=function x(g,f){if("object"!=typeof g||null===g)return g;var u=g[Symbol.toPrimitive];if(void 0!==u){var A=u.call(g,f||"default");if("object"!=typeof A)return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===f?String:Number)(g)}(g,"string");return"symbol"==typeof f?f:String(f)}(g=T||(T={})).AUDIO="audio",g.VIDEO="video",g.AUDIOVIDEO="audiovideo";var C=function(){function g(u){var A;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((A={})[T.AUDIO]=null,A[T.VIDEO]=null,A[T.AUDIOVIDEO]=null,A),this.baseurl=u}return g.prototype.setByteRange=function(u,A){var v=u.split("@",2),a=[];a[0]=1===v.length?A?A.byteRangeEndOffset:0:parseInt(v[1]),a[1]=parseInt(v[0])+a[0],this._byteRange=a},b(g,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,L.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(u){this._url=u}}]),g}(),E=function(g){function f(A,v){var a;return(a=g.call(this,v)||this)._decryptdata=null,a.rawProgramDateTime=null,a.programDateTime=null,a.tagList=[],a.duration=0,a.sn=0,a.levelkeys=void 0,a.type=void 0,a.loader=null,a.keyLoader=null,a.level=-1,a.cc=0,a.startPTS=void 0,a.endPTS=void 0,a.appendedPTS=void 0,a.startDTS=void 0,a.endDTS=void 0,a.start=0,a.deltaPTS=void 0,a.maxStartPTS=void 0,a.minEndPTS=void 0,a.stats=new I.LoadStats,a.urlId=0,a.data=void 0,a.bitrateTest=!1,a.title=null,a.initSegment=null,a.endList=void 0,a.type=A,a}R(f,g);var u=f.prototype;return u.setKeyFormat=function(A){if(this.levelkeys){var v=this.levelkeys[A];v&&!this._decryptdata&&(this._decryptdata=v.getDecryptData(this.sn))}},u.abortRequests=function(){var A,v;null===(A=this.loader)||void 0===A||A.abort(),null===(v=this.keyLoader)||void 0===v||v.abort()},u.setElementaryStreamInfo=function(A,v,a,s,h,m){void 0===m&&(m=!1);var c=this.elementaryStreams,d=c[A];d?(d.startPTS=Math.min(d.startPTS,v),d.endPTS=Math.max(d.endPTS,a),d.startDTS=Math.min(d.startDTS,s),d.endDTS=Math.max(d.endDTS,h)):c[A]={startPTS:v,endPTS:a,startDTS:s,endDTS:h,partial:m}},u.clearElementaryStreamInfo=function(){var A=this.elementaryStreams;A[T.AUDIO]=null,A[T.VIDEO]=null,A[T.AUDIOVIDEO]=null},b(f,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var v=this.levelkeys.identity;if(v)this._decryptdata=v.getDecryptData(this.sn);else{var a=Object.keys(this.levelkeys);if(1===a.length)return this._decryptdata=this.levelkeys[a[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!(0,U.isFiniteNumber)(this.programDateTime))return null;var A=(0,U.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*A}},{key:"encrypted",get:function(){var A;if(null!==(A=this._decryptdata)&&void 0!==A&&A.encrypted)return!0;if(this.levelkeys){var v=Object.keys(this.levelkeys),a=v.length;if(a>1||1===a&&this.levelkeys[v[0]].encrypted)return!0}return!1}}]),f}(C),o=function(g){function f(u,A,v,a,s){var h;(h=g.call(this,v)||this).fragOffset=0,h.duration=0,h.gap=!1,h.independent=!1,h.relurl=void 0,h.fragment=void 0,h.index=void 0,h.stats=new I.LoadStats,h.duration=u.decimalFloatingPoint("DURATION"),h.gap=u.bool("GAP"),h.independent=u.bool("INDEPENDENT"),h.relurl=u.enumeratedString("URI"),h.fragment=A,h.index=a;var m=u.enumeratedString("BYTERANGE");return m&&h.setByteRange(m,s),s&&(h.fragOffset=s.fragOffset+s.duration),h}return R(f,g),b(f,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var u=this.elementaryStreams;return!!(u.audio||u.video||u.audiovideo)}}]),f}(C)},"./src/loader/key-loader.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>F});var U=j("./src/errors.ts"),L=j("./src/loader/fragment-loader.ts"),F=function(){function I(D){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=D}var R=I.prototype;return R.abort=function(){for(var D in this.keyUriToKeyInfo){var _=this.keyUriToKeyInfo[D].loader;_&&_.abort()}},R.detach=function(){for(var D in this.keyUriToKeyInfo){var _=this.keyUriToKeyInfo[D];(_.mediaKeySessionContext||_.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[D]}},R.destroy=function(){for(var D in this.detach(),this.keyUriToKeyInfo){var _=this.keyUriToKeyInfo[D].loader;_&&_.destroy()}this.keyUriToKeyInfo={}},R.createKeyLoadError=function(D,_,b,k){return void 0===_&&(_=U.ErrorDetails.KEY_LOAD_ERROR),new L.LoadError({type:U.ErrorTypes.NETWORK_ERROR,details:_,fatal:!1,frag:D,networkDetails:b})},R.loadClear=function(D,_){var b=this;if(this.emeController&&this.config.emeEnabled)for(var k=D.sn,x=D.cc,T=function(o){var g=_[o];if(x<=g.cc&&("initSegment"===k||k<g.sn))return b.emeController.selectKeySystemFormat(g).then(function(f){g.setKeyFormat(f)}),"break"},C=0;C<_.length&&"break"!==T(C);C++);},R.load=function(D){var _=this;return!D.decryptdata&&D.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(D).then(function(b){return _.loadInternal(D,b)}):this.loadInternal(D)},R.loadInternal=function(D,_){var b,k;_&&D.setKeyFormat(_);var x=D.decryptdata;if(!x)return Promise.reject(this.createKeyLoadError(D,U.ErrorDetails.KEY_LOAD_ERROR,null,_?"Expected frag.decryptdata to be defined after setting format "+_:"Missing decryption data on fragment in onKeyLoading"));var C=x.uri;if(!C)return Promise.reject(this.createKeyLoadError(D,U.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+C+'"'));var o,E=this.keyUriToKeyInfo[C];if(null!==(b=E)&&void 0!==b&&b.decryptdata.key)return x.key=E.decryptdata.key,Promise.resolve({frag:D,keyInfo:E});if(null!==(k=E)&&void 0!==k&&k.keyLoadPromise)switch(null===(o=E.mediaKeySessionContext)||void 0===o?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return E.keyLoadPromise}switch(E=this.keyUriToKeyInfo[C]={decryptdata:x,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},x.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===x.keyFormat?this.loadKeyHTTP(E,D):this.loadKeyEME(E,D);case"AES-128":return this.loadKeyHTTP(E,D);default:return Promise.reject(this.createKeyLoadError(D,U.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+x.method+'"'))}},R.loadKeyEME=function(D,_){var b={frag:_,keyInfo:D};if(this.emeController&&this.config.emeEnabled){var k=this.emeController.loadKey(b);if(k)return(D.keyLoadPromise=k.then(function(x){return D.mediaKeySessionContext=x,b})).catch(function(x){throw D.keyLoadPromise=null,x})}return Promise.resolve(b)},R.loadKeyHTTP=function(D,_){var b=this,k=this.config,T=new(0,k.loader)(k);return _.keyLoader=D.loader=T,D.keyLoadPromise=new Promise(function(C,E){T.load({keyInfo:D,frag:_,responseType:"arraybuffer",url:D.decryptdata.uri},{timeout:k.fragLoadingTimeOut,maxRetry:0,retryDelay:k.fragLoadingRetryDelay,maxRetryDelay:k.fragLoadingMaxRetryTimeout,highWaterMark:0},{onSuccess:function(u,A,v,a){var s=v.frag,h=v.keyInfo;if(!s.decryptdata||h!==b.keyUriToKeyInfo[v.url])return E(b.createKeyLoadError(s,U.ErrorDetails.KEY_LOAD_ERROR,a,"after key load, decryptdata unset or changed"));h.decryptdata.key=s.decryptdata.key=new Uint8Array(u.data),s.keyLoader=null,h.loader=null,C({frag:s,keyInfo:h})},onError:function(u,A,v){b.resetLoader(A),E(b.createKeyLoadError(_,U.ErrorDetails.KEY_LOAD_ERROR,v))},onTimeout:function(u,A,v){b.resetLoader(A),E(b.createKeyLoadError(_,U.ErrorDetails.KEY_LOAD_TIMEOUT,v))},onAbort:function(u,A,v){b.resetLoader(A),E(b.createKeyLoadError(_,U.ErrorDetails.INTERNAL_ABORTED,v))}})})},R.resetLoader=function(D){var _=D.frag,b=D.keyInfo,k=D.url,x=b.loader;_.keyLoader===x&&(_.keyLoader=null,b.loader=null),delete this.keyUriToKeyInfo[k],x&&x.destroy()},I}()},"./src/loader/level-details.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{LevelDetails:()=>_});var U=j("./src/polyfills/number.ts");function L(b,k){for(var x=0;x<k.length;x++){var T=k[x];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(b,I(T.key),T)}}function I(b){var k=function R(b,k){if("object"!=typeof b||null===b)return b;var x=b[Symbol.toPrimitive];if(void 0!==x){var T=x.call(b,k||"default");if("object"!=typeof T)return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===k?String:Number)(b)}(b,"string");return"symbol"==typeof k?k:String(k)}var _=function(){function b(x){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=x}return b.prototype.reloaded=function(x){if(!x)return this.advanced=!0,void(this.updated=!0);var T=this.lastPartSn-x.lastPartSn,C=this.lastPartIndex-x.lastPartIndex;this.updated=this.endSN!==x.endSN||!!C||!!T,this.advanced=this.endSN>x.endSN||T>0||0===T&&C>0,this.misses=this.updated||this.advanced?Math.floor(.6*x.misses):x.misses+1,this.availabilityDelay=x.availabilityDelay},function F(b,k,x){k&&L(b.prototype,k),x&&L(b,x),Object.defineProperty(b,"prototype",{writable:!1})}(b,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,U.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var x=this.driftEndTime-this.driftStartTime;return x>0?1e3*(this.driftEnd-this.driftStart)/x:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var x;return null!==(x=this.partList)&&void 0!==x&&x.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var x;return null!==(x=this.fragments)&&void 0!==x&&x.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var x;return null!==(x=this.partList)&&void 0!==x&&x.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var x;return null!==(x=this.partList)&&void 0!==x&&x.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),b}()},"./src/loader/level-key.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{LevelKey:()=>_});var U=j("./src/utils/keysystem-util.ts"),L=j("./src/utils/mediakeys-helper.ts"),F=j("./src/utils/mp4-tools.ts"),I=j("./src/utils/logger.ts"),R=j("./src/utils/numeric-encoding-utils.ts"),D={},_=function(){function k(T,C,E,o,g){void 0===o&&(o=[1]),void 0===g&&(g=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=T,this.uri=C,this.keyFormat=E,this.keyFormatVersions=o,this.iv=g,this.encrypted=!!T&&"NONE"!==T,this.isCommonEncryption=this.encrypted&&"AES-128"!==T}k.clearKeyUriToKeyIdMap=function(){D={}};var x=k.prototype;return x.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;switch(this.keyFormat){case"identity":return"SAMPLE-AES"===this.method;case L.KeySystemFormats.FAIRPLAY:case L.KeySystemFormats.WIDEVINE:case L.KeySystemFormats.PLAYREADY:case L.KeySystemFormats.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},x.getDecryptData=function(T){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof T&&("AES-128"===this.method&&!this.iv&&I.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),T=0);var C=function b(k){for(var x=new Uint8Array(16),T=12;T<16;T++)x[T]=k>>8*(15-T)&255;return x}(T);return new k(this.method,this.uri,"identity",this.keyFormatVersions,C)}var o=(0,U.convertDataUriToArrayBytes)(this.uri);if(o)switch(this.keyFormat){case L.KeySystemFormats.WIDEVINE:this.pssh=o,o.length>=22&&(this.keyId=o.subarray(o.length-22,o.length-6));break;case L.KeySystemFormats.PLAYREADY:var g=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,F.mp4pssh)(g,null,o);var f=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/2),u=String.fromCharCode.apply(null,Array.from(f)),A=u.substring(u.indexOf("<"),u.length),s=(new DOMParser).parseFromString(A,"text/xml").getElementsByTagName("KID")[0];if(s){var h=s.childNodes[0]?s.childNodes[0].nodeValue:s.getAttribute("VALUE");if(h){var m=(0,R.base64Decode)(h).subarray(0,16);(0,U.changeEndianness)(m),this.keyId=m}}break;default:var c=o.subarray(0,16);if(16!==c.length){var d=new Uint8Array(16);d.set(c,16-c.length),c=d}this.keyId=c}if(!this.keyId||16!==this.keyId.byteLength){var n=D[this.uri];if(!n){var p=Object.keys(D).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,p),D[this.uri]=n}this.keyId=n}return this},k}()},"./src/loader/load-stats.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{LoadStats:()=>U});var U=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>f});var U=j("./src/polyfills/number.ts"),L=j("./node_modules/url-toolkit/src/url-toolkit.js"),I=(j.n(L),j("./src/loader/date-range.ts")),R=j("./src/loader/fragment.ts"),D=j("./src/loader/level-details.ts"),_=j("./src/loader/level-key.ts"),b=j("./src/utils/attr-list.ts"),k=j("./src/utils/logger.ts"),x=j("./src/utils/codecs.ts");function T(){return T=Object.assign?Object.assign.bind():function(m){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var n in d)Object.prototype.hasOwnProperty.call(d,n)&&(m[n]=d[n])}return m},T.apply(this,arguments)}var C=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,E=/#EXT-X-MEDIA:(.*)/g,o=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),g=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),f=function(){function m(){}return m.findGroup=function(c,d){for(var n=0;n<c.length;n++){var p=c[n];if(p.id===d)return p}},m.convertAVC1ToAVCOTI=function(c){var d=c.split(".");if(d.length>2){var n=d.shift()+".";return(n+=parseInt(d.shift()).toString(16))+("000"+parseInt(d.shift()).toString(16)).slice(-4)}return c},m.resolve=function(c,d){return(0,L.buildAbsoluteURL)(d,c,{alwaysNormalize:!0})},m.parseMasterPlaylist=function(c,d){var M,n=[],p=[],S={},y=[],P=!1;for(C.lastIndex=0;null!=(M=C.exec(c));)if(M[1]){var B,G=new b.AttrList(M[1]),N={attrs:G,bitrate:G.decimalInteger("AVERAGE-BANDWIDTH")||G.decimalInteger("BANDWIDTH"),name:G.NAME,url:m.resolve(M[2],d)},q=G.decimalResolution("RESOLUTION");q&&(N.width=q.width,N.height=q.height),A((G.CODECS||"").split(/[ ,]+/).filter(function(Z){return Z}),N),N.videoCodec&&-1!==N.videoCodec.indexOf("avc1")&&(N.videoCodec=m.convertAVC1ToAVCOTI(N.videoCodec)),null!==(B=N.unknownCodecs)&&void 0!==B&&B.length||p.push(N),n.push(N)}else if(M[3]){var H=new b.AttrList(M[3]);H["DATA-ID"]&&(P=!0,S[H["DATA-ID"]]=H)}else if(M[4]){var V=M[4],Y=u(V,d);Y.encrypted&&Y.isSupported()?y.push(Y):k.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+V+'"')}return{levels:p.length>0&&p.length<n.length?p:n,sessionData:P?S:null,sessionKeys:y.length?y:null}},m.parseMasterPlaylistMedia=function(c,d,n,p){void 0===p&&(p=[]);var S,y=[],P=0;for(E.lastIndex=0;null!==(S=E.exec(c));){var M=new b.AttrList(S[1]);if(M.TYPE===n){var B={attrs:M,bitrate:0,id:P++,groupId:M["GROUP-ID"],instreamId:M["INSTREAM-ID"],name:M.NAME||M.LANGUAGE||"",type:n,default:M.bool("DEFAULT"),autoselect:M.bool("AUTOSELECT"),forced:M.bool("FORCED"),lang:M.LANGUAGE,url:M.URI?m.resolve(M.URI,d):""};if(p.length){var G=m.findGroup(p,B.groupId)||p[0];v(B,G,"audioCodec"),v(B,G,"textCodec")}y.push(B)}}return y},m.parseLevelPlaylist=function(c,d,n,p,S){var Y,X,Z,y=new D.LevelDetails(d),P=y.fragments,M=null,B=0,G=0,N=0,q=0,H=null,V=new R.Fragment(p,d),te=-1,re=!1;for(o.lastIndex=0,y.m3u8=c;null!==(Y=o.exec(c));){re&&(re=!1,(V=new R.Fragment(p,d)).start=N,V.sn=B,V.cc=q,V.level=n,M&&(V.initSegment=M,V.rawProgramDateTime=M.rawProgramDateTime,M.rawProgramDateTime=null));var ne=Y[1];if(ne){V.duration=parseFloat(ne);var he=(" "+Y[2]).slice(1);V.title=he||null,V.tagList.push(he?["INF",ne,he]:["INF",ne])}else if(Y[3]){if((0,U.isFiniteNumber)(V.duration)){if(V.start=N,Z){V.levelkeys=Z;var be=y.encryptedFragments;V.levelkeys&&Object.keys(V.levelkeys).some(function(le){return V.levelkeys[le].isCommonEncryption})&&(!be.length||be[be.length-1].levelkeys!==Z)&&be.push(V)}V.sn=B,V.level=n,V.cc=q,V.urlId=S,P.push(V),V.relurl=(" "+Y[3]).slice(1),s(V,H),H=V,N+=V.duration,B++,G=0,re=!0}}else if(Y[4]){var me=(" "+Y[4]).slice(1);H?V.setByteRange(me,H):V.setByteRange(me)}else if(Y[5])V.rawProgramDateTime=(" "+Y[5]).slice(1),V.tagList.push(["PROGRAM-DATE-TIME",V.rawProgramDateTime]),-1===te&&(te=P.length);else{if(!(Y=Y[0].match(g))){k.logger.warn("No matches on slow regex match for level playlist!");continue}for(X=1;X<Y.length&&typeof Y[X]>"u";X++);var ye=(" "+Y[X]).slice(1),Te=(" "+Y[X+1]).slice(1),Ce=Y[X+2]?(" "+Y[X+2]).slice(1):"";switch(ye){case"PLAYLIST-TYPE":y.type=Te.toUpperCase();break;case"MEDIA-SEQUENCE":B=y.startSN=parseInt(Te);break;case"SKIP":var ue=new b.AttrList(Te),ae=ue.decimalInteger("SKIPPED-SEGMENTS");if((0,U.isFiniteNumber)(ae)){y.skippedSegments=ae;for(var ce=ae;ce--;)P.unshift(null);B+=ae}var oe=ue.enumeratedString("RECENTLY-REMOVED-DATERANGES");oe&&(y.recentlyRemovedDateranges=oe.split("\t"));break;case"TARGETDURATION":y.targetduration=parseFloat(Te);break;case"VERSION":y.version=parseInt(Te);break;case"EXTM3U":break;case"ENDLIST":y.live=!1;break;case"#":(Te||Ce)&&V.tagList.push(Ce?[Te,Ce]:[Te]);break;case"DISCONTINUITY":q++,V.tagList.push(["DIS"]);break;case"GAP":V.tagList.push([ye]);break;case"BITRATE":V.tagList.push([ye,Te]);break;case"DATERANGE":var ee=new b.AttrList(Te),de=new I.DateRange(ee,y.dateRanges[ee.ID]);de.isValid||y.skippedSegments?y.dateRanges[de.id]=de:k.logger.warn('Ignoring invalid DATERANGE tag: "'+Te+'"'),V.tagList.push(["EXT-X-DATERANGE",Te]);break;case"DISCONTINUITY-SEQUENCE":q=parseInt(Te);break;case"KEY":var pe=u(Te,d);if(pe.isSupported()){if("NONE"===pe.method){Z=void 0;break}Z||(Z={}),Z[pe.keyFormat]&&(Z=T({},Z)),Z[pe.keyFormat]=pe}else k.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+Te+'"');break;case"START":var Ie=new b.AttrList(Te).decimalFloatingPoint("TIME-OFFSET");(0,U.isFiniteNumber)(Ie)&&(y.startTimeOffset=Ie);break;case"MAP":var Ae=new b.AttrList(Te);if(V.duration){var Re=new R.Fragment(p,d);h(Re,Ae,n,Z),V.initSegment=M=Re,M.rawProgramDateTime&&!V.rawProgramDateTime&&(V.rawProgramDateTime=M.rawProgramDateTime)}else h(V,Ae,n,Z),M=V,re=!0;break;case"SERVER-CONTROL":var Ne=new b.AttrList(Te);y.canBlockReload=Ne.bool("CAN-BLOCK-RELOAD"),y.canSkipUntil=Ne.optionalFloat("CAN-SKIP-UNTIL",0),y.canSkipDateRanges=y.canSkipUntil>0&&Ne.bool("CAN-SKIP-DATERANGES"),y.partHoldBack=Ne.optionalFloat("PART-HOLD-BACK",0),y.holdBack=Ne.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Me=new b.AttrList(Te);y.partTarget=Me.decimalFloatingPoint("PART-TARGET");break;case"PART":var Oe=y.partList;Oe||(Oe=y.partList=[]);var Ue=G>0?Oe[Oe.length-1]:void 0,We=G++,He=new R.Part(new b.AttrList(Te),V,d,We,Ue);Oe.push(He),V.duration+=He.duration;break;case"PRELOAD-HINT":var Ze=new b.AttrList(Te);y.preloadHint=Ze;break;case"RENDITION-REPORT":var Ye=new b.AttrList(Te);y.renditionReports=y.renditionReports||[],y.renditionReports.push(Ye);break;default:k.logger.warn("line parsed but not handled: "+Y)}}}H&&!H.relurl?(P.pop(),N-=H.duration,y.partList&&(y.fragmentHint=H)):y.partList&&(s(V,H),V.cc=q,y.fragmentHint=V);var Qe=P.length,tt=P[0],it=P[Qe-1];if((N+=y.skippedSegments*y.targetduration)>0&&Qe&&it){y.averagetargetduration=N/Qe;var $=it.sn;y.endSN="initSegment"!==$?$:0,y.live||(it.endList=!0),tt&&(y.startCC=tt.cc)}else y.endSN=0,y.startCC=0;return y.fragmentHint&&(N+=y.fragmentHint.duration),y.totalduration=N,y.endCC=q,te>0&&function a(m,c){for(var d=m[c],n=c;n--;){var p=m[n];if(!p)return;p.programDateTime=d.programDateTime-1e3*p.duration,d=p}}(P,te),y},m}();function u(m,c){var d,n,p=new b.AttrList(m),S=null!=(d=p.enumeratedString("METHOD"))?d:"",y=p.URI,P=p.hexadecimalInteger("IV"),M=p.enumeratedString("KEYFORMATVERSIONS"),B=null!=(n=p.enumeratedString("KEYFORMAT"))?n:"identity";y&&p.IV&&!P&&k.logger.error("Invalid IV: "+p.IV);var G=y?f.resolve(y,c):"",N=(M||"1").split("/").map(Number).filter(Number.isFinite);return new _.LevelKey(S,G,B,N,P)}function A(m,c){["video","audio","text"].forEach(function(d){var n=m.filter(function(S){return(0,x.isCodecType)(S,d)});if(n.length){var p=n.filter(function(S){return 0===S.lastIndexOf("avc1",0)||0===S.lastIndexOf("mp4a",0)});c[d+"Codec"]=p.length>0?p[0]:n[0],m=m.filter(function(S){return-1===n.indexOf(S)})}}),c.unknownCodecs=m}function v(m,c,d){var n=c[d];n&&(m[d]=n)}function s(m,c){m.rawProgramDateTime?m.programDateTime=Date.parse(m.rawProgramDateTime):null!=c&&c.programDateTime&&(m.programDateTime=c.endProgramDateTime),(0,U.isFiniteNumber)(m.programDateTime)||(m.programDateTime=null,m.rawProgramDateTime=null)}function h(m,c,d,n){m.relurl=c.URI,c.BYTERANGE&&m.setByteRange(c.BYTERANGE),m.level=d,m.sn="initSegment",n&&(m.levelkeys=n),m.initSegment=null}},"./src/loader/playlist-loader.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>T});var U=j("./src/polyfills/number.ts"),L=j("./src/events.ts"),F=j("./src/errors.ts"),I=j("./src/utils/logger.ts"),R=j("./src/loader/m3u8-parser.ts"),D=j("./src/types/loader.ts"),_=j("./src/utils/attr-list.ts");function k(C,E){var o=C.url;return(void 0===o||0===o.indexOf("data:"))&&(o=E.url),o}const T=function(){function C(o){this.hls=void 0,this.loaders=Object.create(null),this.hls=o,this.registerListeners()}var E=C.prototype;return E.startLoad=function(o){},E.stopLoad=function(){this.destroyInternalLoaders()},E.registerListeners=function(){var o=this.hls;o.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(L.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(L.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.on(L.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.unregisterListeners=function(){var o=this.hls;o.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(L.Events.LEVEL_LOADING,this.onLevelLoading,this),o.off(L.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),o.off(L.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.createInternalLoader=function(o){var g=this.hls.config,v=new(g.pLoader||g.loader)(g);return o.loader=v,this.loaders[o.type]=v,v},E.getInternalLoader=function(o){return this.loaders[o.type]},E.resetInternalLoader=function(o){this.loaders[o]&&delete this.loaders[o]},E.destroyInternalLoaders=function(){for(var o in this.loaders){var g=this.loaders[o];g&&g.destroy(),this.resetInternalLoader(o)}},E.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},E.onManifestLoading=function(o,g){this.load({id:null,groupId:null,level:0,responseType:"text",type:D.PlaylistContextType.MANIFEST,url:g.url,deliveryDirectives:null})},E.onLevelLoading=function(o,g){this.load({id:g.id,groupId:null,level:g.level,responseType:"text",type:D.PlaylistContextType.LEVEL,url:g.url,deliveryDirectives:g.deliveryDirectives})},E.onAudioTrackLoading=function(o,g){this.load({id:g.id,groupId:g.groupId,level:null,responseType:"text",type:D.PlaylistContextType.AUDIO_TRACK,url:g.url,deliveryDirectives:g.deliveryDirectives})},E.onSubtitleTrackLoading=function(o,g){this.load({id:g.id,groupId:g.groupId,level:null,responseType:"text",type:D.PlaylistContextType.SUBTITLE_TRACK,url:g.url,deliveryDirectives:g.deliveryDirectives})},E.load=function(o){var g,v,a,s,h,m,f=this.hls.config,u=this.getInternalLoader(o);if(u){var A=u.context;if(A&&A.url===o.url)return void I.logger.trace("[playlist-loader]: playlist request ongoing");I.logger.log("[playlist-loader]: aborting previous loader for type: "+o.type),u.abort()}switch(o.type){case D.PlaylistContextType.MANIFEST:v=f.manifestLoadingMaxRetry,a=f.manifestLoadingTimeOut,s=f.manifestLoadingRetryDelay,h=f.manifestLoadingMaxRetryTimeout;break;case D.PlaylistContextType.LEVEL:case D.PlaylistContextType.AUDIO_TRACK:case D.PlaylistContextType.SUBTITLE_TRACK:v=0,a=f.levelLoadingTimeOut;break;default:v=f.levelLoadingMaxRetry,a=f.levelLoadingTimeOut,s=f.levelLoadingRetryDelay,h=f.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(o),null!==(g=o.deliveryDirectives)&&void 0!==g&&g.part&&(o.type===D.PlaylistContextType.LEVEL&&null!==o.level?m=this.hls.levels[o.level].details:o.type===D.PlaylistContextType.AUDIO_TRACK&&null!==o.id?m=this.hls.audioTracks[o.id].details:o.type===D.PlaylistContextType.SUBTITLE_TRACK&&null!==o.id&&(m=this.hls.subtitleTracks[o.id].details),m)){var c=m.partTarget,d=m.targetduration;c&&d&&(a=Math.min(1e3*Math.max(3*c,.8*d),a))}var n={timeout:a,maxRetry:v,retryDelay:s,maxRetryDelay:h,highWaterMark:0},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(o,n,p)},E.loadsuccess=function(o,g,f,u){void 0===u&&(u=null),this.resetInternalLoader(f.type);var A=o.data;0===A.indexOf("#EXTM3U")?(g.parsing.start=performance.now(),A.indexOf("#EXTINF:")>0||A.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(o,g,f,u):this.handleMasterPlaylist(o,g,f,u)):this.handleManifestParsingError(o,f,"no EXTM3U delimiter",u)},E.loaderror=function(o,g,f){void 0===f&&(f=null),this.handleNetworkError(g,f,!1,o)},E.loadtimeout=function(o,g,f){void 0===f&&(f=null),this.handleNetworkError(g,f,!0)},E.handleMasterPlaylist=function(o,g,f,u){var A=this.hls,v=o.data,a=k(o,f),s=R.default.parseMasterPlaylist(v,a),h=s.levels,m=s.sessionData,c=s.sessionKeys;if(h.length){var d=h.map(function(M){return{id:M.attrs.AUDIO,audioCodec:M.audioCodec}}),n=h.map(function(M){return{id:M.attrs.SUBTITLES,textCodec:M.textCodec}}),p=R.default.parseMasterPlaylistMedia(v,a,"AUDIO",d),S=R.default.parseMasterPlaylistMedia(v,a,"SUBTITLES",n),y=R.default.parseMasterPlaylistMedia(v,a,"CLOSED-CAPTIONS");p.length&&!p.some(function(M){return!M.url})&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(I.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new _.AttrList({}),bitrate:0,url:""})),A.trigger(L.Events.MANIFEST_LOADED,{levels:h,audioTracks:p,subtitles:S,captions:y,url:a,stats:g,networkDetails:u,sessionData:m,sessionKeys:c})}else this.handleManifestParsingError(o,f,"no level found in manifest",u)},E.handleTrackOrLevelPlaylist=function(o,g,f,u){var A=this.hls,v=f.id,a=f.level,s=f.type,h=k(o,f),m=(0,U.isFiniteNumber)(v)?v:0,c=(0,U.isFiniteNumber)(a)?a:m,d=function b(C){switch(C.type){case D.PlaylistContextType.AUDIO_TRACK:return D.PlaylistLevelType.AUDIO;case D.PlaylistContextType.SUBTITLE_TRACK:return D.PlaylistLevelType.SUBTITLE;default:return D.PlaylistLevelType.MAIN}}(f),n=R.default.parseLevelPlaylist(o.data,h,c,d,m);if(n.fragments.length){if(s===D.PlaylistContextType.MANIFEST){var p={attrs:new _.AttrList({}),bitrate:0,details:n,name:"",url:h};A.trigger(L.Events.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:h,stats:g,networkDetails:u,sessionData:null,sessionKeys:null})}g.parsing.end=performance.now(),f.levelDetails=n,this.handlePlaylistLoaded(o,g,f,u)}else A.trigger(L.Events.ERROR,{type:F.ErrorTypes.NETWORK_ERROR,details:F.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:"number"==typeof f.level?f.level:void 0})},E.handleManifestParsingError=function(o,g,f,u){this.hls.trigger(L.Events.ERROR,{type:F.ErrorTypes.NETWORK_ERROR,details:F.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:g.type===D.PlaylistContextType.MANIFEST,url:o.url,reason:f,response:o,context:g,networkDetails:u})},E.handleNetworkError=function(o,g,f,u){void 0===f&&(f=!1),I.logger.warn("[playlist-loader]: A network "+(f?"timeout":"error")+" occurred while loading "+o.type+" level: "+o.level+" id: "+o.id+' group-id: "'+o.groupId+'"');var A=F.ErrorDetails.UNKNOWN,v=!1,a=this.getInternalLoader(o);switch(o.type){case D.PlaylistContextType.MANIFEST:A=f?F.ErrorDetails.MANIFEST_LOAD_TIMEOUT:F.ErrorDetails.MANIFEST_LOAD_ERROR,v=!0;break;case D.PlaylistContextType.LEVEL:A=f?F.ErrorDetails.LEVEL_LOAD_TIMEOUT:F.ErrorDetails.LEVEL_LOAD_ERROR,v=!1;break;case D.PlaylistContextType.AUDIO_TRACK:A=f?F.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:F.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,v=!1;break;case D.PlaylistContextType.SUBTITLE_TRACK:A=f?F.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:F.ErrorDetails.SUBTITLE_LOAD_ERROR,v=!1}a&&this.resetInternalLoader(o.type);var s={type:F.ErrorTypes.NETWORK_ERROR,details:A,fatal:v,url:o.url,loader:a,context:o,networkDetails:g};u&&(s.response=u),this.hls.trigger(L.Events.ERROR,s)},E.handlePlaylistLoaded=function(o,g,f,u){var A=f.type,v=f.level,a=f.id,s=f.groupId,h=f.loader,m=f.levelDetails,c=f.deliveryDirectives;if(null!=m&&m.targetduration){if(h)switch(m.live&&(h.getCacheAge&&(m.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(m.ageHeader))&&(m.ageHeader=0)),A){case D.PlaylistContextType.MANIFEST:case D.PlaylistContextType.LEVEL:this.hls.trigger(L.Events.LEVEL_LOADED,{details:m,level:v||0,id:a||0,stats:g,networkDetails:u,deliveryDirectives:c});break;case D.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(L.Events.AUDIO_TRACK_LOADED,{details:m,id:a||0,groupId:s||"",stats:g,networkDetails:u,deliveryDirectives:c});break;case D.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(L.Events.SUBTITLE_TRACK_LOADED,{details:m,id:a||0,groupId:s||"",stats:g,networkDetails:u,deliveryDirectives:c})}}else this.handleManifestParsingError(o,f,"invalid target duration",u)},C}()},"./src/polyfills/number.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{MAX_SAFE_INTEGER:()=>L,isFiniteNumber:()=>U});var U=Number.isFinite||function(F){return"number"==typeof F&&isFinite(F)},L=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>L});const L=function(){function F(){}return F.getSilentFrame=function(I,R){if("mp4a.40.2"===I){if(1===R)return new Uint8Array([0,200,0,128,35,128]);if(2===R)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===R)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===R)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===R)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===R)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},F}()},"./src/remux/mp4-generator.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>F});var U=Math.pow(2,32)-1,L=function(){function I(){}return I.init=function(){var R;for(R in I.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})I.types.hasOwnProperty(R)&&(I.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var D=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),_=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);I.HDLR_TYPES={video:D,audio:_};var b=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),k=new Uint8Array([0,0,0,0,0,0,0,0]);I.STTS=I.STSC=I.STCO=k,I.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),I.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),I.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),I.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var x=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),C=new Uint8Array([0,0,0,1]);I.FTYP=I.box(I.types.ftyp,x,C,x,T),I.DINF=I.box(I.types.dinf,I.box(I.types.dref,b))},I.box=function(R){for(var D=8,_=arguments.length,b=new Array(_>1?_-1:0),k=1;k<_;k++)b[k-1]=arguments[k];for(var x=b.length,T=x;x--;)D+=b[x].byteLength;var C=new Uint8Array(D);for(C[0]=D>>24&255,C[1]=D>>16&255,C[2]=D>>8&255,C[3]=255&D,C.set(R,4),x=0,D=8;x<T;x++)C.set(b[x],D),D+=b[x].byteLength;return C},I.hdlr=function(R){return I.box(I.types.hdlr,I.HDLR_TYPES[R])},I.mdat=function(R){return I.box(I.types.mdat,R)},I.mdhd=function(R,D){D*=R;var _=Math.floor(D/(U+1)),b=Math.floor(D%(U+1));return I.box(I.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,_>>24,_>>16&255,_>>8&255,255&_,b>>24,b>>16&255,b>>8&255,255&b,85,196,0,0]))},I.mdia=function(R){return I.box(I.types.mdia,I.mdhd(R.timescale,R.duration),I.hdlr(R.type),I.minf(R))},I.mfhd=function(R){return I.box(I.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,255&R]))},I.minf=function(R){return I.box(I.types.minf,"audio"===R.type?I.box(I.types.smhd,I.SMHD):I.box(I.types.vmhd,I.VMHD),I.DINF,I.stbl(R))},I.moof=function(R,D,_){return I.box(I.types.moof,I.mfhd(R),I.traf(_,D))},I.moov=function(R){for(var D=R.length,_=[];D--;)_[D]=I.trak(R[D]);return I.box.apply(null,[I.types.moov,I.mvhd(R[0].timescale,R[0].duration)].concat(_).concat(I.mvex(R)))},I.mvex=function(R){for(var D=R.length,_=[];D--;)_[D]=I.trex(R[D]);return I.box.apply(null,[I.types.mvex].concat(_))},I.mvhd=function(R,D){D*=R;var _=Math.floor(D/(U+1)),b=Math.floor(D%(U+1)),k=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,255&R,_>>24,_>>16&255,_>>8&255,255&_,b>>24,b>>16&255,b>>8&255,255&b,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return I.box(I.types.mvhd,k)},I.sdtp=function(R){var b,k,D=R.samples||[],_=new Uint8Array(4+D.length);for(b=0;b<D.length;b++)_[b+4]=(k=D[b].flags).dependsOn<<4|k.isDependedOn<<2|k.hasRedundancy;return I.box(I.types.sdtp,_)},I.stbl=function(R){return I.box(I.types.stbl,I.stsd(R),I.box(I.types.stts,I.STTS),I.box(I.types.stsc,I.STSC),I.box(I.types.stsz,I.STSZ),I.box(I.types.stco,I.STCO))},I.avc1=function(R){var b,k,x,D=[],_=[];for(b=0;b<R.sps.length;b++)D.push((x=(k=R.sps[b]).byteLength)>>>8&255),D.push(255&x),D=D.concat(Array.prototype.slice.call(k));for(b=0;b<R.pps.length;b++)_.push((x=(k=R.pps[b]).byteLength)>>>8&255),_.push(255&x),_=_.concat(Array.prototype.slice.call(k));var T=I.box(I.types.avcC,new Uint8Array([1,D[3],D[4],D[5],255,224|R.sps.length].concat(D).concat([R.pps.length]).concat(_))),C=R.width,E=R.height,o=R.pixelRatio[0],g=R.pixelRatio[1];return I.box(I.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,C>>8&255,255&C,E>>8&255,255&E,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,I.box(I.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),I.box(I.types.pasp,new Uint8Array([o>>24,o>>16&255,o>>8&255,255&o,g>>24,g>>16&255,g>>8&255,255&g])))},I.esds=function(R){var D=R.config.length;return new Uint8Array([0,0,0,0,3,23+D,0,1,0,4,15+D,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([D]).concat(R.config).concat([6,1,2]))},I.mp4a=function(R){var D=R.samplerate;return I.box(I.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,D>>8&255,255&D,0,0]),I.box(I.types.esds,I.esds(R)))},I.mp3=function(R){var D=R.samplerate;return I.box(I.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,D>>8&255,255&D,0,0]))},I.stsd=function(R){return I.box(I.types.stsd,I.STSD,"audio"===R.type?"mp3"===R.segmentCodec&&"mp3"===R.codec?I.mp3(R):I.mp4a(R):I.avc1(R))},I.tkhd=function(R){var D=R.id,_=R.duration*R.timescale,b=R.width,k=R.height,x=Math.floor(_/(U+1)),T=Math.floor(_%(U+1));return I.box(I.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,255&D,0,0,0,0,x>>24,x>>16&255,x>>8&255,255&x,T>>24,T>>16&255,T>>8&255,255&T,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,b>>8&255,255&b,0,0,k>>8&255,255&k,0,0]))},I.traf=function(R,D){var _=I.sdtp(R),b=R.id,k=Math.floor(D/(U+1)),x=Math.floor(D%(U+1));return I.box(I.types.traf,I.box(I.types.tfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b])),I.box(I.types.tfdt,new Uint8Array([1,0,0,0,k>>24,k>>16&255,k>>8&255,255&k,x>>24,x>>16&255,x>>8&255,255&x])),I.trun(R,_.length+16+20+8+16+8+8),_)},I.trak=function(R){return R.duration=R.duration||4294967295,I.box(I.types.trak,I.tkhd(R),I.mdia(R))},I.trex=function(R){var D=R.id;return I.box(I.types.trex,new Uint8Array([0,0,0,0,D>>24,D>>16&255,D>>8&255,255&D,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},I.trun=function(R,D){var T,C,E,o,g,f,_=R.samples||[],b=_.length,k=12+16*b,x=new Uint8Array(k);for(x.set(["video"===R.type?1:0,0,15,1,b>>>24&255,b>>>16&255,b>>>8&255,255&b,(D+=8+k)>>>24&255,D>>>16&255,D>>>8&255,255&D],0),T=0;T<b;T++)x.set([(E=(C=_[T]).duration)>>>24&255,E>>>16&255,E>>>8&255,255&E,(o=C.size)>>>24&255,o>>>16&255,o>>>8&255,255&o,(g=C.flags).isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,61440&g.degradPrio,15&g.degradPrio,(f=C.cts)>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*T);return I.box(I.types.trun,x)},I.initSegment=function(R){I.types||I.init();var D=I.moov(R),_=new Uint8Array(I.FTYP.byteLength+D.byteLength);return _.set(I.FTYP),_.set(D,I.FTYP.byteLength),_},I}();L.types=void 0,L.HDLR_TYPES=void 0,L.STTS=void 0,L.STSC=void 0,L.STCO=void 0,L.STSZ=void 0,L.VMHD=void 0,L.SMHD=void 0,L.STSD=void 0,L.FTYP=void 0,L.DINF=void 0;const F=L},"./src/remux/mp4-remuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>g,flushTextTrackMetadataCueSamples:()=>A,flushTextTrackUserdataCueSamples:()=>v,normalizePts:()=>f});var U=j("./src/polyfills/number.ts"),L=j("./src/remux/aac-helper.ts"),F=j("./src/remux/mp4-generator.ts"),I=j("./src/events.ts"),R=j("./src/errors.ts"),D=j("./src/utils/logger.ts"),_=j("./src/types/loader.ts"),b=j("./src/utils/timescale-conversion.ts");function k(){return k=Object.assign?Object.assign.bind():function(h){for(var m=1;m<arguments.length;m++){var c=arguments[m];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},k.apply(this,arguments)}var E=null,o=null,g=function(){function h(c,d,n,p){if(void 0===p&&(p=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=c,this.config=d,this.typeSupported=n,this.ISGenerated=!1,null===E){var y=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);E=y?parseInt(y[1]):0}if(null===o){var P=navigator.userAgent.match(/Safari\/(\d+)/i);o=P?parseInt(P[1]):0}}var m=h.prototype;return m.destroy=function(){},m.resetTimeStamp=function(c){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=c},m.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},m.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},m.getVideoStartPts=function(c){var d=!1,n=c.reduce(function(p,S){var y=S.pts-p;return y<-4294967296?(d=!0,f(p,S.pts)):y>0?p:S.pts},c[0].pts);return d&&D.logger.debug("PTS rollover detected"),n},m.remux=function(c,d,n,p,S,y,P,M){var B,G,N,q,H,V,Y=S,X=S,te=d.pid>-1,re=d.samples.length,ne=c.samples.length>0,he=P&&re>0||re>1;if((!(c.pid>-1)||ne)&&(!te||he)||this.ISGenerated||P){this.ISGenerated||(N=this.generateIS(c,d,S));var Te,me=this.isVideoContiguous,ye=-1;if(he&&(ye=function u(h){for(var m=0;m<h.length;m++)if(h[m].key)return m;return-1}(d.samples),!me&&this.config.forceKeyFrameOnDiscontinuity))if(V=!0,ye>0){D.logger.warn("[mp4-remuxer]: Dropped "+ye+" out of "+re+" video samples due to a missing keyframe");var Ce=this.getVideoStartPts(d.samples);d.samples=d.samples.slice(ye),d.dropped+=ye,Te=X+=(d.samples[0].pts-Ce)/d.inputTimeScale}else-1===ye&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+re+" video samples"),V=!1);if(this.ISGenerated){if(ne&&he){var ue=this.getVideoStartPts(d.samples),ce=(f(c.samples[0].pts,ue)-ue)/d.inputTimeScale;Y+=Math.max(0,ce),X+=Math.max(0,-ce)}if(ne){if(c.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(c,d,S)),G=this.remuxAudio(c,Y,this.isAudioContiguous,y,te||he||M===_.PlaylistLevelType.AUDIO?X:void 0),he){var oe=G?G.endPTS-G.startPTS:0;d.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(c,d,S)),B=this.remuxVideo(d,X,me,oe)}}else he&&(B=this.remuxVideo(d,X,me,0));B&&(B.firstKeyFrame=ye,B.independent=-1!==ye,B.firstKeyFramePTS=Te)}}return this.ISGenerated&&(n.samples.length&&(H=A(n,S,this._initPTS,this._initDTS)),p.samples.length&&(q=v(p,S,this._initPTS))),{audio:G,video:B,initSegment:N,independent:V,text:q,id3:H}},m.generateIS=function(c,d,n){var G,N,q,p=c.samples,S=d.samples,y=this.typeSupported,P={},M=!(0,U.isFiniteNumber)(this._initPTS),B="audio/mp4";if(M&&(G=N=1/0),c.config&&p.length&&("mp3"===(c.timescale=c.samplerate,c.segmentCodec)&&(y.mpeg?(B="audio/mpeg",c.codec=""):y.mp3&&(c.codec="mp3")),P.audio={id:"audio",container:B,codec:c.codec,initSegment:"mp3"===c.segmentCodec&&y.mpeg?new Uint8Array(0):F.default.initSegment([c]),metadata:{channelCount:c.channelCount}},M&&(q=c.inputTimeScale,G=N=p[0].pts-Math.round(q*n))),d.sps&&d.pps&&S.length&&(d.timescale=d.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:d.codec,initSegment:F.default.initSegment([d]),metadata:{width:d.width,height:d.height}},M)){q=d.inputTimeScale;var H=this.getVideoStartPts(S),V=Math.round(q*n);N=Math.min(N,f(S[0].dts,H)-V),G=Math.min(G,H-V)}if(Object.keys(P).length)return this.ISGenerated=!0,M&&(this._initPTS=G,this._initDTS=N),{tracks:P,initPTS:G,timescale:q}},m.remuxVideo=function(c,d,n,p){var H,V,S=c.inputTimeScale,y=c.samples,P=[],M=y.length,B=this._initPTS,G=this.nextAvcDts,N=8,q=this.videoSampleDuration,Y=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,Z=!1;n&&null!==G||(G=d*S-(y[0].pts-f(y[0].dts,y[0].pts)));for(var ne=0;ne<M;ne++){var he=y[ne];he.pts=f(he.pts-B,G),he.dts=f(he.dts-B,G),he.dts<y[ne>0?ne-1:ne].dts&&(Z=!0)}Z&&y.sort(function(yt,Pt){return yt.dts-Pt.dts||yt.pts-Pt.pts});var be=y[y.length-1].dts-(H=y[0].dts),me=be?Math.round(be/(M-1)):q||c.inputTimeScale/30;if(n){var ye=H-G,Te=ye>me,Ce=ye<-1;if((Te||Ce)&&(D.logger.warn(Te?"AVC: "+(0,b.toMsFromMpegTsClock)(ye,!0)+" ms ("+ye+"dts) hole between fragments detected, filling it":"AVC: "+(0,b.toMsFromMpegTsClock)(-ye,!0)+" ms ("+ye+"dts) overlapping between fragments detected"),!Ce||G>y[0].pts)){var ue=y[0].pts-ye;y[0].dts=H=G,y[0].pts=ue,D.logger.log("Video: First PTS/DTS adjusted: "+(0,b.toMsFromMpegTsClock)(ue,!0)+"/"+(0,b.toMsFromMpegTsClock)(H,!0)+", delta: "+(0,b.toMsFromMpegTsClock)(ye,!0)+" ms")}}H=Math.max(0,H);for(var ae=0,ce=0,oe=0;oe<M;oe++){for(var ee=y[oe],de=ee.units,pe=de.length,_e=0,Ie=0;Ie<pe;Ie++)_e+=de[Ie].data.length;ce+=_e,ae+=pe,ee.length=_e,ee.dts=Math.max(ee.dts,H),Y=Math.min(ee.pts,Y),X=Math.max(ee.pts,X)}V=y[M-1].dts;var Re,Ae=ce+4*ae+8;try{Re=new Uint8Array(Ae)}catch{return void this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ae,reason:"fail allocating video mdat "+Ae})}var Ne=new DataView(Re.buffer);Ne.setUint32(0,Ae),Re.set(F.default.types.mdat,4);for(var Me=!1,Oe=Number.POSITIVE_INFINITY,Ue=Number.POSITIVE_INFINITY,We=Number.NEGATIVE_INFINITY,He=Number.NEGATIVE_INFINITY,Ze=0;Ze<M;Ze++){for(var Ye=y[Ze],Qe=Ye.units,tt=0,it=0,$=Qe.length;it<$;it++){var le=Qe[it],je=le.data,Fe=le.data.byteLength;Ne.setUint32(N,Fe),Re.set(je,N+=4),N+=Fe,tt+=4+Fe}var Be=void 0;if(Ze<M-1)q=y[Ze+1].dts-Ye.dts,Be=y[Ze+1].pts-Ye.pts;else{var qe=this.config,Pe=Ze>0?Ye.dts-y[Ze-1].dts:me;if(Be=Ze>0?Ye.pts-y[Ze-1].pts:me,qe.stretchShortVideoTrack&&null!==this.nextAudioPts){var lt=Math.floor(qe.maxBufferHole*S),Ve=(p?Y+p*S:this.nextAudioPts)-Ye.pts;Ve>lt?((q=Ve-Pe)<0?q=Pe:Me=!0,D.logger.log("[mp4-remuxer]: It is approximately "+Ve/90+" ms to the next segment; using duration "+q/90+" ms for the last video frame.")):q=Pe}else q=Pe}var ct=Math.round(Ye.pts-Ye.dts);Oe=Math.min(Oe,q),We=Math.max(We,q),Ue=Math.min(Ue,Be),He=Math.max(He,Be),P.push(new a(Ye.key,q,tt,ct))}if(P.length)if(E){if(E<70){var ht=P[0].flags;ht.dependsOn=2,ht.isNonSync=0}}else if(o&&He-Ue<We-Oe&&me/We<.025&&0===P[0].cts){D.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var gt=H,Je=0,It=P.length;Je<It;Je++){var ft=gt+P[Je].duration;P[Je].duration=Je<It-1?ft+P[Je+1].cts-(gt+P[Je].cts):Je?P[Je-1].duration:me,P[Je].cts=0,gt=ft}}console.assert(null!==q,"mp4SampleDuration must be computed"),this.nextAvcDts=G=V+(q=Me||!q?me:q),this.videoSampleDuration=q,this.isVideoContiguous=!0;var Ot={data1:F.default.moof(c.sequenceNumber++,H,k({},c,{samples:P})),data2:Re,startPTS:Y/S,endPTS:(X+q)/S,startDTS:H/S,endDTS:G/S,type:"video",hasAudio:!1,hasVideo:!0,nb:P.length,dropped:c.dropped};return c.samples=[],c.dropped=0,console.assert(Re.length,"MDAT length must not be zero"),Ot},m.remuxAudio=function(c,d,n,p,S){var y=c.inputTimeScale,M=y/(c.samplerate?c.samplerate:y),B="aac"===c.segmentCodec?1024:1152,G=B*M,N=this._initPTS,q="mp3"===c.segmentCodec&&this.typeSupported.mpeg,H=[],V=void 0!==S,Y=c.samples,X=q?0:8,Z=this.nextAudioPts||-1,te=d*y;if(this.isAudioContiguous=n=n||Y.length&&Z>0&&(p&&Math.abs(te-Z)<9e3||Math.abs(f(Y[0].pts-N,te)-Z)<20*G),Y.forEach(function(le){le.pts=f(le.pts-N,te)}),!n||Z<0){if(!(Y=Y.filter(function(le){return le.pts>=0})).length)return;Z=0===S?0:p&&!V?Math.max(0,te):Y[0].pts}if("aac"===c.segmentCodec)for(var re=this.config.maxAudioFramesDrift,ne=0,he=Z;ne<Y.length;ne++){var be=Y[ne],me=be.pts,ye=me-he,Te=Math.abs(1e3*ye/y);if(ye<=-re*G&&V)0===ne&&(D.logger.warn("Audio frame @ "+(me/y).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ye/y)+" ms."),this.nextAudioPts=Z=he=me);else if(ye>=re*G&&Te<1e4&&V){var Ce=Math.round(ye/G);(he=me-Ce*G)<0&&(Ce--,he+=G),0===ne&&(this.nextAudioPts=Z=he),D.logger.warn("[mp4-remuxer]: Injecting "+Ce+" audio frame @ "+(he/y).toFixed(3)+"s due to "+Math.round(1e3*ye/y)+" ms gap.");for(var ue=0;ue<Ce;ue++){var ae=Math.max(he,0),ce=L.default.getSilentFrame(c.manifestCodec||c.codec,c.channelCount);ce||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=be.unit.subarray()),Y.splice(ne,0,{unit:ce,pts:ae}),he+=G,ne++}}be.pts=he,he+=G}for(var de,oe=null,ee=null,pe=0,_e=Y.length;_e--;)pe+=Y[_e].unit.byteLength;for(var Ie=0,Ae=Y.length;Ie<Ae;Ie++){var Re=Y[Ie],Ne=Re.unit,Me=Re.pts;if(null!==ee)H[Ie-1].duration=Math.round((Me-ee)/M);else{if(n&&"aac"===c.segmentCodec&&(Me=Z),oe=Me,!(pe>0))return;pe+=X;try{de=new Uint8Array(pe)}catch{return void this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:pe,reason:"fail allocating audio mdat "+pe})}q||(new DataView(de.buffer).setUint32(0,pe),de.set(F.default.types.mdat,4))}de.set(Ne,X);var We=Ne.byteLength;X+=We,H.push(new a(!0,B,We,0)),ee=Me}var He=H.length;if(He){this.nextAudioPts=Z=ee+M*H[H.length-1].duration;var Ye=q?new Uint8Array(0):F.default.moof(c.sequenceNumber++,oe/M,k({},c,{samples:H}));c.samples=[];var Qe=oe/y,tt=Z/y,$={data1:Ye,data2:de,startPTS:Qe,endPTS:tt,startDTS:Qe,endDTS:tt,type:"audio",hasAudio:!0,hasVideo:!1,nb:He};return this.isAudioContiguous=!0,console.assert(de.length,"MDAT length must not be zero"),$}},m.remuxEmptyAudio=function(c,d,n,p){var S=c.inputTimeScale,M=this.nextAudioPts,B=(null!==M?M:p.startDTS*S)+this._initDTS,N=S/(c.samplerate?c.samplerate:S)*1024,q=Math.ceil((p.endDTS*S+this._initDTS-B)/N),H=L.default.getSilentFrame(c.manifestCodec||c.codec,c.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),H){for(var V=[],Y=0;Y<q;Y++){var X=B+Y*N;V.push({unit:H,pts:X,dts:X})}return c.samples=V,this.remuxAudio(c,d,n,!1)}D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},h}();function f(h,m){var c;if(null===m)return h;for(c=m<h?-8589934592:8589934592;Math.abs(h-m)>4294967296;)h+=c;return h}function A(h,m,c,d){var n=h.samples.length;if(n){for(var p=h.inputTimeScale,S=0;S<n;S++){var y=h.samples[S];y.pts=f(y.pts-c,m*p)/p,y.dts=f(y.dts-d,m*p)/p}var P=h.samples;return h.samples=[],{samples:P}}}function v(h,m,c){var d=h.samples.length;if(d){for(var n=h.inputTimeScale,p=0;p<d;p++){var S=h.samples[p];S.pts=f(S.pts-c,m*n)/n}h.samples.sort(function(P,M){return P.pts-M.pts});var y=h.samples;return h.samples=[],{samples:y}}}var a=function(h,m,c,d){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=m,this.size=c,this.cts=d,this.flags=new s(h)},s=function(h){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=h?2:1,this.isNonSync=h?0:1}},"./src/remux/passthrough-remuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>b});var U=j("./src/polyfills/number.ts"),L=j("./src/remux/mp4-remuxer.ts"),F=j("./src/utils/mp4-tools.ts"),I=j("./src/loader/fragment.ts"),R=j("./src/utils/logger.ts");function _(k,x){var T=k?.codec;return T&&T.length>4?T:"hvc1"===T||"hev1"===T?"hvc1.1.c.L120.90":"av01"===T?"av01.0.04M.08":"avc1"===T||x===I.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const b=function(){function k(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var x=k.prototype;return x.destroy=function(){},x.resetTimeStamp=function(T){this.initPTS=T,this.lastEndTime=null},x.resetNextTimestamp=function(){this.lastEndTime=null},x.resetInitSegment=function(T,C,E,o){this.audioCodec=C,this.videoCodec=E,this.generateInitSegment((0,F.patchEncyptionData)(T,o)),this.emitInitSegment=!0},x.generateInitSegment=function(T){var C=this.audioCodec,E=this.videoCodec;if(!T||!T.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var o=this.initData=(0,F.parseInitSegment)(T);C||(C=_(o.audio,I.ElementaryStreamTypes.AUDIO)),E||(E=_(o.video,I.ElementaryStreamTypes.VIDEO));var g={};o.audio&&o.video?g.audiovideo={container:"video/mp4",codec:C+","+E,initSegment:T,id:"main"}:o.audio?g.audio={container:"audio/mp4",codec:C,initSegment:T,id:"audio"}:o.video?g.video={container:"video/mp4",codec:E,initSegment:T,id:"main"}:R.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=g},x.remux=function(T,C,E,o,g){var f,u=this.initPTS,A=this.lastEndTime,v={audio:void 0,video:void 0,text:o,id3:E,initSegment:void 0};(0,U.isFiniteNumber)(A)||(A=this.lastEndTime=g||0);var a=C.samples;if(!a||!a.length)return v;var s={initPTS:void 0,timescale:1},h=this.initData;if((!h||!h.length)&&(this.generateInitSegment(a),h=this.initData),!h||!h.length)return R.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),v;this.emitInitSegment&&(s.tracks=this.initTracks,this.emitInitSegment=!1);var m=(0,F.getStartDTS)(h,a);(0,U.isFiniteNumber)(u)||(this.initPTS=s.initPTS=u=m-g);var c=(0,F.getDuration)(a,h),d=T?m-u:A,n=d+c;(0,F.offsetStartDTS)(h,a,u),c>0?this.lastEndTime=n:(R.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var p=!!h.audio,S=!!h.video,y="";p&&(y+="audio"),S&&(y+="video");var P={data1:a,startPTS:d,startDTS:d,endPTS:n,endDTS:n,type:y,hasAudio:p,hasVideo:S,nb:1,dropped:0};v.audio="audio"===P.type?P:void 0,v.video="audio"!==P.type?P:void 0,v.initSegment=s;var M=null!=(f=this.initPTS)?f:0;return v.id3=(0,L.flushTextTrackMetadataCueSamples)(E,g,M,M),o.samples.length&&(v.text=(0,L.flushTextTrackUserdataCueSamples)(o,g,M)),v},k}()},"./src/task-loop.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>U});var U=function(){function L(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var F=L.prototype;return F.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},F.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},F.onHandlerDestroyed=function(){},F.hasInterval=function(){return!!this._tickInterval},F.hasNextTick=function(){return!!this._tickTimer},F.setInterval=function(I){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,I),!0)},F.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},F.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},F.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},F.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},F.doTick=function(){},L}()},"./src/types/cmcd.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{CMCDObjectType:()=>L,CMCDStreamType:()=>I,CMCDStreamingFormat:()=>F,CMCDVersion:()=>U});var L,R,F,I,U=1;(R=L||(L={})).MANIFEST="m",R.AUDIO="a",R.VIDEO="v",R.MUXED="av",R.INIT="i",R.CAPTION="c",R.TIMED_TEXT="tt",R.KEY="k",R.OTHER="o",function(R){R.DASH="d",R.HLS="h",R.SMOOTH="s",R.OTHER="o"}(F||(F={})),function(R){R.VOD="v",R.LIVE="l"}(I||(I={}))},"./src/types/demuxer.ts":(Q,K,j)=>{"use strict";var U,L;j.r(K),j.d(K,{MetadataSchema:()=>U}),(L=U||(U={})).audioId3="org.id3",L.dateRange="com.apple.quicktime.HLS",L.emsg="https://aomedia.org/emsg/ID3"},"./src/types/level.ts":(Q,K,j)=>{"use strict";function U(x,T){for(var C=0;C<T.length;C++){var E=T[C];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(x,F(E.key),E)}}function F(x){var T=function I(x,T){if("object"!=typeof x||null===x)return x;var C=x[Symbol.toPrimitive];if(void 0!==C){var E=C.call(x,T||"default");if("object"!=typeof E)return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===T?String:Number)(x)}(x,"string");return"symbol"==typeof T?T:String(T)}j.r(K),j.d(K,{HdcpLevels:()=>R,HlsSkip:()=>D,HlsUrlParameters:()=>b,Level:()=>k,getSkipValue:()=>_});var D,x,R=["NONE","TYPE-0","TYPE-1","TYPE-2",null];function _(x,T){var C=x.canSkipUntil;return C&&(void 0!==T?T-x.endSN:0)<C?x.canSkipDateRanges?D.v2:D.Yes:D.No}(x=D||(D={})).No="",x.Yes="YES",x.v2="v2";var b=function(){function x(C,E,o){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=C,this.part=E,this.skip=o}return x.prototype.addDirectives=function(C){var E=new self.URL(C);return void 0!==this.msn&&E.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&E.searchParams.set("_HLS_part",this.part.toString()),this.skip&&E.searchParams.set("_HLS_skip",this.skip),E.href},x}(),k=function(){function x(T){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[T.url],this.attrs=T.attrs,this.bitrate=T.bitrate,T.details&&(this.details=T.details),this.id=T.id||0,this.name=T.name,this.width=T.width||0,this.height=T.height||0,this.audioCodec=T.audioCodec,this.videoCodec=T.videoCodec,this.unknownCodecs=T.unknownCodecs,this.codecSet=[T.videoCodec,T.audioCodec].filter(function(C){return C}).join(",").replace(/\.[^.,]+/g,"")}return function L(x,T,C){T&&U(x.prototype,T),C&&U(x,C),Object.defineProperty(x,"prototype",{writable:!1})}(x,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(T){var C=T%this.url.length;this._urlId!==C&&(this.details=void 0,this._urlId=C)}}]),x}()},"./src/types/loader.ts":(Q,K,j)=>{"use strict";var U,F,L;j.r(K),j.d(K,{PlaylistContextType:()=>U,PlaylistLevelType:()=>L}),(F=U||(U={})).MANIFEST="manifest",F.LEVEL="level",F.AUDIO_TRACK="audioTrack",F.SUBTITLE_TRACK="subtitleTrack",function(F){F.MAIN="main",F.AUDIO="audio",F.SUBTITLE="subtitle"}(L||(L={}))},"./src/types/transmuxer.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{ChunkMetadata:()=>U});var U=function(F,I,R,D,_,b){void 0===D&&(D=0),void 0===_&&(_=-1),void 0===b&&(b=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=F,this.sn=I,this.id=R,this.size=D,this.part=_,this.partial=b}},"./src/utils/attr-list.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{AttrList:()=>F});var U=/^(\d+)x(\d+)$/,L=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,F=function(){function I(D){for(var _ in"string"==typeof D&&(D=I.parseAttrList(D)),D)D.hasOwnProperty(_)&&(this[_]=D[_])}var R=I.prototype;return R.decimalInteger=function(D){var _=parseInt(this[D],10);return _>Number.MAX_SAFE_INTEGER?1/0:_},R.hexadecimalInteger=function(D){if(this[D]){var _=(this[D]||"0x").slice(2);_=(1&_.length?"0":"")+_;for(var b=new Uint8Array(_.length/2),k=0;k<_.length/2;k++)b[k]=parseInt(_.slice(2*k,2*k+2),16);return b}return null},R.hexadecimalIntegerAsNumber=function(D){var _=parseInt(this[D],16);return _>Number.MAX_SAFE_INTEGER?1/0:_},R.decimalFloatingPoint=function(D){return parseFloat(this[D])},R.optionalFloat=function(D,_){var b=this[D];return b?parseFloat(b):_},R.enumeratedString=function(D){return this[D]},R.bool=function(D){return"YES"===this[D]},R.decimalResolution=function(D){var _=U.exec(this[D]);if(null!==_)return{width:parseInt(_[1],10),height:parseInt(_[2],10)}},I.parseAttrList=function(D){var _,b={};for(L.lastIndex=0;null!==(_=L.exec(D));){var x=_[2];0===x.indexOf('"')&&x.lastIndexOf('"')===x.length-1&&(x=x.slice(1,-1)),b[_[1]]=x}return b},I}()},"./src/utils/binary-search.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>L});const L={search:function(F,I){for(var R=0,D=F.length-1,_=null,b=null;R<=D;){var k=I(b=F[_=(R+D)/2|0]);if(k>0)R=_+1;else{if(!(k<0))return b;D=_-1}}return null}}},"./src/utils/buffer-helper.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{BufferHelper:()=>F});var U=j("./src/utils/logger.ts"),L={length:0,start:function(){return 0},end:function(){return 0}},F=function(){function I(){}return I.isBuffered=function(R,D){try{if(R)for(var _=I.getBuffered(R),b=0;b<_.length;b++)if(D>=_.start(b)&&D<=_.end(b))return!0}catch{}return!1},I.bufferInfo=function(R,D,_){try{if(R){var x,b=I.getBuffered(R),k=[];for(x=0;x<b.length;x++)k.push({start:b.start(x),end:b.end(x)});return this.bufferedInfo(k,D,_)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},I.bufferedInfo=function(R,D,_){D=Math.max(0,D),R.sort(function(v,a){return v.start-a.start||a.end-v.end});var b=[];if(_)for(var k=0;k<R.length;k++){var x=b.length;if(x){var T=b[x-1].end;R[k].start-T<_?R[k].end>T&&(b[x-1].end=R[k].end):b.push(R[k])}else b.push(R[k])}else b=R;for(var E,C=0,o=D,g=D,f=0;f<b.length;f++){var u=b[f].start,A=b[f].end;if(D+_>=u&&D<A)o=u,C=(g=A)-D;else if(D+_<u){E=u;break}}return{len:C,start:o||0,end:g||0,nextStart:E}},I.getBuffered=function(R){try{return R.buffered}catch(D){return U.logger.log("failed to get media.buffered",D),L}},I}()},"./src/utils/cea-608-parser.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{CaptionScreen:()=>u,Row:()=>f,default:()=>m});var T,c,U=j("./src/utils/logger.ts"),L={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},F=function(c){var d=c;return L.hasOwnProperty(c)&&(d=L[c]),String.fromCharCode(d)},I=15,R=100,D={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_={17:2,18:4,21:6,22:8,23:10,19:13,20:15},b={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},k={25:2,26:4,29:6,30:8,31:10,27:13,28:15},x=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(c=T||(T={}))[c.ERROR=0]="ERROR",c[c.TEXT=1]="TEXT",c[c.WARNING=2]="WARNING",c[c.INFO=2]="INFO",c[c.DEBUG=3]="DEBUG",c[c.DATA=3]="DATA";var C=function(){function c(){this.time=null,this.verboseLevel=T.ERROR}return c.prototype.log=function(n,p){if(this.verboseLevel>=n){var S="function"==typeof p?p():p;U.logger.log(this.time+" ["+n+"] "+S)}},c}(),E=function(c){for(var d=[],n=0;n<c.length;n++)d.push(c[n].toString(16));return d},o=function(){function c(n,p,S,y,P){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=n||"white",this.underline=p||!1,this.italics=S||!1,this.background=y||"black",this.flash=P||!1}var d=c.prototype;return d.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},d.setStyles=function(n){for(var p=["foreground","underline","italics","background","flash"],S=0;S<p.length;S++){var y=p[S];n.hasOwnProperty(y)&&(this[y]=n[y])}},d.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},d.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},d.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},d.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},c}(),g=function(){function c(n,p,S,y,P,M){this.uchar=void 0,this.penState=void 0,this.uchar=n||" ",this.penState=new o(p,S,y,P,M)}var d=c.prototype;return d.reset=function(){this.uchar=" ",this.penState.reset()},d.setChar=function(n,p){this.uchar=n,this.penState.copy(p)},d.setPenState=function(n){this.penState.copy(n)},d.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},d.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},d.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},c}(),f=function(){function c(n){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var p=0;p<R;p++)this.chars.push(new g);this.logger=n,this.pos=0,this.currPenState=new o}var d=c.prototype;return d.equals=function(n){for(var p=!0,S=0;S<R;S++)if(!this.chars[S].equals(n.chars[S])){p=!1;break}return p},d.copy=function(n){for(var p=0;p<R;p++)this.chars[p].copy(n.chars[p])},d.isEmpty=function(){for(var n=!0,p=0;p<R;p++)if(!this.chars[p].isEmpty()){n=!1;break}return n},d.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(T.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>R&&(this.logger.log(T.DEBUG,"Too large cursor position "+this.pos),this.pos=R)},d.moveCursor=function(n){var p=this.pos+n;if(n>1)for(var S=this.pos+1;S<p+1;S++)this.chars[S].setPenState(this.currPenState);this.setCursor(p)},d.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},d.insertChar=function(n){var p=this;n>=144&&this.backSpace();var S=F(n);this.pos>=R?this.logger.log(T.ERROR,function(){return"Cannot insert "+n.toString(16)+" ("+S+") at position "+p.pos+". Skipping it!"}):(this.chars[this.pos].setChar(S,this.currPenState),this.moveCursor(1))},d.clearFromPos=function(n){var p;for(p=n;p<R;p++)this.chars[p].reset()},d.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},d.clearToEndOfRow=function(){this.clearFromPos(this.pos)},d.getTextString=function(){for(var n=[],p=!0,S=0;S<R;S++){var y=this.chars[S].uchar;" "!==y&&(p=!1),n.push(y)}return p?"":n.join("")},d.setPenStyles=function(n){this.currPenState.setStyles(n),this.chars[this.pos].setPenState(this.currPenState)},c}(),u=function(){function c(n){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var p=0;p<I;p++)this.rows.push(new f(n));this.logger=n,this.currRow=I-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var d=c.prototype;return d.reset=function(){for(var n=0;n<I;n++)this.rows[n].clear();this.currRow=I-1},d.equals=function(n){for(var p=!0,S=0;S<I;S++)if(!this.rows[S].equals(n.rows[S])){p=!1;break}return p},d.copy=function(n){for(var p=0;p<I;p++)this.rows[p].copy(n.rows[p])},d.isEmpty=function(){for(var n=!0,p=0;p<I;p++)if(!this.rows[p].isEmpty()){n=!1;break}return n},d.backSpace=function(){this.rows[this.currRow].backSpace()},d.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},d.insertChar=function(n){this.rows[this.currRow].insertChar(n)},d.setPen=function(n){this.rows[this.currRow].setPenStyles(n)},d.moveCursor=function(n){this.rows[this.currRow].moveCursor(n)},d.setCursor=function(n){this.logger.log(T.INFO,"setCursor: "+n),this.rows[this.currRow].setCursor(n)},d.setPAC=function(n){this.logger.log(T.INFO,function(){return"pacData = "+JSON.stringify(n)});var p=n.row-1;if(this.nrRollUpRows&&p<this.nrRollUpRows-1&&(p=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==p){for(var S=0;S<I;S++)this.rows[S].clear();var y=this.currRow+1-this.nrRollUpRows,P=this.lastOutputScreen;if(P){var M=P.rows[y].cueStartTime,B=this.logger.time;if(M&&null!==B&&M<B)for(var G=0;G<this.nrRollUpRows;G++)this.rows[p-this.nrRollUpRows+G+1].copy(P.rows[y+G])}}this.currRow=p;var N=this.rows[this.currRow];if(null!==n.indent){var H=Math.max(n.indent-1,0);N.setCursor(n.indent),n.color=N.chars[H].penState.foreground}this.setPen({foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1})},d.setBkgData=function(n){this.logger.log(T.INFO,function(){return"bkgData = "+JSON.stringify(n)}),this.backSpace(),this.setPen(n),this.insertChar(32)},d.setRollUpRows=function(n){this.nrRollUpRows=n},d.rollUp=function(){var n=this;if(null!==this.nrRollUpRows){this.logger.log(T.TEXT,function(){return n.getDisplayText()});var S=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];S.clear(),this.rows.splice(this.currRow,0,S),this.logger.log(T.INFO,"Rolling up")}else this.logger.log(T.DEBUG,"roll_up but nrRollUpRows not set yet")},d.getDisplayText=function(n){n=n||!1;for(var p=[],S="",P=0;P<I;P++){var M=this.rows[P].getTextString();M&&p.push(n?"Row "+(P+1)+": '"+M+"'":M.trim())}return p.length>0&&(S=n?"["+p.join(" | ")+"]":p.join("\n")),S},d.getTextAndFormat=function(){return this.rows},c}(),A=function(){function c(n,p,S){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=p,this.mode=null,this.verbose=0,this.displayedMemory=new u(S),this.nonDisplayedMemory=new u(S),this.lastOutputScreen=new u(S),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=S}var d=c.prototype;return d.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},d.getHandler=function(){return this.outputFilter},d.setHandler=function(n){this.outputFilter=n},d.setPAC=function(n){this.writeScreen.setPAC(n)},d.setBkgData=function(n){this.writeScreen.setBkgData(n)},d.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(T.INFO,function(){return"MODE="+n}),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},d.insertChars=function(n){for(var p=this,S=0;S<n.length;S++)this.writeScreen.insertChar(n[S]);var y=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(T.INFO,function(){return y+": "+p.writeScreen.getDisplayText(!0)}),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(T.TEXT,function(){return"DISPLAYED: "+p.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},d.ccRCL=function(){this.logger.log(T.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},d.ccBS=function(){this.logger.log(T.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},d.ccAOF=function(){},d.ccAON=function(){},d.ccDER=function(){this.logger.log(T.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},d.ccRU=function(n){this.logger.log(T.INFO,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},d.ccFON=function(){this.logger.log(T.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},d.ccRDC=function(){this.logger.log(T.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},d.ccTR=function(){this.logger.log(T.INFO,"TR"),this.setMode("MODE_TEXT")},d.ccRTD=function(){this.logger.log(T.INFO,"RTD"),this.setMode("MODE_TEXT")},d.ccEDM=function(){this.logger.log(T.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},d.ccCR=function(){this.logger.log(T.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},d.ccENM=function(){this.logger.log(T.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},d.ccEOC=function(){var n=this;if(this.logger.log(T.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var p=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=p,this.writeScreen=this.nonDisplayedMemory,this.logger.log(T.TEXT,function(){return"DISP: "+n.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},d.ccTO=function(n){this.logger.log(T.INFO,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},d.ccMIDROW=function(n){var p={flash:!1};if(p.underline=n%2==1,p.italics=n>=46,p.italics)p.foreground="white";else{var S=Math.floor(n/2)-16;p.foreground=["white","green","blue","cyan","red","yellow","magenta"][S]}this.logger.log(T.INFO,"MIDROW: "+JSON.stringify(p)),this.writeScreen.setPen(p)},d.outputDataUpdate=function(n){void 0===n&&(n=!1);var p=this.logger.time;null!==p&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,p,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:p):this.cueStartTime=p,this.lastOutputScreen.copy(this.displayedMemory))},d.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},c}(),v=function(){function c(n,p,S){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var y=new C;this.channels=[null,new A(n,p,y),new A(n+1,S,y)],this.cmdHistory={a:null,b:null},this.logger=y}var d=c.prototype;return d.getHandler=function(n){return this.channels[n].getHandler()},d.setHandler=function(n,p){this.channels[n].setHandler(p)},d.addData=function(n,p){var S,y,P,M=!1;this.logger.time=n;for(var B=0;B<p.length;B+=2)if(P=127&p[B+1],0!=(y=127&p[B])||0!==P){if(this.logger.log(T.DATA,"["+E([p[B],p[B+1]])+"] -> ("+E([y,P])+")"),(S=this.parseCmd(y,P))||(S=this.parseMidrow(y,P)),S||(S=this.parsePAC(y,P)),S||(S=this.parseBackgroundAttributes(y,P)),!S&&(M=this.parseChars(y,P))){var G=this.currentChannel;G&&G>0?this.channels[G].insertChars(M):this.logger.log(T.WARNING,"No channel found yet. TEXT-MODE?")}!S&&!M&&this.logger.log(T.WARNING,"Couldn't parse cleaned data "+E([y,P])+" orig: "+E([p[B],p[B+1]]))}},d.parseCmd=function(n,p){var S=this.cmdHistory;if(!((20===n||28===n||21===n||29===n)&&p>=32&&p<=47||(23===n||31===n)&&p>=33&&p<=35))return!1;if(s(n,p,S))return a(null,null,S),this.logger.log(T.DEBUG,"Repeated command ("+E([n,p])+") is dropped"),!0;var M=20===n||21===n||23===n?1:2,B=this.channels[M];return 20===n||21===n||28===n||29===n?32===p?B.ccRCL():33===p?B.ccBS():34===p?B.ccAOF():35===p?B.ccAON():36===p?B.ccDER():37===p?B.ccRU(2):38===p?B.ccRU(3):39===p?B.ccRU(4):40===p?B.ccFON():41===p?B.ccRDC():42===p?B.ccTR():43===p?B.ccRTD():44===p?B.ccEDM():45===p?B.ccCR():46===p?B.ccENM():47===p&&B.ccEOC():B.ccTO(p-32),a(n,p,S),this.currentChannel=M,!0},d.parseMidrow=function(n,p){var S=0;if((17===n||25===n)&&p>=32&&p<=47){if((S=17===n?1:2)!==this.currentChannel)return this.logger.log(T.ERROR,"Mismatch channel in midrow parsing"),!1;var y=this.channels[S];return!!y&&(y.ccMIDROW(p),this.logger.log(T.DEBUG,"MIDROW ("+E([n,p])+")"),!0)}return!1},d.parsePAC=function(n,p){var y=this.cmdHistory;if(!((n>=17&&n<=23||n>=25&&n<=31)&&p>=64&&p<=127||(16===n||24===n)&&p>=64&&p<=95))return!1;if(s(n,p,y))return a(null,null,y),!0;var B=n<=23?1:2,G=this.channels[B];return!!G&&(G.setPAC(this.interpretPAC(p>=64&&p<=95?1===B?D[n]:b[n]:1===B?_[n]:k[n],p)),a(n,p,y),this.currentChannel=B,!0)},d.interpretPAC=function(n,p){var S,y={color:null,italics:!1,indent:null,underline:!1,row:n};return y.underline=1==(1&(S=p>95?p-96:p-64)),S<=13?y.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(S/2)]:S<=15?(y.italics=!0,y.color="white"):y.indent=4*Math.floor((S-16)/2),y},d.parseChars=function(n,p){var S,M,y=null,P=null;if(n>=25?(S=2,P=n-8):(S=1,P=n),P>=17&&P<=19?(this.logger.log(T.INFO,"Special char '"+F(M=17===P?p+80:18===P?p+112:p+144)+"' in channel "+S),y=[M]):n>=32&&n<=127&&(y=0===p?[n]:[n,p]),y){var B=E(y);this.logger.log(T.DEBUG,"Char codes =  "+B.join(",")),a(n,p,this.cmdHistory)}return y},d.parseBackgroundAttributes=function(n,p){if(!((16===n||24===n)&&p>=32&&p<=47||(23===n||31===n)&&p>=45&&p<=47))return!1;var P,M={};return 16===n||24===n?(P=Math.floor((p-32)/2),M.background=x[P],p%2==1&&(M.background=M.background+"_semi")):45===p?M.background="transparent":(M.foreground="black",47===p&&(M.underline=!0)),this.channels[n<=23?1:2].setBkgData(M),a(n,p,this.cmdHistory),!0},d.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var p=this.channels[n];p&&p.reset()}this.cmdHistory={a:null,b:null}},d.cueSplitAtTime=function(n){for(var p=0;p<this.channels.length;p++){var S=this.channels[p];S&&S.cueSplitAtTime(n)}},c}();function a(c,d,n){n.a=c,n.b=d}function s(c,d,n){return n.a===c&&n.b===d}const m=v},"./src/utils/codecs.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{isCodecSupportedInMp4:()=>F,isCodecType:()=>L});var U={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function L(I,R){var D=U[R];return!!D&&!0===D[I.slice(0,4)]}function F(I,R){return MediaSource.isTypeSupported((R||"video")+'/mp4;codecs="'+I+'"')}},"./src/utils/cues.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>D});var U=j("./src/utils/vttparser.ts"),L=j("./src/utils/webvtt-parser.ts"),F=j("./src/utils/texttrack-utils.ts"),I=/\s/;const D={newCue:function(_,b,k,x){for(var C,E,o,g,f,T=[],u=self.VTTCue||self.TextTrackCue,A=0;A<x.rows.length;A++)if(o=!0,g=0,f="",!(C=x.rows[A]).isEmpty()){for(var v=0;v<C.chars.length;v++)I.test(C.chars[v].uchar)&&o?g++:(f+=C.chars[v].uchar,o=!1);C.cueStartTime=b,b===k&&(k+=1e-4),g>=16?g--:g++;var a=(0,U.fixLineBreaks)(f.trim()),s=(0,L.generateCueId)(b,k,a);(!_||!_.cues||!_.cues.getCueById(s))&&((E=new u(b,k,a)).id=s,E.line=A+1,E.align="left",E.position=10+Math.min(80,10*Math.floor(8*g/32)),T.push(E))}return _&&T.length&&(T.sort(function(h,m){return"auto"===h.line||"auto"===m.line?0:h.line>8&&m.line>8?m.line-h.line:h.line-m.line}),T.forEach(function(h){return(0,F.addCueToTrack)(_,h)})),T}}},"./src/utils/discontinuities.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{adjustSlidingStart:()=>b,alignMediaPlaylistByPDT:()=>C,alignPDT:()=>T,alignStream:()=>k,findDiscontinuousReferenceFrag:()=>D,findFirstFragWithCC:()=>I,shouldAlignOnDiscontinuities:()=>R});var U=j("./src/polyfills/number.ts"),L=j("./src/utils/logger.ts"),F=j("./src/controller/level-helper.ts");function I(E,o){for(var g=null,f=0,u=E.length;f<u;f++){var A=E[f];if(A&&A.cc===o){g=A;break}}return g}function R(E,o,g){return!(!o.details||!(g.endCC>g.startCC||E&&E.cc<g.startCC))}function D(E,o,g){void 0===g&&(g=0);var f=E.fragments,u=o.fragments;if(u.length&&f.length){var A=I(f,u[0].cc);if(A&&(!A||A.startPTS))return A;L.logger.log("No frag in previous level to align on")}else L.logger.log("No fragments to align")}function _(E,o){if(E){var g=E.start+o;E.start=E.startPTS=g,E.endPTS=g+E.duration}}function b(E,o){for(var g=o.fragments,f=0,u=g.length;f<u;f++)_(g[f],E);o.fragmentHint&&_(o.fragmentHint,E),o.alignedSliding=!0}function k(E,o,g){!o||(function x(E,o,g){if(R(E,g,o)){var f=D(g.details,o);f&&(0,U.isFiniteNumber)(f.start)&&(L.logger.log("Adjusting PTS using last level due to CC increase within current level "+o.url),b(f.start,o))}}(E,g,o),!g.alignedSliding&&o.details&&T(g,o.details),!g.alignedSliding&&o.details&&!g.skippedSegments&&(0,F.adjustSliding)(o.details,g))}function T(E,o){if(o.fragments.length&&E.hasProgramDateTime&&o.hasProgramDateTime){var g=o.fragments[0].programDateTime,f=E.fragments[0].programDateTime,u=(f-g)/1e3+o.fragments[0].start;u&&(0,U.isFiniteNumber)(u)&&(L.logger.log("Adjusting PTS using programDateTime delta "+(f-g)+"ms, sliding:"+u.toFixed(3)+" "+E.url+" "),b(u,E))}}function C(E,o){if(E.hasProgramDateTime&&o.hasProgramDateTime){var g=E.fragments,f=o.fragments;if(g.length&&f.length){var A=f[Math.round(f.length/2)-1],v=I(g,A.cc)||g[Math.round(g.length/2)-1],a=A.programDateTime,s=v.programDateTime;null!==a&&null!==s&&b((s-a)/1e3-(v.start-A.start),E)}}}},"./src/utils/ewma-bandwidth-estimator.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>F});var U=j("./src/utils/ewma.ts");const F=function(){function I(D,_,b){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=b,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new U.default(D),this.fast_=new U.default(_)}var R=I.prototype;return R.update=function(D,_){var b=this.slow_,k=this.fast_;this.slow_.halfLife!==D&&(this.slow_=new U.default(D,b.getEstimate(),b.getTotalWeight())),this.fast_.halfLife!==_&&(this.fast_=new U.default(_,k.getEstimate(),k.getTotalWeight()))},R.sample=function(D,_){var k=(D=Math.max(D,this.minDelayMs_))/1e3,x=8*_/k;this.fast_.sample(k,x),this.slow_.sample(k,x)},R.canEstimate=function(){var D=this.fast_;return D&&D.getTotalWeight()>=this.minWeight_},R.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},R.destroy=function(){},I}()},"./src/utils/ewma.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>L});const L=function(){function F(R,D,_){void 0===D&&(D=0),void 0===_&&(_=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=R,this.alpha_=R?Math.exp(Math.log(.5)/R):0,this.estimate_=D,this.totalWeight_=_}var I=F.prototype;return I.sample=function(R,D){var _=Math.pow(this.alpha_,R);this.estimate_=D*(1-_)+_*this.estimate_,this.totalWeight_+=R},I.getTotalWeight=function(){return this.totalWeight_},I.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},F}()},"./src/utils/fetch-loader.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>u,fetchSupported:()=>C});var U=j("./src/polyfills/number.ts"),L=j("./src/loader/load-stats.ts"),F=j("./src/demux/chunk-cache.ts");function R(A){var v="function"==typeof Map?new Map:void 0;return R=function(a){if(null===a||!function b(A){return-1!==Function.toString.call(A).indexOf("[native code]")}(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if(typeof v<"u"){if(v.has(a))return v.get(a);v.set(a,s)}function s(){return D(a,arguments,x(this).constructor)}return s.prototype=Object.create(a.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),k(s,a)},R(A)}function D(A,v,a){return(D=function _(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(s,h,m){var c=[null];c.push.apply(c,h);var n=new(Function.bind.apply(s,c));return m&&k(n,m.prototype),n}).apply(null,arguments)}function k(A,v){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,s){return a.__proto__=s,a})(A,v)}function x(A){return(x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(v){return v.__proto__||Object.getPrototypeOf(v)})(A)}function T(){return T=Object.assign?Object.assign.bind():function(A){for(var v=1;v<arguments.length;v++){var a=arguments[v];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(A[s]=a[s])}return A},T.apply(this,arguments)}function C(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var E=function(){function A(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||g,this.controller=new self.AbortController,this.stats=new L.LoadStats}var v=A.prototype;return v.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},v.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},v.abort=function(){var a;this.abortInternal(),null!==(a=this.callbacks)&&void 0!==a&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},v.load=function(a,s,h){var m=this,c=this.stats;if(c.loading.start)throw new Error("Loader can only be used once.");c.loading.start=self.performance.now();var d=function o(A,v){var a={method:"GET",mode:"cors",credentials:"same-origin",signal:v,headers:new self.Headers(T({},A.headers))};return A.rangeEnd&&a.headers.set("Range","bytes="+A.rangeStart+"-"+String(A.rangeEnd-1)),a}(a,this.controller.signal),n=h.onProgress,p="arraybuffer"===a.responseType,S=p?"byteLength":"length";this.context=a,this.config=s,this.callbacks=h,this.request=this.fetchSetup(a,d),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){m.abortInternal(),h.onTimeout(c,a,m.response)},s.timeout),self.fetch(this.request).then(function(y){if(m.response=m.loader=y,!y.ok)throw new f(y.statusText||"fetch, bad network response",y.status,y);return c.loading.first=Math.max(self.performance.now(),c.loading.start),c.total=parseInt(y.headers.get("Content-Length")||"0"),n&&(0,U.isFiniteNumber)(s.highWaterMark)?m.loadProgressively(y,c,a,s.highWaterMark,n):p?y.arrayBuffer():y.text()}).then(function(y){var P=m.response;self.clearTimeout(m.requestTimeout),c.loading.end=Math.max(self.performance.now(),c.loading.first);var M=y[S];M&&(c.loaded=c.total=M);var B={url:P.url,data:y};n&&!(0,U.isFiniteNumber)(s.highWaterMark)&&n(c,a,y,P),h.onSuccess(B,c,a,P)}).catch(function(y){self.clearTimeout(m.requestTimeout),c.aborted||h.onError({code:y&&y.code||0,text:y?y.message:null},a,y?y.details:null)})},v.getCacheAge=function(){var a=null;if(this.response){var s=this.response.headers.get("age");a=s?parseFloat(s):null}return a},v.loadProgressively=function(a,s,h,m,c){void 0===m&&(m=0);var d=new F.default,n=a.body.getReader();return function S(){return n.read().then(function(y){if(y.done)return d.dataLength&&c(s,h,d.flush(),a),Promise.resolve(new ArrayBuffer(0));var P=y.value,M=P.length;return s.loaded+=M,M<m||d.dataLength?(d.push(P),d.dataLength>=m&&c(s,h,d.flush(),a)):c(s,h,P,a),S()}).catch(function(){return Promise.reject()})}()},A}();function g(A,v){return new self.Request(A.url,v)}var f=function(A){function v(a,s,h){var m;return(m=A.call(this,a)||this).code=void 0,m.details=void 0,m.code=s,m.details=h,m}return function I(A,v){A.prototype=Object.create(v.prototype),A.prototype.constructor=A,k(A,v)}(v,A),v}(R(Error));const u=E},"./src/utils/hex.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>L});const L={hexDump:function(F){for(var I="",R=0;R<F.length;R++){var D=F[R].toString(16);D.length<2&&(D="0"+D),I+=D}return I}}},"./src/utils/imsc1-ttml-parser.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{IMSC1_CODEC:()=>b,parseIMSC1:()=>C});var U=j("./src/utils/mp4-tools.ts"),L=j("./src/utils/vttparser.ts"),F=j("./src/utils/vttcue.ts"),I=j("./src/demux/id3.ts"),R=j("./src/utils/timescale-conversion.ts"),D=j("./src/utils/webvtt-parser.ts");function _(){return _=Object.assign?Object.assign.bind():function(m){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var n in d)Object.prototype.hasOwnProperty.call(d,n)&&(m[n]=d[n])}return m},_.apply(this,arguments)}var b="stpp.ttml.im1t",k=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,x=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function C(m,c,d,n,p){var S=(0,U.findBox)(new Uint8Array(m),["mdat"]);if(0!==S.length){var y=S.map(function(M){return(0,I.utf8ArrayToStr)(M)}),P=(0,R.toTimescaleFromScale)(c,1,d);try{y.forEach(function(M){return n(function E(m,c){var p=(new DOMParser).parseFromString(m,"text/xml").getElementsByTagName("tt")[0];if(!p)throw new Error("Invalid ttml");var S={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},y=Object.keys(S).reduce(function(N,q){return N[q]=p.getAttribute("ttp:"+q)||S[q],N},{}),P="preserve"!==p.getAttribute("xml:space"),M=g(o(p,"styling","style")),B=g(o(p,"layout","region")),G=o(p,"body","[begin]");return[].map.call(G,function(N){var q=f(N,P);if(!q||!N.hasAttribute("begin"))return null;var H=a(N.getAttribute("begin"),y),V=a(N.getAttribute("dur"),y),Y=a(N.getAttribute("end"),y);if(null===H)throw v(N);if(null===Y){if(null===V)throw v(N);Y=H+V}var X=new F.default(H-c,Y-c,q);X.id=(0,D.generateCueId)(X.startTime,X.endTime,X.text);var re=function u(m,c,d){var n="http://www.w3.org/ns/ttml#styling",p=null,y=null!=m&&m.hasAttribute("style")?m.getAttribute("style"):null;return y&&d.hasOwnProperty(y)&&(p=d[y]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(P,M){var B=A(c,n,M)||A(m,n,M)||A(p,n,M);return B&&(P[M]=B),P},{})}(B[N.getAttribute("region")],M[N.getAttribute("style")],M),ne=re.textAlign;if(ne){var he=T[ne];he&&(X.lineAlign=he),X.align=ne}return _(X,re),X}).filter(function(N){return null!==N})}(M,P))})}catch(M){p(M)}}else p(new Error("Could not parse IMSC1 mdat"))}function o(m,c,d){var n=m.getElementsByTagName(c)[0];return n?[].slice.call(n.querySelectorAll(d)):[]}function g(m){return m.reduce(function(c,d){var n=d.getAttribute("xml:id");return n&&(c[n]=d),c},{})}function f(m,c){return[].slice.call(m.childNodes).reduce(function(d,n,p){var S;return"br"===n.nodeName&&p?d+"\n":null!==(S=n.childNodes)&&void 0!==S&&S.length?f(n,c):c?d+n.textContent.trim().replace(/\s+/g," "):d+n.textContent},"")}function A(m,c,d){return m&&m.hasAttributeNS(c,d)?m.getAttributeNS(c,d):null}function v(m){return new Error("Could not parse ttml timestamp "+m)}function a(m,c){if(!m)return null;var d=(0,L.parseTimeStamp)(m);return null===d&&(k.test(m)?d=function s(m,c){var d=k.exec(m);return 3600*(0|d[1])+60*(0|d[2])+(0|d[3])+((0|d[4])+(0|d[5])/c.subFrameRate)/c.frameRate}(m,c):x.test(m)&&(d=function h(m,c){var d=x.exec(m),n=Number(d[1]);switch(d[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/c.frameRate;case"t":return n/c.tickRate}return n}(m,c))),d}},"./src/utils/keysystem-util.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{changeEndianness:()=>F,convertDataUriToArrayBytes:()=>I,strToUtf8array:()=>R});var U=j("./src/utils/numeric-encoding-utils.ts");function F(D){var _=function(b,k,x){var T=b[k];b[k]=b[x],b[x]=T};_(D,0,3),_(D,1,2),_(D,4,5),_(D,6,7)}function I(D){var _=D.split(":"),b=null;if("data"===_[0]&&2===_.length){var k=_[1].split(";"),x=k[k.length-1].split(",");if(2===x.length){var C=x[1];"base64"===x[0]?(k.splice(-1,1),b=(0,U.base64Decode)(C)):b=function L(D){var _=R(D).subarray(0,16),b=new Uint8Array(16);return b.set(_,16-_.length),b}(C)}}return b}function R(D){return Uint8Array.from(unescape(encodeURIComponent(D)),function(_){return _.charCodeAt(0)})}},"./src/utils/logger.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{enableLogs:()=>D,logger:()=>_});var U=function(){},L={trace:U,debug:U,log:U,warn:U,info:U,error:U},F=L;function D(b,k){if(self.console&&!0===b||"object"==typeof b){!function R(b){for(var k=arguments.length,x=new Array(k>1?k-1:0),T=1;T<k;T++)x[T-1]=arguments[T];x.forEach(function(C){F[C]=b[C]?b[C].bind(b):function I(b){var k=self.console[b];return k?k.bind(self.console,"["+b+"] >"):U}(C)})}(b,"debug","log","info","warn","error");try{F.log('Debug logs enabled for "'+k+'"')}catch{F=L}}else F=L}var _=L},"./src/utils/mediakeys-helper.ts":(Q,K,j)=>{"use strict";var U,T,L,I;function F(T){switch(T){case L.FAIRPLAY:return U.FAIRPLAY;case L.PLAYREADY:return U.PLAYREADY;case L.WIDEVINE:return U.WIDEVINE;case L.CLEARKEY:return U.CLEARKEY}}function R(T){if(T===I.WIDEVINE)return U.WIDEVINE}function D(T){switch(T){case U.FAIRPLAY:return L.FAIRPLAY;case U.PLAYREADY:return L.PLAYREADY;case U.WIDEVINE:return L.WIDEVINE;case U.CLEARKEY:return L.CLEARKEY}}function _(T){var C=T.drmSystems,E=T.widevineLicenseUrl,o=C?[U.FAIRPLAY,U.WIDEVINE,U.PLAYREADY,U.CLEARKEY].filter(function(g){return!!C[g]}):[];return!o[U.WIDEVINE]&&E&&o.push(U.WIDEVINE),o}j.r(K),j.d(K,{KeySystemFormats:()=>L,KeySystemIds:()=>I,KeySystems:()=>U,getKeySystemsForConfig:()=>_,getSupportedMediaKeySystemConfigurations:()=>k,keySystemDomainToKeySystemFormat:()=>D,keySystemFormatToKeySystemDomain:()=>F,keySystemIdToKeySystemDomain:()=>R,requestMediaKeySystemAccess:()=>b}),(T=U||(U={})).CLEARKEY="org.w3.clearkey",T.FAIRPLAY="com.apple.fps",T.PLAYREADY="com.microsoft.playready",T.WIDEVINE="com.widevine.alpha",function(T){T.CLEARKEY="org.w3.clearkey",T.FAIRPLAY="com.apple.streamingkeydelivery",T.PLAYREADY="com.microsoft.playready",T.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(L||(L={})),function(T){T.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"}(I||(I={}));var b=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function k(T,C,E,o){var g;switch(T){case U.FAIRPLAY:g=["cenc","sinf"];break;case U.WIDEVINE:case U.PLAYREADY:g=["cenc"];break;case U.CLEARKEY:g=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+T)}return function x(T,C,E,o){return[{initDataTypes:T,persistentState:o.persistentState||"not-allowed",distinctiveIdentifier:o.distinctiveIdentifier||"not-allowed",sessionTypes:o.sessionTypes||[o.sessionType||"temporary"],audioCapabilities:C.map(function(f){return{contentType:'audio/mp4; codecs="'+f+'"',robustness:o.audioRobustness||"",encryptionScheme:o.audioEncryptionScheme||null}}),videoCapabilities:E.map(function(f){return{contentType:'video/mp4; codecs="'+f+'"',robustness:o.videoRobustness||"",encryptionScheme:o.videoEncryptionScheme||null}})}]}(g,C,E,o)}},"./src/utils/mediasource-helper.ts":(Q,K,j)=>{"use strict";function U(){return self.MediaSource||self.WebKitMediaSource}j.r(K),j.d(K,{getMediaSource:()=>U})},"./src/utils/mp4-tools.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{RemuxerTrackIdConfig:()=>b,appendUint8Array:()=>c,bin2str:()=>k,computeRawDurationFromSamples:()=>s,discardEPB:()=>y,findBox:()=>o,getDuration:()=>a,getStartDTS:()=>v,mp4Box:()=>M,mp4pssh:()=>B,offsetStartDTS:()=>h,parseEmsg:()=>P,parseInitSegment:()=>f,parsePssh:()=>G,parseSEIMessageFromNALu:()=>S,parseSamples:()=>d,parseSegmentIndex:()=>g,parseSinf:()=>A,patchEncyptionData:()=>u,readSint32:()=>C,readUint16:()=>x,readUint32:()=>T,segmentValidRange:()=>m,writeUint32:()=>E});var U=j("./src/loader/fragment.ts"),L=j("./src/utils/typed-array.ts"),F=j("./src/demux/id3.ts"),I=j("./src/utils/logger.ts"),R=j("./src/utils/hex.ts"),D=Math.pow(2,32)-1,_=[].push,b={video:1,audio:2,id3:3,text:4};function k(N){return String.fromCharCode.apply(null,N)}function x(N,q){var H=N[q]<<8|N[q+1];return H<0?65536+H:H}function T(N,q){var H=C(N,q);return H<0?4294967296+H:H}function C(N,q){return N[q]<<24|N[q+1]<<16|N[q+2]<<8|N[q+3]}function E(N,q,H){N[q]=H>>24,N[q+1]=H>>16&255,N[q+2]=H>>8&255,N[q+3]=255&H}function o(N,q){var H=[];if(!q.length)return H;for(var V=N.byteLength,Y=0;Y<V;){var X=T(N,Y),te=X>1?Y+X:V;if(k(N.subarray(Y+4,Y+8))===q[0])if(1===q.length)H.push(N.subarray(Y+8,te));else{var re=o(N.subarray(Y+8,te),q.slice(1));re.length&&_.apply(H,re)}Y=te}return H}function g(N){var q=[],H=N[0],V=8,Y=T(N,V);V+=4,V+=0===H?8:16;var te=N.length+0,re=x(N,V+=2);V+=2;for(var ne=0;ne<re;ne++){var he=V,be=T(N,he);he+=4;var me=2147483647&be;if(1==(2147483648&be)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var Te=T(N,he);he+=4,q.push({referenceSize:me,subsegmentDuration:Te,info:{duration:Te/Y,start:te,end:te+me-1}}),te+=me,V=he+=4}return{earliestPresentationTime:0,timescale:Y,version:H,referencesCount:re,references:q}}function f(N){for(var q=[],H=o(N,["moov","trak"]),V=0;V<H.length;V++){var Y=H[V],X=o(Y,["tkhd"])[0];if(X){var Z=X[0],te=0===Z?12:20,re=T(X,te),ne=o(Y,["mdia","mdhd"])[0];if(ne){var he=T(ne,te=0===(Z=ne[0])?12:20),be=o(Y,["mdia","hdlr"])[0];if(be){var me=k(be.subarray(8,12)),ye={soun:U.ElementaryStreamTypes.AUDIO,vide:U.ElementaryStreamTypes.VIDEO}[me];if(ye){var Te=o(Y,["mdia","minf","stbl","stsd"])[0],Ce=void 0;Te&&(Ce=k(Te.subarray(12,16))),q[re]={timescale:he,type:ye},q[ye]={timescale:he,id:re,codec:Ce}}}}}}return o(N,["moov","mvex","trex"]).forEach(function(ae){var ce=T(ae,4),oe=q[ce];oe&&(oe.default={duration:T(ae,12),flags:T(ae,20)})}),q}function u(N,q){if(!N||!q)return N;var H=q.keyId;return H&&q.isCommonEncryption&&o(N,["moov","trak"]).forEach(function(Y){var Z=o(Y,["mdia","minf","stbl","stsd"])[0].subarray(8),te=o(Z,["enca"]),re=te.length>0;re||(te=o(Z,["encv"])),te.forEach(function(ne){o(ne.subarray(re?28:78),["sinf"]).forEach(function(me){var ye=A(me);if(ye){var Te=ye.subarray(8,24);Te.some(function(Ce){return 0!==Ce})||(I.logger.log("[eme] Patching keyId in 'enc"+(re?"a":"v")+">sinf>>tenc' box: "+R.default.hexDump(Te)+" -> "+R.default.hexDump(H)),ye.set(H,8))}})})}),N}function A(N){var q=o(N,["schm"])[0];if(q){var H=k(q.subarray(4,8));if("cbcs"===H||"cenc"===H)return o(N,["schi","tenc"])[0]}return I.logger.error("[eme] missing 'schm' box"),null}function v(N,q){return o(q,["moof","traf"]).reduce(function(H,V){var Y=o(V,["tfdt"])[0],X=Y[0],Z=o(V,["tfhd"]).reduce(function(te,re){var ne=T(re,4),he=N[ne];if(he){var be=T(Y,4);1===X&&(be*=Math.pow(2,32),be+=T(Y,8));var ye=be/(he.timescale||9e4);if(isFinite(ye)&&(null===te||ye<te))return ye}return te},null);return null!==Z&&isFinite(Z)&&(null===H||Z<H)?Z:H},null)||0}function a(N,q){for(var H=0,V=0,Y=0,X=o(N,["moof","traf"]),Z=0;Z<X.length;Z++){var te=X[Z],re=o(te,["tfhd"])[0],he=q[T(re,4)];if(he){var be=he.default,me=T(re,0)|be?.flags,ye=be?.duration;8&me&&(ye=T(re,2&me?12:8));for(var Te=he.timescale||9e4,Ce=o(te,["trun"]),ue=0;ue<Ce.length;ue++)!(H=s(Ce[ue]))&&ye&&(H=ye*T(Ce[ue],4)),he.type===U.ElementaryStreamTypes.VIDEO?V+=H/Te:he.type===U.ElementaryStreamTypes.AUDIO&&(Y+=H/Te)}}if(0===V&&0===Y){for(var ce=0,oe=o(N,["sidx"]),ee=0;ee<oe.length;ee++){var de=g(oe[ee]);null!=de&&de.references&&(ce+=de.references.reduce(function(pe,_e){return pe+_e.info.duration||0},0))}return ce}return V||Y}function s(N){var q=T(N,0),H=8;1&q&&(H+=4),4&q&&(H+=4);for(var V=0,Y=T(N,4),X=0;X<Y;X++)256&q&&(V+=T(N,H),H+=4),512&q&&(H+=4),1024&q&&(H+=4),2048&q&&(H+=4);return V}function h(N,q,H){o(q,["moof","traf"]).forEach(function(V){o(V,["tfhd"]).forEach(function(Y){var X=T(Y,4),Z=N[X];if(Z){var te=Z.timescale||9e4;o(V,["tfdt"]).forEach(function(re){var ne=re[0],he=T(re,4);if(0===ne)he-=H*te,E(re,4,he=Math.max(he,0));else{he*=Math.pow(2,32),he+=T(re,8),he-=H*te,he=Math.max(he,0);var be=Math.floor(he/(D+1)),me=Math.floor(he%(D+1));E(re,4,be),E(re,8,me)}})}})})}function m(N){var q={valid:null,remainder:null},H=o(N,["moof"]);if(!H)return q;if(H.length<2)return q.remainder=N,q;var V=H[H.length-1];return q.valid=(0,L.sliceUint8)(N,0,V.byteOffset-8),q.remainder=(0,L.sliceUint8)(N,V.byteOffset-8),q}function c(N,q){var H=new Uint8Array(N.length+q.length);return H.set(N),H.set(q,N.length),H}function d(N,q){var H=[],V=q.samples,Y=q.timescale,X=q.id,Z=!1;return o(V,["moof"]).map(function(re){var ne=re.byteOffset-8;o(re,["traf"]).map(function(be){var me=o(be,["tfdt"]).map(function(ye){var Te=ye[0],Ce=T(ye,4);return 1===Te&&(Ce*=Math.pow(2,32),Ce+=T(ye,8)),Ce/Y})[0];return void 0!==me&&(N=me),o(be,["tfhd"]).map(function(ye){var Te=T(ye,4),Ce=16777215&T(ye,0),oe=0,ee=0!=(16&Ce),de=0,pe=0!=(32&Ce),_e=8;Te===X&&(0!=(1&Ce)&&(_e+=8),0!=(2&Ce)&&(_e+=4),0!=(8&Ce)&&(oe=T(ye,_e),_e+=4),ee&&(de=T(ye,_e),_e+=4),pe&&(_e+=4),"video"===q.type&&(Z=function n(N){if(!N)return!1;var q=N.indexOf("."),H=q<0?N:N.substring(0,q);return"hvc1"===H||"hev1"===H||"dvh1"===H||"dvhe"===H}(q.codec)),o(be,["trun"]).map(function(Ie){var Ae=Ie[0],Re=16777215&T(Ie,0),Ne=0!=(1&Re),Me=0,Oe=0!=(4&Re),Ue=0!=(256&Re),We=0,He=0!=(512&Re),Ze=0,Ye=0!=(1024&Re),Qe=0!=(2048&Re),tt=0,it=T(Ie,4),$=8;Ne&&(Me=T(Ie,$),$+=4),Oe&&($+=4);for(var le=Me+ne,je=0;je<it;je++){if(Ue?(We=T(Ie,$),$+=4):We=oe,He?(Ze=T(Ie,$),$+=4):Ze=de,Ye&&($+=4),Qe&&(tt=0===Ae?T(Ie,$):C(Ie,$),$+=4),q.type===U.ElementaryStreamTypes.VIDEO)for(var Fe=0;Fe<Ze;){var Be=T(V,le);p(Z,V[le+=4])&&S(V.subarray(le,le+Be),Z?2:1,N+tt/Y,H),le+=Be,Fe+=Be+4}N+=We/Y}}))})})}),H}function p(N,q){if(N){var H=q>>1&63;return 39===H||40===H}return 6==(31&q)}function S(N,q,H,V){var Y=y(N),X=0;X+=q;for(var Z=0,te=0,re=!1,ne=0;X<Y.length;){Z=0;do{if(X>=Y.length)break;Z+=ne=Y[X++]}while(255===ne);te=0;do{if(X>=Y.length)break;te+=ne=Y[X++]}while(255===ne);var he=Y.length-X;if(!re&&4===Z&&X<Y.length){if(re=!0,181===Y[X++]){var me=x(Y,X);if(X+=2,49===me){var ye=T(Y,X);if(X+=4,1195456820===ye){var Te=Y[X++];if(3===Te){var Ce=Y[X++],ae=64&Ce,ce=ae?2+3*(31&Ce):0,oe=new Uint8Array(ce);if(ae){oe[0]=Ce;for(var ee=1;ee<ce;ee++)oe[ee]=Y[X++]}V.push({type:Te,payloadType:Z,pts:H,bytes:oe})}}}}}else if(5===Z&&te<he){if(re=!0,te>16){for(var de=[],pe=0;pe<16;pe++){var _e=Y[X++].toString(16);de.push(1==_e.length?"0"+_e:_e),(3===pe||5===pe||7===pe||9===pe)&&de.push("-")}for(var Ie=te-16,Ae=new Uint8Array(Ie),Re=0;Re<Ie;Re++)Ae[Re]=Y[X++];V.push({payloadType:Z,pts:H,uuid:de.join(""),userData:(0,F.utf8ArrayToStr)(Ae),userDataBytes:Ae})}}else if(te<he)X+=te;else if(te>he)break}}function y(N){for(var q=N.byteLength,H=[],V=1;V<q-2;)0===N[V]&&0===N[V+1]&&3===N[V+2]?(H.push(V+2),V+=2):V++;if(0===H.length)return N;var Y=q-H.length,X=new Uint8Array(Y),Z=0;for(V=0;V<Y;Z++,V++)Z===H[0]&&(Z++,H.shift()),X[V]=N[Z];return X}function P(N){var q=N[0],H="",V="",Y=0,X=0,Z=0,te=0,re=0,ne=0;if(0===q){for(;"\0"!==k(N.subarray(ne,ne+1));)H+=k(N.subarray(ne,ne+1)),ne+=1;for(H+=k(N.subarray(ne,ne+1)),ne+=1;"\0"!==k(N.subarray(ne,ne+1));)V+=k(N.subarray(ne,ne+1)),ne+=1;V+=k(N.subarray(ne,ne+1)),ne+=1,Y=T(N,12),X=T(N,16),te=T(N,20),re=T(N,24),ne=28}else if(1===q){Y=T(N,ne+=4);var he=T(N,ne+=4),be=T(N,ne+=4);for(ne+=4,Z=Math.pow(2,32)*he+be,Number.isSafeInteger(Z)||(Z=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),te=T(N,ne),re=T(N,ne+=4),ne+=4;"\0"!==k(N.subarray(ne,ne+1));)H+=k(N.subarray(ne,ne+1)),ne+=1;for(H+=k(N.subarray(ne,ne+1)),ne+=1;"\0"!==k(N.subarray(ne,ne+1));)V+=k(N.subarray(ne,ne+1)),ne+=1;V+=k(N.subarray(ne,ne+1)),ne+=1}return{schemeIdUri:H,value:V,timeScale:Y,presentationTime:Z,presentationTimeDelta:X,eventDuration:te,id:re,payload:N.subarray(ne,N.byteLength)}}function M(N){for(var q=arguments.length,H=new Array(q>1?q-1:0),V=1;V<q;V++)H[V-1]=arguments[V];for(var Y=H.length,X=8,Z=Y;Z--;)X+=H[Z].byteLength;var te=new Uint8Array(X);for(te[0]=X>>24&255,te[1]=X>>16&255,te[2]=X>>8&255,te[3]=255&X,te.set(N,4),Z=0,X=8;Z<Y;Z++)te.set(H[Z],X),X+=H[Z].byteLength;return te}function B(N,q,H){if(16!==N.byteLength)throw new RangeError("Invalid system id");var V,Y,te;if(q){V=1,Y=new Uint8Array(16*q.length);for(var X=0;X<q.length;X++){var Z=q[X];if(16!==Z.byteLength)throw new RangeError("Invalid key");Y.set(Z,16*X)}}else V=0,Y=new Uint8Array;V>0?(te=new Uint8Array(4),q.length>0&&new DataView(te.buffer).setUint32(0,q.length,!1)):te=new Uint8Array;var re=new Uint8Array(4);return H&&H.byteLength>0&&new DataView(re.buffer).setUint32(0,H.byteLength,!1),M([112,115,115,104],new Uint8Array([V,0,0,0]),N,te,Y,re,H||new Uint8Array)}function G(N){if(!(N instanceof ArrayBuffer)||N.byteLength<32)return null;var q={version:0,systemId:"",kids:null,data:null},H=new DataView(N),V=H.getUint32(0);if(N.byteLength!==V&&V>44)return null;if(1886614376!==H.getUint32(4)||(q.version=H.getUint32(8)>>>24,q.version>1))return null;q.systemId=R.default.hexDump(new Uint8Array(N,12,16));var X=H.getUint32(28);if(0===q.version){if(V-32<X)return null;q.data=new Uint8Array(N,32,X)}else if(1===q.version){q.kids=[];for(var Z=0;Z<X;Z++)q.kids.push(new Uint8Array(N,32+16*Z,16))}return q}},"./src/utils/numeric-encoding-utils.ts":(Q,K,j)=>{"use strict";function U(_){return _.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function L(_){return btoa(_)}function F(_){return atob(_)}function I(_){return btoa(String.fromCharCode.apply(String,_))}function R(_){return U(I(_))}function D(_){return Uint8Array.from(atob(_),function(b){return b.charCodeAt(0)})}j.r(K),j.d(K,{base64Decode:()=>D,base64DecodeToStr:()=>F,base64Encode:()=>I,base64ToBase64Url:()=>U,base64UrlEncode:()=>R,strToBase64Encode:()=>L})},"./src/utils/output-filter.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>U});var U=function(){function L(I,R){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=I,this.trackName=R}var F=L.prototype;return F.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},F.newCue=function(I,R,D){(null===this.startTime||this.startTime>I)&&(this.startTime=I),this.endTime=R,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},F.reset=function(){this.cueRanges=[],this.startTime=null},L}()},"./src/utils/texttrack-utils.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{addCueToTrack:()=>F,clearCurrentCues:()=>I,getCuesInRange:()=>_,removeCuesInRange:()=>R,sendAddTrackEvent:()=>L});var U=j("./src/utils/logger.ts");function L(b,k){var x;try{x=new Event("addtrack")}catch{(x=document.createEvent("Event")).initEvent("addtrack",!1,!1)}x.track=b,k.dispatchEvent(x)}function F(b,k){var x=b.mode;if("disabled"===x&&(b.mode="hidden"),b.cues&&!b.cues.getCueById(k.id))try{if(b.addCue(k),!b.cues.getCueById(k.id))throw new Error("addCue is failed for: "+k)}catch(C){U.logger.debug("[texttrack-utils]: "+C);var T=new self.TextTrackCue(k.startTime,k.endTime,k.text);T.id=k.id,b.addCue(T)}"disabled"===x&&(b.mode=x)}function I(b){var k=b.mode;if("disabled"===k&&(b.mode="hidden"),b.cues)for(var x=b.cues.length;x--;)b.removeCue(b.cues[x]);"disabled"===k&&(b.mode=k)}function R(b,k,x,T){var C=b.mode;if("disabled"===C&&(b.mode="hidden"),b.cues&&b.cues.length>0)for(var E=_(b.cues,k,x),o=0;o<E.length;o++)(!T||T(E[o]))&&b.removeCue(E[o]);"disabled"===C&&(b.mode=C)}function _(b,k,x){var T=[],C=function D(b,k){if(k<b[0].startTime)return 0;var x=b.length-1;if(k>b[x].endTime)return-1;for(var T=0,C=x;T<=C;){var E=Math.floor((C+T)/2);if(k<b[E].startTime)C=E-1;else{if(!(k>b[E].startTime&&T<x))return E;T=E+1}}return b[T].startTime-k<k-b[C].startTime?T:C}(b,k);if(C>-1)for(var E=C,o=b.length;E<o;E++){var g=b[E];if(g.startTime>=k&&g.endTime<=x)T.push(g);else if(g.startTime>x)return T}return T}},"./src/utils/time-ranges.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>L});const L={toString:function(F){for(var I="",R=F.length,D=0;D<R;D++)I+="["+F.start(D).toFixed(3)+","+F.end(D).toFixed(3)+"]";return I}}},"./src/utils/timescale-conversion.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{toMpegTsClockFromTimescale:()=>R,toMsFromMpegTsClock:()=>I,toTimescaleFromBase:()=>L,toTimescaleFromScale:()=>F});var U=9e4;function L(D,_,b,k){void 0===b&&(b=1),void 0===k&&(k=!1);var x=D*_*b;return k?Math.round(x):x}function F(D,_,b,k){return void 0===b&&(b=1),void 0===k&&(k=!1),L(D,_,1/b,k)}function I(D,_){return void 0===_&&(_=!1),L(D,1e3,1/U,_)}function R(D,_){return void 0===_&&(_=1),L(D,U,1/_)}},"./src/utils/typed-array.ts":(Q,K,j)=>{"use strict";function U(L,F,I){return Uint8Array.prototype.slice?L.slice(F,I):new Uint8Array(Array.prototype.slice.call(L,F,I))}j.r(K),j.d(K,{sliceUint8:()=>U})},"./src/utils/vttcue.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>U});const U=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var L=["","lr","rl"],F=["start","middle","end","left","right"];function I(k,x){if("string"!=typeof x||!Array.isArray(k))return!1;var T=x.toLowerCase();return!!~k.indexOf(T)&&T}function D(k){return I(F,k)}function _(k){for(var x=arguments.length,T=new Array(x>1?x-1:0),C=1;C<x;C++)T[C-1]=arguments[C];for(var E=1;E<arguments.length;E++){var o=arguments[E];for(var g in o)k[g]=o[g]}return k}function b(k,x,T){var C=this,E={enumerable:!0};C.hasBeenReset=!1;var o="",g=!1,f=k,u=x,A=T,v=null,a="",s=!0,h="auto",m="start",c=50,d="middle",n=50,p="middle";Object.defineProperty(C,"id",_({},E,{get:function(){return o},set:function(S){o=""+S}})),Object.defineProperty(C,"pauseOnExit",_({},E,{get:function(){return g},set:function(S){g=!!S}})),Object.defineProperty(C,"startTime",_({},E,{get:function(){return f},set:function(S){if("number"!=typeof S)throw new TypeError("Start time must be set to a number.");f=S,this.hasBeenReset=!0}})),Object.defineProperty(C,"endTime",_({},E,{get:function(){return u},set:function(S){if("number"!=typeof S)throw new TypeError("End time must be set to a number.");u=S,this.hasBeenReset=!0}})),Object.defineProperty(C,"text",_({},E,{get:function(){return A},set:function(S){A=""+S,this.hasBeenReset=!0}})),Object.defineProperty(C,"region",_({},E,{get:function(){return v},set:function(S){v=S,this.hasBeenReset=!0}})),Object.defineProperty(C,"vertical",_({},E,{get:function(){return a},set:function(S){var y=function R(k){return I(L,k)}(S);if(!1===y)throw new SyntaxError("An invalid or illegal string was specified.");a=y,this.hasBeenReset=!0}})),Object.defineProperty(C,"snapToLines",_({},E,{get:function(){return s},set:function(S){s=!!S,this.hasBeenReset=!0}})),Object.defineProperty(C,"line",_({},E,{get:function(){return h},set:function(S){if("number"!=typeof S&&"auto"!==S)throw new SyntaxError("An invalid number or illegal string was specified.");h=S,this.hasBeenReset=!0}})),Object.defineProperty(C,"lineAlign",_({},E,{get:function(){return m},set:function(S){var y=D(S);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");m=y,this.hasBeenReset=!0}})),Object.defineProperty(C,"position",_({},E,{get:function(){return c},set:function(S){if(S<0||S>100)throw new Error("Position must be between 0 and 100.");c=S,this.hasBeenReset=!0}})),Object.defineProperty(C,"positionAlign",_({},E,{get:function(){return d},set:function(S){var y=D(S);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");d=y,this.hasBeenReset=!0}})),Object.defineProperty(C,"size",_({},E,{get:function(){return n},set:function(S){if(S<0||S>100)throw new Error("Size must be between 0 and 100.");n=S,this.hasBeenReset=!0}})),Object.defineProperty(C,"align",_({},E,{get:function(){return p},set:function(S){var y=D(S);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");p=y,this.hasBeenReset=!0}})),C.displayState=void 0}return b.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},b}()},"./src/utils/vttparser.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{VTTParser:()=>x,fixLineBreaks:()=>k,parseTimeStamp:()=>F});var U=j("./src/utils/vttcue.ts"),L=function(){function T(){}return T.prototype.decode=function(E,o){if(!E)return"";if("string"!=typeof E)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(E))},T}();function F(T){function C(o,g,f,u){return 3600*(0|o)+60*(0|g)+(0|f)+parseFloat(u||0)}var E=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return E?parseFloat(E[2])>59?C(E[2],E[3],0,E[4]):C(E[1],E[2],E[3],E[4]):null}var I=function(){function T(){this.values=Object.create(null)}var C=T.prototype;return C.set=function(E,o){!this.get(E)&&""!==o&&(this.values[E]=o)},C.get=function(E,o,g){return g?this.has(E)?this.values[E]:o[g]:this.has(E)?this.values[E]:o},C.has=function(E){return E in this.values},C.alt=function(E,o,g){for(var f=0;f<g.length;++f)if(o===g[f]){this.set(E,o);break}},C.integer=function(E,o){/^-?\d+$/.test(o)&&this.set(E,parseInt(o,10))},C.percent=function(E,o){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(o)){var g=parseFloat(o);if(g>=0&&g<=100)return this.set(E,g),!0}return!1},T}();function R(T,C,E,o){var g=o?T.split(o):[T];for(var f in g)if("string"==typeof g[f]){var u=g[f].split(E);2===u.length&&C(u[0],u[1])}}var D=new U.default(0,0,""),_="middle"===D.align?"middle":"center";function b(T,C,E){var o=T;function g(){var A=F(T);if(null===A)throw new Error("Malformed timestamp: "+o);return T=T.replace(/^[^\sa-zA-Z-]+/,""),A}function u(){T=T.replace(/^\s+/,"")}if(u(),C.startTime=g(),u(),"--\x3e"!==T.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+o);T=T.slice(3),u(),C.endTime=g(),u(),function f(A,v){var a=new I;R(A,function(m,c){var d;switch(m){case"region":for(var n=E.length-1;n>=0;n--)if(E[n].id===c){a.set(m,E[n].region);break}break;case"vertical":a.alt(m,c,["rl","lr"]);break;case"line":d=c.split(","),a.integer(m,d[0]),a.percent(m,d[0])&&a.set("snapToLines",!1),a.alt(m,d[0],["auto"]),2===d.length&&a.alt("lineAlign",d[1],["start",_,"end"]);break;case"position":d=c.split(","),a.percent(m,d[0]),2===d.length&&a.alt("positionAlign",d[1],["start",_,"end","line-left","line-right","auto"]);break;case"size":a.percent(m,c);break;case"align":a.alt(m,c,["start",_,"end","left","right"])}},/:/,/\s/),v.region=a.get("region",null),v.vertical=a.get("vertical","");var s=a.get("line","auto");"auto"===s&&-1===D.line&&(s=-1),v.line=s,v.lineAlign=a.get("lineAlign","start"),v.snapToLines=a.get("snapToLines",!0),v.size=a.get("size",100),v.align=a.get("align",_);var h=a.get("position","auto");"auto"===h&&50===D.position&&(h="start"===v.align||"left"===v.align?0:"end"===v.align||"right"===v.align?100:50),v.position=h}(T,C)}function k(T){return T.replace(/<br(?: \/)?>/gi,"\n")}var x=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new L,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var C=T.prototype;return C.parse=function(E){var o=this;function g(){var s=o.buffer,h=0;for(s=k(s);h<s.length&&"\r"!==s[h]&&"\n"!==s[h];)++h;var m=s.slice(0,h);return"\r"===s[h]&&++h,"\n"===s[h]&&++h,o.buffer=s.slice(h),m}E&&(o.buffer+=o.decoder.decode(E,{stream:!0}));try{var u="";if("INITIAL"===o.state){if(!/\r\n|\n/.test(o.buffer))return this;var A=(u=g()).match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(!A||!A[0])throw new Error("Malformed WebVTT signature.");o.state="HEADER"}for(var v=!1;o.buffer;){if(!/\r\n|\n/.test(o.buffer))return this;switch(v?v=!1:u=g(),o.state){case"HEADER":/:/.test(u)?R(u,function(h,m){},/:/):u||(o.state="ID");continue;case"NOTE":u||(o.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(u)){o.state="NOTE";break}if(!u)continue;if(o.cue=new U.default(0,0,""),o.state="CUE",-1===u.indexOf("--\x3e")){o.cue.id=u;continue}case"CUE":if(!o.cue){o.state="BADCUE";continue}try{b(u,o.cue,o.regionList)}catch{o.cue=null,o.state="BADCUE";continue}o.state="CUETEXT";continue;case"CUETEXT":var a=-1!==u.indexOf("--\x3e");if(!u||a&&(v=!0)){o.oncue&&o.cue&&o.oncue(o.cue),o.cue=null,o.state="ID";continue}if(null===o.cue)continue;o.cue.text&&(o.cue.text+="\n"),o.cue.text+=u;continue;case"BADCUE":u||(o.state="ID")}}}catch{"CUETEXT"===o.state&&o.cue&&o.oncue&&o.oncue(o.cue),o.cue=null,o.state="INITIAL"===o.state?"BADWEBVTT":"BADCUE"}return this},C.flush=function(){var E=this;try{if((E.cue||"HEADER"===E.state)&&(E.buffer+="\n\n",E.parse()),"INITIAL"===E.state||"BADWEBVTT"===E.state)throw new Error("Malformed WebVTT signature.")}catch(o){E.onparsingerror&&E.onparsingerror(o)}return E.onflush&&E.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{generateCueId:()=>x,parseWebVTT:()=>C});var U=j("./src/polyfills/number.ts"),L=j("./src/utils/vttparser.ts"),F=j("./src/demux/id3.ts"),I=j("./src/utils/timescale-conversion.ts"),R=j("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,_=function(E,o,g){return void 0===g&&(g=0),E.slice(g,g+o.length)===o},b=function(E){var o=parseInt(E.slice(-3)),g=parseInt(E.slice(-6,-4)),f=parseInt(E.slice(-9,-7)),u=E.length>9?parseInt(E.substring(0,E.indexOf(":"))):0;if(!((0,U.isFiniteNumber)(o)&&(0,U.isFiniteNumber)(g)&&(0,U.isFiniteNumber)(f)&&(0,U.isFiniteNumber)(u)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+E);return o+=1e3*g,(o+=6e4*f)+36e5*u},k=function(E){for(var o=5381,g=E.length;g;)o=33*o^E.charCodeAt(--g);return(o>>>0).toString()};function x(E,o,g){return k(E.toString())+k(o.toString())+k(g)}var T=function(E,o,g){var f=E[o],u=E[f.prevCC];if(!u||!u.new&&f.new)return E.ccOffset=E.presentationOffset=f.start,void(f.new=!1);for(;null!==(A=u)&&void 0!==A&&A.new;){var A;E.ccOffset+=f.start-u.start,f.new=!1,u=E[(f=u).prevCC]}E.presentationOffset=g};function C(E,o,g,f,u,A,v,a){var S,s=new L.VTTParser,h=(0,F.utf8ArrayToStr)(new Uint8Array(E)).trim().replace(D,"\n").split("\n"),m=[],c=(0,I.toMpegTsClockFromTimescale)(o,g),d="00:00.000",n=0,p=0,y=!0;s.oncue=function(P){var M=f[u],B=f.ccOffset,G=(n-c)/9e4;null!=M&&M.new&&(void 0!==p?B=f.ccOffset=M.start:T(f,u,G)),G&&(B=G-f.presentationOffset);var N=P.endTime-P.startTime,q=(0,R.normalizePts)(9e4*(P.startTime+B-p),9e4*A)/9e4;P.startTime=Math.max(q,0),P.endTime=Math.max(q+N,0);var H=P.text.trim();P.text=decodeURIComponent(encodeURIComponent(H)),P.id||(P.id=x(P.startTime,P.endTime,H)),P.endTime>0&&m.push(P)},s.onparsingerror=function(P){S=P},s.onflush=function(){S?a(S):v(m)},h.forEach(function(P){if(y){if(_(P,"X-TIMESTAMP-MAP=")){y=!1,P.slice(16).split(",").forEach(function(M){_(M,"LOCAL:")?d=M.slice(6):_(M,"MPEGTS:")&&(n=parseInt(M.slice(7)))});try{p=b(d)/1e3}catch(M){S=M}return}""===P&&(y=!1)}s.parse(P+"\n")}),s.flush()}},"./src/utils/xhr-loader.ts":(Q,K,j)=>{"use strict";j.r(K),j.d(K,{default:()=>R});var U=j("./src/utils/logger.ts"),L=j("./src/loader/load-stats.ts"),F=/^age:\s*[\d.]+\s*$/m;const R=function(){function D(b){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=b?b.xhrSetup:null,this.stats=new L.LoadStats,this.retryDelay=0}var _=D.prototype;return _.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},_.abortInternal=function(){var b=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),b&&(b.onreadystatechange=null,b.onprogress=null,4!==b.readyState&&(this.stats.aborted=!0,b.abort()))},_.abort=function(){var b;this.abortInternal(),null!==(b=this.callbacks)&&void 0!==b&&b.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},_.load=function(b,k,x){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=b,this.config=k,this.callbacks=x,this.retryDelay=k.retryDelay,this.loadInternal()},_.loadInternal=function(){var b=this.config,k=this.context;if(b){var x=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var C=this.xhrSetup;try{if(C)try{C(x,k.url)}catch{x.open("GET",k.url,!0),C(x,k.url)}x.readyState||x.open("GET",k.url,!0);var E=this.context.headers;if(E)for(var o in E)x.setRequestHeader(o,E[o])}catch(g){return void this.callbacks.onError({code:x.status,text:g.message},k,x)}k.rangeEnd&&x.setRequestHeader("Range","bytes="+k.rangeStart+"-"+(k.rangeEnd-1)),x.onreadystatechange=this.readystatechange.bind(this),x.onprogress=this.loadprogress.bind(this),x.responseType=k.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),b.timeout),x.send()}},_.readystatechange=function(){var b=this.context,k=this.loader,x=this.stats;if(b&&k){var T=k.readyState,C=this.config;if(!x.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),0===x.loading.first&&(x.loading.first=Math.max(self.performance.now(),x.loading.start)),4===T){k.onreadystatechange=null,k.onprogress=null;var E=k.status,o="arraybuffer"===k.responseType;if(E>=200&&E<300&&(o&&k.response||null!==k.responseText)){var g,f;if(x.loading.end=Math.max(self.performance.now(),x.loading.first),f=o?(g=k.response).byteLength:(g=k.responseText).length,x.loaded=x.total=f,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(x,b,g,k),!this.callbacks)return;this.callbacks.onSuccess({url:k.responseURL,data:g},x,b,k)}else x.retry>=C.maxRetry||E>=400&&E<499?(U.logger.error(E+" while loading "+b.url),this.callbacks.onError({code:E,text:k.statusText},b,k)):(U.logger.warn(E+" while loading "+b.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,C.maxRetryDelay),x.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),C.timeout)}},_.loadtimeout=function(){U.logger.warn("timeout while loading "+this.context.url);var b=this.callbacks;b&&(this.abortInternal(),b.onTimeout(this.stats,this.context,this.loader))},_.loadprogress=function(b){var k=this.stats;k.loaded=b.loaded,b.lengthComputable&&(k.total=b.total)},_.getCacheAge=function(){var b=null;if(this.loader&&F.test(this.loader.getAllResponseHeaders())){var k=this.loader.getResponseHeader("age");b=k?parseFloat(k):null}return b},D}()},"./node_modules/eventemitter3/index.js":Q=>{"use strict";var K=Object.prototype.hasOwnProperty,j="~";function U(){}function L(D,_,b){this.fn=D,this.context=_,this.once=b||!1}function F(D,_,b,k,x){if("function"!=typeof b)throw new TypeError("The listener must be a function");var T=new L(b,k||D,x),C=j?j+_:_;return D._events[C]?D._events[C].fn?D._events[C]=[D._events[C],T]:D._events[C].push(T):(D._events[C]=T,D._eventsCount++),D}function I(D,_){0==--D._eventsCount?D._events=new U:delete D._events[_]}function R(){this._events=new U,this._eventsCount=0}Object.create&&(U.prototype=Object.create(null),(new U).__proto__||(j=!1)),R.prototype.eventNames=function(){var _,b,D=[];if(0===this._eventsCount)return D;for(b in _=this._events)K.call(_,b)&&D.push(j?b.slice(1):b);return Object.getOwnPropertySymbols?D.concat(Object.getOwnPropertySymbols(_)):D},R.prototype.listeners=function(D){var b=this._events[j?j+D:D];if(!b)return[];if(b.fn)return[b.fn];for(var k=0,x=b.length,T=new Array(x);k<x;k++)T[k]=b[k].fn;return T},R.prototype.listenerCount=function(D){var b=this._events[j?j+D:D];return b?b.fn?1:b.length:0},R.prototype.emit=function(D,_,b,k,x,T){var C=j?j+D:D;if(!this._events[C])return!1;var g,f,E=this._events[C],o=arguments.length;if(E.fn){switch(E.once&&this.removeListener(D,E.fn,void 0,!0),o){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,_),!0;case 3:return E.fn.call(E.context,_,b),!0;case 4:return E.fn.call(E.context,_,b,k),!0;case 5:return E.fn.call(E.context,_,b,k,x),!0;case 6:return E.fn.call(E.context,_,b,k,x,T),!0}for(f=1,g=new Array(o-1);f<o;f++)g[f-1]=arguments[f];E.fn.apply(E.context,g)}else{var A,u=E.length;for(f=0;f<u;f++)switch(E[f].once&&this.removeListener(D,E[f].fn,void 0,!0),o){case 1:E[f].fn.call(E[f].context);break;case 2:E[f].fn.call(E[f].context,_);break;case 3:E[f].fn.call(E[f].context,_,b);break;case 4:E[f].fn.call(E[f].context,_,b,k);break;default:if(!g)for(A=1,g=new Array(o-1);A<o;A++)g[A-1]=arguments[A];E[f].fn.apply(E[f].context,g)}}return!0},R.prototype.on=function(D,_,b){return F(this,D,_,b,!1)},R.prototype.once=function(D,_,b){return F(this,D,_,b,!0)},R.prototype.removeListener=function(D,_,b,k){var x=j?j+D:D;if(!this._events[x])return this;if(!_)return I(this,x),this;var T=this._events[x];if(T.fn)T.fn===_&&(!k||T.once)&&(!b||T.context===b)&&I(this,x);else{for(var C=0,E=[],o=T.length;C<o;C++)(T[C].fn!==_||k&&!T[C].once||b&&T[C].context!==b)&&E.push(T[C]);E.length?this._events[x]=1===E.length?E[0]:E:I(this,x)}return this},R.prototype.removeAllListeners=function(D){var _;return D?this._events[_=j?j+D:D]&&I(this,_):(this._events=new U,this._eventsCount=0),this},R.prototype.off=R.prototype.removeListener,R.prototype.addListener=R.prototype.on,R.prefixed=j,R.EventEmitter=R,Q.exports=R},"./node_modules/url-toolkit/src/url-toolkit.js":function(Q){var j,U,L,F,I;j=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,U=/^(?=([^\/?#]*))\1([^]*)$/,L=/(?:\/|^)\.(?=\/)/g,F=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Q.exports=I={buildAbsoluteURL:function(R,D,_){if(_=_||{},R=R.trim(),!(D=D.trim())){if(!_.alwaysNormalize)return R;var b=I.parseURL(R);if(!b)throw new Error("Error trying to parse base URL.");return b.path=I.normalizePath(b.path),I.buildURLFromParts(b)}var k=I.parseURL(D);if(!k)throw new Error("Error trying to parse relative URL.");if(k.scheme)return _.alwaysNormalize?(k.path=I.normalizePath(k.path),I.buildURLFromParts(k)):D;var x=I.parseURL(R);if(!x)throw new Error("Error trying to parse base URL.");if(!x.netLoc&&x.path&&"/"!==x.path[0]){var T=U.exec(x.path);x.netLoc=T[1],x.path=T[2]}x.netLoc&&!x.path&&(x.path="/");var C={scheme:x.scheme,netLoc:k.netLoc,path:null,params:k.params,query:k.query,fragment:k.fragment};if(!k.netLoc&&(C.netLoc=x.netLoc,"/"!==k.path[0]))if(k.path){var E=x.path,o=E.substring(0,E.lastIndexOf("/")+1)+k.path;C.path=I.normalizePath(o)}else C.path=x.path,k.params||(C.params=x.params,k.query||(C.query=x.query));return null===C.path&&(C.path=_.alwaysNormalize?I.normalizePath(k.path):k.path),I.buildURLFromParts(C)},parseURL:function(R){var D=j.exec(R);return D?{scheme:D[1]||"",netLoc:D[2]||"",path:D[3]||"",params:D[4]||"",query:D[5]||"",fragment:D[6]||""}:null},normalizePath:function(R){for(R=R.split("").reverse().join("").replace(L,"");R.length!==(R=R.replace(F,"")).length;);return R.split("").reverse().join("")},buildURLFromParts:function(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}}}},Ee={};function ke(Q){var K=Ee[Q];if(void 0!==K)return K.exports;var j=Ee[Q]={exports:{}};return Le[Q].call(j.exports,j,j.exports,ke),j.exports}ke.m=Le,ke.n=Q=>{var K=Q&&Q.__esModule?()=>Q.default:()=>Q;return ke.d(K,{a:K}),K},ke.d=(Q,K)=>{for(var j in K)ke.o(K,j)&&!ke.o(Q,j)&&Object.defineProperty(Q,j,{enumerable:!0,get:K[j]})},ke.o=(Q,K)=>Object.prototype.hasOwnProperty.call(Q,K),ke.r=Q=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(Q,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(Q,"__esModule",{value:!0})};var Se=ke("./src/hls.ts");return Se.default})(),ge.exports=Ee())},988:ge=>{ge.exports=function Ee(ke){if(!ke)return!1;var Se=Le.call(ke);return"[object Function]"===Se||"function"==typeof ke&&"[object RegExp]"!==Se||typeof window<"u"&&(ke===window.setTimeout||ke===window.alert||ke===window.confirm||ke===window.prompt)};var Le=Object.prototype.toString},642:(ge,Le)=>{function Ee(U){if(U&&"object"==typeof U){var L=U.which||U.keyCode||U.charCode;L&&(U=L)}if("number"==typeof U)return K[U];var I,F=String(U);return(I=ke[F.toLowerCase()])?I:(I=Se[F.toLowerCase()])||(1===F.length?F.charCodeAt(0):void 0)}Ee.isEventKey=function(U,L){if(U&&"object"==typeof U){var F=U.which||U.keyCode||U.charCode;if(null==F)return!1;if("string"==typeof L){var I;if(I=ke[L.toLowerCase()])return I===F;if(I=Se[L.toLowerCase()])return I===F}else if("number"==typeof L)return L===F;return!1}};var ke=(Le=ge.exports=Ee).code=Le.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},Se=Le.aliases={windows:91,"\u21e7":16,"\u2325":18,"\u2303":17,"\u2318":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(Q=97;Q<123;Q++)ke[String.fromCharCode(Q)]=Q-32;for(var Q=48;Q<58;Q++)ke[Q-48]=Q;for(Q=1;Q<13;Q++)ke["f"+Q]=Q+111;for(Q=0;Q<10;Q++)ke["numpad "+Q]=Q+96;var K=Le.names=Le.title={};for(Q in ke)K[ke[Q]]=Q;for(var j in Se)ke[j]=Se[j]},54:ge=>{ge.exports=function Le(Ee,ke){var Se,Q=null;try{Se=JSON.parse(Ee,ke)}catch(K){Q=K}return[Q,Se]}},207:(ge,Le,Ee)=>{"use strict";var ke=Ee(697),Se=Ee(675),Q=Ee(110),K=Ee(642),j=Ee(104),U=Ee(721),L=Ee(54),F=Ee(424),I=Ee(497),R=Ee(271),D=Ee(169);function _(l){return l&&"object"==typeof l&&"default"in l?l:{default:l}}for(var S,b=_(ke),k=_(Se),x=_(Q),T=_(K),C=_(j),E=_(U),o=_(L),g=_(F),f=_(I),u=_(R),A=_(D),v="7.21.2",a={},s=function(l,w){return a[l]=a[l]||[],w&&(a[l]=a[l].concat(w)),a[l]},m=function(l,w){var i=s(l).indexOf(w);return!(i<=-1||(a[l]=a[l].slice(),a[l].splice(i,1),0))},d={prefixed:!0},n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],p=n[0],y=0;y<n.length;y++)if(n[y][1]in k.default){S=n[y];break}if(S){for(var P=0;P<S.length;P++)d[p[P]]=S[P];d.prefixed=S[0]!==p[0]}var M=[],N=function G(l){var i,w="info",e=function(){for(var t=arguments.length,r=new Array(t),O=0;O<t;O++)r[O]=arguments[O];i("log",w,r)};return i=function(l,w){return function(i,e,t){var r=w.levels[e],O=new RegExp("^("+r+")$");if("log"!==i&&t.unshift(i.toUpperCase()+":"),t.unshift(l+":"),M){M.push([].concat(t));var W=M.length-1e3;M.splice(0,W>0?W:0)}if(b.default.console){var z=b.default.console[i];!z&&"debug"===i&&(z=b.default.console.info||b.default.console.log),z&&r&&O.test(i)&&z[Array.isArray(t)?"apply":"call"](b.default.console,t)}}}(l,e),e.createLogger=function(t){return G(l+": "+t)},e.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:w},e.level=function(t){if("string"==typeof t){if(!e.levels.hasOwnProperty(t))throw new Error('"'+t+'" in not a valid log level');w=t}return w},(e.history=function(){return M?[].concat(M):[]}).filter=function(t){return(M||[]).filter(function(r){return new RegExp(".*"+t+".*").test(r[0])})},e.history.clear=function(){M&&(M.length=0)},e.history.disable=function(){null!==M&&(M.length=0,M=null)},e.history.enable=function(){null===M&&(M=[])},e.error=function(){for(var t=arguments.length,r=new Array(t),O=0;O<t;O++)r[O]=arguments[O];return i("error",w,r)},e.warn=function(){for(var t=arguments.length,r=new Array(t),O=0;O<t;O++)r[O]=arguments[O];return i("warn",w,r)},e.debug=function(){for(var t=arguments.length,r=new Array(t),O=0;O<t;O++)r[O]=arguments[O];return i("debug",w,r)},e}("VIDEOJS"),q=N.createLogger,H=Object.prototype.toString,V=function(l){return te(l)?Object.keys(l):[]};function Y(l,w){V(l).forEach(function(i){return w(l[i],i)})}function Z(l){for(var w=arguments.length,i=new Array(w>1?w-1:0),e=1;e<w;e++)i[e-1]=arguments[e];return Object.assign?x.default.apply(void 0,[l].concat(i)):(i.forEach(function(t){!t||Y(t,function(r,O){l[O]=r})}),l)}function te(l){return!!l&&"object"==typeof l}function re(l){return te(l)&&"[object Object]"===H.call(l)&&l.constructor===Object}function ne(l,w){if(!l||!w)return"";if("function"==typeof b.default.getComputedStyle){var i;try{i=b.default.getComputedStyle(l)}catch{return""}return i?i.getPropertyValue(w)||i[w]:""}return""}var l,he=b.default.navigator&&b.default.navigator.userAgent||"",be=/AppleWebKit\/([\d.]+)/i.exec(he),me=be?parseFloat(be.pop()):null,ye=/iPod/i.test(he),Te=(l=he.match(/OS (\d+)_/i))&&l[1]?l[1]:null,Ce=/Android/i.test(he),ue=function(){var l=he.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!l)return null;var w=l[1]&&parseFloat(l[1]),i=l[2]&&parseFloat(l[2]);return w&&i?parseFloat(l[1]+"."+l[2]):w||null}(),ae=Ce&&ue<5&&me<537,ce=/Firefox/i.test(he),oe=/Edg/i.test(he),ee=!oe&&(/Chrome/i.test(he)||/CriOS/i.test(he)),de=function(){var l=he.match(/(Chrome|CriOS)\/(\d+)/);return l&&l[2]?parseFloat(l[2]):null}(),pe=function(){var l=/MSIE\s(\d+)\.\d/.exec(he),w=l&&parseFloat(l[1]);return!w&&/Trident\/7.0/i.test(he)&&/rv:11.0/.test(he)&&(w=11),w}(),_e=/Safari/i.test(he)&&!ee&&!Ce&&!oe,Ie=/Windows/i.test(he),Ae=Boolean(Ye()&&("ontouchstart"in b.default||b.default.navigator.maxTouchPoints||b.default.DocumentTouch&&b.default.document instanceof b.default.DocumentTouch)),Re=/iPad/i.test(he)||_e&&Ae&&!/iPhone/i.test(he),Ne=/iPhone/i.test(he)&&!Re,Me=Ne||Re||ye,Oe=(_e||Me)&&!ee,Ue=Object.freeze({__proto__:null,IS_IPOD:ye,IOS_VERSION:Te,IS_ANDROID:Ce,ANDROID_VERSION:ue,IS_NATIVE_ANDROID:ae,IS_FIREFOX:ce,IS_EDGE:oe,IS_CHROME:ee,CHROME_VERSION:de,IE_VERSION:pe,IS_SAFARI:_e,IS_WINDOWS:Ie,TOUCH_ENABLED:Ae,IS_IPAD:Re,IS_IPHONE:Ne,IS_IOS:Me,IS_ANY_SAFARI:Oe});function We(l){return"string"==typeof l&&Boolean(l.trim())}function He(l){if(l.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function Ye(){return k.default===b.default.document}function Qe(l){return te(l)&&1===l.nodeType}function tt(){try{return b.default.parent!==b.default.self}catch{return!0}}function it(l){return function(w,i){if(!We(w))return k.default[l](null);We(i)&&(i=k.default.querySelector(i));var e=Qe(i)?i:k.default;return e[l]&&e[l](w)}}function $(l,w,i,e){void 0===l&&(l="div"),void 0===w&&(w={}),void 0===i&&(i={});var t=k.default.createElement(l);return Object.getOwnPropertyNames(w).forEach(function(r){var O=w[r];-1!==r.indexOf("aria-")||"role"===r||"type"===r?(N.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set "+r+" to "+O+"."),t.setAttribute(r,O)):"textContent"===r?le(t,O):(t[r]!==O||"tabIndex"===r)&&(t[r]=O)}),Object.getOwnPropertyNames(i).forEach(function(r){t.setAttribute(r,i[r])}),e&&yt(t,e),t}function le(l,w){return typeof l.textContent>"u"?l.innerText=w:l.textContent=w,l}function je(l,w){w.firstChild?w.insertBefore(l,w.firstChild):w.appendChild(l)}function Fe(l,w){return He(w),l.classList?l.classList.contains(w):function Ze(l){return new RegExp("(^|\\s)"+l+"($|\\s)")}(w).test(l.className)}function Be(l,w){return l.classList?l.classList.add(w):Fe(l,w)||(l.className=(l.className+" "+w).trim()),l}function qe(l,w){return l?(l.classList?l.classList.remove(w):(He(w),l.className=l.className.split(/\s+/).filter(function(i){return i!==w}).join(" ")),l):(N.warn("removeClass was called with an element that doesn't exist"),null)}function Pe(l,w,i){var e=Fe(l,w);if("function"==typeof i&&(i=i(l,w)),"boolean"!=typeof i&&(i=!e),i!==e)return i?Be(l,w):qe(l,w),l}function lt(l,w){Object.getOwnPropertyNames(w).forEach(function(i){var e=w[i];null===e||typeof e>"u"||!1===e?l.removeAttribute(i):l.setAttribute(i,!0===e?"":e)})}function Ve(l){var w={};if(l&&l.attributes&&l.attributes.length>0)for(var e=l.attributes,t=e.length-1;t>=0;t--){var r=e[t].name,O=e[t].value;("boolean"==typeof l[r]||-1!==",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+r+","))&&(O=null!==O),w[r]=O}return w}function ct(l,w){return l.getAttribute(w)}function ht(l,w,i){l.setAttribute(w,i)}function gt(l,w){l.removeAttribute(w)}function Je(){k.default.body.focus(),k.default.onselectstart=function(){return!1}}function It(){k.default.onselectstart=function(){return!0}}function ft(l){if(l&&l.getBoundingClientRect&&l.parentNode){var w=l.getBoundingClientRect(),i={};return["bottom","height","left","right","top","width"].forEach(function(e){void 0!==w[e]&&(i[e]=w[e])}),i.height||(i.height=parseFloat(ne(l,"height"))),i.width||(i.width=parseFloat(ne(l,"width"))),i}}function Et(l){if(!l||l&&!l.offsetParent)return{left:0,top:0,width:0,height:0};for(var w=l.offsetWidth,i=l.offsetHeight,e=0,t=0;l.offsetParent&&l!==k.default[d.fullscreenElement];)e+=l.offsetLeft,t+=l.offsetTop,l=l.offsetParent;return{left:e,top:t,width:w,height:i}}function mt(l,w){var i={x:0,y:0};if(Me)for(var e=l;e&&"html"!==e.nodeName.toLowerCase();){var t=ne(e,"transform");if(/^matrix/.test(t)){var r=t.slice(7,-1).split(/,\s/).map(Number);i.x+=r[4],i.y+=r[5]}else if(/^matrix3d/.test(t)){var O=t.slice(9,-1).split(/,\s/).map(Number);i.x+=O[12],i.y+=O[13]}e=e.parentNode}var W={},z=Et(w.target),J=Et(l),se=J.width,fe=w.offsetY-(J.top-z.top),De=w.offsetX-(J.left-z.left);return w.changedTouches&&(De=w.changedTouches[0].pageX-J.left,fe=w.changedTouches[0].pageY+J.top,Me&&(De-=i.x,fe-=i.y)),W.y=1-Math.max(0,Math.min(1,fe/J.height)),W.x=Math.max(0,Math.min(1,De/se)),W}function Rt(l){return te(l)&&3===l.nodeType}function Tt(l){for(;l.firstChild;)l.removeChild(l.firstChild);return l}function Ot(l){return"function"==typeof l&&(l=l()),(Array.isArray(l)?l:[l]).map(function(w){return"function"==typeof w&&(w=w()),Qe(w)||Rt(w)?w:"string"==typeof w&&/\S/.test(w)?k.default.createTextNode(w):void 0}).filter(function(w){return w})}function yt(l,w){return Ot(w).forEach(function(i){return l.appendChild(i)}),l}function Pt(l,w){return yt(Tt(l),w)}function St(l){return void 0===l.button&&void 0===l.buttons||0===l.button&&void 0===l.buttons||"mouseup"===l.type&&0===l.button&&0===l.buttons||!(0!==l.button||1!==l.buttons)}var nr,ut=it("querySelector"),rr=it("querySelectorAll"),Vt=Object.freeze({__proto__:null,isReal:Ye,isEl:Qe,isInFrame:tt,createEl:$,textContent:le,prependTo:je,hasClass:Fe,addClass:Be,removeClass:qe,toggleClass:Pe,setAttributes:lt,getAttributes:Ve,getAttribute:ct,setAttribute:ht,removeAttribute:gt,blockTextSelection:Je,unblockTextSelection:It,getBoundingClientRect:ft,findPosition:Et,getPointerPosition:mt,isTextNode:Rt,emptyEl:Tt,normalizeContent:Ot,appendContent:yt,insertContent:Pt,isSingleLeftClick:St,$:ut,$$:rr}),ir=!1,ar=function(){if(!1!==nr.options.autoSetup){var l=Array.prototype.slice.call(k.default.getElementsByTagName("video")),w=Array.prototype.slice.call(k.default.getElementsByTagName("audio")),i=Array.prototype.slice.call(k.default.getElementsByTagName("video-js")),e=l.concat(w,i);if(e&&e.length>0)for(var t=0,r=e.length;t<r;t++){var O=e[t];if(!O||!O.getAttribute){kt(1);break}void 0===O.player&&null!==O.getAttribute("data-setup")&&nr(O)}else ir||kt(1)}};function kt(l,w){!Ye()||(w&&(nr=w),b.default.setTimeout(ar,l))}function Mt(){ir=!0,b.default.removeEventListener("load",Mt)}Ye()&&("complete"===k.default.readyState?Mt():b.default.addEventListener("load",Mt));var wi,fr=function(l){var w=k.default.createElement("style");return w.className=l,w},sr=function(l,w){l.styleSheet?l.styleSheet.cssText=w:l.textContent=w},Fn=3;function Dt(){return Fn++}b.default.WeakMap||(wi=function(){function l(){this.vdata="vdata"+Math.floor(b.default.performance&&b.default.performance.now()||Date.now()),this.data={}}var w=l.prototype;return w.set=function(i,e){var t=i[this.vdata]||Dt();return i[this.vdata]||(i[this.vdata]=t),this.data[t]=e,this},w.get=function(i){var e=i[this.vdata];if(e)return this.data[e];N("We have no data for this element",i)},w.has=function(i){return i[this.vdata]in this.data},w.delete=function(i){var e=i[this.vdata];e&&(delete this.data[e],delete i[this.vdata])},l}());var at=b.default.WeakMap?new WeakMap:new wi;function Ci(l,w){if(at.has(l)){var i=at.get(l);0===i.handlers[w].length&&(delete i.handlers[w],l.removeEventListener?l.removeEventListener(w,i.dispatcher,!1):l.detachEvent&&l.detachEvent("on"+w,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),0===Object.getOwnPropertyNames(i).length&&at.delete(l)}}function Fr(l,w,i,e){i.forEach(function(t){l(w,t,e)})}function pr(l){if(l.fixed_)return l;function w(){return!0}function i(){return!1}if(!l||!l.isPropagationStopped||!l.isImmediatePropagationStopped){var e=l||b.default.event;for(var t in l={},e)"layerX"!==t&&"layerY"!==t&&"keyLocation"!==t&&"webkitMovementX"!==t&&"webkitMovementY"!==t&&"path"!==t&&("returnValue"===t&&e.preventDefault||(l[t]=e[t]));if(l.target||(l.target=l.srcElement||k.default),l.relatedTarget||(l.relatedTarget=l.fromElement===l.target?l.toElement:l.fromElement),l.preventDefault=function(){e.preventDefault&&e.preventDefault(),l.returnValue=!1,e.returnValue=!1,l.defaultPrevented=!0},l.defaultPrevented=!1,l.stopPropagation=function(){e.stopPropagation&&e.stopPropagation(),l.cancelBubble=!0,e.cancelBubble=!0,l.isPropagationStopped=w},l.isPropagationStopped=i,l.stopImmediatePropagation=function(){e.stopImmediatePropagation&&e.stopImmediatePropagation(),l.isImmediatePropagationStopped=w,l.stopPropagation()},l.isImmediatePropagationStopped=i,null!=l.clientX){var r=k.default.documentElement,O=k.default.body;l.pageX=l.clientX+(r&&r.scrollLeft||O&&O.scrollLeft||0)-(r&&r.clientLeft||O&&O.clientLeft||0),l.pageY=l.clientY+(r&&r.scrollTop||O&&O.scrollTop||0)-(r&&r.clientTop||O&&O.clientTop||0)}l.which=l.charCode||l.keyCode,null!=l.button&&(l.button=1&l.button?0:4&l.button?1:2&l.button?2:0)}return l.fixed_=!0,l}var vr,jn=function(){if("boolean"!=typeof vr){vr=!1;try{var l=Object.defineProperty({},"passive",{get:function(){vr=!0}});b.default.addEventListener("test",null,l),b.default.removeEventListener("test",null,l)}catch{}}return vr},Nn=["touchstart","touchmove"];function dt(l,w,i){if(Array.isArray(w))return Fr(dt,l,w,i);at.has(l)||at.set(l,{});var e=at.get(l);if(e.handlers||(e.handlers={}),e.handlers[w]||(e.handlers[w]=[]),i.guid||(i.guid=Dt()),e.handlers[w].push(i),e.dispatcher||(e.disabled=!1,e.dispatcher=function(r,O){if(!e.disabled){r=pr(r);var W=e.handlers[r.type];if(W)for(var z=W.slice(0),J=0,se=z.length;J<se&&!r.isImmediatePropagationStopped();J++)try{z[J].call(l,r,O)}catch(ie){N.error(ie)}}}),1===e.handlers[w].length)if(l.addEventListener){var t=!1;jn()&&Nn.indexOf(w)>-1&&(t={passive:!0}),l.addEventListener(w,e.dispatcher,t)}else l.attachEvent&&l.attachEvent("on"+w,e.dispatcher)}function nt(l,w,i){if(at.has(l)){var e=at.get(l);if(e.handlers){if(Array.isArray(w))return Fr(nt,l,w,i);var t=function(z,J){e.handlers[J]=[],Ci(z,J)};if(void 0===w){for(var r in e.handlers)Object.prototype.hasOwnProperty.call(e.handlers||{},r)&&t(l,r);return}var O=e.handlers[w];if(O){if(!i)return void t(l,w);if(i.guid)for(var W=0;W<O.length;W++)O[W].guid===i.guid&&O.splice(W--,1);Ci(l,w)}}}}function Kt(l,w,i){var e=at.has(l)?at.get(l):{},t=l.parentNode||l.ownerDocument;if("string"==typeof w?w={type:w,target:l}:w.target||(w.target=l),w=pr(w),e.dispatcher&&e.dispatcher.call(l,w,i),t&&!w.isPropagationStopped()&&!0===w.bubbles)Kt.call(null,t,w,i);else if(!t&&!w.defaultPrevented&&w.target&&w.target[w.type]){at.has(w.target)||at.set(w.target,{});var r=at.get(w.target);w.target[w.type]&&(r.disabled=!0,"function"==typeof w.target[w.type]&&w.target[w.type](),r.disabled=!1)}return!w.defaultPrevented}function gr(l,w,i){if(Array.isArray(w))return Fr(gr,l,w,i);var e=function t(){nt(l,w,t),i.apply(this,arguments)};e.guid=i.guid=i.guid||Dt(),dt(l,w,e)}function Ai(l,w,i){var e=function t(){nt(l,w,t),i.apply(this,arguments)};e.guid=i.guid=i.guid||Dt(),dt(l,w,e)}var or,Bn=Object.freeze({__proto__:null,fixEvent:pr,on:dt,off:nt,trigger:Kt,one:gr,any:Ai}),_t=30,ze=function(l,w,i){w.guid||(w.guid=Dt());var e=w.bind(l);return e.guid=i?i+"_"+w.guid:w.guid,e},xt=function(l,w){var i=b.default.performance.now();return function(){var t=b.default.performance.now();t-i>=w&&(l.apply(void 0,arguments),i=t)}},Un=function(l,w,i,e){void 0===e&&(e=b.default);var t,O=function(){var W=this,z=arguments,J=function(){t=null,J=null,i||l.apply(W,z)};!t&&i&&l.apply(W,z),e.clearTimeout(t),t=e.setTimeout(J,w)};return O.cancel=function(){e.clearTimeout(t),t=null},O},rt=function(){};rt.prototype.allowedEvents_={},rt.prototype.on=function(l,w){var i=this.addEventListener;this.addEventListener=function(){},dt(this,l,w),this.addEventListener=i},rt.prototype.addEventListener=rt.prototype.on,rt.prototype.off=function(l,w){nt(this,l,w)},rt.prototype.removeEventListener=rt.prototype.off,rt.prototype.one=function(l,w){var i=this.addEventListener;this.addEventListener=function(){},gr(this,l,w),this.addEventListener=i},rt.prototype.any=function(l,w){var i=this.addEventListener;this.addEventListener=function(){},Ai(this,l,w),this.addEventListener=i},rt.prototype.trigger=function(l){var w=l.type||l;"string"==typeof l&&(l={type:w}),l=pr(l),this.allowedEvents_[w]&&this["on"+w]&&this["on"+w](l),Kt(this,l)},rt.prototype.dispatchEvent=rt.prototype.trigger,rt.prototype.queueTrigger=function(l){var w=this;or||(or=new Map);var i=l.type||l,e=or.get(this);e||or.set(this,e=new Map);var t=e.get(i);e.delete(i),b.default.clearTimeout(t);var r=b.default.setTimeout(function(){e.delete(i),0===e.size&&(e=null,or.delete(w)),w.trigger(l)},0);e.set(i,r)};var mr=function(l){return"function"==typeof l.name?l.name():"string"==typeof l.name?l.name:l.name_?l.name_:l.constructor&&l.constructor.name?l.constructor.name:typeof l},Lt=function(l){return l instanceof rt||!!l.eventBusEl_&&["on","one","off","trigger"].every(function(w){return"function"==typeof l[w]})},jr=function(l){return"string"==typeof l&&/\S/.test(l)||Array.isArray(l)&&!!l.length},yr=function(l,w,i){if(!l||!l.nodeName&&!Lt(l))throw new Error("Invalid target for "+mr(w)+"#"+i+"; must be a DOM node or evented object.")},Di=function(l,w,i){if(!jr(l))throw new Error("Invalid event type for "+mr(w)+"#"+i+"; must be a non-empty string or array.")},xi=function(l,w,i){if("function"!=typeof l)throw new Error("Invalid listener for "+mr(w)+"#"+i+"; must be a function.")},Nr=function(l,w,i){var t,r,O,e=w.length<3||w[0]===l||w[0]===l.eventBusEl_;return e?(t=l.eventBusEl_,w.length>=3&&w.shift(),r=w[0],O=w[1]):(t=w[0],r=w[1],O=w[2]),yr(t,l,i),Di(r,l,i),xi(O,l,i),{isTargetingSelf:e,target:t,type:r,listener:O=ze(l,O)}},jt=function(l,w,i,e){yr(l,l,w),l.nodeName?Bn[w](l,i,e):l[w](i,e)},Gn={on:function(){for(var l=this,w=arguments.length,i=new Array(w),e=0;e<w;e++)i[e]=arguments[e];var t=Nr(this,i,"on"),r=t.isTargetingSelf,O=t.target,W=t.type,z=t.listener;if(jt(O,"on",W,z),!r){var J=function(){return l.off(O,W,z)};J.guid=z.guid;var se=function(){return l.off("dispose",J)};se.guid=z.guid,jt(this,"on","dispose",J),jt(O,"on","dispose",se)}},one:function(){for(var l=this,w=arguments.length,i=new Array(w),e=0;e<w;e++)i[e]=arguments[e];var t=Nr(this,i,"one"),O=t.target,W=t.type,z=t.listener;if(t.isTargetingSelf)jt(O,"one",W,z);else{var J=function se(){l.off(O,W,se);for(var ie=arguments.length,fe=new Array(ie),De=0;De<ie;De++)fe[De]=arguments[De];z.apply(null,fe)};J.guid=z.guid,jt(O,"one",W,J)}},any:function(){for(var l=this,w=arguments.length,i=new Array(w),e=0;e<w;e++)i[e]=arguments[e];var t=Nr(this,i,"any"),O=t.target,W=t.type,z=t.listener;if(t.isTargetingSelf)jt(O,"any",W,z);else{var J=function se(){l.off(O,W,se);for(var ie=arguments.length,fe=new Array(ie),De=0;De<ie;De++)fe[De]=arguments[De];z.apply(null,fe)};J.guid=z.guid,jt(O,"any",W,J)}},off:function(l,w,i){if(!l||jr(l))nt(this.eventBusEl_,l,w);else{var e=l,t=w;yr(e,this,"off"),Di(t,this,"off"),xi(i,this,"off"),i=ze(this,i),this.off("dispose",i),e.nodeName?(nt(e,t,i),nt(e,"dispose",i)):Lt(e)&&(e.off(t,i),e.off("dispose",i))}},trigger:function(l,w){if(yr(this.eventBusEl_,this,"trigger"),!jr(l&&"string"!=typeof l?l.type:l)){var e="Invalid event type for "+mr(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(!l)throw new Error(e);(this.log||N).error(e)}return Kt(this.eventBusEl_,l,w)}};function Br(l,w){void 0===w&&(w={});var e=w.eventBusKey;if(e){if(!l[e].nodeName)throw new Error('The eventBusKey "'+e+'" does not refer to an element.');l.eventBusEl_=l[e]}else l.eventBusEl_=$("span",{className:"vjs-event-bus"});return Z(l,Gn),l.eventedCallbacks&&l.eventedCallbacks.forEach(function(t){t()}),l.on("dispose",function(){l.off(),[l,l.el_,l.eventBusEl_].forEach(function(t){t&&at.has(t)&&at.delete(t)}),b.default.setTimeout(function(){l.eventBusEl_=null},0)}),l}var qn={state:{},setState:function(l){var i,w=this;return"function"==typeof l&&(l=l()),Y(l,function(e,t){w.state[t]!==e&&((i=i||{})[t]={from:w.state[t],to:e}),w.state[t]=e}),i&&Lt(this)&&this.trigger({changes:i,type:"statechanged"}),i}};function Li(l,w){return Z(l,qn),l.state=Z({},l.state,w),"function"==typeof l.handleStateChanged&&Lt(l)&&l.on("statechanged",l.handleStateChanged),l}var _r=function(l){return"string"!=typeof l?l:l.replace(/./,function(w){return w.toLowerCase()})},$e=function(l){return"string"!=typeof l?l:l.replace(/./,function(w){return w.toUpperCase()})};function Xe(){for(var l={},w=arguments.length,i=new Array(w),e=0;e<w;e++)i[e]=arguments[e];return i.forEach(function(t){!t||Y(t,function(r,O){re(r)?(re(l[O])||(l[O]={}),l[O]=Xe(l[O],r)):l[O]=r})}),l}var Kn=function(){function l(){this.map_={}}var w=l.prototype;return w.has=function(i){return i in this.map_},w.delete=function(i){var e=this.has(i);return delete this.map_[i],e},w.set=function(i,e){return this.map_[i]=e,this},w.forEach=function(i,e){for(var t in this.map_)i.call(e,this.map_[t],t,this)},l}(),Wn=b.default.Map?b.default.Map:Kn,Yn=function(){function l(){this.set_={}}var w=l.prototype;return w.has=function(i){return i in this.set_},w.delete=function(i){var e=this.has(i);return delete this.set_[i],e},w.add=function(i){return this.set_[i]=1,this},w.forEach=function(i,e){for(var t in this.set_)i.call(e,t,t,this)},l}(),Ur=b.default.Set?b.default.Set:Yn,ve=function(){function l(i,e,t){var r=this;if(this.player_=!i&&this.play?i=this:i,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Xe({},this.options_),e=this.options_=Xe(this.options_,e),this.id_=e.id||e.el&&e.el.id,!this.id_){var O=i&&i.id&&i.id()||"no_player";this.id_=O+"_component_"+Dt()}this.name_=e.name||null,e.el?this.el_=e.el:!1!==e.createEl&&(this.el_=this.createEl()),e.className&&this.el_&&e.className.split(" ").forEach(function(W){return r.addClass(W)}),!1!==e.evented&&(Br(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Li(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Ur,this.setIntervalIds_=new Ur,this.rafIds_=new Ur,this.namedRafs_=new Wn,this.clearingTimersOnDispose_=!1,!1!==e.initChildren&&this.initChildren(),this.ready(t),!1!==e.reportTouchActivity&&this.enableTouchActivity()}var w=l.prototype;return w.dispose=function(i){if(void 0===i&&(i={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(i.restoreEl?this.el_.parentNode.replaceChild(i.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},w.isDisposed=function(){return Boolean(this.isDisposed_)},w.player=function(){return this.player_},w.options=function(i){return i?(this.options_=Xe(this.options_,i),this.options_):this.options_},w.el=function(){return this.el_},w.createEl=function(i,e,t){return $(i,e,t)},w.localize=function(i,e,t){void 0===t&&(t=i);var r=this.player_.language&&this.player_.language(),O=this.player_.languages&&this.player_.languages(),W=O&&O[r],z=r&&r.split("-")[0],J=O&&O[z],se=t;return W&&W[i]?se=W[i]:J&&J[i]&&(se=J[i]),e&&(se=se.replace(/\{(\d+)\}/g,function(ie,fe){var De=e[fe-1],Ge=De;return typeof De>"u"&&(Ge=ie),Ge})),se},w.handleLanguagechange=function(){},w.contentEl=function(){return this.contentEl_||this.el_},w.id=function(){return this.id_},w.name=function(){return this.name_},w.children=function(){return this.children_},w.getChildById=function(i){return this.childIndex_[i]},w.getChild=function(i){if(i)return this.childNameIndex_[i]},w.getDescendant=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e=e.reduce(function(W,z){return W.concat(z)},[]);for(var r=this,O=0;O<e.length;O++)if(!(r=r.getChild(e[O]))||!r.getChild)return;return r},w.addChild=function(i,e,t){var r,O;if(void 0===e&&(e={}),void 0===t&&(t=this.children_.length),"string"==typeof i){O=$e(i);var W=e.componentClass||O;e.name=O;var z=l.getComponent(W);if(!z)throw new Error("Component "+W+" does not exist");if("function"!=typeof z)return null;r=new z(this.player_||this,e)}else r=i;if(r.parentComponent_&&r.parentComponent_.removeChild(r),this.children_.splice(t,0,r),r.parentComponent_=this,"function"==typeof r.id&&(this.childIndex_[r.id()]=r),(O=O||r.name&&$e(r.name()))&&(this.childNameIndex_[O]=r,this.childNameIndex_[_r(O)]=r),"function"==typeof r.el&&r.el()){var J=null;this.children_[t+1]&&(this.children_[t+1].el_?J=this.children_[t+1].el_:Qe(this.children_[t+1])&&(J=this.children_[t+1])),this.contentEl().insertBefore(r.el(),J)}return r},w.removeChild=function(i){if("string"==typeof i&&(i=this.getChild(i)),i&&this.children_){for(var e=!1,t=this.children_.length-1;t>=0;t--)if(this.children_[t]===i){e=!0,this.children_.splice(t,1);break}if(e){i.parentComponent_=null,this.childIndex_[i.id()]=null,this.childNameIndex_[$e(i.name())]=null,this.childNameIndex_[_r(i.name())]=null;var r=i.el();r&&r.parentNode===this.contentEl()&&this.contentEl().removeChild(i.el())}}},w.initChildren=function(){var i=this,e=this.options_.children;if(e){var O,t=this.options_,W=l.getComponent("Tech");(O=Array.isArray(e)?e:Object.keys(e)).concat(Object.keys(this.options_).filter(function(z){return!O.some(function(J){return"string"==typeof J?z===J:z===J.name})})).map(function(z){var J,se;return"string"==typeof z?se=e[J=z]||i.options_[J]||{}:(J=z.name,se=z),{name:J,opts:se}}).filter(function(z){var J=l.getComponent(z.opts.componentClass||$e(z.name));return J&&!W.isTech(J)}).forEach(function(z){var J=z.name,se=z.opts;if(void 0!==t[J]&&(se=t[J]),!1!==se){!0===se&&(se={}),se.playerOptions=i.options_.playerOptions;var ie=i.addChild(J,se);ie&&(i[J]=ie)}})}},w.buildCSSClass=function(){return""},w.ready=function(i,e){if(void 0===e&&(e=!1),i){if(!this.isReady_)return this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(i);e?i.call(this):this.setTimeout(i,1)}},w.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var i=this.readyQueue_;this.readyQueue_=[],i&&i.length>0&&i.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)},w.$=function(i,e){return ut(i,e||this.contentEl())},w.$$=function(i,e){return rr(i,e||this.contentEl())},w.hasClass=function(i){return Fe(this.el_,i)},w.addClass=function(i){Be(this.el_,i)},w.removeClass=function(i){qe(this.el_,i)},w.toggleClass=function(i,e){Pe(this.el_,i,e)},w.show=function(){this.removeClass("vjs-hidden")},w.hide=function(){this.addClass("vjs-hidden")},w.lockShowing=function(){this.addClass("vjs-lock-showing")},w.unlockShowing=function(){this.removeClass("vjs-lock-showing")},w.getAttribute=function(i){return ct(this.el_,i)},w.setAttribute=function(i,e){ht(this.el_,i,e)},w.removeAttribute=function(i){gt(this.el_,i)},w.width=function(i,e){return this.dimension("width",i,e)},w.height=function(i,e){return this.dimension("height",i,e)},w.dimensions=function(i,e){this.width(i,!0),this.height(e)},w.dimension=function(i,e,t){if(void 0!==e)return(null===e||e!=e)&&(e=0),this.el_.style[i]=-1!==(""+e).indexOf("%")||-1!==(""+e).indexOf("px")?e:"auto"===e?"":e+"px",void(t||this.trigger("componentresize"));if(!this.el_)return 0;var r=this.el_.style[i],O=r.indexOf("px");return parseInt(-1!==O?r.slice(0,O):this.el_["offset"+$e(i)],10)},w.currentDimension=function(i){var e=0;if("width"!==i&&"height"!==i)throw new Error("currentDimension only accepts width or height value");if(e=ne(this.el_,i),0===(e=parseFloat(e))||isNaN(e)){var t="offset"+$e(i);e=this.el_[t]}return e},w.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},w.currentWidth=function(){return this.currentDimension("width")},w.currentHeight=function(){return this.currentDimension("height")},w.focus=function(){this.el_.focus()},w.blur=function(){this.el_.blur()},w.handleKeyDown=function(i){this.player_&&(T.default.isEventKey(i,"Tab")||i.stopPropagation(),this.player_.handleKeyDown(i))},w.handleKeyPress=function(i){this.handleKeyDown(i)},w.emitTapEvents=function(){var O,i=0,e=null;this.on("touchstart",function(z){1===z.touches.length&&(e={pageX:z.touches[0].pageX,pageY:z.touches[0].pageY},i=b.default.performance.now(),O=!0)}),this.on("touchmove",function(z){if(z.touches.length>1)O=!1;else if(e){var J=z.touches[0].pageX-e.pageX,se=z.touches[0].pageY-e.pageY;Math.sqrt(J*J+se*se)>10&&(O=!1)}});var W=function(){O=!1};this.on("touchleave",W),this.on("touchcancel",W),this.on("touchend",function(z){e=null,!0===O&&b.default.performance.now()-i<200&&(z.preventDefault(),this.trigger("tap"))})},w.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var e,i=ze(this.player(),this.player().reportUserActivity);this.on("touchstart",function(){i(),this.clearInterval(e),e=this.setInterval(i,250)});var t=function(r){i(),this.clearInterval(e)};this.on("touchmove",i),this.on("touchend",t),this.on("touchcancel",t)}},w.setTimeout=function(i,e){var r,t=this;return i=ze(this,i),this.clearTimersOnDispose_(),r=b.default.setTimeout(function(){t.setTimeoutIds_.has(r)&&t.setTimeoutIds_.delete(r),i()},e),this.setTimeoutIds_.add(r),r},w.clearTimeout=function(i){return this.setTimeoutIds_.has(i)&&(this.setTimeoutIds_.delete(i),b.default.clearTimeout(i)),i},w.setInterval=function(i,e){i=ze(this,i),this.clearTimersOnDispose_();var t=b.default.setInterval(i,e);return this.setIntervalIds_.add(t),t},w.clearInterval=function(i){return this.setIntervalIds_.has(i)&&(this.setIntervalIds_.delete(i),b.default.clearInterval(i)),i},w.requestAnimationFrame=function(i){var t,e=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),i=ze(this,i),t=b.default.requestAnimationFrame(function(){e.rafIds_.has(t)&&e.rafIds_.delete(t),i()}),this.rafIds_.add(t),t):this.setTimeout(i,1e3/60)},w.requestNamedAnimationFrame=function(i,e){var t=this;if(!this.namedRafs_.has(i)){this.clearTimersOnDispose_(),e=ze(this,e);var r=this.requestAnimationFrame(function(){e(),t.namedRafs_.has(i)&&t.namedRafs_.delete(i)});return this.namedRafs_.set(i,r),i}},w.cancelNamedAnimationFrame=function(i){!this.namedRafs_.has(i)||(this.cancelAnimationFrame(this.namedRafs_.get(i)),this.namedRafs_.delete(i))},w.cancelAnimationFrame=function(i){return this.supportsRaf_?(this.rafIds_.has(i)&&(this.rafIds_.delete(i),b.default.cancelAnimationFrame(i)),i):this.clearTimeout(i)},w.clearTimersOnDispose_=function(){var i=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(e){var r=e[1];i[e[0]].forEach(function(O,W){return i[r](W)})}),i.clearingTimersOnDispose_=!1}))},l.registerComponent=function(i,e){if("string"!=typeof i||!i)throw new Error('Illegal component name, "'+i+'"; must be a non-empty string.');var t=l.getComponent("Tech"),r=t&&t.isTech(e),O=l===e||l.prototype.isPrototypeOf(e.prototype);if(r||!O)throw new Error('Illegal component, "'+i+'"; '+(r?"techs must be registered using Tech.registerTech()":"must be a Component subclass")+".");i=$e(i),l.components_||(l.components_={});var z=l.getComponent("Player");if("Player"===i&&z&&z.players){var J=z.players,se=Object.keys(J);if(J&&se.length>0&&se.map(function(ie){return J[ie]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return l.components_[i]=e,l.components_[_r(i)]=e,e},l.getComponent=function(i){if(i&&l.components_)return l.components_[i]},l}();function Ii(l,w,i,e){return function zn(l,w,i){if("number"!=typeof w||w<0||w>i)throw new Error("Failed to execute '"+l+"' on 'TimeRanges': The index provided ("+w+") is non-numeric or out of bounds (0-"+i+").")}(l,e,i.length-1),i[e][w]}function Hr(l){var w;return w=void 0===l||0===l.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:l.length,start:Ii.bind(null,"start",0,l),end:Ii.bind(null,"end",1,l)},b.default.Symbol&&b.default.Symbol.iterator&&(w[b.default.Symbol.iterator]=function(){return(l||[]).values()}),w}function Nt(l,w){return Array.isArray(l)?Hr(l):void 0===l||void 0===w?Hr():Hr([[l,w]])}function Ri(l,w){var e,t,i=0;if(!w)return 0;(!l||!l.length)&&(l=Nt(0,0));for(var r=0;r<l.length;r++)e=l.start(r),(t=l.end(r))>w&&(t=w),i+=t-e;return i/w}function st(l){if(l instanceof st)return l;"number"==typeof l?this.code=l:"string"==typeof l?this.message=l:te(l)&&("number"==typeof l.code&&(this.code=l.code),Z(this,l)),this.message||(this.message=st.defaultMessages[this.code]||"")}ve.prototype.supportsRaf_="function"==typeof b.default.requestAnimationFrame&&"function"==typeof b.default.cancelAnimationFrame,ve.registerComponent("Component",ve),st.prototype.code=0,st.prototype.message="",st.prototype.status=null,st.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],st.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var Wt=0;Wt<st.errorTypes.length;Wt++)st[st.errorTypes[Wt]]=Wt,st.prototype[st.errorTypes[Wt]]=Wt;function lr(l){return null!=l&&"function"==typeof l.then}function wt(l){lr(l)&&l.then(null,function(w){})}var Gr=function(l){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(i,e,t){return l[e]&&(i[e]=l[e]),i},{cues:l.cues&&Array.prototype.map.call(l.cues,function(i){return{startTime:i.startTime,endTime:i.endTime,text:i.text,id:i.id}})})},qr="vjs-modal-dialog",Yt=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).handleKeyDown_=function(O){return r.handleKeyDown(O)},r.close_=function(O){return r.close(O)},r.opened_=r.hasBeenOpened_=r.hasBeenFilled_=!1,r.closeable(!r.options_.uncloseable),r.content(r.options_.content),r.contentEl_=$("div",{className:qr+"-content"},{role:"document"}),r.descEl_=$("p",{className:qr+"-description vjs-control-text",id:r.el().getAttribute("aria-describedby")}),le(r.descEl_,r.description()),r.el_.appendChild(r.descEl_),r.el_.appendChild(r.contentEl_),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},i.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,l.prototype.dispose.call(this)},i.buildCSSClass=function(){return qr+" vjs-hidden "+l.prototype.buildCSSClass.call(this)},i.label=function(){return this.localize(this.options_.label||"Modal Window")},i.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},i.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},i.opened=function(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_},i.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},i.closeable=function(e){if("boolean"==typeof e){var t=this.closeable_=!!e,r=this.getChild("closeButton");if(t&&!r){var O=this.contentEl_;this.contentEl_=this.el_,r=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=O,this.on(r,"close",this.close_)}!t&&r&&(this.off(r,"close",this.close_),this.removeChild(r),r.dispose())}return this.closeable_},i.fill=function(){this.fillWith(this.content())},i.fillWith=function(e){var t=this.contentEl(),r=t.parentNode,O=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,r.removeChild(t),this.empty(),Pt(t,e),this.trigger("modalfill"),O?r.insertBefore(t,O):r.appendChild(t);var W=this.getChild("closeButton");W&&r.appendChild(W.el_)},i.empty=function(){this.trigger("beforemodalempty"),Tt(this.contentEl()),this.trigger("modalempty")},i.content=function(e){return typeof e<"u"&&(this.content_=e),this.content_},i.conditionalFocus_=function(){var e=k.default.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())},i.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},i.handleKeyDown=function(e){if(e.stopPropagation(),T.default.isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(T.default.isEventKey(e,"Tab")){for(var O,t=this.focusableEls_(),r=this.el_.querySelector(":focus"),W=0;W<t.length;W++)if(r===t[W]){O=W;break}k.default.activeElement===this.el_&&(O=0),e.shiftKey&&0===O?(t[t.length-1].focus(),e.preventDefault()):!e.shiftKey&&O===t.length-1&&(t[0].focus(),e.preventDefault())}},i.focusableEls_=function(){var e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,function(t){return(t instanceof b.default.HTMLAnchorElement||t instanceof b.default.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof b.default.HTMLInputElement||t instanceof b.default.HTMLSelectElement||t instanceof b.default.HTMLTextAreaElement||t instanceof b.default.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof b.default.HTMLIFrameElement||t instanceof b.default.HTMLObjectElement||t instanceof b.default.HTMLEmbedElement||t.hasAttribute("tabindex")&&-1!==t.getAttribute("tabindex")||t.hasAttribute("contenteditable")})},w}(ve);Yt.prototype.options_={pauseOnOpen:!0,temporary:!0},ve.registerComponent("ModalDialog",Yt);var zt=function(l){function w(e){var t;void 0===e&&(e=[]),(t=l.call(this)||this).tracks_=[],Object.defineProperty(C.default(t),"length",{get:function(){return this.tracks_.length}});for(var r=0;r<e.length;r++)t.addTrack(e[r]);return t}E.default(w,l);var i=w.prototype;return i.addTrack=function(e){var t=this,r=this.tracks_.length;""+r in this||Object.defineProperty(this,r,{get:function(){return this.tracks_[r]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=function(){t.trigger({track:e,type:"labelchange",target:t})},Lt(e)&&e.addEventListener("labelchange",e.labelchange_)},i.removeTrack=function(e){for(var t,r=0,O=this.length;r<O;r++)if(this[r]===e){(t=this[r]).off&&t.off(),this.tracks_.splice(r,1);break}!t||this.trigger({track:t,type:"removetrack",target:this})},i.getTrackById=function(e){for(var t=null,r=0,O=this.length;r<O;r++){var W=this[r];if(W.id===e){t=W;break}}return t},w}(rt);for(var Qn in zt.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"},zt.prototype.allowedEvents_)zt.prototype["on"+Qn]=null;var Vr=function(l,w){for(var i=0;i<l.length;i++)!Object.keys(l[i]).length||w.id===l[i].id||(l[i].enabled=!1)},Jn=function(l){function w(e){var t;void 0===e&&(e=[]);for(var r=e.length-1;r>=0;r--)if(e[r].enabled){Vr(e,e[r]);break}return(t=l.call(this,e)||this).changing_=!1,t}E.default(w,l);var i=w.prototype;return i.addTrack=function(e){var t=this;e.enabled&&Vr(this,e),l.prototype.addTrack.call(this,e),e.addEventListener&&(e.enabledChange_=function(){t.changing_||(t.changing_=!0,Vr(t,e),t.changing_=!1,t.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))},i.removeTrack=function(e){l.prototype.removeTrack.call(this,e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)},w}(zt),Kr=function(l,w){for(var i=0;i<l.length;i++)!Object.keys(l[i]).length||w.id===l[i].id||(l[i].selected=!1)},$n=function(l){function w(e){var t;void 0===e&&(e=[]);for(var r=e.length-1;r>=0;r--)if(e[r].selected){Kr(e,e[r]);break}return(t=l.call(this,e)||this).changing_=!1,Object.defineProperty(C.default(t),"selectedIndex",{get:function(){for(var O=0;O<this.length;O++)if(this[O].selected)return O;return-1},set:function(){}}),t}E.default(w,l);var i=w.prototype;return i.addTrack=function(e){var t=this;e.selected&&Kr(this,e),l.prototype.addTrack.call(this,e),e.addEventListener&&(e.selectedChange_=function(){t.changing_||(t.changing_=!0,Kr(t,e),t.changing_=!1,t.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))},i.removeTrack=function(e){l.prototype.removeTrack.call(this,e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)},w}(zt),Pi=function(l){function w(){return l.apply(this,arguments)||this}E.default(w,l);var i=w.prototype;return i.addTrack=function(e){var t=this;l.prototype.addTrack.call(this,e),this.queueChange_||(this.queueChange_=function(){return t.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return t.trigger("selectedlanguagechange")}),e.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)},i.removeTrack=function(e){l.prototype.removeTrack.call(this,e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},w}(zt),ea=function(){function l(i){void 0===i&&(i=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var e=0,t=i.length;e<t;e++)this.addTrackElement_(i[e])}var w=l.prototype;return w.addTrackElement_=function(i){var e=this.trackElements_.length;""+e in this||Object.defineProperty(this,e,{get:function(){return this.trackElements_[e]}}),-1===this.trackElements_.indexOf(i)&&this.trackElements_.push(i)},w.getTrackElementByTrack_=function(i){for(var e,t=0,r=this.trackElements_.length;t<r;t++)if(i===this.trackElements_[t].track){e=this.trackElements_[t];break}return e},w.removeTrackElement_=function(i){for(var e=0,t=this.trackElements_.length;e<t;e++)if(i===this.trackElements_[e]){this.trackElements_[e].track&&"function"==typeof this.trackElements_[e].track.off&&this.trackElements_[e].track.off(),"function"==typeof this.trackElements_[e].off&&this.trackElements_[e].off(),this.trackElements_.splice(e,1);break}},l}(),Mi=function(){function l(i){l.prototype.setCues_.call(this,i),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var w=l.prototype;return w.setCues_=function(i){var e=this.length||0,t=0,r=i.length;this.cues_=i,this.length_=i.length;var O=function(W){""+W in this||Object.defineProperty(this,""+W,{get:function(){return this.cues_[W]}})};if(e<r)for(t=e;t<r;t++)O.call(this,t)},w.getCueById=function(i){for(var e=null,t=0,r=this.length;t<r;t++){var O=this[t];if(O.id===i){e=O;break}}return e},l}(),ta={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},ra={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},ia={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},Fi={disabled:"disabled",hidden:"hidden",showing:"showing"},Wr=function(l){function w(i){var e;void 0===i&&(i={}),e=l.call(this)||this;var t={id:i.id||"vjs_track_"+Dt(),kind:i.kind||"",language:i.language||""},r=i.label||"",O=function(z){Object.defineProperty(C.default(e),z,{get:function(){return t[z]},set:function(){}})};for(var W in t)O(W);return Object.defineProperty(C.default(e),"label",{get:function(){return r},set:function(z){z!==r&&(r=z,this.trigger("labelchange"))}}),e}return E.default(w,l),w}(rt),Yr=function(l){var w=["protocol","hostname","port","pathname","search","hash","host"],i=k.default.createElement("a");i.href=l;for(var e={},t=0;t<w.length;t++)e[w[t]]=i[w[t]];return"http:"===e.protocol&&(e.host=e.host.replace(/:80$/,"")),"https:"===e.protocol&&(e.host=e.host.replace(/:443$/,"")),e.protocol||(e.protocol=b.default.location.protocol),e.host||(e.host=b.default.location.host),e},ji=function(l){if(!l.match(/^https?:\/\//)){var w=k.default.createElement("a");w.href=l,l=w.href}return l},zr=function(l){if("string"==typeof l){var i=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(l);if(i)return i.pop().toLowerCase()}return""},br=function(l,w){void 0===w&&(w=b.default.location);var i=Yr(l);return(":"===i.protocol?w.protocol:i.protocol)+i.host!==w.protocol+w.host},na=Object.freeze({__proto__:null,parseUrl:Yr,getAbsoluteURL:ji,getFileExtension:zr,isCrossOrigin:br}),Ni=function(l,w){var i=new b.default.WebVTT.Parser(b.default,b.default.vttjs,b.default.WebVTT.StringDecoder()),e=[];i.oncue=function(t){w.addCue(t)},i.onparsingerror=function(t){e.push(t)},i.onflush=function(){w.trigger({type:"loadeddata",target:w})},i.parse(l),e.length>0&&(b.default.console&&b.default.console.groupCollapsed&&b.default.console.groupCollapsed("Text Track parsing errors for "+w.src),e.forEach(function(t){return N.error(t)}),b.default.console&&b.default.console.groupEnd&&b.default.console.groupEnd()),i.flush()},Bi=function(l,w){var i={uri:l},e=br(l);e&&(i.cors=e);var t="use-credentials"===w.tech_.crossOrigin();t&&(i.withCredentials=t),g.default(i,ze(this,function(r,O,W){if(r)return N.error(r,O);w.loaded_=!0,"function"!=typeof b.default.WebVTT?w.tech_&&w.tech_.any(["vttjsloaded","vttjserror"],function(z){if("vttjserror"!==z.type)return Ni(W,w);N.error("vttjs failed to load, stopping trying to process "+w.src)}):Ni(W,w)}))},ur=function(l){function w(e){var t;if(void 0===e&&(e={}),!e.tech)throw new Error("A tech was not provided.");var r=Xe(e,{kind:ia[e.kind]||"subtitles",language:e.language||e.srclang||""}),O=Fi[r.mode]||"disabled",W=r.default;("metadata"===r.kind||"chapters"===r.kind)&&(O="hidden"),(t=l.call(this,r)||this).tech_=r.tech,t.cues_=[],t.activeCues_=[],t.preload_=!1!==t.tech_.preloadTextTracks;var z=new Mi(t.cues_),J=new Mi(t.activeCues_),se=!1;return t.timeupdateHandler=ze(C.default(t),function(fe){if(void 0===fe&&(fe={}),!this.tech_.isDisposed()){if(!this.tech_.isReady_)return void("timeupdate"!==fe.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)));this.activeCues=this.activeCues,se&&(this.trigger("cuechange"),se=!1),"timeupdate"!==fe.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}}),t.tech_.one("dispose",function(){t.stopTracking()}),"disabled"!==O&&t.startTracking(),Object.defineProperties(C.default(t),{default:{get:function(){return W},set:function(){}},mode:{get:function(){return O},set:function(fe){!Fi[fe]||O!==fe&&(O=fe,!this.preload_&&"disabled"!==O&&0===this.cues.length&&Bi(this.src,this),this.stopTracking(),"disabled"!==O&&this.startTracking(),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?z:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return J;for(var fe=this.tech_.currentTime(),De=[],Ge=0,Gt=this.cues.length;Ge<Gt;Ge++){var qt=this.cues[Ge];(qt.startTime<=fe&&qt.endTime>=fe||qt.startTime===qt.endTime&&qt.startTime<=fe&&qt.startTime+.5>=fe)&&De.push(qt)}if(se=!1,De.length!==this.activeCues_.length)se=!0;else for(var ki=0;ki<De.length;ki++)-1===this.activeCues_.indexOf(De[ki])&&(se=!0);return this.activeCues_=De,J.setCues_(this.activeCues_),J},set:function(){}}}),r.src?(t.src=r.src,t.preload_||(t.loaded_=!0),(t.preload_||"subtitles"!==r.kind&&"captions"!==r.kind)&&Bi(t.src,C.default(t))):t.loaded_=!0,t}E.default(w,l);var i=w.prototype;return i.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)},i.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)},i.addCue=function(e){var t=e;if(b.default.vttjs&&!(e instanceof b.default.vttjs.VTTCue)){for(var r in t=new b.default.vttjs.VTTCue(e.startTime,e.endTime,e.text),e)r in t||(t[r]=e[r]);t.id=e.id,t.originalCue_=e}for(var O=this.tech_.textTracks(),W=0;W<O.length;W++)O[W]!==this&&O[W].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)},i.removeCue=function(e){for(var t=this.cues_.length;t--;){var r=this.cues_[t];if(r===e||r.originalCue_&&r.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}},w}(Wr);ur.prototype.allowedEvents_={cuechange:"cuechange"};var Ui=function(l){function w(i){var e;void 0===i&&(i={});var t=Xe(i,{kind:ra[i.kind]||""});e=l.call(this,t)||this;var r=!1;return Object.defineProperty(C.default(e),"enabled",{get:function(){return r},set:function(O){"boolean"!=typeof O||O===r||(r=O,this.trigger("enabledchange"))}}),t.enabled&&(e.enabled=t.enabled),e.loaded_=!0,e}return E.default(w,l),w}(Wr),Hi=function(l){function w(i){var e;void 0===i&&(i={});var t=Xe(i,{kind:ta[i.kind]||""});e=l.call(this,t)||this;var r=!1;return Object.defineProperty(C.default(e),"selected",{get:function(){return r},set:function(O){"boolean"!=typeof O||O===r||(r=O,this.trigger("selectedchange"))}}),t.selected&&(e.selected=t.selected),e}return E.default(w,l),w}(Wr),Gi=0,qi=2,Xt=function(l){function w(i){var e;void 0===i&&(i={}),e=l.call(this)||this;var t,r=new ur(i);return e.kind=r.kind,e.src=r.src,e.srclang=r.language,e.label=r.label,e.default=r.default,Object.defineProperties(C.default(e),{readyState:{get:function(){return t}},track:{get:function(){return r}}}),t=Gi,r.addEventListener("loadeddata",function(){t=qi,e.trigger({type:"load",target:C.default(e)})}),e}return E.default(w,l),w}(rt);Xt.prototype.allowedEvents_={load:"load"},Xt.NONE=Gi,Xt.LOADING=1,Xt.LOADED=qi,Xt.ERROR=3;var pt={audio:{ListClass:Jn,TrackClass:Ui,capitalName:"Audio"},video:{ListClass:$n,TrackClass:Hi,capitalName:"Video"},text:{ListClass:Pi,TrackClass:ur,capitalName:"Text"}};Object.keys(pt).forEach(function(l){pt[l].getterName=l+"Tracks",pt[l].privateName=l+"Tracks_"});var Zt={remoteText:{ListClass:Pi,TrackClass:ur,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:ea,TrackClass:Xt,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},ot=x.default({},pt,Zt);Zt.names=Object.keys(Zt),pt.names=Object.keys(pt),ot.names=[].concat(Zt.names).concat(pt.names);var Ke=function(l){function w(e,t){var r;return void 0===e&&(e={}),void 0===t&&(t=function(){}),e.reportTouchActivity=!1,(r=l.call(this,null,e,t)||this).onDurationChange_=function(O){return r.onDurationChange(O)},r.trackProgress_=function(O){return r.trackProgress(O)},r.trackCurrentTime_=function(O){return r.trackCurrentTime(O)},r.stopTrackingCurrentTime_=function(O){return r.stopTrackingCurrentTime(O)},r.disposeSourceHandler_=function(O){return r.disposeSourceHandler(O)},r.queuedHanders_=new Set,r.hasStarted_=!1,r.on("playing",function(){this.hasStarted_=!0}),r.on("loadstart",function(){this.hasStarted_=!1}),ot.names.forEach(function(O){var W=ot[O];e&&e[W.getterName]&&(r[W.privateName]=e[W.getterName])}),r.featuresProgressEvents||r.manualProgressOn(),r.featuresTimeupdateEvents||r.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(O){!1===e["native"+O+"Tracks"]&&(r["featuresNative"+O+"Tracks"]=!1)}),!1===e.nativeCaptions||!1===e.nativeTextTracks?r.featuresNativeTextTracks=!1:(!0===e.nativeCaptions||!0===e.nativeTextTracks)&&(r.featuresNativeTextTracks=!0),r.featuresNativeTextTracks||r.emulateTextTracks(),r.preloadTextTracks=!1!==e.preloadTextTracks,r.autoRemoteTextTracks_=new ot.text.ListClass,r.initTrackListeners(),e.nativeControlsForTouch||r.emitTapEvents(),r.constructor&&(r.name_=r.constructor.name||"Unknown Tech"),r}E.default(w,l);var i=w.prototype;return i.triggerSourceset=function(e){var t=this;this.isReady_||this.one("ready",function(){return t.setTimeout(function(){return t.triggerSourceset(e)},1)}),this.trigger({src:e,type:"sourceset"})},i.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},i.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},i.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(ze(this,function(){var t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),this.bufferedPercent_=t,1===t&&this.stopTrackingProgress()}),500)},i.onDurationChange=function(e){this.duration_=this.duration()},i.buffered=function(){return Nt(0,0)},i.bufferedPercent=function(){return Ri(this.buffered(),this.duration_)},i.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},i.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},i.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},i.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},i.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},i.dispose=function(){this.clearTracks(pt.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),l.prototype.dispose.call(this)},i.clearTracks=function(e){var t=this;(e=[].concat(e)).forEach(function(r){for(var O=t[r+"Tracks"]()||[],W=O.length;W--;){var z=O[W];"text"===r&&t.removeRemoteTextTrack(z),O.removeTrack(z)}})},i.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],t=e.length;t--;)this.removeRemoteTextTrack(e[t])},i.reset=function(){},i.crossOrigin=function(){},i.setCrossOrigin=function(){},i.error=function(e){return void 0!==e&&(this.error_=new st(e),this.trigger("error")),this.error_},i.played=function(){return this.hasStarted_?Nt(0,0):Nt()},i.play=function(){},i.setScrubbing=function(){},i.scrubbing=function(){},i.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},i.initTrackListeners=function(){var e=this;pt.names.forEach(function(t){var O=function(){e.trigger(t+"trackchange")},W=e[pt[t].getterName]();W.addEventListener("removetrack",O),W.addEventListener("addtrack",O),e.on("dispose",function(){W.removeEventListener("removetrack",O),W.removeEventListener("addtrack",O)})})},i.addWebVttScript_=function(){var e=this;if(!b.default.WebVTT)if(k.default.body.contains(this.el())){if(!this.options_["vtt.js"]&&re(f.default)&&Object.keys(f.default).length>0)return void this.trigger("vttjsloaded");var t=k.default.createElement("script");t.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",t.onload=function(){e.trigger("vttjsloaded")},t.onerror=function(){e.trigger("vttjserror")},this.on("dispose",function(){t.onload=null,t.onerror=null}),b.default.WebVTT=!0,this.el().parentNode.appendChild(t)}else this.ready(this.addWebVttScript_)},i.emulateTextTracks=function(){var e=this,t=this.textTracks(),r=this.remoteTextTracks(),O=function(se){return t.addTrack(se.track)},W=function(se){return t.removeTrack(se.track)};r.on("addtrack",O),r.on("removetrack",W),this.addWebVttScript_();var z=function(){return e.trigger("texttrackchange")},J=function(){z();for(var se=0;se<t.length;se++){var ie=t[se];ie.removeEventListener("cuechange",z),"showing"===ie.mode&&ie.addEventListener("cuechange",z)}};J(),t.addEventListener("change",J),t.addEventListener("addtrack",J),t.addEventListener("removetrack",J),this.on("dispose",function(){r.off("addtrack",O),r.off("removetrack",W),t.removeEventListener("change",J),t.removeEventListener("addtrack",J),t.removeEventListener("removetrack",J);for(var se=0;se<t.length;se++)t[se].removeEventListener("cuechange",z)})},i.addTextTrack=function(e,t,r){if(!e)throw new Error("TextTrack kind is required but was not provided");return function oa(l,w,i,e,t){void 0===t&&(t={});var r=l.textTracks();t.kind=w,i&&(t.label=i),e&&(t.language=e),t.tech=l;var O=new ot.text.TrackClass(t);return r.addTrack(O),O}(this,e,t,r)},i.createRemoteTextTrack=function(e){var t=Xe(e,{tech:this});return new Zt.remoteTextEl.TrackClass(t)},i.addRemoteTextTrack=function(e,t){var r=this;void 0===e&&(e={});var O=this.createRemoteTextTrack(e);return!0!==t&&!1!==t&&(N.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),t=!0),this.remoteTextTrackEls().addTrackElement_(O),this.remoteTextTracks().addTrack(O.track),!0!==t&&this.ready(function(){return r.autoRemoteTextTracks_.addTrack(O.track)}),O},i.removeRemoteTextTrack=function(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},i.getVideoPlaybackQuality=function(){return{}},i.requestPictureInPicture=function(){var e=this.options_.Promise||b.default.Promise;if(e)return e.reject()},i.disablePictureInPicture=function(){return!0},i.setDisablePictureInPicture=function(){},i.requestVideoFrameCallback=function(e){var t=this,r=Dt();return!this.isReady_||this.paused()?(this.queuedHanders_.add(r),this.one("playing",function(){t.queuedHanders_.has(r)&&(t.queuedHanders_.delete(r),e())})):this.requestNamedAnimationFrame(r,e),r},i.cancelVideoFrameCallback=function(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)},i.setPoster=function(){},i.playsinline=function(){},i.setPlaysinline=function(){},i.overrideNativeAudioTracks=function(){},i.overrideNativeVideoTracks=function(){},i.canPlayType=function(){return""},w.canPlayType=function(){return""},w.canPlaySource=function(e,t){return w.canPlayType(e.type)},w.isTech=function(e){return e.prototype instanceof w||e instanceof w||e===w},w.registerTech=function(e,t){if(w.techs_||(w.techs_={}),!w.isTech(t))throw new Error("Tech "+e+" must be a Tech");if(!w.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!w.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=$e(e),w.techs_[e]=t,w.techs_[_r(e)]=t,"Tech"!==e&&w.defaultTechOrder_.push(e),t},w.getTech=function(e){if(e){if(w.techs_&&w.techs_[e])return w.techs_[e];if(e=$e(e),b.default&&b.default.videojs&&b.default.videojs[e])return N.warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),b.default.videojs[e]}},w}(ve);ot.names.forEach(function(l){var w=ot[l];Ke.prototype[w.getterName]=function(){return this[w.privateName]=this[w.privateName]||new w.ListClass,this[w.privateName]}}),Ke.prototype.featuresVolumeControl=!0,Ke.prototype.featuresMuteControl=!0,Ke.prototype.featuresFullscreenResize=!1,Ke.prototype.featuresPlaybackRate=!1,Ke.prototype.featuresProgressEvents=!1,Ke.prototype.featuresSourceset=!1,Ke.prototype.featuresTimeupdateEvents=!1,Ke.prototype.featuresNativeTextTracks=!1,Ke.prototype.featuresVideoFrameCallback=!1,Ke.withSourceHandlers=function(l){l.registerSourceHandler=function(i,e){var t=l.sourceHandlers;t||(t=l.sourceHandlers=[]),void 0===e&&(e=t.length),t.splice(e,0,i)},l.canPlayType=function(i){for(var t,e=l.sourceHandlers||[],r=0;r<e.length;r++)if(t=e[r].canPlayType(i))return t;return""},l.selectSourceHandler=function(i,e){for(var t=l.sourceHandlers||[],O=0;O<t.length;O++)if(t[O].canHandleSource(i,e))return t[O];return null},l.canPlaySource=function(i,e){var t=l.selectSourceHandler(i,e);return t?t.canHandleSource(i,e):""},["seekable","seeking","duration"].forEach(function(i){var e=this[i];"function"==typeof e&&(this[i]=function(){return this.sourceHandler_&&this.sourceHandler_[i]?this.sourceHandler_[i].apply(this.sourceHandler_,arguments):e.apply(this,arguments)})},l.prototype),l.prototype.setSource=function(i){var e=l.selectSourceHandler(i,this.options_);e||(l.nativeSourceHandler?e=l.nativeSourceHandler:N.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),e!==l.nativeSourceHandler&&(this.currentSource_=i),this.sourceHandler_=e.handleSource(i,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},l.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},ve.registerComponent("Tech",Ke),Ke.registerTech("Tech",Ke),Ke.defaultTechOrder_=[];var Bt={},Xr={},Er={};function ua(l,w,i){l.setTimeout(function(){return Ut(w,Bt[w.type],i,l)},1)}function Vi(l,w,i,e){void 0===e&&(e=null);var t="call"+$e(i),r=l.reduce(Zr(t),e),O=r===Er,W=O?null:w[i](r);return function va(l,w,i,e){for(var t=l.length-1;t>=0;t--){var r=l[t];r[w]&&r[w](e,i)}}(l,i,W,O),W}var fa={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},pa={setCurrentTime:1,setMuted:1,setVolume:1},Ki={play:1,pause:1};function Zr(l){return function(w,i){return w===Er?Er:i[l]?i[l](w):w}}function Ut(l,w,i,e,t,r){void 0===l&&(l={}),void 0===w&&(w=[]),void 0===t&&(t=[]),void 0===r&&(r=!1);var W=w[0],z=w.slice(1);if("string"==typeof W)Ut(l,Bt[W],i,e,t,r);else if(W){var J=function ma(l,w){var i=Xr[l.id()],e=null;if(null==i)return e=w(l),Xr[l.id()]=[[w,e]],e;for(var t=0;t<i.length;t++){var r=i[t];r[0]===w&&(e=r[1])}return null===e&&(e=w(l),i.push([w,e])),e}(e,W);if(!J.setSource)return t.push(J),Ut(l,z,i,e,t,r);J.setSource(Z({},l),function(se,ie){if(se)return Ut(l,z,i,e,t,r);t.push(J),Ut(ie,l.type===ie.type?z:Bt[ie.type],i,e,t,r)})}else z.length?Ut(l,z,i,e,t,r):r?i(l,t):Ut(l,Bt["*"],i,e,t,!0)}var ya={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Tr=function(l){void 0===l&&(l="");var w=zr(l);return ya[w.toLowerCase()]||""},ba=function l(w){if(Array.isArray(w)){var i=[];w.forEach(function(e){e=l(e),Array.isArray(e)?i=i.concat(e):te(e)&&i.push(e)}),w=i}else w="string"==typeof w&&w.trim()?[Wi({src:w})]:te(w)&&"string"==typeof w.src&&w.src&&w.src.trim()?[Wi(w)]:[];return w};function Wi(l){if(!l.type){var w=Tr(l.src);w&&(l.type=w)}return l}var Ea=function(l){function w(i,e,t){var r,O=Xe({createEl:!1},e);if(r=l.call(this,i,O,t)||this,e.playerOptions.sources&&0!==e.playerOptions.sources.length)i.src(e.playerOptions.sources);else for(var W=0,z=e.playerOptions.techOrder;W<z.length;W++){var J=$e(z[W]),se=Ke.getTech(J);if(J||(se=ve.getComponent(J)),se&&se.isSupported()){i.loadTech_(J);break}}return r}return E.default(w,l),w}(ve);ve.registerComponent("MediaLoader",Ea);var Sr=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).options_.controlText&&r.controlText(r.options_.controlText),r.handleMouseOver_=function(O){return r.handleMouseOver(O)},r.handleMouseOut_=function(O){return r.handleMouseOut(O)},r.handleClick_=function(O){return r.handleClick(O)},r.handleKeyDown_=function(O){return r.handleKeyDown(O)},r.emitTapEvents(),r.enable(),r}E.default(w,l);var i=w.prototype;return i.createEl=function(e,t,r){void 0===e&&(e="div"),void 0===t&&(t={}),void 0===r&&(r={}),t=Z({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&N.error("Creating a ClickableComponent with an HTML element of "+e+" is not supported; use a Button instead."),r=Z({role:"button"},r),this.tabIndex_=t.tabIndex;var O=$(e,t,r);return O.appendChild($("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(O),O},i.dispose=function(){this.controlTextEl_=null,l.prototype.dispose.call(this)},i.createControlTextEl=function(e){return this.controlTextEl_=$("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},i.controlText=function(e,t){if(void 0===t&&(t=this.el()),void 0===e)return this.controlText_||"Need Text";var r=this.localize(e);this.controlText_=e,le(this.controlTextEl_,r),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",r)},i.buildCSSClass=function(){return"vjs-control vjs-button "+l.prototype.buildCSSClass.call(this)},i.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},i.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},i.handleLanguagechange=function(){this.controlText(this.controlText_)},i.handleClick=function(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},i.handleKeyDown=function(e){T.default.isEventKey(e,"Space")||T.default.isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):l.prototype.handleKeyDown.call(this,e)},w}(ve);ve.registerComponent("ClickableComponent",Sr);var Ta=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).update(),r.update_=function(O){return r.update(O)},e.on("posterchange",r.update_),r}E.default(w,l);var i=w.prototype;return i.dispose=function(){this.player().off("posterchange",this.update_),l.prototype.dispose.call(this)},i.createEl=function(){return $("div",{className:"vjs-poster",tabIndex:-1})},i.update=function(e){var t=this.player().poster();this.setSrc(t),t?this.show():this.hide()},i.setSrc=function(e){var t="";e&&(t='url("'+e+'")'),this.el_.style.backgroundImage=t},i.handleClick=function(e){if(this.player_.controls()){var t=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;this.player_.tech(!0)&&!((pe||oe)&&t)&&this.player_.tech(!0).focus(),this.player_.paused()?wt(this.player_.play()):this.player_.pause()}},w}(Sr);ve.registerComponent("PosterImage",Ta);var vt="#222",Sa={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Qr(l,w){var i;if(4===l.length)i=l[1]+l[1]+l[2]+l[2]+l[3]+l[3];else{if(7!==l.length)throw new Error("Invalid color code provided, "+l+"; must be formatted as e.g. #f0e or #f604e2.");i=l.slice(1)}return"rgba("+parseInt(i.slice(0,2),16)+","+parseInt(i.slice(2,4),16)+","+parseInt(i.slice(4,6),16)+","+w+")"}function Jr(l,w,i){try{l.style[w]=i}catch{return}}var ka=function(l){function w(e,t,r){var O;O=l.call(this,e,t,r)||this;var W=function(z){return O.updateDisplay(z)};return e.on("loadstart",function(z){return O.toggleDisplay(z)}),e.on("texttrackchange",W),e.on("loadedmetadata",function(z){return O.preselectTrack(z)}),e.ready(ze(C.default(O),function(){if(e.tech_&&e.tech_.featuresNativeTextTracks)this.hide();else{e.on("fullscreenchange",W),e.on("playerresize",W),b.default.addEventListener("orientationchange",W),e.on("dispose",function(){return b.default.removeEventListener("orientationchange",W)});for(var z=this.options_.playerOptions.tracks||[],J=0;J<z.length;J++)this.player_.addRemoteTextTrack(z[J],!0);this.preselectTrack()}})),O}E.default(w,l);var i=w.prototype;return i.preselectTrack=function(){for(var O,W,z,e={captions:1,subtitles:1},t=this.player_.textTracks(),r=this.player_.cache_.selectedLanguage,J=0;J<t.length;J++){var se=t[J];r&&r.enabled&&r.language&&r.language===se.language&&se.kind in e?se.kind===r.kind?z=se:z||(z=se):r&&!r.enabled?(z=null,O=null,W=null):se.default&&("descriptions"!==se.kind||O?se.kind in e&&!W&&(W=se):O=se)}z?z.mode="showing":W?W.mode="showing":O&&(O.mode="showing")},i.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},i.clearDisplay=function(){"function"==typeof b.default.WebVTT&&b.default.WebVTT.processCues(b.default,[],this.el_)},i.updateDisplay=function(){var e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){for(var r=[],O=0;O<e.length;++O){var W=e[O];"showing"===W.mode&&r.push(W)}this.updateForTrack(r)}else{for(var z=null,J=null,se=e.length;se--;){var ie=e[se];"showing"===ie.mode&&("descriptions"===ie.kind?z=ie:J=ie)}J?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(J)):z&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(z))}},i.updateDisplayState=function(e){for(var t=this.player_.textTrackSettings.getValues(),r=e.activeCues,O=r.length;O--;){var W=r[O];if(W){var z=W.displayState;if(t.color&&(z.firstChild.style.color=t.color),t.textOpacity&&Jr(z.firstChild,"color",Qr(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(z.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&Jr(z.firstChild,"backgroundColor",Qr(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?Jr(z,"backgroundColor",Qr(t.windowColor,t.windowOpacity)):z.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?z.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px "+vt:"raised"===t.edgeStyle?z.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px "+vt:"depressed"===t.edgeStyle?z.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px "+vt:"uniform"===t.edgeStyle&&(z.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px "+vt)),t.fontPercent&&1!==t.fontPercent){var J=b.default.parseFloat(z.style.fontSize);z.style.fontSize=J*t.fontPercent+"px",z.style.height="auto",z.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?z.firstChild.style.fontVariant="small-caps":z.firstChild.style.fontFamily=Sa[t.fontFamily])}}},i.updateForTrack=function(e){if(Array.isArray(e)||(e=[e]),"function"==typeof b.default.WebVTT&&!e.every(function(fe){return!fe.activeCues})){for(var t=[],r=0;r<e.length;++r)for(var O=e[r],W=0;W<O.activeCues.length;++W)t.push(O.activeCues[W]);b.default.WebVTT.processCues(b.default,t,this.el_);for(var z=0;z<e.length;++z){for(var J=e[z],se=0;se<J.activeCues.length;++se){var ie=J.activeCues[se].displayState;Be(ie,"vjs-text-track-cue"),Be(ie,"vjs-text-track-cue-"+(J.language?J.language:z)),J.language&&ht(ie,"lang",J.language)}this.player_.textTrackSettings&&this.updateDisplayState(J)}}},w}(ve);ve.registerComponent("TextTrackDisplay",ka);var wa=function(l){function w(){return l.apply(this,arguments)||this}return E.default(w,l),w.prototype.createEl=function(){var e=this.player_.isAudio(),t=this.localize(e?"Audio Player":"Video Player"),r=$("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[t])}),O=l.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return O.appendChild(r),O},w}(ve);ve.registerComponent("LoadingSpinner",wa);var bt=function(l){function w(){return l.apply(this,arguments)||this}E.default(w,l);var i=w.prototype;return i.createEl=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r={});var O=$("button",t=Z({className:this.buildCSSClass()},t),r=Z({type:"button"},r));return O.appendChild($("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(O),O},i.addChild=function(e,t){return void 0===t&&(t={}),N.warn("Adding an actionable (user controllable) child to a Button ("+this.constructor.name+") is not supported; use a ClickableComponent instead."),ve.prototype.addChild.call(this,e,t)},i.enable=function(){l.prototype.enable.call(this),this.el_.removeAttribute("disabled")},i.disable=function(){l.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},i.handleKeyDown=function(e){T.default.isEventKey(e,"Space")||T.default.isEventKey(e,"Enter")?e.stopPropagation():l.prototype.handleKeyDown.call(this,e)},w}(Sr);ve.registerComponent("Button",bt);var zi=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).mouseused_=!1,r.on("mousedown",function(O){return r.handleMouseDown(O)}),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-big-play-button"},i.handleClick=function(e){var t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){var r=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;return wt(t),void(this.player_.tech(!0)&&(!pe&&!oe||!r)&&this.player_.tech(!0).focus())}var O=this.player_.getChild("controlBar"),W=O&&O.getChild("playToggle");if(W){var z=function(){return W.focus()};lr(t)?t.then(z,function(){}):this.setTimeout(z,1)}else this.player_.tech(!0).focus()},i.handleKeyDown=function(e){this.mouseused_=!1,l.prototype.handleKeyDown.call(this,e)},i.handleMouseDown=function(e){this.mouseused_=!0},w}(bt);zi.prototype.controlText_="Play Video",ve.registerComponent("BigPlayButton",zi);var Ca=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).controlText(t&&t.controlText||r.localize("Close")),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-close-button "+l.prototype.buildCSSClass.call(this)},i.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},i.handleKeyDown=function(e){T.default.isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):l.prototype.handleKeyDown.call(this,e)},w}(bt);ve.registerComponent("CloseButton",Ca);var Xi=function(l){function w(e,t){var r;return void 0===t&&(t={}),r=l.call(this,e,t)||this,t.replay=void 0===t.replay||t.replay,r.on(e,"play",function(O){return r.handlePlay(O)}),r.on(e,"pause",function(O){return r.handlePause(O)}),t.replay&&r.on(e,"ended",function(O){return r.handleEnded(O)}),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-play-control "+l.prototype.buildCSSClass.call(this)},i.handleClick=function(e){this.player_.paused()?wt(this.player_.play()):this.player_.pause()},i.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},i.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},i.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},i.handleEnded=function(e){var t=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(r){return t.handleSeeked(r)})},w}(bt);Xi.prototype.controlText_="Play",ve.registerComponent("PlayToggle",Xi);var Zi=function(l,w){l=l<0?0:l;var i=Math.floor(l%60),e=Math.floor(l/60%60),t=Math.floor(l/3600),r=Math.floor(w/60%60),O=Math.floor(w/3600);return(isNaN(l)||l===1/0)&&(t=e=i="-"),(t=t>0||O>0?t+":":"")+(e=((t||r>=10)&&e<10?"0"+e:e)+":")+(i<10?"0"+i:i)},$r=Zi;function Qt(l,w){return void 0===w&&(w=l),$r(l,w)}var Jt=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).on(e,["timeupdate","ended"],function(O){return r.updateContent(O)}),r.updateTextNode_(),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){var e=this.buildCSSClass(),t=l.prototype.createEl.call(this,"div",{className:e+" vjs-time-control vjs-control"}),r=$("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+"\xa0"},{role:"presentation"});return t.appendChild(r),this.contentEl_=$("span",{className:e+"-display"},{"aria-live":"off",role:"presentation"}),t.appendChild(this.contentEl_),t},i.dispose=function(){this.contentEl_=null,this.textNode_=null,l.prototype.dispose.call(this)},i.updateTextNode_=function(e){var t=this;void 0===e&&(e=0),e=Qt(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(t.contentEl_){var r=t.textNode_;r&&t.contentEl_.firstChild!==r&&(r=null,N.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),t.textNode_=k.default.createTextNode(t.formattedTime_),t.textNode_&&(r?t.contentEl_.replaceChild(t.textNode_,r):t.contentEl_.appendChild(t.textNode_))}}))},i.updateContent=function(e){},w}(ve);Jt.prototype.labelText_="Time",Jt.prototype.controlText_="Time",ve.registerComponent("TimeDisplay",Jt);var ei=function(l){function w(){return l.apply(this,arguments)||this}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-current-time"},i.updateContent=function(e){var t;t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)},w}(Jt);ei.prototype.labelText_="Current Time",ei.prototype.controlText_="Current Time",ve.registerComponent("CurrentTimeDisplay",ei);var ti=function(l){function w(e,t){var r,O=function(W){return r.updateContent(W)};return(r=l.call(this,e,t)||this).on(e,"durationchange",O),r.on(e,"loadstart",O),r.on(e,"loadedmetadata",O),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-duration"},i.updateContent=function(e){var t=this.player_.duration();this.updateTextNode_(t)},w}(Jt);ti.prototype.labelText_="Duration",ti.prototype.controlText_="Duration",ve.registerComponent("DurationDisplay",ti);var xa=function(l){function w(){return l.apply(this,arguments)||this}return E.default(w,l),w.prototype.createEl=function(){var e=l.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),t=l.prototype.createEl.call(this,"div"),r=l.prototype.createEl.call(this,"span",{textContent:"/"});return t.appendChild(r),e.appendChild(t),e},w}(ve);ve.registerComponent("TimeDivider",xa);var ri=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).on(e,"durationchange",function(O){return r.updateContent(O)}),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-remaining-time"},i.createEl=function(){var e=l.prototype.createEl.call(this);return!1!==this.options_.displayNegative&&e.insertBefore($("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e},i.updateContent=function(e){var t;"number"==typeof this.player_.duration()&&(t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t))},w}(Jt);ri.prototype.labelText_="Remaining Time",ri.prototype.controlText_="Remaining Time",ve.registerComponent("RemainingTimeDisplay",ri);var La=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).updateShowing(),r.on(r.player(),"durationchange",function(O){return r.updateShowing(O)}),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){var e=l.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=$("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild($("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+"\xa0"})),this.contentEl_.appendChild(k.default.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e},i.dispose=function(){this.contentEl_=null,l.prototype.dispose.call(this)},i.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},w}(ve);ve.registerComponent("LiveDisplay",La);var Qi=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).updateLiveEdgeStatus(),r.player_.liveTracker&&(r.updateLiveEdgeStatusHandler_=function(O){return r.updateLiveEdgeStatus(O)},r.on(r.player_.liveTracker,"liveedgechange",r.updateLiveEdgeStatusHandler_)),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){var e=l.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=$("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e},i.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},i.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},i.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,l.prototype.dispose.call(this)},w}(bt);Qi.prototype.controlText_="Seek to live, currently playing live",ve.registerComponent("SeekToLive",Qi);var kr=function(l,w,i){return l=Number(l),Math.min(i,Math.max(w,isNaN(l)?w:l))},ii=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).handleMouseDown_=function(O){return r.handleMouseDown(O)},r.handleMouseUp_=function(O){return r.handleMouseUp(O)},r.handleKeyDown_=function(O){return r.handleKeyDown(O)},r.handleClick_=function(O){return r.handleClick(O)},r.handleMouseMove_=function(O){return r.handleMouseMove(O)},r.update_=function(O){return r.update(O)},r.bar=r.getChild(r.options_.barName),r.vertical(!!r.options_.vertical),r.enable(),r}E.default(w,l);var i=w.prototype;return i.enabled=function(){return this.enabled_},i.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},i.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},i.createEl=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),t.className=t.className+" vjs-slider",t=Z({tabIndex:0},t),r=Z({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},r),l.prototype.createEl.call(this,e,t,r)},i.handleMouseDown=function(e){var t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"===e.type&&!ee&&e.preventDefault(),Je(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)},i.handleMouseMove=function(e){},i.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;It(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.update()},i.update=function(){var e=this;if(this.el_&&this.bar){var t=this.getProgress();return t===this.progress_||(this.progress_=t,this.requestNamedAnimationFrame("Slider#update",function(){var r=e.vertical()?"height":"width";e.bar.el().style[r]=(100*t).toFixed(2)+"%"})),t}},i.getProgress=function(){return Number(kr(this.getPercent(),0,1).toFixed(4))},i.calculateDistance=function(e){var t=mt(this.el_,e);return this.vertical()?t.y:t.x},i.handleKeyDown=function(e){T.default.isEventKey(e,"Left")||T.default.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):T.default.isEventKey(e,"Right")||T.default.isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):l.prototype.handleKeyDown.call(this,e)},i.handleClick=function(e){e.stopPropagation(),e.preventDefault()},i.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.addClass(this.vertical_?"vjs-slider-vertical":"vjs-slider-horizontal")},w}(ve);ve.registerComponent("Slider",ii);var ni=function(l,w){return kr(l/w*100,0,100).toFixed(2)+"%"},Ia=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).partEls_=[],r.on(e,"progress",function(O){return r.update(O)}),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){var e=l.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),t=$("span",{className:"vjs-control-text"}),r=$("span",{textContent:this.localize("Loaded")}),O=k.default.createTextNode(": ");return this.percentageEl_=$("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(t),t.appendChild(r),t.appendChild(O),t.appendChild(this.percentageEl_),e},i.dispose=function(){this.partEls_=null,this.percentageEl_=null,l.prototype.dispose.call(this)},i.update=function(e){var t=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var r=t.player_.liveTracker,O=t.player_.buffered(),W=r&&r.isLive()?r.seekableEnd():t.player_.duration(),z=t.player_.bufferedEnd(),J=t.partEls_,se=ni(z,W);t.percent_!==se&&(t.el_.style.width=se,le(t.percentageEl_,se),t.percent_=se);for(var ie=0;ie<O.length;ie++){var fe=O.start(ie),De=O.end(ie),Ge=J[ie];Ge||(Ge=t.el_.appendChild($()),J[ie]=Ge),(Ge.dataset.start!==fe||Ge.dataset.end!==De)&&(Ge.dataset.start=fe,Ge.dataset.end=De,Ge.style.left=ni(fe,z),Ge.style.width=ni(De-fe,z))}for(var Gt=J.length;Gt>O.length;Gt--)t.el_.removeChild(J[Gt-1]);J.length=O.length})},w}(ve);ve.registerComponent("LoadProgressBar",Ia);var Ra=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).update=xt(ze(C.default(r),r.update),_t),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},i.update=function(e,t,r){var O=Et(this.el_),W=ft(this.player_.el()),z=e.width*t;if(W&&O){var J=e.left-W.left+z,se=e.width-z+(W.right-e.right),ie=O.width/2;J<ie?ie+=ie-J:se<ie&&(ie=se),ie<0?ie=0:ie>O.width&&(ie=O.width),ie=Math.round(ie),this.el_.style.right="-"+ie+"px",this.write(r)}},i.write=function(e){le(this.el_,e)},i.updateTime=function(e,t,r,O){var W=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var z,J=W.player_.duration();if(W.player_.liveTracker&&W.player_.liveTracker.isLive()){var se=W.player_.liveTracker.liveWindow(),ie=se-t*se;z=(ie<1?"":"-")+Qt(ie,se)}else z=Qt(r,J);W.update(e,t,z),O&&O()})},w}(ve);ve.registerComponent("TimeTooltip",Ra);var ai=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).update=xt(ze(C.default(r),r.update),_t),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},i.update=function(e,t){var r=this.getChild("timeTooltip");if(r){var O=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();r.updateTime(e,t,O)}},w}(ve);ai.prototype.options_={children:[]},!Me&&!Ce&&ai.prototype.options_.children.push("timeTooltip"),ve.registerComponent("PlayProgressBar",ai);var Ji=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).update=xt(ze(C.default(r),r.update),_t),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},i.update=function(e,t){var r=this,O=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,O,function(){r.el_.style.left=e.width*t+"px"})},w}(ve);Ji.prototype.options_={children:["timeTooltip"]},ve.registerComponent("MouseTimeDisplay",Ji);var si=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).setEventHandlers_(),r}E.default(w,l);var i=w.prototype;return i.setEventHandlers_=function(){var e=this;this.update_=ze(this,this.update),this.update=xt(this.update_,_t),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(t){return e.enableInterval_(t)},this.disableIntervalHandler_=function(t){return e.disableInterval_(t)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in k.default&&"visibilityState"in k.default&&this.on(k.default,"visibilitychange",this.toggleVisibility_)},i.toggleVisibility_=function(e){"hidden"===k.default.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())},i.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,_t))},i.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||!this.updateInterval||(this.clearInterval(this.updateInterval),this.updateInterval=null)},i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},i.update=function(e){var t=this;if("hidden"!==k.default.visibilityState){var r=l.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var O=t.player_.ended()?t.player_.duration():t.getCurrentTime_(),W=t.player_.liveTracker,z=t.player_.duration();W&&W.isLive()&&(z=t.player_.liveTracker.liveCurrentTime()),t.percent_!==r&&(t.el_.setAttribute("aria-valuenow",(100*r).toFixed(2)),t.percent_=r),(t.currentTime_!==O||t.duration_!==z)&&(t.el_.setAttribute("aria-valuetext",t.localize("progress bar timing: currentTime={1} duration={2}",[Qt(O,z),Qt(z,z)],"{1} of {2}")),t.currentTime_=O,t.duration_=z),t.bar&&t.bar.update(ft(t.el()),t.getProgress())}),r}},i.userSeek_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)},i.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},i.getPercent=function(){var t,e=this.getCurrentTime_(),r=this.player_.liveTracker;return r&&r.isLive()?(t=(e-r.seekableStart())/r.liveWindow(),r.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t},i.handleMouseDown=function(e){!St(e)||(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),l.prototype.handleMouseDown.call(this,e))},i.handleMouseMove=function(e,t){if(void 0===t&&(t=!1),St(e)){!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);var r,O=this.calculateDistance(e),W=this.player_.liveTracker;if(W&&W.isLive()){if(O>=.99)return void W.seekToLiveEdge();var z=W.seekableStart(),J=W.liveCurrentTime();if((r=z+O*W.liveWindow())>=J&&(r=J),r<=z&&(r=z+.1),r===1/0)return}else(r=O*this.player_.duration())===this.player_.duration()&&(r-=.1);this.userSeek_(r)}},i.enable=function(){l.prototype.enable.call(this);var e=this.getChild("mouseTimeDisplay");!e||e.show()},i.disable=function(){l.prototype.disable.call(this);var e=this.getChild("mouseTimeDisplay");!e||e.hide()},i.handleMouseUp=function(e){l.prototype.handleMouseUp.call(this,e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?wt(this.player_.play()):this.update_()},i.stepForward=function(){this.userSeek_(this.player_.currentTime()+5)},i.stepBack=function(){this.userSeek_(this.player_.currentTime()-5)},i.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},i.handleKeyDown=function(e){var t=this.player_.liveTracker;if(T.default.isEventKey(e,"Space")||T.default.isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(T.default.isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(T.default.isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),t&&t.isLive()?this.userSeek_(t.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(T.default(e))){e.preventDefault(),e.stopPropagation();var r=10*(T.default.codes[T.default(e)]-T.default.codes[0])/100;t&&t.isLive()?this.userSeek_(t.seekableStart()+t.liveWindow()*r):this.userSeek_(this.player_.duration()*r)}else T.default.isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-60)):T.default.isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+60)):l.prototype.handleKeyDown.call(this,e)},i.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in k.default&&"visibilityState"in k.default&&this.off(k.default,"visibilitychange",this.toggleVisibility_),l.prototype.dispose.call(this)},w}(ii);si.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},!Me&&!Ce&&si.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),ve.registerComponent("SeekBar",si);var en=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).handleMouseMove=xt(ze(C.default(r),r.handleMouseMove),_t),r.throttledHandleMouseSeek=xt(ze(C.default(r),r.handleMouseSeek),_t),r.handleMouseUpHandler_=function(O){return r.handleMouseUp(O)},r.handleMouseDownHandler_=function(O){return r.handleMouseDown(O)},r.enable(),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},i.handleMouseMove=function(e){var t=this.getChild("seekBar");if(t){var r=t.getChild("playProgressBar"),O=t.getChild("mouseTimeDisplay");if(r||O){var W=t.el(),z=Et(W),J=mt(W,e).x;J=kr(J,0,1),O&&O.update(z,J),r&&r.update(z,t.getProgress())}}},i.handleMouseSeek=function(e){var t=this.getChild("seekBar");t&&t.handleMouseMove(e)},i.enabled=function(){return this.enabled_},i.disable=function(){if(this.children().forEach(function(t){return t.disable&&t.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&wt(this.player_.play())}},i.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},i.removeListenersAddedOnMousedownAndTouchstart=function(){var e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)},i.handleMouseDown=function(e){var t=this.el_.ownerDocument,r=this.getChild("seekBar");r&&r.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseUp=function(e){var t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()},w}(ve);en.prototype.options_={children:["seekBar"]},ve.registerComponent("ProgressControl",en);var tn=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).on(e,["enterpictureinpicture","leavepictureinpicture"],function(O){return r.handlePictureInPictureChange(O)}),r.on(e,["disablepictureinpicturechanged","loadedmetadata"],function(O){return r.handlePictureInPictureEnabledChange(O)}),r.on(e,["loadedmetadata","audioonlymodechange","audiopostermodechange"],function(){"audio"===e.currentType().substring(0,5)||e.audioPosterMode()||e.audioOnlyMode()?(e.isInPictureInPicture()&&e.exitPictureInPicture(),r.hide()):r.show()}),r.disable(),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-picture-in-picture-control "+l.prototype.buildCSSClass.call(this)},i.handlePictureInPictureEnabledChange=function(){k.default.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},i.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},i.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},w}(bt);tn.prototype.controlText_="Picture-in-Picture",ve.registerComponent("PictureInPictureToggle",tn);var rn=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).on(e,"fullscreenchange",function(O){return r.handleFullscreenChange(O)}),!1===k.default[e.fsApi_.fullscreenEnabled]&&r.disable(),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-fullscreen-control "+l.prototype.buildCSSClass.call(this)},i.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},i.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},w}(bt);rn.prototype.controlText_="Fullscreen",ve.registerComponent("FullscreenToggle",rn);var Oa=function(l,w){w.tech_&&!w.tech_.featuresVolumeControl&&l.addClass("vjs-hidden"),l.on(w,"loadstart",function(){w.tech_.featuresVolumeControl?l.removeClass("vjs-hidden"):l.addClass("vjs-hidden")})},Pa=function(l){function w(){return l.apply(this,arguments)||this}return E.default(w,l),w.prototype.createEl=function(){var e=l.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return e.appendChild(l.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),e},w}(ve);ve.registerComponent("VolumeLevel",Pa);var Ma=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).update=xt(ze(C.default(r),r.update),_t),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},i.update=function(e,t,r,O){if(!r){var W=ft(this.el_),z=ft(this.player_.el()),J=e.width*t;if(!z||!W)return;var se=e.left-z.left+J,ie=e.width-J+(z.right-e.right),fe=W.width/2;se<fe?fe+=fe-se:ie<fe&&(fe=ie),fe<0?fe=0:fe>W.width&&(fe=W.width),this.el_.style.right="-"+fe+"px"}this.write(O+"%")},i.write=function(e){le(this.el_,e)},i.updateVolume=function(e,t,r,O,W){var z=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){z.update(e,t,r,O.toFixed(0)),W&&W()})},w}(ve);ve.registerComponent("VolumeLevelTooltip",Ma);var nn=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).update=xt(ze(C.default(r),r.update),_t),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},i.update=function(e,t,r){var O=this,W=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,r,W,function(){r?O.el_.style.bottom=e.height*t+"px":O.el_.style.left=e.width*t+"px"})},w}(ve);nn.prototype.options_={children:["volumeLevelTooltip"]},ve.registerComponent("MouseVolumeLevelDisplay",nn);var Cr=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).on("slideractive",function(O){return r.updateLastVolume_(O)}),r.on(e,"volumechange",function(O){return r.updateARIAAttributes(O)}),e.ready(function(){return r.updateARIAAttributes()}),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},i.handleMouseDown=function(e){!St(e)||l.prototype.handleMouseDown.call(this,e)},i.handleMouseMove=function(e){var t=this.getChild("mouseVolumeLevelDisplay");if(t){var r=this.el(),O=ft(r),W=this.vertical(),z=mt(r,e);z=kr(z=W?z.y:z.x,0,1),t.update(O,z,W)}!St(e)||(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},i.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},i.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},i.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},i.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},i.updateARIAAttributes=function(e){var t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")},i.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},i.updateLastVolume_=function(){var e=this,t=this.player_.volume();this.one("sliderinactive",function(){0===e.player_.volume()&&e.player_.lastVolume_(t)})},w}(ii);Cr.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},!Me&&!Ce&&Cr.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),Cr.prototype.playerEvent="volumechange",ve.registerComponent("VolumeBar",Cr);var an=function(l){function w(e,t){var r;return void 0===t&&(t={}),t.vertical=t.vertical||!1,(typeof t.volumeBar>"u"||re(t.volumeBar))&&(t.volumeBar=t.volumeBar||{},t.volumeBar.vertical=t.vertical),r=l.call(this,e,t)||this,Oa(C.default(r),e),r.throttledHandleMouseMove=xt(ze(C.default(r),r.handleMouseMove),_t),r.handleMouseUpHandler_=function(O){return r.handleMouseUp(O)},r.on("mousedown",function(O){return r.handleMouseDown(O)}),r.on("touchstart",function(O){return r.handleMouseDown(O)}),r.on("mousemove",function(O){return r.handleMouseMove(O)}),r.on(r.volumeBar,["focus","slideractive"],function(){r.volumeBar.addClass("vjs-slider-active"),r.addClass("vjs-slider-active"),r.trigger("slideractive")}),r.on(r.volumeBar,["blur","sliderinactive"],function(){r.volumeBar.removeClass("vjs-slider-active"),r.removeClass("vjs-slider-active"),r.trigger("sliderinactive")}),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){var e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),l.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+e})},i.handleMouseDown=function(e){var t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseUp=function(e){var t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)},i.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},w}(ve);an.prototype.options_={children:["volumeBar"]},ve.registerComponent("VolumeControl",an);var Fa=function(l,w){w.tech_&&!w.tech_.featuresMuteControl&&l.addClass("vjs-hidden"),l.on(w,"loadstart",function(){w.tech_.featuresMuteControl?l.removeClass("vjs-hidden"):l.addClass("vjs-hidden")})},sn=function(l){function w(e,t){var r;return r=l.call(this,e,t)||this,Fa(C.default(r),e),r.on(e,["loadstart","volumechange"],function(O){return r.update(O)}),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-mute-control "+l.prototype.buildCSSClass.call(this)},i.handleClick=function(e){var t=this.player_.volume(),r=this.player_.lastVolume_();0===t?(this.player_.volume(r<.1?.1:r),this.player_.muted(!1)):this.player_.muted(!this.player_.muted())},i.update=function(e){this.updateIcon_(),this.updateControlText_()},i.updateIcon_=function(){var e=this.player_.volume(),t=3;Me&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2);for(var r=0;r<4;r++)qe(this.el_,"vjs-vol-"+r);Be(this.el_,"vjs-vol-"+t)},i.updateControlText_=function(){var t=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)},w}(bt);sn.prototype.controlText_="Mute",ve.registerComponent("MuteToggle",sn);var on=function(l){function w(e,t){var r;return void 0===t&&(t={}),t.inline=!(typeof t.inline<"u")||t.inline,(typeof t.volumeControl>"u"||re(t.volumeControl))&&(t.volumeControl=t.volumeControl||{},t.volumeControl.vertical=!t.inline),(r=l.call(this,e,t)||this).handleKeyPressHandler_=function(O){return r.handleKeyPress(O)},r.on(e,["loadstart"],function(O){return r.volumePanelState_(O)}),r.on(r.muteToggle,"keyup",function(O){return r.handleKeyPress(O)}),r.on(r.volumeControl,"keyup",function(O){return r.handleVolumeControlKeyUp(O)}),r.on("keydown",function(O){return r.handleKeyPress(O)}),r.on("mouseover",function(O){return r.handleMouseOver(O)}),r.on("mouseout",function(O){return r.handleMouseOut(O)}),r.on(r.volumeControl,["slideractive"],r.sliderActive_),r.on(r.volumeControl,["sliderinactive"],r.sliderInactive_),r}E.default(w,l);var i=w.prototype;return i.sliderActive_=function(){this.addClass("vjs-slider-active")},i.sliderInactive_=function(){this.removeClass("vjs-slider-active")},i.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},i.createEl=function(){var e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),l.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+e})},i.dispose=function(){this.handleMouseOut(),l.prototype.dispose.call(this)},i.handleVolumeControlKeyUp=function(e){T.default.isEventKey(e,"Esc")&&this.muteToggle.focus()},i.handleMouseOver=function(e){this.addClass("vjs-hover"),dt(k.default,"keyup",this.handleKeyPressHandler_)},i.handleMouseOut=function(e){this.removeClass("vjs-hover"),nt(k.default,"keyup",this.handleKeyPressHandler_)},i.handleKeyPress=function(e){T.default.isEventKey(e,"Esc")&&this.handleMouseOut()},w}(ve);on.prototype.options_={children:["muteToggle","volumeControl"]},ve.registerComponent("VolumePanel",on);var ln=function(l){function w(e,t){var r;return r=l.call(this,e,t)||this,t&&(r.menuButton_=t.menuButton),r.focusedChild_=-1,r.on("keydown",function(O){return r.handleKeyDown(O)}),r.boundHandleBlur_=function(O){return r.handleBlur(O)},r.boundHandleTapClick_=function(O){return r.handleTapClick(O)},r}E.default(w,l);var i=w.prototype;return i.addEventListenerForItem=function(e){e instanceof ve&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))},i.removeEventListenerForItem=function(e){e instanceof ve&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))},i.removeChild=function(e){"string"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),l.prototype.removeChild.call(this,e)},i.addItem=function(e){var t=this.addChild(e);t&&this.addEventListenerForItem(t)},i.createEl=function(){this.contentEl_=$(this.options_.contentElType||"ul",{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var t=l.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),dt(t,"click",function(r){r.preventDefault(),r.stopImmediatePropagation()}),t},i.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,l.prototype.dispose.call(this)},i.handleBlur=function(e){var t=e.relatedTarget||k.default.activeElement;if(!this.children().some(function(O){return O.el()===t})){var r=this.menuButton_;r&&r.buttonPressed_&&t!==r.el().firstChild&&r.unpressButton()}},i.handleTapClick=function(e){if(this.menuButton_){this.menuButton_.unpressButton();var t=this.children();if(!Array.isArray(t))return;var r=t.filter(function(O){return O.el()===e.target})[0];if(!r)return;"CaptionSettingsMenuItem"!==r.name()&&this.menuButton_.focus()}},i.handleKeyDown=function(e){T.default.isEventKey(e,"Left")||T.default.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(T.default.isEventKey(e,"Right")||T.default.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},i.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},i.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},i.focus=function(e){void 0===e&&(e=0);var t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())},w}(ve);ve.registerComponent("Menu",ln);var oi=function(l){function w(e,t){var r;void 0===t&&(t={}),(r=l.call(this,e,t)||this).menuButton_=new bt(e,t),r.menuButton_.controlText(r.controlText_),r.menuButton_.el_.setAttribute("aria-haspopup","true");var O=bt.prototype.buildCSSClass();r.menuButton_.el_.className=r.buildCSSClass()+" "+O,r.menuButton_.removeClass("vjs-control"),r.addChild(r.menuButton_),r.update(),r.enabled_=!0;var W=function(z){return r.handleClick(z)};return r.handleMenuKeyUp_=function(z){return r.handleMenuKeyUp(z)},r.on(r.menuButton_,"tap",W),r.on(r.menuButton_,"click",W),r.on(r.menuButton_,"keydown",function(z){return r.handleKeyDown(z)}),r.on(r.menuButton_,"mouseenter",function(){r.addClass("vjs-hover"),r.menu.show(),dt(k.default,"keyup",r.handleMenuKeyUp_)}),r.on("mouseleave",function(z){return r.handleMouseLeave(z)}),r.on("keydown",function(z){return r.handleSubmenuKeyDown(z)}),r}E.default(w,l);var i=w.prototype;return i.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))},i.createMenu=function(){var e=new ln(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var t=$("li",{className:"vjs-menu-title",textContent:$e(this.options_.title),tabIndex:-1}),r=new ve(this.player_,{el:t});e.addItem(r)}if(this.items=this.createItems(),this.items)for(var O=0;O<this.items.length;O++)e.addItem(this.items[O]);return e},i.createItems=function(){},i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},i.buildWrapperCSSClass=function(){var e="vjs-menu-button";return"vjs-menu-button "+(e+=!0===this.options_.inline?"-inline":"-popup")+" "+bt.prototype.buildCSSClass()+" "+l.prototype.buildCSSClass.call(this)},i.buildCSSClass=function(){var e="vjs-menu-button";return"vjs-menu-button "+(e+=!0===this.options_.inline?"-inline":"-popup")+" "+l.prototype.buildCSSClass.call(this)},i.controlText=function(e,t){return void 0===t&&(t=this.menuButton_.el()),this.menuButton_.controlText(e,t)},i.dispose=function(){this.handleMouseLeave(),l.prototype.dispose.call(this)},i.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},i.handleMouseLeave=function(e){this.removeClass("vjs-hover"),nt(k.default,"keyup",this.handleMenuKeyUp_)},i.focus=function(){this.menuButton_.focus()},i.blur=function(){this.menuButton_.blur()},i.handleKeyDown=function(e){T.default.isEventKey(e,"Esc")||T.default.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),T.default.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(T.default.isEventKey(e,"Up")||T.default.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},i.handleMenuKeyUp=function(e){(T.default.isEventKey(e,"Esc")||T.default.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")},i.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},i.handleSubmenuKeyDown=function(e){(T.default.isEventKey(e,"Esc")||T.default.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),T.default.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))},i.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),Me&&tt())return;this.menu.focus()}},i.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},i.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},i.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},w}(ve);ve.registerComponent("MenuButton",oi);var li=function(l){function w(i,e){var t,r=e.tracks;if((t=l.call(this,i,e)||this).items.length<=1&&t.hide(),!r)return C.default(t);var O=ze(C.default(t),t.update);return r.addEventListener("removetrack",O),r.addEventListener("addtrack",O),r.addEventListener("labelchange",O),t.player_.on("ready",O),t.player_.on("dispose",function(){r.removeEventListener("removetrack",O),r.removeEventListener("addtrack",O),r.removeEventListener("labelchange",O)}),t}return E.default(w,l),w}(oi);ve.registerComponent("TrackButton",li);var ja=["Tab","Esc","Up","Down","Right","Left"],cr=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).selectable=t.selectable,r.isSelected_=t.selected||!1,r.multiSelectable=t.multiSelectable,r.selected(r.isSelected_),r.el_.setAttribute("role",r.selectable?r.multiSelectable?"menuitemcheckbox":"menuitemradio":"menuitem"),r}E.default(w,l);var i=w.prototype;return i.createEl=function(e,t,r){this.nonIconControl=!0;var O=l.prototype.createEl.call(this,"li",Z({className:"vjs-menu-item",tabIndex:-1},t),r);return O.replaceChild($("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),O.querySelector(".vjs-icon-placeholder")),O},i.handleKeyDown=function(e){ja.some(function(t){return T.default.isEventKey(e,t)})||l.prototype.handleKeyDown.call(this,e)},i.handleClick=function(e){this.selected(!0)},i.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},w}(Sr);ve.registerComponent("MenuItem",cr);var dr=function(l){function w(e,t){var r,O=t.track,W=e.textTracks();t.label=O.label||O.language||"Unknown",t.selected="showing"===O.mode,(r=l.call(this,e,t)||this).track=O,r.kinds=(t.kinds||[t.kind||r.track.kind]).filter(Boolean);var se,z=function(){for(var ie=arguments.length,fe=new Array(ie),De=0;De<ie;De++)fe[De]=arguments[De];r.handleTracksChange.apply(C.default(r),fe)},J=function(){for(var ie=arguments.length,fe=new Array(ie),De=0;De<ie;De++)fe[De]=arguments[De];r.handleSelectedLanguageChange.apply(C.default(r),fe)};return e.on(["loadstart","texttrackchange"],z),W.addEventListener("change",z),W.addEventListener("selectedlanguagechange",J),r.on("dispose",function(){e.off(["loadstart","texttrackchange"],z),W.removeEventListener("change",z),W.removeEventListener("selectedlanguagechange",J)}),void 0===W.onchange&&r.on(["tap","click"],function(){if("object"!=typeof b.default.Event)try{se=new b.default.Event("change")}catch{}se||(se=k.default.createEvent("Event")).initEvent("change",!0,!0),W.dispatchEvent(se)}),r.handleTracksChange(),r}E.default(w,l);var i=w.prototype;return i.handleClick=function(e){var t=this.track,r=this.player_.textTracks();if(l.prototype.handleClick.call(this,e),r)for(var O=0;O<r.length;O++){var W=r[O];-1!==this.kinds.indexOf(W.kind)&&(W===t?"showing"!==W.mode&&(W.mode="showing"):"disabled"!==W.mode&&(W.mode="disabled"))}},i.handleTracksChange=function(e){var t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)},i.handleSelectedLanguageChange=function(e){if("showing"===this.track.mode){var t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},i.dispose=function(){this.track=null,l.prototype.dispose.call(this)},w}(cr);ve.registerComponent("TextTrackMenuItem",dr);var un=function(l){function w(e,t){return t.track={player:e,kind:t.kind,kinds:t.kinds,default:!1,mode:"disabled"},t.kinds||(t.kinds=[t.kind]),t.track.label=t.label?t.label:t.kinds.join(" and ")+" off",t.selectable=!0,t.multiSelectable=!1,l.call(this,e,t)||this}E.default(w,l);var i=w.prototype;return i.handleTracksChange=function(e){for(var t=this.player().textTracks(),r=!0,O=0,W=t.length;O<W;O++){var z=t[O];if(this.options_.kinds.indexOf(z.kind)>-1&&"showing"===z.mode){r=!1;break}}r!==this.isSelected_&&this.selected(r)},i.handleSelectedLanguageChange=function(e){for(var t=this.player().textTracks(),r=!0,O=0,W=t.length;O<W;O++){var z=t[O];if(["captions","descriptions","subtitles"].indexOf(z.kind)>-1&&"showing"===z.mode){r=!1;break}}r&&(this.player_.cache_.selectedLanguage={enabled:!1})},w}(dr);ve.registerComponent("OffTextTrackMenuItem",un);var $t=function(l){function w(e,t){return void 0===t&&(t={}),t.tracks=e.textTracks(),l.call(this,e,t)||this}return E.default(w,l),w.prototype.createItems=function(e,t){var r;void 0===e&&(e=[]),void 0===t&&(t=dr),this.label_&&(r=this.label_+" off"),e.push(new un(this.player_,{kinds:this.kinds_,kind:this.kind_,label:r})),this.hideThreshold_+=1;var O=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var W=0;W<O.length;W++){var z=O[W];if(this.kinds_.indexOf(z.kind)>-1){var J=new t(this.player_,{track:z,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});J.addClass("vjs-"+z.kind+"-menu-item"),e.push(J)}}return e},w}(li);ve.registerComponent("TextTrackButton",$t);var cn=function(l){function w(e,t){var r,O=t.track,W=t.cue,z=e.currentTime();return t.selectable=!0,t.multiSelectable=!1,t.label=W.text,t.selected=W.startTime<=z&&z<W.endTime,(r=l.call(this,e,t)||this).track=O,r.cue=W,r}return E.default(w,l),w.prototype.handleClick=function(e){l.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},w}(cr);ve.registerComponent("ChaptersTrackMenuItem",cn);var ui=function(l){function w(e,t,r){var O;return(O=l.call(this,e,t,r)||this).selectCurrentItem_=function(){O.items.forEach(function(W){W.selected(O.track_.activeCues[0]===W.cue)})},O}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-chapters-button "+l.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-chapters-button "+l.prototype.buildWrapperCSSClass.call(this)},i.update=function(e){if(!e||!e.track||"chapters"===e.track.kind){var t=this.findChaptersTrack();t!==this.track_?(this.setTrack(t),l.prototype.update.call(this)):(!this.items||t&&t.cues&&t.cues.length!==this.items.length)&&l.prototype.update.call(this)}},i.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var r=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);r&&r.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}},i.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],t=e.length-1;t>=0;t--){var r=e[t];if(r.kind===this.kind_)return r}},i.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize($e(this.kind_))},i.createMenu=function(){return this.options_.title=this.getMenuCaption(),l.prototype.createMenu.call(this)},i.createItems=function(){var e=[];if(!this.track_)return e;var t=this.track_.cues;if(!t)return e;for(var r=0,O=t.length;r<O;r++){var z=new cn(this.player_,{track:this.track_,cue:t[r]});e.push(z)}return e},w}($t);ui.prototype.kind_="chapters",ui.prototype.controlText_="Chapters",ve.registerComponent("ChaptersButton",ui);var ci=function(l){function w(e,t,r){var O;O=l.call(this,e,t,r)||this;var W=e.textTracks(),z=ze(C.default(O),O.handleTracksChange);return W.addEventListener("change",z),O.on("dispose",function(){W.removeEventListener("change",z)}),O}E.default(w,l);var i=w.prototype;return i.handleTracksChange=function(e){for(var t=this.player().textTracks(),r=!1,O=0,W=t.length;O<W;O++){var z=t[O];if(z.kind!==this.kind_&&"showing"===z.mode){r=!0;break}}r?this.disable():this.enable()},i.buildCSSClass=function(){return"vjs-descriptions-button "+l.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+l.prototype.buildWrapperCSSClass.call(this)},w}($t);ci.prototype.kind_="descriptions",ci.prototype.controlText_="Descriptions",ve.registerComponent("DescriptionsButton",ci);var di=function(l){function w(e,t,r){return l.call(this,e,t,r)||this}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-subtitles-button "+l.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+l.prototype.buildWrapperCSSClass.call(this)},w}($t);di.prototype.kind_="subtitles",di.prototype.controlText_="Subtitles",ve.registerComponent("SubtitlesButton",di);var hi=function(l){function w(e,t){var r;return t.track={player:e,kind:t.kind,label:t.kind+" settings",selectable:!1,default:!1,mode:"disabled"},t.selectable=!1,t.name="CaptionSettingsMenuItem",(r=l.call(this,e,t)||this).addClass("vjs-texttrack-settings"),r.controlText(", opens "+t.kind+" settings dialog"),r}return E.default(w,l),w.prototype.handleClick=function(e){this.player().getChild("textTrackSettings").open()},w}(dr);ve.registerComponent("CaptionSettingsMenuItem",hi);var fi=function(l){function w(e,t,r){return l.call(this,e,t,r)||this}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-captions-button "+l.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-captions-button "+l.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){var e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new hi(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),l.prototype.createItems.call(this,e)},w}($t);fi.prototype.kind_="captions",fi.prototype.controlText_="Captions",ve.registerComponent("CaptionsButton",fi);var dn=function(l){function w(){return l.apply(this,arguments)||this}return E.default(w,l),w.prototype.createEl=function(e,t,r){var O=l.prototype.createEl.call(this,e,t,r),W=O.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(W.appendChild($("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),W.appendChild($("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),O},w}(dr);ve.registerComponent("SubsCapsMenuItem",dn);var pi=function(l){function w(e,t){var r;return void 0===t&&(t={}),(r=l.call(this,e,t)||this).label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(r.player_.language_)>-1&&(r.label_="captions"),r.menuButton_.controlText($e(r.label_)),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-subs-caps-button "+l.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+l.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){var e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new hi(this.player_,{kind:this.label_})),this.hideThreshold_+=1),l.prototype.createItems.call(this,e,dn)},w}($t);pi.prototype.kinds_=["captions","subtitles"],pi.prototype.controlText_="Subtitles",ve.registerComponent("SubsCapsButton",pi);var hn=function(l){function w(e,t){var r,O=t.track,W=e.audioTracks();t.label=O.label||O.language||"Unknown",t.selected=O.enabled,(r=l.call(this,e,t)||this).track=O,r.addClass("vjs-"+O.kind+"-menu-item");var z=function(){for(var J=arguments.length,se=new Array(J),ie=0;ie<J;ie++)se[ie]=arguments[ie];r.handleTracksChange.apply(C.default(r),se)};return W.addEventListener("change",z),r.on("dispose",function(){W.removeEventListener("change",z)}),r}E.default(w,l);var i=w.prototype;return i.createEl=function(e,t,r){var O=l.prototype.createEl.call(this,e,t,r),W=O.querySelector(".vjs-menu-item-text");return"main-desc"===this.options_.track.kind&&(W.appendChild($("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),W.appendChild($("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),O},i.handleClick=function(e){if(l.prototype.handleClick.call(this,e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var t=this.player_.audioTracks(),r=0;r<t.length;r++){var O=t[r];O!==this.track&&(O.enabled=O===this.track)}},i.handleTracksChange=function(e){this.selected(this.track.enabled)},w}(cr);ve.registerComponent("AudioTrackMenuItem",hn);var fn=function(l){function w(e,t){return void 0===t&&(t={}),t.tracks=e.audioTracks(),l.call(this,e,t)||this}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-audio-button "+l.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-audio-button "+l.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(e){void 0===e&&(e=[]),this.hideThreshold_=1;for(var t=this.player_.audioTracks(),r=0;r<t.length;r++)e.push(new hn(this.player_,{track:t[r],selectable:!0,multiSelectable:!1}));return e},w}(li);fn.prototype.controlText_="Audio Track",ve.registerComponent("AudioTrackButton",fn);var vi=function(l){function w(e,t){var r,O=t.rate,W=parseFloat(O,10);return t.label=O,t.selected=W===e.playbackRate(),t.selectable=!0,t.multiSelectable=!1,(r=l.call(this,e,t)||this).label=O,r.rate=W,r.on(e,"ratechange",function(z){return r.update(z)}),r}E.default(w,l);var i=w.prototype;return i.handleClick=function(e){l.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},i.update=function(e){this.selected(this.player().playbackRate()===this.rate)},w}(cr);vi.prototype.contentElType="button",ve.registerComponent("PlaybackRateMenuItem",vi);var pn=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).menuButton_.el_.setAttribute("aria-describedby",r.labelElId_),r.updateVisibility(),r.updateLabel(),r.on(e,"loadstart",function(O){return r.updateVisibility(O)}),r.on(e,"ratechange",function(O){return r.updateLabel(O)}),r.on(e,"playbackrateschange",function(O){return r.handlePlaybackRateschange(O)}),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){var e=l.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=$("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e},i.dispose=function(){this.labelEl_=null,l.prototype.dispose.call(this)},i.buildCSSClass=function(){return"vjs-playback-rate "+l.prototype.buildCSSClass.call(this)},i.buildWrapperCSSClass=function(){return"vjs-playback-rate "+l.prototype.buildWrapperCSSClass.call(this)},i.createItems=function(){for(var e=this.playbackRates(),t=[],r=e.length-1;r>=0;r--)t.push(new vi(this.player(),{rate:e[r]+"x"}));return t},i.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},i.handleClick=function(e){var t=this.player().playbackRate(),r=this.playbackRates(),W=(r.indexOf(t)+1)%r.length;this.player().playbackRate(r[W])},i.handlePlaybackRateschange=function(e){this.update()},i.playbackRates=function(){var e=this.player();return e.playbackRates&&e.playbackRates()||[]},i.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},i.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},i.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},w}(oi);pn.prototype.controlText_="Playback Rate",ve.registerComponent("PlaybackRateMenuButton",pn);var vn=function(l){function w(){return l.apply(this,arguments)||this}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-spacer "+l.prototype.buildCSSClass.call(this)},i.createEl=function(e,t,r){return void 0===e&&(e="div"),void 0===t&&(t={}),void 0===r&&(r={}),t.className||(t.className=this.buildCSSClass()),l.prototype.createEl.call(this,e,t,r)},w}(ve);ve.registerComponent("Spacer",vn);var Na=function(l){function w(){return l.apply(this,arguments)||this}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-custom-control-spacer "+l.prototype.buildCSSClass.call(this)},i.createEl=function(){return l.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:"\xa0"})},w}(vn);ve.registerComponent("CustomControlSpacer",Na);var Ar=function(l){function w(){return l.apply(this,arguments)||this}return E.default(w,l),w.prototype.createEl=function(){return l.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},w}(ve);Ar.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in k.default&&Ar.prototype.options_.children.splice(Ar.prototype.options_.children.length-1,0,"pictureInPictureToggle"),ve.registerComponent("ControlBar",Ar);var gn=function(l){function w(e,t){var r;return(r=l.call(this,e,t)||this).on(e,"error",function(O){return r.open(O)}),r}E.default(w,l);var i=w.prototype;return i.buildCSSClass=function(){return"vjs-error-display "+l.prototype.buildCSSClass.call(this)},i.content=function(){var e=this.player().error();return e?this.localize(e.message):""},w}(Yt);gn.prototype.options_=x.default({},Yt.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),ve.registerComponent("ErrorDisplay",gn);var gi="vjs-text-track-settings",mn=["#000","Black"],yn=["#00F","Blue"],_n=["#0FF","Cyan"],bn=["#0F0","Green"],En=["#F0F","Magenta"],Tn=["#F00","Red"],Sn=["#FFF","White"],kn=["#FF0","Yellow"],mi=["1","Opaque"],yi=["0.5","Semi-Transparent"],wn=["0","Transparent"],Ht={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[mn,Sn,Tn,bn,yn,kn,En,_n]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[mi,yi,wn]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Sn,mn,Tn,bn,yn,kn,En,_n]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(l){return"1.00"===l?null:Number(l)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[mi,yi]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[wn,yi,mi]}};function Cn(l,w){if(w&&(l=w(l)),l&&"none"!==l)return l}Ht.windowColor.options=Ht.backgroundColor.options;var Ha=function(l){function w(e,t){var r;return t.temporary=!1,(r=l.call(this,e,t)||this).updateDisplay=r.updateDisplay.bind(C.default(r)),r.fill(),r.hasBeenOpened_=r.hasBeenFilled_=!0,r.endDialog=$("p",{className:"vjs-control-text",textContent:r.localize("End of dialog window.")}),r.el().appendChild(r.endDialog),r.setDefaults(),void 0===t.persistTextTrackSettings&&(r.options_.persistTextTrackSettings=r.options_.playerOptions.persistTextTrackSettings),r.on(r.$(".vjs-done-button"),"click",function(){r.saveSettings(),r.close()}),r.on(r.$(".vjs-default-button"),"click",function(){r.setDefaults(),r.updateDisplay()}),Y(Ht,function(O){r.on(r.$(O.selector),"change",r.updateDisplay)}),r.options_.persistTextTrackSettings&&r.restoreSettings(),r}E.default(w,l);var i=w.prototype;return i.dispose=function(){this.endDialog=null,l.prototype.dispose.call(this)},i.createElSelect_=function(e,t,r){var O=this;void 0===t&&(t=""),void 0===r&&(r="label");var W=Ht[e],z=W.id.replace("%s",this.id_),J=[t,z].join(" ").trim();return["<"+r+' id="'+z+'" class="'+("label"===r?"vjs-label":"")+'">',this.localize(W.label),"</"+r+">",'<select aria-labelledby="'+J+'">'].concat(W.options.map(function(se){var ie=z+"-"+se[1].replace(/\W+/g,"");return['<option id="'+ie+'" value="'+se[0]+'" ','aria-labelledby="'+J+" "+ie+'">',O.localize(se[1]),"</option>"].join("")})).concat("</select>").join("")},i.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},i.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},i.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},i.createElColors_=function(){return $("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},i.createElFont_=function(){return $("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},i.createElControls_=function(){var e=this.localize("restore all settings to the default values");return $("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},i.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},i.label=function(){return this.localize("Caption Settings Dialog")},i.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},i.buildCSSClass=function(){return l.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},i.getValues=function(){var e=this;return function X(l,w,i){return void 0===i&&(i=0),V(l).reduce(function(e,t){return w(e,l[t],t)},i)}(Ht,function(t,r,O){var W=function Ba(l,w){return Cn(l.options[l.options.selectedIndex].value,w)}(e.$(r.selector),r.parser);return void 0!==W&&(t[O]=W),t},{})},i.setValues=function(e){var t=this;Y(Ht,function(r,O){!function Ua(l,w,i){if(w)for(var e=0;e<l.options.length;e++)if(Cn(l.options[e].value,i)===w){l.selectedIndex=e;break}}(t.$(r.selector),e[O],r.parser)})},i.setDefaults=function(){var e=this;Y(Ht,function(t){var r=t.hasOwnProperty("default")?t.default:0;e.$(t.selector).selectedIndex=r})},i.restoreSettings=function(){var e;try{e=JSON.parse(b.default.localStorage.getItem(gi))}catch(t){N.warn(t)}e&&this.setValues(e)},i.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?b.default.localStorage.setItem(gi,JSON.stringify(e)):b.default.localStorage.removeItem(gi)}catch(t){N.warn(t)}}},i.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},i.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,t=e&&e.subsCapsButton,r=e&&e.captionsButton;t?t.focus():r&&r.focus()},w}(Yt);ve.registerComponent("TextTrackSettings",Ha);var Ga=function(l){function w(e,t){var r,O=t.ResizeObserver||b.default.ResizeObserver;null===t.ResizeObserver&&(O=!1);var W=Xe({createEl:!O,reportTouchActivity:!1},t);return(r=l.call(this,e,W)||this).ResizeObserver=t.ResizeObserver||b.default.ResizeObserver,r.loadListener_=null,r.resizeObserver_=null,r.debouncedHandler_=Un(function(){r.resizeHandler()},100,!1,C.default(r)),O?(r.resizeObserver_=new r.ResizeObserver(r.debouncedHandler_),r.resizeObserver_.observe(e.el())):(r.loadListener_=function(){if(r.el_&&r.el_.contentWindow){var z=r.debouncedHandler_,J=r.unloadListener_=function(){nt(this,"resize",z),nt(this,"unload",J),J=null};dt(r.el_.contentWindow,"unload",J),dt(r.el_.contentWindow,"resize",z)}},r.one("load",r.loadListener_)),r}E.default(w,l);var i=w.prototype;return i.createEl=function(){return l.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})},i.resizeHandler=function(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")},i.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,l.prototype.dispose.call(this)},w}(ve);ve.registerComponent("ResizeManager",Ga);var qa={trackingThreshold:20,liveTolerance:15},Va=function(l){function w(e,t){var r,O=Xe(qa,t,{createEl:!1});return(r=l.call(this,e,O)||this).handleVisibilityChange_=function(W){return r.handleVisibilityChange(W)},r.trackLiveHandler_=function(){return r.trackLive_()},r.handlePlay_=function(W){return r.handlePlay(W)},r.handleFirstTimeupdate_=function(W){return r.handleFirstTimeupdate(W)},r.handleSeeked_=function(W){return r.handleSeeked(W)},r.seekToLiveEdge_=function(W){return r.seekToLiveEdge(W)},r.reset_(),r.on(r.player_,"durationchange",function(W){return r.handleDurationchange(W)}),r.on(r.player_,"canplay",function(){return r.toggleTracking()}),pe&&"hidden"in k.default&&"visibilityState"in k.default&&r.on(k.default,"visibilitychange",r.handleVisibilityChange_),r}E.default(w,l);var i=w.prototype;return i.handleVisibilityChange=function(){this.player_.duration()===1/0&&(k.default.hidden?this.stopTracking():this.startTracking())},i.trackLive_=function(){var e=this.player_.seekable();if(e&&e.length){var t=Number(b.default.performance.now().toFixed(4)),r=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+r;var O=this.liveCurrentTime(),W=this.player_.currentTime(),z=this.player_.paused()||this.seekedBehindLive_||Math.abs(O-W)>this.options_.liveTolerance;(!this.timeupdateSeen_||O===1/0)&&(z=!1),z!==this.behindLiveEdge_&&(this.behindLiveEdge_=z,this.trigger("liveedgechange"))}},i.handleDurationchange=function(){this.toggleTracking()},i.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},i.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,_t),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},i.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},i.handleSeeked=function(){var e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()},i.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},i.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},i.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},i.stopTracking=function(){!this.isTracking()||(this.reset_(),this.trigger("liveedgechange"))},i.seekableEnd=function(){for(var e=this.player_.seekable(),t=[],r=e?e.length:0;r--;)t.push(e.end(r));return t.length?t.sort()[t.length-1]:1/0},i.seekableStart=function(){for(var e=this.player_.seekable(),t=[],r=e?e.length:0;r--;)t.push(e.start(r));return t.length?t.sort()[0]:0},i.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()},i.isLive=function(){return this.isTracking()},i.atLiveEdge=function(){return!this.behindLiveEdge()},i.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},i.pastSeekEnd=function(){var e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_},i.behindLiveEdge=function(){return this.behindLiveEdge_},i.isTracking=function(){return"number"==typeof this.trackingInterval_},i.seekToLiveEdge=function(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},i.dispose=function(){this.off(k.default,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),l.prototype.dispose.call(this)},w}(ve);ve.registerComponent("LiveTracker",Va);var Dr,_i=function(l){var w=l.el();if(w.hasAttribute("src"))return l.triggerSourceset(w.src),!0;var i=l.$$("source"),e=[],t="";if(!i.length)return!1;for(var r=0;r<i.length;r++){var O=i[r].src;O&&-1===e.indexOf(O)&&e.push(O)}return!!e.length&&(1===e.length&&(t=e[0]),l.triggerSourceset(t),!0)},Ka=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(l){var w=k.default.createElement(this.nodeName.toLowerCase());w.innerHTML=l;for(var i=k.default.createDocumentFragment();w.childNodes.length;)i.appendChild(w.childNodes[0]);return this.innerText="",b.default.Element.prototype.appendChild.call(this,i),this.innerHTML}}),An=function(l,w){for(var i={},e=0;e<l.length&&!((i=Object.getOwnPropertyDescriptor(l[e],w))&&i.set&&i.get);e++);return i.enumerable=!0,i.configurable=!0,i},Dn=function(l){var w=l.el();if(!w.resetSourceWatch_){var i={},e=function(l){return An([l.el(),b.default.HTMLMediaElement.prototype,b.default.Element.prototype,Ka],"innerHTML")}(l),t=function(r){return function(){for(var O=arguments.length,W=new Array(O),z=0;z<O;z++)W[z]=arguments[z];var J=r.apply(w,W);return _i(l),J}};["append","appendChild","insertAdjacentHTML"].forEach(function(r){!w[r]||(i[r]=w[r],w[r]=t(i[r]))}),Object.defineProperty(w,"innerHTML",Xe(e,{set:t(e.set)})),w.resetSourceWatch_=function(){w.resetSourceWatch_=null,Object.keys(i).forEach(function(r){w[r]=i[r]}),Object.defineProperty(w,"innerHTML",e)},l.one("sourceset",w.resetSourceWatch_)}},Ya=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?ji(b.default.Element.prototype.getAttribute.call(this,"src")):""},set:function(l){return b.default.Element.prototype.setAttribute.call(this,"src",l),l}}),bi=function(l,w,i,e){void 0===e&&(e=!0);var t=function(O){return Object.defineProperty(l,w,{value:O,enumerable:!0,writable:!0})},r={configurable:!0,enumerable:!0,get:function(){var O=i();return t(O),O}};return e&&(r.set=t),Object.defineProperty(l,w,r)},we=function(l){function w(e,t){var r;r=l.call(this,e,t)||this;var O=e.source,W=!1;if(r.featuresVideoFrameCallback=r.featuresVideoFrameCallback&&"VIDEO"===r.el_.tagName,O&&(r.el_.currentSrc!==O.src||e.tag&&3===e.tag.initNetworkState_)?r.setSource(O):r.handleLateInit_(r.el_),e.enableSourceset&&r.setupSourcesetHandling_(),r.isScrubbing_=!1,r.el_.hasChildNodes()){for(var z=r.el_.childNodes,J=z.length,se=[];J--;){var ie=z[J];"track"===ie.nodeName.toLowerCase()&&(r.featuresNativeTextTracks?(r.remoteTextTrackEls().addTrackElement_(ie),r.remoteTextTracks().addTrack(ie.track),r.textTracks().addTrack(ie.track),!W&&!r.el_.hasAttribute("crossorigin")&&br(ie.src)&&(W=!0)):se.push(ie))}for(var De=0;De<se.length;De++)r.el_.removeChild(se[De])}return r.proxyNativeTracks_(),r.featuresNativeTextTracks&&W&&N.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),r.restoreMetadataTracksInIOSNativePlayer_(),(Ae||Ne||ae)&&!0===e.nativeControlsForTouch&&r.setControls(!0),r.proxyWebkitFullscreen_(),r.triggerReady(),r}E.default(w,l);var i=w.prototype;return i.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),w.disposeMediaElement(this.el_),this.options_=null,l.prototype.dispose.call(this)},i.setupSourcesetHandling_=function(){!function(l){if(l.featuresSourceset){var w=l.el();if(!w.resetSourceset_){var i=function(l){return An([l.el(),b.default.HTMLMediaElement.prototype,Ya],"src")}(l),e=w.setAttribute,t=w.load;Object.defineProperty(w,"src",Xe(i,{set:function(r){var O=i.set.call(w,r);return l.triggerSourceset(w.src),O}})),w.setAttribute=function(r,O){var W=e.call(w,r,O);return/src/i.test(r)&&l.triggerSourceset(w.src),W},w.load=function(){var r=t.call(w);return _i(l)||(l.triggerSourceset(""),Dn(l)),r},w.currentSrc?l.triggerSourceset(w.currentSrc):_i(l)||Dn(l),w.resetSourceset_=function(){w.resetSourceset_=null,w.load=t,w.setAttribute=e,Object.defineProperty(w,"src",i),w.resetSourceWatch_&&w.resetSourceWatch_()}}}}(this)},i.restoreMetadataTracksInIOSNativePlayer_=function(){var t,e=this.textTracks(),r=function(){t=[];for(var W=0;W<e.length;W++){var z=e[W];"metadata"===z.kind&&t.push({track:z,storedMode:z.mode})}};r(),e.addEventListener("change",r),this.on("dispose",function(){return e.removeEventListener("change",r)});var O=function W(){for(var z=0;z<t.length;z++){var J=t[z];"disabled"===J.track.mode&&J.track.mode!==J.storedMode&&(J.track.mode=J.storedMode)}e.removeEventListener("change",W)};this.on("webkitbeginfullscreen",function(){e.removeEventListener("change",r),e.removeEventListener("change",O),e.addEventListener("change",O)}),this.on("webkitendfullscreen",function(){e.removeEventListener("change",r),e.addEventListener("change",r),e.removeEventListener("change",O)})},i.overrideNative_=function(e,t){var r=this;if(t===this["featuresNative"+e+"Tracks"]){var O=e.toLowerCase();this[O+"TracksListeners_"]&&Object.keys(this[O+"TracksListeners_"]).forEach(function(W){r.el()[O+"Tracks"].removeEventListener(W,r[O+"TracksListeners_"][W])}),this["featuresNative"+e+"Tracks"]=!t,this[O+"TracksListeners_"]=null,this.proxyNativeTracksForType_(O)}},i.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},i.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},i.proxyNativeTracksForType_=function(e){var t=this,r=pt[e],O=this.el()[r.getterName],W=this[r.getterName]();if(this["featuresNative"+r.capitalName+"Tracks"]&&O&&O.addEventListener){var z={change:function(se){var ie={type:"change",target:W,currentTarget:W,srcElement:W};W.trigger(ie),"text"===e&&t[Zt.remoteText.getterName]().trigger(ie)},addtrack:function(se){W.addTrack(se.track)},removetrack:function(se){W.removeTrack(se.track)}},J=function(){for(var se=[],ie=0;ie<W.length;ie++){for(var fe=!1,De=0;De<O.length;De++)if(O[De]===W[ie]){fe=!0;break}fe||se.push(W[ie])}for(;se.length;)W.removeTrack(se.shift())};this[r.getterName+"Listeners_"]=z,Object.keys(z).forEach(function(se){var ie=z[se];O.addEventListener(se,ie),t.on("dispose",function(fe){return O.removeEventListener(se,ie)})}),this.on("loadstart",J),this.on("dispose",function(se){return t.off("loadstart",J)})}},i.proxyNativeTracks_=function(){var e=this;pt.names.forEach(function(t){e.proxyNativeTracksForType_(t)})},i.createEl=function(){var e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){var t=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(t,e),w.disposeMediaElement(e),e=t}else{e=k.default.createElement("video");var O=Xe({},this.options_.tag&&Ve(this.options_.tag));(!Ae||!0!==this.options_.nativeControlsForTouch)&&delete O.controls,lt(e,Z(O,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&ht(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);for(var W=["loop","muted","playsinline","autoplay"],z=0;z<W.length;z++){var J=W[z],se=this.options_[J];typeof se<"u"&&(se?ht(e,J,J):gt(e,J),e[J]=se)}return e},i.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var t=!1,r=function(){t=!0};this.on("loadstart",r);var O=function(){t||this.trigger("loadstart")};return this.on("loadedmetadata",O),void this.ready(function(){this.off("loadstart",r),this.off("loadedmetadata",O),t||this.trigger("loadstart")})}var W=["loadstart"];W.push("loadedmetadata"),e.readyState>=2&&W.push("loadeddata"),e.readyState>=3&&W.push("canplay"),e.readyState>=4&&W.push("canplaythrough"),this.ready(function(){W.forEach(function(z){this.trigger(z)},this)})}},i.setScrubbing=function(e){this.isScrubbing_=e},i.scrubbing=function(){return this.isScrubbing_},i.setCurrentTime=function(e){try{this.isScrubbing_&&this.el_.fastSeek&&Oe?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){N(t,"Video is not ready. (Video.js)")}},i.duration=function(){var e=this;return this.el_.duration===1/0&&Ce&&ee&&0===this.el_.currentTime?(this.on("timeupdate",function r(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",r))}),NaN):this.el_.duration||NaN},i.width=function(){return this.el_.offsetWidth},i.height=function(){return this.el_.offsetHeight},i.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var t=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},r=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",t),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",r),this.on("dispose",function(){e.off("webkitbeginfullscreen",r),e.off("webkitendfullscreen",t)})}},i.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var e=b.default.navigator&&b.default.navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},i.enterFullScreen=function(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)wt(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},i.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))},i.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},i.requestVideoFrameCallback=function(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):l.prototype.requestVideoFrameCallback.call(this,e)},i.cancelVideoFrameCallback=function(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):l.prototype.cancelVideoFrameCallback.call(this,e)},i.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},i.reset=function(){w.resetMediaElement(this.el_)},i.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},i.setControls=function(e){this.el_.controls=!!e},i.addTextTrack=function(e,t,r){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,t,r):l.prototype.addTextTrack.call(this,e,t,r)},i.createRemoteTextTrack=function(e){if(!this.featuresNativeTextTracks)return l.prototype.createRemoteTextTrack.call(this,e);var t=k.default.createElement("track");return e.kind&&(t.kind=e.kind),e.label&&(t.label=e.label),(e.language||e.srclang)&&(t.srclang=e.language||e.srclang),e.default&&(t.default=e.default),e.id&&(t.id=e.id),e.src&&(t.src=e.src),t},i.addRemoteTextTrack=function(e,t){var r=l.prototype.addRemoteTextTrack.call(this,e,t);return this.featuresNativeTextTracks&&this.el().appendChild(r),r},i.removeRemoteTextTrack=function(e){if(l.prototype.removeRemoteTextTrack.call(this,e),this.featuresNativeTextTracks)for(var t=this.$$("track"),r=t.length;r--;)(e===t[r]||e===t[r].track)&&this.el().removeChild(t[r])},i.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),b.default.performance&&"function"==typeof b.default.performance.now?e.creationTime=b.default.performance.now():b.default.performance&&b.default.performance.timing&&"number"==typeof b.default.performance.timing.navigationStart&&(e.creationTime=b.default.Date.now()-b.default.performance.timing.navigationStart),e},w}(Ke);bi(we,"TEST_VID",function(){if(Ye()){var l=k.default.createElement("video"),w=k.default.createElement("track");return w.kind="captions",w.srclang="en",w.label="English",l.appendChild(w),l}}),we.isSupported=function(){try{we.TEST_VID.volume=.5}catch{return!1}return!(!we.TEST_VID||!we.TEST_VID.canPlayType)},we.canPlayType=function(l){return we.TEST_VID.canPlayType(l)},we.canPlaySource=function(l,w){return we.canPlayType(l.type)},we.canControlVolume=function(){try{var l=we.TEST_VID.volume;we.TEST_VID.volume=l/2+.1;var w=l!==we.TEST_VID.volume;return w&&Me?(b.default.setTimeout(function(){we&&we.prototype&&(we.prototype.featuresVolumeControl=l!==we.TEST_VID.volume)}),!1):w}catch{return!1}},we.canMuteVolume=function(){try{var l=we.TEST_VID.muted;return we.TEST_VID.muted=!l,we.TEST_VID.muted?ht(we.TEST_VID,"muted","muted"):gt(we.TEST_VID,"muted"),l!==we.TEST_VID.muted}catch{return!1}},we.canControlPlaybackRate=function(){if(Ce&&ee&&de<58)return!1;try{var l=we.TEST_VID.playbackRate;return we.TEST_VID.playbackRate=l/2+.1,l!==we.TEST_VID.playbackRate}catch{return!1}},we.canOverrideAttributes=function(){try{var l=function(){};Object.defineProperty(k.default.createElement("video"),"src",{get:l,set:l}),Object.defineProperty(k.default.createElement("audio"),"src",{get:l,set:l}),Object.defineProperty(k.default.createElement("video"),"innerHTML",{get:l,set:l}),Object.defineProperty(k.default.createElement("audio"),"innerHTML",{get:l,set:l})}catch{return!1}return!0},we.supportsNativeTextTracks=function(){return Oe||Me&&ee},we.supportsNativeVideoTracks=function(){return!(!we.TEST_VID||!we.TEST_VID.videoTracks)},we.supportsNativeAudioTracks=function(){return!(!we.TEST_VID||!we.TEST_VID.audioTracks)},we.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(l){var i=l[1];bi(we.prototype,l[0],function(){return we[i]()},!0)}),we.prototype.featuresVolumeControl=we.canControlVolume(),we.prototype.movingMediaElementInDOM=!Me,we.prototype.featuresFullscreenResize=!0,we.prototype.featuresProgressEvents=!0,we.prototype.featuresTimeupdateEvents=!0,we.prototype.featuresVideoFrameCallback=!(!we.TEST_VID||!we.TEST_VID.requestVideoFrameCallback),we.patchCanPlayType=function(){ue>=4&&!ce&&!ee&&(Dr=we.TEST_VID&&we.TEST_VID.constructor.prototype.canPlayType,we.TEST_VID.constructor.prototype.canPlayType=function(l){return l&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(l)?"maybe":Dr.call(this,l)})},we.unpatchCanPlayType=function(){var l=we.TEST_VID.constructor.prototype.canPlayType;return Dr&&(we.TEST_VID.constructor.prototype.canPlayType=Dr),l},we.patchCanPlayType(),we.disposeMediaElement=function(l){if(l){for(l.parentNode&&l.parentNode.removeChild(l);l.hasChildNodes();)l.removeChild(l.firstChild);l.removeAttribute("src"),"function"==typeof l.load&&function(){try{l.load()}catch{}}()}},we.resetMediaElement=function(l){if(l){for(var w=l.querySelectorAll("source"),i=w.length;i--;)l.removeChild(w[i]);l.removeAttribute("src"),"function"==typeof l.load&&function(){try{l.load()}catch{}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(l){we.prototype[l]=function(){return this.el_[l]||this.el_.hasAttribute(l)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(l){we.prototype["set"+$e(l)]=function(w){this.el_[l]=w,w?this.el_.setAttribute(l,l):this.el_.removeAttribute(l)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(l){we.prototype[l]=function(){return this.el_[l]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(l){we.prototype["set"+$e(l)]=function(w){this.el_[l]=w}}),["pause","load","play"].forEach(function(l){we.prototype[l]=function(){return this.el_[l]()}}),Ke.withSourceHandlers(we),we.nativeSourceHandler={},we.nativeSourceHandler.canPlayType=function(l){try{return we.TEST_VID.canPlayType(l)}catch{return""}},we.nativeSourceHandler.canHandleSource=function(l,w){if(l.type)return we.nativeSourceHandler.canPlayType(l.type);if(l.src){var i=zr(l.src);return we.nativeSourceHandler.canPlayType("video/"+i)}return""},we.nativeSourceHandler.handleSource=function(l,w,i){w.setSrc(l.src)},we.nativeSourceHandler.dispose=function(){},we.registerSourceHandler(we.nativeSourceHandler),Ke.registerTech("Html5",we);var xn=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],Ei={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},Ti=["tiny","xsmall","small","medium","large","xlarge","huge"],xr={};Ti.forEach(function(l){var w="x"===l.charAt(0)?"x-"+l.substring(1):l;xr[l]="vjs-layout-"+w});var Za={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},et=function(l){function w(e,t,r){var O;if(e.id=e.id||t.id||"vjs_video_"+Dt(),(t=Z(w.getTagSettings(e),t)).initChildren=!1,t.createEl=!1,t.evented=!1,t.reportTouchActivity=!1,!t.language)if("function"==typeof e.closest){var W=e.closest("[lang]");W&&W.getAttribute&&(t.language=W.getAttribute("lang"))}else for(var z=e;z&&1===z.nodeType;){if(Ve(z).hasOwnProperty("lang")){t.language=z.getAttribute("lang");break}z=z.parentNode}if((O=l.call(this,null,t,r)||this).boundDocumentFullscreenChange_=function(fe){return O.documentFullscreenChange_(fe)},O.boundFullWindowOnEscKey_=function(fe){return O.fullWindowOnEscKey(fe)},O.boundUpdateStyleEl_=function(fe){return O.updateStyleEl_(fe)},O.boundApplyInitTime_=function(fe){return O.applyInitTime_(fe)},O.boundUpdateCurrentBreakpoint_=function(fe){return O.updateCurrentBreakpoint_(fe)},O.boundHandleTechClick_=function(fe){return O.handleTechClick_(fe)},O.boundHandleTechDoubleClick_=function(fe){return O.handleTechDoubleClick_(fe)},O.boundHandleTechTouchStart_=function(fe){return O.handleTechTouchStart_(fe)},O.boundHandleTechTouchMove_=function(fe){return O.handleTechTouchMove_(fe)},O.boundHandleTechTouchEnd_=function(fe){return O.handleTechTouchEnd_(fe)},O.boundHandleTechTap_=function(fe){return O.handleTechTap_(fe)},O.isFullscreen_=!1,O.log=q(O.id_),O.fsApi_=d,O.isPosterFromTech_=!1,O.queuedCallbacks_=[],O.isReady_=!1,O.hasStarted_=!1,O.userActive_=!1,O.debugEnabled_=!1,O.audioOnlyMode_=!1,O.audioPosterMode_=!1,O.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!O.options_||!O.options_.techOrder||!O.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(O.tag=e,O.tagAttributes=e&&Ve(e),O.language(O.options_.language),t.languages){var J={};Object.getOwnPropertyNames(t.languages).forEach(function(fe){J[fe.toLowerCase()]=t.languages[fe]}),O.languages_=J}else O.languages_=w.prototype.options_.languages;O.resetCache_(),O.poster_=t.poster||"",O.controls_=!!t.controls,e.controls=!1,e.removeAttribute("controls"),O.changingSrc_=!1,O.playCallbacks_=[],O.playTerminatedQueue_=[],e.hasAttribute("autoplay")?O.autoplay(!0):O.autoplay(O.options_.autoplay),t.plugins&&Object.keys(t.plugins).forEach(function(fe){if("function"!=typeof O[fe])throw new Error('plugin "'+fe+'" does not exist')}),O.scrubbing_=!1,O.el_=O.createEl(),Br(C.default(O),{eventBusKey:"el_"}),O.fsApi_.requestFullscreen&&(dt(k.default,O.fsApi_.fullscreenchange,O.boundDocumentFullscreenChange_),O.on(O.fsApi_.fullscreenchange,O.boundDocumentFullscreenChange_)),O.fluid_&&O.on(["playerreset","resize"],O.boundUpdateStyleEl_);var se=Xe(O.options_);t.plugins&&Object.keys(t.plugins).forEach(function(fe){O[fe](t.plugins[fe])}),t.debug&&O.debug(!0),O.options_.playerOptions=se,O.middleware_=[],O.playbackRates(t.playbackRates),O.initChildren(),O.isAudio("audio"===e.nodeName.toLowerCase()),O.controls()?O.addClass("vjs-controls-enabled"):O.addClass("vjs-controls-disabled"),O.el_.setAttribute("role","region"),O.isAudio()?O.el_.setAttribute("aria-label",O.localize("Audio Player")):O.el_.setAttribute("aria-label",O.localize("Video Player")),O.isAudio()&&O.addClass("vjs-audio"),O.flexNotSupported_()&&O.addClass("vjs-no-flex"),Ae&&O.addClass("vjs-touch-enabled"),Me||O.addClass("vjs-workinghover"),w.players[O.id_]=C.default(O);var ie=v.split(".")[0];return O.addClass("vjs-v"+ie),O.userActive(!0),O.reportUserActivity(),O.one("play",function(fe){return O.listenForUserActivity_(fe)}),O.on("stageclick",function(fe){return O.handleStageClick_(fe)}),O.on("keydown",function(fe){return O.handleKeyDown(fe)}),O.on("languagechange",function(fe){return O.handleLanguagechange(fe)}),O.breakpoints(O.options_.breakpoints),O.responsive(O.options_.responsive),O.on("ready",function(){O.audioPosterMode(O.options_.audioPosterMode),O.audioOnlyMode(O.options_.audioOnlyMode)}),O}E.default(w,l);var i=w.prototype;return i.dispose=function(){var e=this;this.trigger("dispose"),this.off("dispose"),nt(k.default,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),nt(k.default,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),w.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),function ga(l){Xr[l.id()]=null}(this),ot.names.forEach(function(t){var O=e[ot[t].getterName]();O&&O.off&&O.off()}),l.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},i.createEl=function(){var t,e=this.tag,r=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player"),O="video-js"===this.tag.tagName.toLowerCase();r?t=this.el_=e.parentNode:O||(t=this.el_=l.prototype.createEl.call(this,"div"));var W=Ve(e);if(O){for(t=this.el_=e,e=this.tag=k.default.createElement("video");t.children.length;)e.appendChild(t.firstChild);Fe(t,"video-js")||Be(t,"video-js"),t.appendChild(e),r=this.playerElIngest_=t,Object.keys(t).forEach(function(De){try{e[De]=t[De]}catch{}})}if(e.setAttribute("tabindex","-1"),W.tabindex="-1",(pe||ee&&Ie)&&(e.setAttribute("role","application"),W.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in W&&delete W.width,"height"in W&&delete W.height,Object.getOwnPropertyNames(W).forEach(function(De){O&&"class"===De||t.setAttribute(De,W[De]),O&&e.setAttribute(De,W[De])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=t.player=this,this.addClass("vjs-paused"),!0!==b.default.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=fr("vjs-styles-dimensions");var z=ut(".vjs-styles-defaults"),J=ut("head");J.insertBefore(this.styleEl_,z?z.nextSibling:J.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var se=e.getElementsByTagName("a"),ie=0;ie<se.length;ie++){var fe=se.item(ie);Be(fe,"vjs-hidden"),fe.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!r&&e.parentNode.insertBefore(t,e),je(e,t),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t},i.crossOrigin=function(e){if(!e)return this.techGet_("crossOrigin");"anonymous"===e||"use-credentials"===e?this.techCall_("setCrossOrigin",e):N.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+e+'"')},i.width=function(e){return this.dimension("width",e)},i.height=function(e){return this.dimension("height",e)},i.dimension=function(e,t){var r=e+"_";if(void 0===t)return this[r]||0;if(""===t||"auto"===t)return this[r]=void 0,void this.updateStyleEl_();var O=parseFloat(t);isNaN(O)?N.error('Improper value "'+t+'" supplied for for '+e):(this[r]=O,this.updateStyleEl_())},i.fluid=function(e){var t=this;if(void 0===e)return!!this.fluid_;this.fluid_=!!e,Lt(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),function(l,w){Lt(l)?w():(l.eventedCallbacks||(l.eventedCallbacks=[]),l.eventedCallbacks.push(w))}(this,function(){t.on(["playerreset","resize"],t.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()},i.fill=function(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},i.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},i.updateStyleEl_=function(){if(!0!==b.default.VIDEOJS_NO_DYNAMIC_STYLE){var O,W,J,se=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),ie=se[1]/se[0];O=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/ie:this.videoWidth()||300,W=void 0!==this.height_?this.height_:O*ie,J=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(J),sr(this.styleEl_,"\n      ."+J+" {\n        width: "+O+"px;\n        height: "+W+"px;\n      }\n\n      ."+J+".vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: "+100*ie+"%;\n      }\n    ")}else{var e="number"==typeof this.width_?this.width_:this.options_.width,t="number"==typeof this.height_?this.height_:this.options_.height,r=this.tech_&&this.tech_.el();r&&(e>=0&&(r.width=e),t>=0&&(r.height=t))}},i.loadTech_=function(e,t){var r=this;this.tech_&&this.unloadTech_();var O=$e(e),W=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==O&&this.tag&&(Ke.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=O,this.isReady_=!1;var z=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(z=!1);var J={source:t,autoplay:z,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+W+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};ot.names.forEach(function(ie){var fe=ot[ie];J[fe.getterName]=r[fe.privateName]}),Z(J,this.options_[O]),Z(J,this.options_[W]),Z(J,this.options_[e.toLowerCase()]),this.tag&&(J.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(J.startTime=this.cache_.currentTime);var se=Ke.getTech(e);if(!se)throw new Error("No Tech named '"+O+"' exists! '"+O+"' should be registered using videojs.registerTech()'");this.tech_=new se(J),this.tech_.ready(ze(this,this.handleTechReady_),!0),function(l,w){l.forEach(function(i){var e=w.addRemoteTextTrack(i).track;!i.src&&i.cues&&i.cues.forEach(function(t){return e.addCue(t)})}),w.textTracks()}(this.textTracksJson_||[],this.tech_),xn.forEach(function(ie){r.on(r.tech_,ie,function(fe){return r["handleTech"+$e(ie)+"_"](fe)})}),Object.keys(Ei).forEach(function(ie){r.on(r.tech_,ie,function(fe){0===r.tech_.playbackRate()&&r.tech_.seeking()?r.queuedCallbacks_.push({callback:r["handleTech"+Ei[ie]+"_"].bind(r),event:fe}):r["handleTech"+Ei[ie]+"_"](fe)})}),this.on(this.tech_,"loadstart",function(ie){return r.handleTechLoadStart_(ie)}),this.on(this.tech_,"sourceset",function(ie){return r.handleTechSourceset_(ie)}),this.on(this.tech_,"waiting",function(ie){return r.handleTechWaiting_(ie)}),this.on(this.tech_,"ended",function(ie){return r.handleTechEnded_(ie)}),this.on(this.tech_,"seeking",function(ie){return r.handleTechSeeking_(ie)}),this.on(this.tech_,"play",function(ie){return r.handleTechPlay_(ie)}),this.on(this.tech_,"firstplay",function(ie){return r.handleTechFirstPlay_(ie)}),this.on(this.tech_,"pause",function(ie){return r.handleTechPause_(ie)}),this.on(this.tech_,"durationchange",function(ie){return r.handleTechDurationChange_(ie)}),this.on(this.tech_,"fullscreenchange",function(ie,fe){return r.handleTechFullscreenChange_(ie,fe)}),this.on(this.tech_,"fullscreenerror",function(ie,fe){return r.handleTechFullscreenError_(ie,fe)}),this.on(this.tech_,"enterpictureinpicture",function(ie){return r.handleTechEnterPictureInPicture_(ie)}),this.on(this.tech_,"leavepictureinpicture",function(ie){return r.handleTechLeavePictureInPicture_(ie)}),this.on(this.tech_,"error",function(ie){return r.handleTechError_(ie)}),this.on(this.tech_,"posterchange",function(ie){return r.handleTechPosterChange_(ie)}),this.on(this.tech_,"textdata",function(ie){return r.handleTechTextData_(ie)}),this.on(this.tech_,"ratechange",function(ie){return r.handleTechRateChange_(ie)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&("Html5"!==O||!this.tag)&&je(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},i.unloadTech_=function(){var e=this;ot.names.forEach(function(t){var r=ot[t];e[r.privateName]=e[r.getterName]()}),this.textTracksJson_=function(l){var w=l.$$("track"),i=Array.prototype.map.call(w,function(t){return t.track});return Array.prototype.map.call(w,function(t){var r=Gr(t.track);return t.src&&(r.src=t.src),r}).concat(Array.prototype.filter.call(l.textTracks(),function(t){return-1===i.indexOf(t)}).map(Gr))}(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},i.tech=function(e){return void 0===e&&N.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_},i.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},i.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},i.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},i.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())},i.manualAutoplay_=function(e){var t=this;if(this.tech_&&"string"==typeof e){var O,r=function(){var W=t.muted();t.muted(!0);var z=function(){t.muted(W)};t.playTerminatedQueue_.push(z);var J=t.play();if(lr(J))return J.catch(function(se){throw z(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(se||""))})};if("any"!==e||this.muted()?O="muted"!==e||this.muted()?this.play():r():lr(O=this.play())&&(O=O.catch(r)),lr(O))return O.then(function(){t.trigger({type:"autoplay-success",autoplay:e})}).catch(function(){t.trigger({type:"autoplay-failure",autoplay:e})})}},i.updateSourceCaches_=function(e){void 0===e&&(e="");var t=e,r="";"string"!=typeof t&&(t=e.src,r=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!r&&(r=function(l,w){if(!w)return"";if(l.cache_.source.src===w&&l.cache_.source.type)return l.cache_.source.type;var i=l.cache_.sources.filter(function(O){return O.src===w});if(i.length)return i[0].type;for(var e=l.$$("source"),t=0;t<e.length;t++){var r=e[t];if(r.type&&r.src&&r.src===w)return r.type}return Tr(w)}(this,t)),this.cache_.source=Xe({},e,{src:t,type:r});for(var O=this.cache_.sources.filter(function(fe){return fe.src&&fe.src===t}),W=[],z=this.$$("source"),J=[],se=0;se<z.length;se++){var ie=Ve(z[se]);W.push(ie),ie.src&&ie.src===t&&J.push(ie.src)}J.length&&!O.length?this.cache_.sources=W:O.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t},i.handleTechSourceset_=function(e){var t=this;if(!this.changingSrc_){var r=function(z){return t.updateSourceCaches_(z)},O=this.currentSource().src,W=e.src;O&&!/^blob:/.test(O)&&/^blob:/.test(W)&&(!this.lastSource_||this.lastSource_.tech!==W&&this.lastSource_.player!==O)&&(r=function(){}),r(W),e.src||this.tech_.any(["sourceset","loadstart"],function(z){if("sourceset"!==z.type){var J=t.techGet("currentSrc");t.lastSource_.tech=J,t.updateSourceCaches_(J)}})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})},i.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},i.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},i.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},i.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var t=this.currentTime();this.on("timeupdate",function O(){t!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",O))})},i.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},i.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},i.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},i.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},i.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},i.handleTechFirstPlay_=function(){this.options_.starttime&&(N.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},i.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},i.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},i.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},i.handleTechClick_=function(e){!this.controls_||(void 0===this.options_||void 0===this.options_.userActions||void 0===this.options_.userActions.click||!1!==this.options_.userActions.click)&&(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?wt(this.play()):this.pause())},i.handleTechDoubleClick_=function(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(r){return r.contains(e.target)})||(void 0===this.options_||void 0===this.options_.userActions||void 0===this.options_.userActions.doubleClick||!1!==this.options_.userActions.doubleClick)&&(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},i.handleTechTap_=function(){this.userActive(!this.userActive())},i.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},i.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},i.handleTechTouchEnd_=function(e){e.cancelable&&e.preventDefault()},i.handleStageClick_=function(){this.reportUserActivity()},i.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},i.documentFullscreenChange_=function(e){var t=e.target.player;if(!t||t===this){var r=this.el(),O=k.default[this.fsApi_.fullscreenElement]===r;!O&&r.matches?O=r.matches(":"+this.fsApi_.fullscreen):!O&&r.msMatchesSelector&&(O=r.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(O)}},i.handleTechFullscreenChange_=function(e,t){var r=this;t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",function(){r.removeClass("vjs-ios-native-fs")})),this.isFullscreen(t.isFullscreen))},i.handleTechFullscreenError_=function(e,t){this.trigger("fullscreenerror",t)},i.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},i.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},i.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},i.handleTechError_=function(){var e=this.tech_.error();this.error(e)},i.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},i.getCache=function(){return this.cache_},i.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},i.techCall_=function(e,t){this.ready(function(){if(e in pa)return function ha(l,w,i,e){return w[i](l.reduce(Zr(i),e))}(this.middleware_,this.tech_,e,t);if(e in Ki)return Vi(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(r){throw N(r),r}},!0)},i.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in fa)return function da(l,w,i){return l.reduceRight(Zr(i),w[i]())}(this.middleware_,this.tech_,e);if(e in Ki)return Vi(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw void 0===this.tech_[e]?(N("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t),t):"TypeError"===t.name?(N("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t),this.tech_.isReady_=!1,t):(N(t),t)}}},i.play=function(){var e=this,t=this.options_.Promise||b.default.Promise;return t?new t(function(r){e.play_(r)}):this.play_()},i.play_=function(e){var t=this;void 0===e&&(e=wt),this.playCallbacks_.push(e);var r=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!r)return this.waitToPlay_=function(W){t.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!r&&(Oe||Me)&&this.load());var O=this.techGet_("play");null===O?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(O)},i.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(t){t()})},i.runPlayCallbacks_=function(e){var t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(r){r(e)})},i.pause=function(){this.techCall_("pause")},i.paused=function(){return!1!==this.techGet_("paused")},i.played=function(){return this.techGet_("played")||Nt(0,0)},i.scrubbing=function(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},i.currentTime=function(e){return typeof e<"u"?(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),void(this.cache_.initTime=0)):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},i.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},i.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))},i.remainingTime=function(){return this.duration()-this.currentTime()},i.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},i.buffered=function(){var e=this.techGet_("buffered");return(!e||!e.length)&&(e=Nt(0,0)),e},i.bufferedPercent=function(){return Ri(this.buffered(),this.duration())},i.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),r=e.end(e.length-1);return r>t&&(r=t),r},i.volume=function(e){var t;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)},i.muted=function(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)},i.defaultMuted=function(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},i.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},i.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},i.isFullscreen=function(e){if(void 0!==e){var t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_},i.requestFullscreen=function(e){var t=this.options_.Promise||b.default.Promise;if(t){var r=this;return new t(function(O,W){function z(){r.off("fullscreenerror",se),r.off("fullscreenchange",J)}function J(){z(),O()}function se(fe,De){z(),W(De)}r.one("fullscreenchange",J),r.one("fullscreenerror",se);var ie=r.requestFullscreenHelper_(e);ie&&(ie.then(z,z),ie.then(O,W))})}return this.requestFullscreenHelper_()},i.requestFullscreenHelper_=function(e){var r,t=this;if(this.fsApi_.prefixed||(r=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(r=e)),this.fsApi_.requestFullscreen){var O=this.el_[this.fsApi_.requestFullscreen](r);return O&&O.then(function(){return t.isFullscreen(!0)},function(){return t.isFullscreen(!1)}),O}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},i.exitFullscreen=function(){var e=this.options_.Promise||b.default.Promise;if(e){var t=this;return new e(function(r,O){function W(){t.off("fullscreenerror",J),t.off("fullscreenchange",z)}function z(){W(),r()}function J(ie,fe){W(),O(fe)}t.one("fullscreenchange",z),t.one("fullscreenerror",J);var se=t.exitFullscreenHelper_();se&&(se.then(W,W),se.then(r,O))})}return this.exitFullscreenHelper_()},i.exitFullscreenHelper_=function(){var e=this;if(this.fsApi_.requestFullscreen){var t=k.default[this.fsApi_.exitFullscreen]();return t&&wt(t.then(function(){return e.isFullscreen(!1)})),t}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},i.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=k.default.documentElement.style.overflow,dt(k.default,"keydown",this.boundFullWindowOnEscKey_),k.default.documentElement.style.overflow="hidden",Be(k.default.body,"vjs-full-window"),this.trigger("enterFullWindow")},i.fullWindowOnEscKey=function(e){T.default.isEventKey(e,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},i.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,nt(k.default,"keydown",this.boundFullWindowOnEscKey_),k.default.documentElement.style.overflow=this.docOrigOverflow,qe(k.default.body,"vjs-full-window"),this.trigger("exitFullWindow")},i.disablePictureInPicture=function(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")},i.isInPictureInPicture=function(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},i.requestPictureInPicture=function(){if("pictureInPictureEnabled"in k.default&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")},i.exitPictureInPicture=function(){if("pictureInPictureEnabled"in k.default)return k.default.exitPictureInPicture()},i.handleKeyDown=function(e){var O,W,t=this.options_.userActions;t&&t.hotkeys&&(W=(O=this.el_.ownerDocument.activeElement).tagName.toLowerCase(),O.isContentEditable||("input"===W?-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(O.type):-1!==["textarea"].indexOf(W))||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e)))},i.handleHotkeys=function(e){var t=this.options_.userActions?this.options_.userActions.hotkeys:{},r=t.fullscreenKey,W=t.muteKey,z=void 0===W?function(Ge){return T.default.isEventKey(Ge,"m")}:W,J=t.playPauseKey,se=void 0===J?function(Ge){return T.default.isEventKey(Ge,"k")||T.default.isEventKey(Ge,"Space")}:J;if((void 0===r?function(Ge){return T.default.isEventKey(Ge,"f")}:r).call(this,e)){e.preventDefault(),e.stopPropagation();var ie=ve.getComponent("FullscreenToggle");!1!==k.default[this.fsApi_.fullscreenEnabled]&&ie.prototype.handleClick.call(this,e)}else z.call(this,e)?(e.preventDefault(),e.stopPropagation(),ve.getComponent("MuteToggle").prototype.handleClick.call(this,e)):se.call(this,e)&&(e.preventDefault(),e.stopPropagation(),ve.getComponent("PlayToggle").prototype.handleClick.call(this,e))},i.canPlayType=function(e){for(var t,r=0,O=this.options_.techOrder;r<O.length;r++){var W=O[r],z=Ke.getTech(W);if(z||(z=ve.getComponent(W)),z){if(z.isSupported()&&(t=z.canPlayType(e)))return t}else N.error('The "'+W+'" tech is undefined. Skipped browser support check for that tech.')}return""},i.selectSource=function(e){var se,t=this,r=this.options_.techOrder.map(function(se){return[se,Ke.getTech(se)]}).filter(function(se){var ie=se[0],fe=se[1];return fe?fe.isSupported():(N.error('The "'+ie+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),O=function(se,ie,fe){var De;return se.some(function(Ge){return ie.some(function(Gt){if(De=fe(Ge,Gt))return!0})}),De},J=function(se,ie){var fe=se[0];if(se[1].canPlaySource(ie,t.options_[fe.toLowerCase()]))return{source:ie,tech:fe}};return(this.options_.sourceOrder?O(e,r,(se=J,function(ie,fe){return se(fe,ie)})):O(r,e,J))||!1},i.handleSrc_=function(e,t){var r=this;if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var O=ba(e);if(O.length){if(this.changingSrc_=!0,t||(this.cache_.sources=O),this.updateSourceCaches_(O[0]),ua(this,O[0],function(J,se){if(r.middleware_=se,t||(r.cache_.sources=O),r.updateSourceCaches_(J),r.src_(J))return O.length>1?r.handleSrc_(O.slice(1)):(r.changingSrc_=!1,r.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void r.triggerReady());!function ca(l,w){l.forEach(function(i){return i.setTech&&i.setTech(w)})}(se,r.tech_)}),this.options_.retryOnError&&O.length>1){var W=function(){r.error(null),r.handleSrc_(O.slice(1),!0)},z=function(){r.off("error",W)};this.one("error",W),this.one("playing",z),this.resetRetryOnError_=function(){r.off("error",W),r.off("playing",z)}}}else this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)},i.src=function(e){return this.handleSrc_(e,!1)},i.src_=function(e){var t=this,r=this.selectSource([e]);return!r||(function(l,w){return $e(l)===$e(w)}(r.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(r.tech,r.source),this.tech_.ready(function(){t.changingSrc_=!1}),!1))},i.load=function(){this.techCall_("load")},i.reset=function(){var e=this,t=this.options_.Promise||b.default.Promise;this.paused()||!t?this.doReset_():wt(this.play().then(function(){return e.doReset_()}))},i.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Lt(this)&&this.trigger("playerreset")},i.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},i.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar||{},t=e.durationDisplay,r=e.remainingTimeDisplay;t&&t.updateContent(),r&&r.updateContent()},i.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},i.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},i.currentSources=function(){var e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t},i.currentSource=function(){return this.cache_.source||{}},i.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},i.currentType=function(){return this.currentSource()&&this.currentSource().type||""},i.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")},i.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t=typeof t>"u"?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)},i.playsinline=function(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},i.loop=function(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")},i.poster=function(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},i.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},i.controls=function(e){if(void 0===e)return!!this.controls_;this.controls_!==(e=!!e)&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},i.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;this.usingNativeControls_!==(e=!!e)&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},i.error=function(e){var t=this;if(void 0===e)return this.error_||null;if(s("beforeerror").forEach(function(O){var W=O(t,e);te(W)&&!Array.isArray(W)||"string"==typeof W||"number"==typeof W||null===W?e=W:t.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&e&&4===e.code){var r=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],r),void this.one("loadstart",function(){this.off(["click","touchstart"],r)})}if(null===e)return this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new st(e),this.addClass("vjs-error"),N.error("(CODE:"+this.error_.code+" "+st.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),s("error").forEach(function(O){return O(t,t.error_)})},i.reportUserActivity=function(e){this.userActivity_=!0},i.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},i.listenForUserActivity_=function(){var e,t,r,O=ze(this,this.reportUserActivity),J=function(fe){O(),this.clearInterval(e)};this.on("mousedown",function(){O(),this.clearInterval(e),e=this.setInterval(O,250)}),this.on("mousemove",function(fe){(fe.screenX!==t||fe.screenY!==r)&&(t=fe.screenX,r=fe.screenY,O())}),this.on("mouseup",J),this.on("mouseleave",J);var ie,se=this.getChild("controlBar");se&&!Me&&!Ce&&(se.on("mouseenter",function(fe){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),se.on("mouseleave",function(fe){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",O),this.on("keyup",O),this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(ie);var fe=this.options_.inactivityTimeout;fe<=0||(ie=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},fe))}},250)},i.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)},i.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},i.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},i.enableAudioOnlyUI_=function(){var e=this;this.addClass("vjs-audio-only-mode");var t=this.children(),r=this.getChild("ControlBar"),O=r&&r.currentHeight();t.forEach(function(W){W!==r&&W.el_&&!W.hasClass("vjs-hidden")&&(W.hide(),e.audioOnlyCache_.hiddenChildren.push(W))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(O),this.trigger("audioonlymodechange")},i.disableAudioOnlyUI_=function(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(function(e){return e.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")},i.audioOnlyMode=function(e){var t=this;if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=e;var r=this.options_.Promise||b.default.Promise;if(r){if(e){var O=[];return this.isInPictureInPicture()&&O.push(this.exitPictureInPicture()),this.isFullscreen()&&O.push(this.exitFullscreen()),this.audioPosterMode()&&O.push(this.audioPosterMode(!1)),r.all(O).then(function(){return t.enableAudioOnlyUI_()})}return r.resolve().then(function(){return t.disableAudioOnlyUI_()})}e?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},i.enablePosterModeUI_=function(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},i.disablePosterModeUI_=function(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},i.audioPosterMode=function(e){var t=this;if("boolean"!=typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=e;var r=this.options_.Promise||b.default.Promise;return r?e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(function(){t.enablePosterModeUI_()}):r.resolve().then(function(){t.enablePosterModeUI_()}):r.resolve().then(function(){t.disablePosterModeUI_()}):e?(this.audioOnlyMode()&&this.audioOnlyMode(!1),void this.enablePosterModeUI_()):void this.disablePosterModeUI_()},i.addTextTrack=function(e,t,r){if(this.tech_)return this.tech_.addTextTrack(e,t,r)},i.addRemoteTextTrack=function(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)},i.removeRemoteTextTrack=function(e){void 0===e&&(e={});var r=e.track;if(r||(r=e),this.tech_)return this.tech_.removeRemoteTextTrack(r)},i.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},i.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},i.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},i.language=function(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),Lt(this)&&this.trigger("languagechange"))},i.languages=function(){return Xe(w.prototype.options_.languages,this.languages_)},i.toJSON=function(){var e=Xe(this.options_),t=e.tracks;e.tracks=[];for(var r=0;r<t.length;r++){var O=t[r];(O=Xe(O)).player=void 0,e.tracks[r]=O}return e},i.createModal=function(e,t){var r=this;(t=t||{}).content=e||"";var O=new Yt(this,t);return this.addChild(O),O.on("dispose",function(){r.removeChild(O)}),O.open(),O},i.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),t=this.currentWidth(),r=0;r<Ti.length;r++){var O=Ti[r];if(t<=this.breakpoints_[O]){if(e===O)return;e&&this.removeClass(xr[e]),this.addClass(xr[O]),this.breakpoint_=O;break}}},i.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)},i.breakpoints=function(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Z({},Za,e),this.updateCurrentBreakpoint_()),Z(this.breakpoints_)},i.responsive=function(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0},i.currentBreakpoint=function(){return this.breakpoint_},i.currentBreakpointClass=function(){return xr[this.breakpoint_]||""},i.loadMedia=function(e,t){var r=this;if(e&&"object"==typeof e){this.reset(),this.cache_.media=Xe(e);var O=this.cache_.media,z=O.poster,J=O.src,se=O.textTracks;!O.artwork&&z&&(this.cache_.media.artwork=[{src:z,type:Tr(z)}]),J&&this.src(J),z&&this.poster(z),Array.isArray(se)&&se.forEach(function(ie){return r.addRemoteTextTrack(ie,!1)}),this.ready(t)}},i.getMedia=function(){if(!this.cache_.media){var e=this.poster(),O={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(W){return{kind:W.kind,label:W.label,language:W.language,src:W.src}})};return e&&(O.poster=e,O.artwork=[{src:O.poster,type:Tr(O.poster)}]),O}return Xe(this.cache_.media)},w.getTagSettings=function(e){var t={sources:[],tracks:[]},r=Ve(e),O=r["data-setup"];if(Fe(e,"vjs-fill")&&(r.fill=!0),Fe(e,"vjs-fluid")&&(r.fluid=!0),null!==O){var W=o.default(O||"{}"),z=W[0],J=W[1];z&&N.error(z),Z(r,J)}if(Z(t,r),e.hasChildNodes())for(var se=e.childNodes,ie=0,fe=se.length;ie<fe;ie++){var De=se[ie],Ge=De.nodeName.toLowerCase();"source"===Ge?t.sources.push(Ve(De)):"track"===Ge&&t.tracks.push(Ve(De))}return t},i.flexNotSupported_=function(){var e=k.default.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},i.debug=function(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},i.playbackRates=function(e){if(void 0===e)return this.cache_.playbackRates;!Array.isArray(e)||!e.every(function(t){return"number"==typeof t})||(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))},w}(ve);ot.names.forEach(function(l){var w=ot[l];et.prototype[w.getterName]=function(){return this.tech_?this.tech_[w.getterName]():(this[w.privateName]=this[w.privateName]||new w.ListClass,this[w.privateName])}}),et.prototype.crossorigin=et.prototype.crossOrigin,et.players={};var hr=b.default.navigator;et.prototype.options_={techOrder:Ke.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:hr&&(hr.languages&&hr.languages[0]||hr.userLanguage||hr.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(l){et.prototype[l]=function(){return this.techGet_(l)}}),xn.forEach(function(l){et.prototype["handleTech"+$e(l)+"_"]=function(){return this.trigger(l)}}),ve.registerComponent("Player",et);var Lr="plugin",er="activePlugins_",tr={},Ir=function(l){return tr.hasOwnProperty(l)},Rr=function(l){return Ir(l)?tr[l]:void 0},Ln=function(l,w){l[er]=l[er]||{},l[er][w]=!0},Or=function(l,w,i){var e=(i?"before":"")+"pluginsetup";l.trigger(e,w),l.trigger(e+":"+w.name,w)},In=function(l,w){return w.prototype.name=l,function(){Or(this,{name:l,plugin:w,instance:null},!0);for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];var r=u.default(w,[this].concat(e));return this[l]=function(){return r},Or(this,r.getEventHash()),r}},Ct=function(){function l(i){if(this.constructor===l)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=i,this.log||(this.log=this.player.log.createLogger(this.name)),Br(this),delete this.trigger,Li(this,this.constructor.defaultState),Ln(i,this.name),this.dispose=this.dispose.bind(this),i.on("dispose",this.dispose)}var w=l.prototype;return w.version=function(){return this.constructor.VERSION},w.getEventHash=function(i){return void 0===i&&(i={}),i.name=this.name,i.plugin=this.constructor,i.instance=this,i},w.trigger=function(i,e){return void 0===e&&(e={}),Kt(this.eventBusEl_,i,this.getEventHash(e))},w.handleStateChanged=function(i){},w.dispose=function(){var i=this.name,e=this.player;this.trigger("dispose"),this.off(),e.off("dispose",this.dispose),e[er][i]=!1,this.player=this.state=null,e[i]=In(i,tr[i])},l.isBasic=function(i){var e="string"==typeof i?Rr(i):i;return"function"==typeof e&&!l.prototype.isPrototypeOf(e.prototype)},l.registerPlugin=function(i,e){if("string"!=typeof i)throw new Error('Illegal plugin name, "'+i+'", must be a string, was '+typeof i+".");if(Ir(i))N.warn('A plugin named "'+i+'" already exists. You may want to avoid re-registering plugins!');else if(et.prototype.hasOwnProperty(i))throw new Error('Illegal plugin name, "'+i+'", cannot share a name with an existing player method!');if("function"!=typeof e)throw new Error('Illegal plugin for "'+i+'", must be a function, was '+typeof e+".");return tr[i]=e,i!==Lr&&(et.prototype[i]=l.isBasic(e)?function(l,w){var i=function(){Or(this,{name:l,plugin:w,instance:null},!0);var e=w.apply(this,arguments);return Ln(this,l),Or(this,{name:l,plugin:w,instance:e}),e};return Object.keys(w).forEach(function(e){i[e]=w[e]}),i}(i,e):In(i,e)),e},l.deregisterPlugin=function(i){if(i===Lr)throw new Error("Cannot de-register base plugin.");Ir(i)&&(delete tr[i],delete et.prototype[i])},l.getPlugins=function(i){var e;return void 0===i&&(i=Object.keys(tr)),i.forEach(function(t){var r=Rr(t);r&&((e=e||{})[t]=r)}),e},l.getPluginVersion=function(i){var e=Rr(i);return e&&e.VERSION||""},l}();Ct.getPlugin=Rr,Ct.BASE_PLUGIN_NAME=Lr,Ct.registerPlugin(Lr,Ct),et.prototype.usingPlugin=function(l){return!!this[er]&&!0===this[er][l]},et.prototype.hasPlugin=function(l){return!!Ir(l)};var Rn=!1,On=function(l){return 0===l.indexOf("#")?l.slice(1):l};function xe(l,w,i){var e=xe.getPlayer(l);if(e)return w&&N.warn('Player "'+l+'" is already initialised. Options will not be applied.'),i&&e.ready(i),e;var t="string"==typeof l?ut("#"+On(l)):l;if(!Qe(t))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!t.ownerDocument.defaultView||!t.ownerDocument.body.contains(t))&&N.warn("The element supplied is not included in the DOM"),!0===(w=w||{}).restoreEl&&(w.restoreEl=(t.parentNode&&t.parentNode.hasAttribute("data-vjs-player")?t.parentNode:t).cloneNode(!0)),s("beforesetup").forEach(function(O){var W=O(t,Xe(w));te(W)&&!Array.isArray(W)?w=Xe(w,W):N.error("please return an object in beforesetup hooks")});var r=ve.getComponent("Player");return e=new r(t,w,i),s("setup").forEach(function(O){return O(e)}),e}if(xe.hooks_=a,xe.hooks=s,xe.hook=function(l,w){s(l,w)},xe.hookOnce=function(l,w){s(l,[].concat(w).map(function(i){return function t(){return m(l,t),i.apply(void 0,arguments)}}))},xe.removeHook=m,!0!==b.default.VIDEOJS_NO_DYNAMIC_STYLE&&Ye()){var Pr=ut(".vjs-styles-defaults");if(!Pr){Pr=fr("vjs-styles-defaults");var Si=ut("head");Si&&Si.insertBefore(Pr,Si.firstChild),sr(Pr,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}kt(1,xe),xe.VERSION=v,xe.options=et.prototype.options_,xe.getPlayers=function(){return et.players},xe.getPlayer=function(l){var i,w=et.players;if("string"==typeof l){var e=On(l),t=w[e];if(t)return t;i=ut("#"+e)}else i=l;if(Qe(i)){var O=i.player,W=i.playerId;if(O||w[W])return O||w[W]}},xe.getAllPlayers=function(){return Object.keys(et.players).map(function(l){return et.players[l]}).filter(Boolean)},xe.players=et.players,xe.getComponent=ve.getComponent,xe.registerComponent=function(l,w){Ke.isTech(w)&&N.warn("The "+l+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),ve.registerComponent.call(ve,l,w)},xe.getTech=Ke.getTech,xe.registerTech=Ke.registerTech,xe.use=function la(l,w){Bt[l]=Bt[l]||[],Bt[l].push(w)},Object.defineProperty(xe,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(xe.middleware,"TERMINATOR",{value:Er,writeable:!1,enumerable:!0}),xe.browser=Ue,xe.TOUCH_ENABLED=Ae,xe.extend=function(l,w){void 0===w&&(w={}),Rn||(N.warn("videojs.extend is deprecated as of Video.js 7.22.0 and will be removed in Video.js 8.0.0"),Rn=!0);var i=function(){l.apply(this,arguments)},e={};for(var t in"object"==typeof w?(w.constructor!==Object.prototype.constructor&&(i=w.constructor),e=w):"function"==typeof w&&(i=w),A.default(i,l),l&&(i.super_=l),e)e.hasOwnProperty(t)&&(i.prototype[t]=e[t]);return i},xe.mergeOptions=Xe,xe.bind=ze,xe.registerPlugin=Ct.registerPlugin,xe.deregisterPlugin=Ct.deregisterPlugin,xe.plugin=function(l,w){return N.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),Ct.registerPlugin(l,w)},xe.getPlugins=Ct.getPlugins,xe.getPlugin=Ct.getPlugin,xe.getPluginVersion=Ct.getPluginVersion,xe.addLanguage=function(l,w){var i;return l=(""+l).toLowerCase(),(xe.options.languages=Xe(xe.options.languages,((i={})[l]=w,i)))[l]},xe.log=N,xe.createLogger=q,xe.createTimeRange=xe.createTimeRanges=Nt,xe.formatTime=Qt,xe.setFormatTime=function Aa(l){$r=l},xe.resetFormatTime=function Da(){$r=Zi},xe.parseUrl=Yr,xe.isCrossOrigin=br,xe.EventTarget=rt,xe.on=dt,xe.one=gr,xe.off=nt,xe.trigger=Kt,xe.xhr=g.default,xe.TextTrack=ur,xe.AudioTrack=Ui,xe.VideoTrack=Hi,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(l){xe[l]=function(){return N.warn("videojs."+l+"() is deprecated; use videojs.dom."+l+"() instead"),Vt[l].apply(null,arguments)}}),xe.computedStyle=ne,xe.dom=Vt,xe.url=na,xe.defineLazyProperty=bi,xe.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"}),ge.exports=xe},288:(ge,Le,Ee)=>{var Se;typeof self<"u"&&self,ge.exports=(Se=Ee(207),function(Q){function K(U){if(j[U])return j[U].exports;var L=j[U]={i:U,l:!1,exports:{}};return Q[U].call(L.exports,L,L.exports,K),L.l=!0,L.exports}var j={};return K.m=Q,K.c=j,K.d=function(U,L,F){K.o(U,L)||Object.defineProperty(U,L,{configurable:!1,enumerable:!0,get:F})},K.n=function(U){var L=U&&U.__esModule?function(){return U.default}:function(){return U};return K.d(L,"a",L),L},K.o=function(U,L){return Object.prototype.hasOwnProperty.call(U,L)},K.p="",K(K.s=2)}([function(Q,K,j){var L;typeof self<"u"&&self,L=function(){return function(U){function L(I){if(F[I])return F[I].exports;var R=F[I]={i:I,l:!1,exports:{}};return U[I].call(R.exports,R,R.exports,L),R.l=!0,R.exports}var F={};return L.m=U,L.c=F,L.d=function(I,R,D){L.o(I,R)||Object.defineProperty(I,R,{configurable:!1,enumerable:!0,get:D})},L.n=function(I){var R=I&&I.__esModule?function(){return I.default}:function(){return I};return L.d(R,"a",R),R},L.o=function(I,R){return Object.prototype.hasOwnProperty.call(I,R)},L.p="",L(L.s=18)}([function(U,L,F){(function(I){var R;R=typeof window<"u"?window:void 0!==I?I:typeof self<"u"?self:{},U.exports=R}).call(L,F(20))},function(U,L){function R(H,V){var Y=N(H)||function o(H){return function f(H){return function a(H){return!!H&&"object"==typeof H}(H)&&g(H)}(H)&&S.call(H,"callee")&&(!P.call(H,"callee")||y.call(H)==m)}(H)?function I(H,V){for(var Y=-1,X=Array(H);++Y<H;)X[Y]=V(Y);return X}(H.length,String):[],X=Y.length,Z=!!X;for(var te in H)!V&&!S.call(H,te)||Z&&("length"==te||x(te,X))||Y.push(te);return Y}function D(H,V,Y){var X=H[V];S.call(H,V)&&E(X,Y)&&(void 0!==Y||V in H)||(H[V]=Y)}function x(H,V){return!!(V=V??h)&&("number"==typeof H||n.test(H))&&H>-1&&H%1==0&&H<V}function C(H){var V=H&&H.constructor;return H===("function"==typeof V&&V.prototype||p)}function E(H,V){return H===V||H!=H&&V!=V}function g(H){return null!=H&&function A(H){return"number"==typeof H&&H>-1&&H%1==0&&H<=h}(H.length)&&!function u(H){var V=v(H)?y.call(H):"";return V==c||V==d}(H)}function v(H){var V=typeof H;return!!H&&("object"==V||"function"==V)}function s(H){return g(H)?R(H):function _(H){if(!C(H))return M(H);var V=[];for(var Y in Object(H))S.call(H,Y)&&"constructor"!=Y&&V.push(Y);return V}(H)}var H,V,h=9007199254740991,m="[object Arguments]",c="[object Function]",d="[object GeneratorFunction]",n=/^(?:0|[1-9]\d*)$/,p=Object.prototype,S=p.hasOwnProperty,y=p.toString,P=p.propertyIsEnumerable,M=(H=Object.keys,V=Object,function(Y){return H(V(Y))}),B=Math.max,G=!P.call({valueOf:1},"valueOf"),N=Array.isArray,q=function(H){return function b(H,V){return V=B(void 0===V?H.length-1:V,0),function(){for(var Y=arguments,X=-1,Z=B(Y.length-V,0),te=Array(Z);++X<Z;)te[X]=Y[V+X];X=-1;for(var re=Array(V+1);++X<V;)re[X]=Y[X];return re[V]=te,function F(H,V,Y){switch(Y.length){case 0:return H.call(V);case 1:return H.call(V,Y[0]);case 2:return H.call(V,Y[0],Y[1]);case 3:return H.call(V,Y[0],Y[1],Y[2])}return H.apply(V,Y)}(H,this,re)}}(function(V,Y){var X=-1,Z=Y.length,te=Z>1?Y[Z-1]:void 0,re=Z>2?Y[2]:void 0;for(te=H.length>3&&"function"==typeof te?(Z--,te):void 0,re&&function T(H,V,Y){if(!v(Y))return!1;var X=typeof V;return!!("number"==X?g(Y)&&x(V,Y.length):"string"==X&&V in Y)&&E(Y[V],H)}(Y[0],Y[1],re)&&(te=Z<3?void 0:te,Z=1),V=Object(V);++X<Z;){var ne=Y[X];ne&&H(V,ne)}return V})}(function(H,V){if(G||C(V)||g(V))!function k(H,V,Y,X){Y||(Y={});for(var Z=-1,te=V.length;++Z<te;){var re=V[Z],ne=X?X(Y[re],H[re],re,Y,H):void 0;D(Y,re,void 0===ne?H[re]:ne)}return Y}(V,s(V),H);else for(var Y in V)S.call(V,Y)&&D(H,Y,V[Y])});U.exports=q},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(0))&&_.__esModule?_:{default:_},D={now:function(){var _=R.default.performance,b=_&&_.timing;return b&&"number"==typeof b.navigationStart&&"function"==typeof _.now?b.navigationStart+_.now():Date.now()}};L.default=D},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(R,D,_){_=void 0===_?1:_,R[D]=R[D]||0,R[D]+=_}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(21))&&_.__esModule?_:{default:_},D=R.default.methodFactory;R.default.methodFactory=function(_,b,k){var x=D(_,b,k);return function(){for(var T=["[mux]"],C=0;C<arguments.length;C++)T.push(arguments[C]);x.apply(void 0,T)}},R.default.setLevel(R.default.getLevel()),L.default=R.default},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var D=function(_){if("string"!=typeof _||""===_)return["localhost"];var x=(_.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/)||[])[4],T=void 0;return x&&(T=(x.match(/[^\.]+\.[^\.]+$/)||[])[0]),[x,T]};L.extractHostnameAndDomain=D,L.extractHostname=function(_){return D(_)[0]},L.extractDomain=function(_){return D(_)[1]}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(D){var _=16*Math.random()|0;return("x"===D?_:3&_|8).toString(16)})},L.generateShortID=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(D){var _={};return(D=D||"").trim().split(/[\r\n]+/).forEach(function(b){if(b){var k=b.split(": "),x=k.shift();x&&(R.indexOf(x.toLowerCase())>=0||0===x.toLowerCase().indexOf("x-litix-"))&&(_[x]=k.join(": "))}}),_};var R=["x-cdn","content-type"]},function(U,L,F){"use strict";var I=SyntaxError,R=Function,D=TypeError,_=function(S){try{return R('"use strict"; return ('+S+").constructor;")()}catch{}},b=Object.getOwnPropertyDescriptor;if(b)try{b({},"")}catch{b=null}var k=function(){throw new D},x=b?function(){try{return k}catch{try{return b(arguments,"callee").get}catch{return k}}}():k,T=F(43)(),C=Object.getPrototypeOf||function(S){return S.__proto__},E={},o=typeof Uint8Array>"u"?void 0:C(Uint8Array),g={"%AggregateError%":typeof AggregateError>"u"?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":T?C([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":E,"%AsyncGenerator%":E,"%AsyncGeneratorFunction%":E,"%AsyncIteratorPrototype%":E,"%Atomics%":typeof Atomics>"u"?void 0:Atomics,"%BigInt%":typeof BigInt>"u"?void 0:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?void 0:Float32Array,"%Float64Array%":typeof Float64Array>"u"?void 0:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?void 0:FinalizationRegistry,"%Function%":R,"%GeneratorFunction%":E,"%Int8Array%":typeof Int8Array>"u"?void 0:Int8Array,"%Int16Array%":typeof Int16Array>"u"?void 0:Int16Array,"%Int32Array%":typeof Int32Array>"u"?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":T?C(C([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%Map%":typeof Map>"u"?void 0:Map,"%MapIteratorPrototype%":typeof Map<"u"&&T?C((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?void 0:Promise,"%Proxy%":typeof Proxy>"u"?void 0:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?void 0:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?void 0:Set,"%SetIteratorPrototype%":typeof Set<"u"&&T?C((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":T?C(""[Symbol.iterator]()):void 0,"%Symbol%":T?Symbol:void 0,"%SyntaxError%":I,"%ThrowTypeError%":x,"%TypedArray%":o,"%TypeError%":D,"%Uint8Array%":typeof Uint8Array>"u"?void 0:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?void 0:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?void 0:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?void 0:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?void 0:WeakMap,"%WeakRef%":typeof WeakRef>"u"?void 0:WeakRef,"%WeakSet%":typeof WeakSet>"u"?void 0:WeakSet},f=function S(y){var P;if("%AsyncFunction%"===y)P=_("async function () {}");else if("%GeneratorFunction%"===y)P=_("function* () {}");else if("%AsyncGeneratorFunction%"===y)P=_("async function* () {}");else if("%AsyncGenerator%"===y){var M=S("%AsyncGeneratorFunction%");M&&(P=M.prototype)}else if("%AsyncIteratorPrototype%"===y){var B=S("%AsyncGenerator%");B&&(P=C(B.prototype))}return g[y]=P,P},u={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},A=F(9),v=F(46),a=A.call(Function.call,Array.prototype.concat),s=A.call(Function.apply,Array.prototype.splice),h=A.call(Function.call,String.prototype.replace),m=A.call(Function.call,String.prototype.slice),c=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,d=/\\(\\)?/g,n=function(S){var y=m(S,0,1),P=m(S,-1);if("%"===y&&"%"!==P)throw new I("invalid intrinsic syntax, expected closing `%`");if("%"===P&&"%"!==y)throw new I("invalid intrinsic syntax, expected opening `%`");var M=[];return h(S,c,function(B,G,N,q){M[M.length]=N?h(q,d,"$1"):G||B}),M},p=function(S,y){var P,M=S;if(v(u,M)&&(M="%"+(P=u[M])[0]+"%"),v(g,M)){var B=g[M];if(B===E&&(B=f(M)),void 0===B&&!y)throw new D("intrinsic "+S+" exists, but is not available. Please file an issue!");return{alias:P,name:M,value:B}}throw new I("intrinsic "+S+" does not exist!")};U.exports=function(S,y){if("string"!=typeof S||0===S.length)throw new D("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof y)throw new D('"allowMissing" argument must be a boolean');var P=n(S),M=P.length>0?P[0]:"",B=p("%"+M+"%",y),G=B.name,N=B.value,q=!1,H=B.alias;H&&(M=H[0],s(P,a([0,1],H)));for(var V=1,Y=!0;V<P.length;V+=1){var X=P[V],Z=m(X,0,1),te=m(X,-1);if(('"'===Z||"'"===Z||"`"===Z||'"'===te||"'"===te||"`"===te)&&Z!==te)throw new I("property names with quotes must have matching quotes");if("constructor"!==X&&Y||(q=!0),v(g,G="%"+(M+="."+X)+"%"))N=g[G];else if(null!=N){if(!(X in N)){if(!y)throw new D("base intrinsic for "+S+" exists, but the property is not available.");return}if(b&&V+1>=P.length){var re=b(N,X);N=(Y=!!re)&&"get"in re&&!("originalValue"in re.get)?re.get:N[X]}else Y=v(N,X),N=N[X];Y&&!q&&(g[G]=N)}}return N}},function(U,L,F){"use strict";var I=F(45);U.exports=Function.prototype.bind||I},function(U,L,F){"use strict";var I=String.prototype.replace,R=/%20/g,D_RFC3986="RFC3986";U.exports={default:D_RFC3986,formatters:{RFC1738:function(_){return I.call(_,R,"+")},RFC3986:function(_){return String(_)}},RFC1738:"RFC1738",RFC3986:D_RFC3986}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.findMediaElement=L.getMuxPlayerId=void 0;var I=F(6),R=function(_){return _&&void 0!==_.nodeName?(_.muxId||(_.muxId=_.id||(0,I.generateShortID)()),_.muxId):_};L.getMuxPlayerId=R,L.findMediaElement=function(_){var b=void 0;return _&&void 0!==_.nodeName?_=R(b=_):b=document.querySelector(_),[b,_,b&&b.nodeName?b.nodeName.toLowerCase():""]}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(){return"1"===(D.default.doNotTrack||D.default.navigator&&(D.default.navigator.doNotTrack||D.default.navigator.msDoNotTrack))};var _,D=(_=F(0))&&_.__esModule?_:{default:_}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(0))&&_.__esModule?_:{default:_},D={exists:function(){var _=R.default.performance;return void 0!==(_&&_.timing)},domContentLoadedEventEnd:function(){var _=R.default.performance,b=_&&_.timing;return b&&b.domContentLoadedEventEnd},navigationStart:function(){var _=R.default.performance,b=_&&_.timing;return b&&b.navigationStart}};L.default=D},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function(R){var D={};for(var _ in R){var b=R[_];-1!==b["DATA-ID"].search("io.litix.data.")&&(D[b["DATA-ID"].replace("io.litix.data.","")]=b.VALUE)}return D}},function(U,L,F){"use strict";var I=F(41),R=F(51),D=F(10);U.exports={formats:D,parse:R,stringify:I}},function(U,L,F){"use strict";var I=F(10),R=Object.prototype.hasOwnProperty,D=Array.isArray,_=function(){for(var v=[],a=0;a<256;++a)v.push("%"+((a<16?"0":"")+a.toString(16)).toUpperCase());return v}(),k=function(v,a){for(var s=a&&a.plainObjects?Object.create(null):{},h=0;h<v.length;++h)void 0!==v[h]&&(s[h]=v[h]);return s};U.exports={arrayToObject:k,assign:function(v,a){return Object.keys(a).reduce(function(s,h){return s[h]=a[h],s},v)},combine:function(v,a){return[].concat(v,a)},compact:function(v){for(var a=[{obj:{o:v},prop:"o"}],s=[],h=0;h<a.length;++h)for(var m=a[h],c=m.obj[m.prop],d=Object.keys(c),n=0;n<d.length;++n){var p=d[n],S=c[p];"object"==typeof S&&null!==S&&-1===s.indexOf(S)&&(a.push({obj:c,prop:p}),s.push(S))}return function(v){for(;v.length>1;){var a=v.pop(),s=a.obj[a.prop];if(D(s)){for(var h=[],m=0;m<s.length;++m)void 0!==s[m]&&h.push(s[m]);a.obj[a.prop]=h}}}(a),v},decode:function(v,a,s){var h=v.replace(/\+/g," ");if("iso-8859-1"===s)return h.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(h)}catch{return h}},encode:function(v,a,s,h,m){if(0===v.length)return v;var c=v;if("symbol"==typeof v?c=Symbol.prototype.toString.call(v):"string"!=typeof v&&(c=String(v)),"iso-8859-1"===s)return escape(c).replace(/%u[0-9a-f]{4}/gi,function(S){return"%26%23"+parseInt(S.slice(2),16)+"%3B"});for(var d="",n=0;n<c.length;++n){var p=c.charCodeAt(n);45===p||46===p||95===p||126===p||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||m===I.RFC1738&&(40===p||41===p)?d+=c.charAt(n):p<128?d+=_[p]:p<2048?d+=_[192|p>>6]+_[128|63&p]:p<55296||p>=57344?d+=_[224|p>>12]+_[128|p>>6&63]+_[128|63&p]:(p=65536+((1023&p)<<10|1023&c.charCodeAt(n+=1)),d+=_[240|p>>18]+_[128|p>>12&63]+_[128|p>>6&63]+_[128|63&p])}return d},isBuffer:function(v){return!(!v||"object"!=typeof v||!(v.constructor&&v.constructor.isBuffer&&v.constructor.isBuffer(v)))},isRegExp:function(v){return"[object RegExp]"===Object.prototype.toString.call(v)},maybeMap:function(v,a){if(D(v)){for(var s=[],h=0;h<v.length;h+=1)s.push(a(v[h]));return s}return a(v)},merge:function v(a,s,h){if(!s)return a;if("object"!=typeof s){if(D(a))a.push(s);else{if(!a||"object"!=typeof a)return[a,s];(h&&(h.plainObjects||h.allowPrototypes)||!R.call(Object.prototype,s))&&(a[s]=!0)}return a}if(!a||"object"!=typeof a)return[a].concat(s);var m=a;return D(a)&&!D(s)&&(m=k(a,h)),D(a)&&D(s)?(s.forEach(function(c,d){if(R.call(a,d)){var n=a[d];n&&"object"==typeof n&&c&&"object"==typeof c?a[d]=v(n,c,h):a.push(c)}else a[d]=c}),a):Object.keys(s).reduce(function(c,d){var n=s[d];return c[d]=R.call(c,d)?v(c[d],n,h):n,c},m)}}},function(U,L,F){"use strict";function I(g){return g&&g.__esModule?g:{default:g}}function R(g){var f={};for(var u in g)g.hasOwnProperty(u)&&(f[g[u]]=u);return f}Object.defineProperty(L,"__esModule",{value:!0}),L.default=function D(g){var f={},u={};return Object.keys(g).forEach(function(A){var v=!1;if(g.hasOwnProperty(A)&&void 0!==g[A]){var a=A.split("_"),s=a[0],h=C[s];h||(b.default.info("Data key word `"+a[0]+"` not expected in "+A),h=s+"_"),a.splice(1).forEach(function(m){"url"===m&&(v=!0),o[m]?h+=o[m]:Number(m)&&Math.floor(Number(m))===Number(m)?h+=m:(b.default.info("Data key word `"+m+"` not expected in "+A),h+="_"+m+"_")}),v?u[h]=g[A]:f[h]=g[A]}}),(0,x.default)(f,u)};var b=I(F(4)),x=I(F(1)),C=R({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",i:"internal",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),o=R({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",ed:"edge",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",ep:"experiments",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"})},function(U,L,F){"use strict";U.exports=F(19).default},function(U,L,F){"use strict";function I(d){return d&&d.__esModule?d:{default:d}}Object.defineProperty(L,"__esModule",{value:!0});var R=function(n,p){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return function d(n,p){var S=[],y=!0,P=!1,M=void 0;try{for(var B,G=n[Symbol.iterator]();!(y=(B=G.next()).done)&&(S.push(B.value),!p||S.length!==p);y=!0);}catch(N){P=!0,M=N}finally{try{!y&&G.return&&G.return()}finally{if(P)throw M}}return S}(n,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_=I(F(0)),b=F(11),x=I(F(4)),C=I(F(12)),o=I(F(2)),f=I(F(22)),A=I(F(58)),a=I(F(59)),h=I(F(64)),m={},c=function d(n){var p=arguments;"string"==typeof n?d.hasOwnProperty(n)?_.default.setTimeout(function(){p=Array.prototype.splice.call(p,1),d[n].apply(null,p)},0):x.default.warn("`"+n+"` is an unknown task"):"function"==typeof n?_.default.setTimeout(function(){n(d)},0):x.default.warn("`"+n+"` is invalid.")};c.loaded=o.default.now(),c.NAME="mux-embed",c.VERSION="4.9.1",c.API_VERSION="2.1",c.PLAYER_TRACKED=!1,c.monitor=function(d,n){return(0,A.default)(c,d,n)},c.destroyMonitor=function(d){var n=(0,b.findMediaElement)(d),S=R(n,1)[0];S&&S.mux&&"function"==typeof S.mux.destroy?S.mux.destroy():x.default.error("A video element monitor for `"+d+"` has not been initialized via `mux.monitor`.")},c.addHLSJS=function(d,n){var p=(0,b.getMuxPlayerId)(d);m[p]?m[p].addHLSJS(n):x.default.error("A monitor for `"+p+"` has not been initialized.")},c.addDashJS=function(d,n){var p=(0,b.getMuxPlayerId)(d);m[p]?m[p].addDashJS(n):x.default.error("A monitor for `"+p+"` has not been initialized.")},c.removeHLSJS=function(d){var n=(0,b.getMuxPlayerId)(d);m[n]?m[n].removeHLSJS():x.default.error("A monitor for `"+n+"` has not been initialized.")},c.removeDashJS=function(d){var n=(0,b.getMuxPlayerId)(d);m[n]?m[n].removeDashJS():x.default.error("A monitor for `"+n+"` has not been initialized.")},c.init=function(d,n){(0,C.default)()&&n&&n.respectDoNotTrack&&x.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var p=(0,b.getMuxPlayerId)(d);m[p]=new f.default(c,p,n)},c.emit=function(d,n,p){var S=(0,b.getMuxPlayerId)(d);m[S]?(m[S].emit(n,p),"destroy"===n&&delete m[S]):x.default.error("A monitor for `"+S+"` has not been initialized.")},void 0!==_.default&&"function"==typeof _.default.addEventListener&&_.default.addEventListener("pagehide",function(d){d.persisted||(c.WINDOW_UNLOADING=!0)},!1),c.checkDoNotTrack=C.default,c.log=x.default,c.utils=a.default,c.events=h.default,L.default=c},function(U,L){var F;F=function(){return this}();try{F=F||Function("return this")()||(0,eval)("this")}catch{"object"==typeof window&&(F=window)}U.exports=F},function(U,L,F){var I,R;!function(D,_){"use strict";void 0!==(R="function"==typeof(I=function(){function D(a,s){var h=a[s];if("function"==typeof h.bind)return h.bind(a);try{return Function.prototype.bind.call(h,a)}catch{return function(){return Function.prototype.apply.apply(h,[a,arguments])}}}function _(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function b(a){return"debug"===a&&(a="log"),typeof console!==o&&("trace"===a&&g?_:void 0!==console[a]?D(console,a):void 0!==console.log?D(console,"log"):E)}function k(a,s){for(var h=0;h<f.length;h++){var m=f[h];this[m]=h<a?E:this.methodFactory(m,a,s)}this.log=this.debug}function x(a,s,h){return function(){typeof console!==o&&(k.call(this,s,h),this[a].apply(this,arguments))}}function T(a,s,h){return b(a)||x.apply(this,arguments)}function C(a,s,h){function m(P){var M=(f[P]||"silent").toUpperCase();if(typeof window!==o&&S){try{return void(window.localStorage[S]=M)}catch{}try{window.document.cookie=encodeURIComponent(S)+"="+M+";"}catch{}}}function c(){var P;if(typeof window!==o&&S){try{P=window.localStorage[S]}catch{}if(typeof P===o)try{var M=window.document.cookie,B=M.indexOf(encodeURIComponent(S)+"=");-1!==B&&(P=/^([^;]+)/.exec(M.slice(B))[1])}catch{}return void 0===p.levels[P]&&(P=void 0),P}}function d(){if(typeof window!==o&&S){try{return void window.localStorage.removeItem(S)}catch{}try{window.document.cookie=encodeURIComponent(S)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}var n,p=this;s=s??"WARN";var S="loglevel";"string"==typeof a?S+=":"+a:"symbol"==typeof a&&(S=void 0),p.name=a,p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=h||T,p.getLevel=function(){return n},p.setLevel=function(P,M){if("string"==typeof P&&void 0!==p.levels[P.toUpperCase()]&&(P=p.levels[P.toUpperCase()]),!("number"==typeof P&&P>=0&&P<=p.levels.SILENT))throw"log.setLevel() called with invalid level: "+P;if(n=P,!1!==M&&m(P),k.call(p,P,a),typeof console===o&&P<p.levels.SILENT)return"No console available for logging"},p.setDefaultLevel=function(P){s=P,c()||p.setLevel(P,!1)},p.resetLevel=function(){p.setLevel(s,!1),d()},p.enableAll=function(P){p.setLevel(p.levels.TRACE,P)},p.disableAll=function(P){p.setLevel(p.levels.SILENT,P)};var y=c();null==y&&(y=s),p.setLevel(y,!1)}var E=function(){},o="undefined",g=typeof window!==o&&typeof window.navigator!==o&&/Trident\/|MSIE /.test(window.navigator.userAgent),f=["trace","debug","info","warn","error"],u=new C,A={};u.getLogger=function(a){if("symbol"!=typeof a&&"string"!=typeof a||""===a)throw new TypeError("You must supply a name when creating a logger.");var s=A[a];return s||(s=A[a]=new C(a,u.getLevel(),u.methodFactory)),s};var v=typeof window!==o?window.log:void 0;return u.noConflict=function(){return typeof window!==o&&window.log===u&&(window.log=v),u},u.getLoggers=function(){return A},u.default=u,u})?I.call(L,F,L,U):I)&&(U.exports=R)}()},function(U,L,F){"use strict";function I(ee){return ee&&ee.__esModule?ee:{default:ee}}Object.defineProperty(L,"__esModule",{value:!0});var R=function(de,pe){if(Array.isArray(de))return de;if(Symbol.iterator in Object(de))return function ee(de,pe){var _e=[],Ie=!0,Ae=!1,Re=void 0;try{for(var Ne,Me=de[Symbol.iterator]();!(Ie=(Ne=Me.next()).done)&&(_e.push(Ne.value),!pe||_e.length!==pe);Ie=!0);}catch(Oe){Ae=!0,Re=Oe}finally{try{!Ie&&Me.return&&Me.return()}finally{if(Ae)throw Re}}return _e}(de,pe);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_=I(F(4)),k=I(F(1)),x=F(6),T=F(5),E=I(F(0)),g=I(F(13)),u=I(F(3)),A=F(23),v=F(24),s=I(F(25)),m=I(F(26)),d=I(F(27)),p=I(F(28)),y=I(F(29)),M=I(F(30)),G=I(F(31)),q=I(F(32)),V=I(F(33)),X=I(F(34)),te=I(F(35)),ne=I(F(36)),be=I(F(37)),ye=I(F(38)),Ce=I(F(39)),ae=I(F(57)),ce=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],oe=function(ee,de,pe){var _e=this;this.DOM_CONTENT_LOADED_EVENT_END=g.default.domContentLoadedEventEnd(),this.NAVIGATION_START=g.default.navigationStart();this.mux=ee,this.id=de,(pe=(0,k.default)({debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,disablePlayheadRebufferTracking:!1,errorTranslator:function(Oe){return Oe}},pe)).data=pe.data||{},pe.data.property_key&&(pe.data.env_key=pe.data.property_key,delete pe.data.property_key),_.default.setLevel(pe.debug?"debug":"warn"),this.getPlayheadTime=pe.getPlayheadTime,this.getStateData=pe.getStateData||function(){},this.getAdData=pe.getAdData||function(){},this.minimumRebufferDuration=pe.minimumRebufferDuration,this.sustainedRebufferThreshold=pe.sustainedRebufferThreshold,this.playbackHeartbeatTime=pe.playbackHeartbeatTime,this.disableRebufferTracking=pe.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=pe.errorTranslator,this.playbackEventDispatcher=new Ce.default(ee,pe.data.env_key,pe),this.data={player_instance_id:(0,x.generateUUID)(),mux_sample_rate:pe.sampleRate,beacon_domain:pe.beaconCollectionDomain?pe.beaconCollectionDomain:pe.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(Oe,Ue){Ue=(0,k.default)({viewer_time:this.mux.utils.now()},Ue),this.oldEmit(Oe,Ue)};var Ae=function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",function(Oe,Ue){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,k.default)(this.data,Ue),this._initializeViewData(),this.one("play",Ae),this.one("adbreakstart",Ae)});var Re=function(Oe){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",Oe)}.bind(this);if(this.on("videochange",function(Oe,Ue){Re(Ue)}),this.on("programchange",function(Oe,Ue){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),Re((0,k.default)(Ue,{view_program_changed:!0})),Ae(),this.emit("play"),this.emit("playing")}),this.on("fragmentchange",function(Oe,Ue){this.currentFragmentPDT=Ue.currentFragmentPDT,this.currentFragmentStart=Ue.currentFragmentStart}),this.on("destroy",this.destroy),void 0!==E.default&&"function"==typeof E.default.addEventListener&&"function"==typeof E.default.removeEventListener){var Ne=function(Oe){Oe.persisted||_e.destroy()};E.default.addEventListener("pagehide",Ne,!1),this.on("destroy",function(){E.default.removeEventListener("pagehide",Ne)})}this.on("playerready",function(Oe,Ue){(0,k.default)(this.data,Ue)}),ce.forEach(function(Oe){_e.on(Oe,function(Ue,We){0!==Oe.indexOf("ad")&&this._updateStateData(),(0,k.default)(this.data,We),this._sanitizeData()}),_e.on("after"+Oe,function(){("error"!==Oe||this.viewErrored)&&this.send(Oe)})}),this.on("viewend",function(Oe,Ue){(0,k.default)(_e.data,Ue)}),this.one("playerready",function(Oe){var Ue=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=Ue-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time}),d.default.apply(this),ye.default.apply(this),te.default.apply(this),M.default.apply(this),m.default.apply(this),X.default.apply(this),p.default.apply(this),y.default.apply(this),ne.default.apply(this),G.default.apply(this),q.default.apply(this),V.default.apply(this),be.default.apply(this),ae.default.apply(this),pe.hlsjs&&this.addHLSJS(pe),pe.dashjs&&this.addDashJS(pe),this.emit("viewinit",pe.data)};(0,k.default)(oe.prototype,s.default.prototype),(0,k.default)(oe.prototype,M.default.prototype),(0,k.default)(oe.prototype,te.default.prototype),(0,k.default)(oe.prototype,m.default.prototype),(0,k.default)(oe.prototype,p.default.prototype),(0,k.default)(oe.prototype,y.default.prototype),(0,k.default)(oe.prototype,ne.default.prototype),(0,k.default)(oe.prototype,q.default.prototype),(0,k.default)(oe.prototype,V.default.prototype),oe.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),E.default.clearTimeout(this._heartBeatTimeout))},oe.prototype.send=function(ee){var de=(0,k.default)({},this.data);if(void 0===de.video_source_is_live&&(de.player_source_duration===1/0||de.video_source_duration===1/0?de.video_source_is_live=!0:(de.player_source_duration>0||de.video_source_duration>0)&&(de.video_source_is_live=!1)),de.video_source_is_live||["player_program_time","player_manifest_newest_program_time","player_live_edge_program_time","player_program_time","video_holdback","video_part_holdback","video_target_duration","video_part_target_duration"].forEach(function(Ne){de[Ne]=void 0}),de.video_source_url=de.video_source_url||de.player_source_url,de.video_source_url){var _e=(0,T.extractHostnameAndDomain)(de.video_source_url),Ie=R(_e,2),Ae=Ie[0];de.video_source_domain=Ie[1],de.video_source_hostname=Ae}delete de.ad_request_id,this.playbackEventDispatcher.send(ee,de),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},oe.prototype._updateStateData=function(){(0,k.default)(this.data,this.getStateData()),this._updatePlayheadTime(),this._sanitizeData()},oe.prototype._sanitizeData=function(){var ee=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(de){var pe=parseInt(ee.data[de],10);ee.data[de]=isNaN(pe)?void 0:pe}),["player_source_url","video_source_url"].forEach(function(de){if(ee.data[de]){var pe=ee.data[de].toLowerCase();0!==pe.indexOf("data:")&&0!==pe.indexOf("blob:")||(ee.data[de]="MSE style URL")}})},oe.prototype._resetVideoData=function(ee,de){var pe=this;Object.keys(this.data).forEach(function(_e){0===_e.indexOf("video_")&&delete pe.data[_e]})},oe.prototype._resetViewData=function(){var ee=this;Object.keys(this.data).forEach(function(de){0===de.indexOf("view_")&&delete ee.data[de]}),this.data.view_sequence_number=1},oe.prototype._resetErrorData=function(ee,de){delete this.data.player_error_code,delete this.data.player_error_message},oe.prototype._initializeViewData=function(){var ee=this,de=this.data.view_id=(0,x.generateUUID)(),pe=function(){de===ee.data.view_id&&(0,u.default)(ee.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",pe):pe()},oe.prototype._restartHeartBeat=function(){var ee=this;E.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=E.default.setTimeout(function(){ee.data.player_is_paused||ee.emit("hb")},1e4))},oe.prototype.addHLSJS=function(ee){return ee.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=ee.hlsjs,void(0,A.monitorHlsJs)(this.mux,this.id,ee.hlsjs,{},ee.Hls||E.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},oe.prototype.removeHLSJS=function(){this.hlsjs&&((0,A.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},oe.prototype.addDashJS=function(ee){return ee.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=ee.dashjs,void(0,v.monitorDashJS)(this.mux,this.id,ee.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},oe.prototype.removeDashJS=function(){this.dashjs&&((0,v.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},L.default=oe},function(U,L,F){"use strict";function I(f){return f&&f.__esModule?f:{default:f}}Object.defineProperty(L,"__esModule",{value:!0}),L.stopMonitoringHlsJs=L.monitorHlsJs=void 0;var D=I(F(7)),b=I(F(13)),k=F(5),T=I(F(14)),C=function(f){if(!f)return{};var u=b.default.navigationStart(),A=f.loading,a=A?A.first:f.tfirst,s=A?A.end:f.tload;return{bytesLoaded:f.total,requestStart:Math.round(u+(A?A.start:f.trequest)),responseStart:Math.round(u+a),responseEnd:Math.round(u+s)}},E=function(f){if(f&&"function"==typeof f.getAllResponseHeaders)return(0,D.default)(f.getAllResponseHeaders())};L.monitorHlsJs=function(f,u,A){var v=arguments[4],a=f.log,s=f.utils.secondsToMs,h=function(B){var G=parseInt(v.version),N=void 0;return 1===G&&null!==B.programDateTime&&(N=B.programDateTime),0===G&&null!==B.pdt&&(N=B.pdt),N};if(b.default.exists()){var m=function(B,G){return f.emit(u,B,G)},c=function(B,G){var N=G.levels,q=G.audioTracks,H=G.url,V=G.stats,Y=G.networkDetails,Z={},te={},re={};re=(0,T.default)(G.sessionData),N.forEach(function(Te,Ce){Z[Ce]={width:Te.width,height:Te.height,bitrate:Te.bitrate,attrs:Te.attrs}}),q.forEach(function(Te,Ce){te[Ce]={name:Te.name,language:Te.lang,bitrate:Te.bitrate}});var ne=C(V),he=ne.bytesLoaded,be=ne.requestStart,me=ne.responseStart,ye=ne.responseEnd;re.request_event_type=B,re.request_bytes_loaded=he,re.request_start=be,re.request_response_start=me,re.request_response_end=ye,re.request_type="manifest",re.request_hostname=(0,k.extractHostname)(H),re.request_response_headers=E(Y),re.request_rendition_lists={media:Z,audio:te,video:{}},m("requestcompleted",re)};A.on(v.Events.MANIFEST_LOADED,c);var d=function(B,G){var N=G.details,q=G.level,H=G.networkDetails,Y=C(G.stats),X=Y.bytesLoaded,Z=Y.requestStart,te=Y.responseStart,re=Y.responseEnd,ne=N.fragments[N.fragments.length-1],he=h(ne)+s(ne.duration);m("requestcompleted",{request_event_type:B,request_bytes_loaded:X,request_start:Z,request_response_start:te,request_response_end:re,request_current_level:q,request_type:"manifest",request_hostname:(0,k.extractHostname)(N.url),request_response_headers:E(H),video_holdback:N.holdBack&&s(N.holdBack),video_part_holdback:N.partHoldBack&&s(N.partHoldBack),video_part_target_duration:N.partTarget&&s(N.partTarget),video_target_duration:N.targetduration&&s(N.targetduration),video_source_is_live:N.live,player_manifest_newest_program_time:isNaN(he)?void 0:he})};A.on(v.Events.LEVEL_LOADED,d);var n=function(B,G){var N=G.details,q=G.networkDetails,V=C(G.stats);m("requestcompleted",{request_event_type:B,request_bytes_loaded:V.bytesLoaded,request_start:V.requestStart,request_response_start:V.responseStart,request_response_end:V.responseEnd,request_type:"manifest",request_hostname:(0,k.extractHostname)(N.url),request_response_headers:E(q)})};A.on(v.Events.AUDIO_TRACK_LOADED,n);var p=function(B,G){var q=G.networkDetails,H=G.frag,V=C(G.stats),re={request_event_type:B,request_bytes_loaded:V.bytesLoaded,request_start:V.requestStart,request_response_start:V.responseStart,request_response_end:V.responseEnd,request_hostname:q?(0,k.extractHostname)(q.responseURL):void 0,request_response_headers:E(q),request_media_duration:H.duration};"main"===H.type?(re.request_type="media",re.request_current_level=H.level,re.request_video_width=(A.levels[H.level]||{}).width,re.request_video_height=(A.levels[H.level]||{}).height):re.request_type=H.type,m("requestcompleted",re)};A.on(v.Events.FRAG_LOADED,p);var S=function(B,G){var N=G.frag,q=N.start,V={currentFragmentPDT:h(N),currentFragmentStart:s(q)};m("fragmentchange",V)};A.on(v.Events.FRAG_CHANGED,S);var y=function(B,G){var N=G.type,q=G.details,H=G.response,V=G.fatal,Y=G.context,X=G.frag;if(q===v.ErrorDetails.MANIFEST_LOAD_ERROR||q===v.ErrorDetails.MANIFEST_LOAD_TIMEOUT||q===v.ErrorDetails.FRAG_LOAD_ERROR||q===v.ErrorDetails.FRAG_LOAD_TIMEOUT||q===v.ErrorDetails.LEVEL_LOAD_ERROR||q===v.ErrorDetails.LEVEL_LOAD_TIMEOUT){var Z=X&&X.url||Y&&Y.url||"";m("requestfailed",{request_error:q,request_url:Z,request_hostname:(0,k.extractHostname)(Z),request_type:q===v.ErrorDetails.FRAG_LOAD_ERROR||q===v.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:H&&H.code,request_error_text:H&&H.text})}V&&m("error",{player_error_code:N,player_error_message:q})};A.on(v.Events.ERROR,y);var P=function(B,G){var N=G.frag,q=N&&N._url||"";m("requestcanceled",{request_cancel:B,request_url:q,request_type:"media",request_hostname:(0,k.extractHostname)(q)})};A.on(v.Events.FRAG_LOAD_EMERGENCY_ABORTED,P);var M=function(B,G){var q=A.levels[G.level];if(q&&q.attrs&&q.attrs.BANDWIDTH){var H=q.attrs.BANDWIDTH;H?m("renditionchange",{video_source_bitrate:H,video_source_width:q.width,video_source_height:q.height}):a.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};A.on(v.Events.LEVEL_SWITCHED,M),A._stopMuxMonitor=function(){A.off(v.Events.MANIFEST_LOADED,c),A.off(v.Events.LEVEL_LOADED,d),A.off(v.Events.AUDIO_TRACK_LOADED,n),A.off(v.Events.FRAG_LOADED,p),A.off(v.Events.FRAG_CHANGED,S),A.off(v.Events.ERROR,y),A.off(v.Events.FRAG_LOAD_EMERGENCY_ABORTED,P),A.off(v.Events.LEVEL_SWITCHED,M),A.off(v.Events.DESTROYING,A._stopMuxMonitor),delete A._stopMuxMonitor},A.on(v.Events.DESTROYING,A._stopMuxMonitor)}else a.warn("performance timing not supported. Not tracking HLS.js.")},L.stopMonitoringHlsJs=function(f){f&&"function"==typeof f._stopMuxMonitor&&f._stopMuxMonitor()}},function(U,L,F){"use strict";function I(o){return o&&o.__esModule?o:{default:o}}Object.defineProperty(L,"__esModule",{value:!0}),L.stopMonitoringDashJS=L.monitorDashJS=void 0;var D=I(F(0)),b=I(F(7)),k=F(5),x=function(o,g){if(!o||"function"!=typeof o.getRequests)return{};var f=o.getRequests({state:"executed"});if(0===f.length)return{};var u=f[f.length-1],A=(0,k.extractHostname)(u.url),v=u.bytesLoaded,a=new Date(u.requestStartDate).getTime(),s=new Date(u.firstByteDate).getTime(),h=new Date(u.requestEndDate).getTime(),m=isNaN(u.duration)?0:u.duration,c="function"==typeof g.getMetricsFor?g.getMetricsFor(u.mediaType).HttpList:g.getDashMetrics().getHttpRequests(u.mediaType),d=void 0;return c.length>0&&(d=(0,b.default)(c[c.length-1]._responseHeaders||"")),{requestStart:a,requestResponseStart:s,requestResponseEnd:h,requestBytesLoaded:v,requestResponseHeaders:d,requestMediaDuration:m,requestHostname:A}};L.monitorDashJS=function(o,g,f){var u=o.log;if(f&&f.on){var A=function(p,S){return o.emit(g,p,S)},v=function(p){A("requestcompleted",{request_event_type:p.type,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,k.extractHostname)((p.data||{}).url)})};f.on("manifestLoaded",v);var a={},s=function(p){var S=p.type,y=p.fragmentModel,G=(p.chunk||{}).mediaInfo||{},N=G.type,q=G.bitrateList,H={};(q=q||[]).forEach(function(he,be){H[be]={},H[be].width=he.width,H[be].height=he.height,H[be].bitrate=he.bandwidth,H[be].attrs={}}),"video"===N?a.video=H:"audio"===N?a.audio=H:a.media=H;var V=x(y,f);A("requestcompleted",{request_event_type:S,request_start:V.requestStart,request_response_start:V.requestResponseStart,request_response_end:V.requestResponseEnd,request_bytes_loaded:-1,request_type:N+"_init",request_response_headers:V.requestResponseHeaders,request_hostname:V.requestHostname,request_media_duration:V.requestMediaDuration,request_rendition_lists:a})};f.on("initFragmentLoaded",s);var h=function(p){var S=p.type,M=p.chunk||{},G=M.start,q=(M.mediaInfo||{}).type,H=x(p.fragmentModel,f),V=H.requestStart,Y=H.requestResponseStart,X=H.requestResponseEnd,Z=H.requestBytesLoaded,te=H.requestResponseHeaders,re=H.requestMediaDuration,ne=H.requestHostname,he=function(o,g){var f=g.getQualityFor(o),A=g.getCurrentTrackFor(o).bitrateList;return A?{currentLevel:f,renditionWidth:A[f].width||null,renditionHeight:A[f].height||null,renditionBitrate:A[f].bandwidth}:{}}(q,f);A("requestcompleted",{request_event_type:S,request_start:V,request_response_start:Y,request_response_end:X,request_bytes_loaded:Z,request_type:q,request_response_headers:te,request_hostname:ne,request_media_start_time:G,request_media_duration:re,request_current_level:he.currentLevel,request_labeled_bitrate:he.renditionBitrate,request_video_width:he.renditionWidth,request_video_height:he.renditionHeight})};f.on("mediaFragmentLoaded",h);var m={video:void 0,audio:void 0,totalBitrate:void 0},d=function(p,S,y){if("number"==typeof p.newQuality){var P=p.mediaType;if("audio"===P||"video"===P){var M=f.getBitrateInfoListFor(P).find(function(G){return G.qualityIndex===p.newQuality});if(!M||"number"!=typeof M.bitrate)return void u.warn("missing bitrate info for "+P);m[P]=M;var B=function(){if(m.video&&"number"==typeof m.video.bitrate){if(!m.video.width||!m.video.height)return void u.warn("have bitrate info for video but missing width/height");var p=m.video.bitrate;return m.audio&&"number"==typeof m.audio.bitrate&&(p+=m.audio.bitrate),p!==m.totalBitrate?(m.totalBitrate=p,{video_source_bitrate:p,video_source_height:m.video.height,video_source_width:m.video.width}):void 0}}();B&&A("renditionchange",B)}}else u.warn("missing evt.newQuality in qualityChangeRendered event",p)};f.on("qualityChangeRendered",d);var n=function(p){var y=p.event,P=(y=y||{}).request||{},M=D.default.event&&D.default.event.currentTarget||{};A("requestfailed",{request_error:p.error+"_"+y.id+"_"+P.type,request_url:y.url,request_hostname:(0,k.extractHostname)(y.url),request_type:P.mediaType,request_error_code:M.status,request_error_type:M.statusText})};f.on("error",n),f._stopMuxMonitor=function(){f.off("manifestLoaded",v),f.off("initFragmentLoaded",s),f.off("mediaFragmentLoaded",h),f.off("qualityChangeRendered",d),f.off("error",n),delete f._stopMuxMonitor}}else u.warn("Invalid dash.js player reference. Monitoring blocked.")},L.stopMonitoringDashJS=function(o){o&&"function"==typeof o._stopMuxMonitor&&o._stopMuxMonitor()}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var I=function(){},R=0;I.prototype.on=function(D,_,b){return _._eventEmitterGuid=_._eventEmitterGuid||++R,this._listeners=this._listeners||{},this._listeners[D]=this._listeners[D]||[],b&&(_=_.bind(b)),this._listeners[D].push(_),_},I.prototype.off=function(D,_){var b=this._listeners&&this._listeners[D];b&&b.forEach(function(k,x){k._eventEmitterGuid===_._eventEmitterGuid&&b.splice(x,1)})},I.prototype.one=function(D,_,b){var k=this;_._eventEmitterGuid=_._eventEmitterGuid||++R;var x=function T(){k.off(D,T),_.apply(b||this,arguments)};x._eventEmitterGuid=_._eventEmitterGuid,this.on(D,x)},I.prototype.emit=function(D,_){var b=this;if(this._listeners){var x=this._listeners[D]||[],T=this._listeners["after"+D]||[],C=function(E,o){(E=E.slice()).forEach(function(g){g.call(b,{type:D},o)})};C(this._listeners["before*"]||[],_=_||{}),C(x,_),C(T,_)}},L.default=I},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(0))&&_.__esModule?_:{default:_},D=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",function(){this._playheadShouldBeProgressing=!0}),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("rebufferstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()}),this.on("timeupdate",function(){null!==this._playbackHeartbeatInterval&&this.emit("playbackheartbeat")}),this.on("devicesleep",function(_,b){null!==this._playbackHeartbeatInterval&&(R.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:b.viewer_time}),this._playbackHeartbeatInterval=null)})};D.prototype._startPlaybackHeartbeatInterval=function(){var _=this;null===this._playbackHeartbeatInterval&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=R.default.setInterval(function(){_.emit("playbackheartbeat")},this.playbackHeartbeatTime))},D.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(R.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},L.default=D},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(){var R=this;this.on("viewinit",function(){R.viewErrored=!1}),this.on("error",function(){try{var D=R.errorTranslator({player_error_code:R.data.player_error_code,player_error_message:R.data.player_error_message});D?(R.data.player_error_code=D.player_error_code,R.data.player_error_message=D.player_error_message,R.viewErrored=!0):(delete R.data.player_error_code,delete R.data.player_error_message)}catch(_){R.mux.log.warn("Exception in error translator callback.",_),R.viewErrored=!0}})}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(3))&&_.__esModule?_:{default:_},D=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};D.prototype._updateWatchTime=function(_,b){var k=b.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=k),(0,R.default)(this.data,"view_watch_time",k-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=k},D.prototype._clearWatchTimeState=function(_,b){this._updateWatchTime(_,b),this._watchTimeTrackerLastCheckedTime=null},L.default=D},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(3))&&_.__esModule?_:{default:_},D=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};D.prototype._updatePlaybackTime=function(){var _=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&_>this._playbackTimeTrackerLastPlayheadPosition){var b=_-this._playbackTimeTrackerLastPlayheadPosition;b<=1e3&&(0,R.default)(this.data,"view_content_playback_time",b)}this._playbackTimeTrackerLastPlayheadPosition=_},D.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},L.default=D},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var I=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",function(){this.off("timeupdate",this._updatePlayheadTime)})};I.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=void 0===this.data.view_max_playhead_position?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},I.prototype._updatePlayheadTime=function(R,D){var _=this,b=function(){_.currentFragmentPDT&&_.currentFragmentStart&&(_.data.player_program_time=_.currentFragmentPDT+_.data.player_playhead_time-_.currentFragmentStart)};if(D&&D.player_playhead_time)this.data.player_playhead_time=D.player_playhead_time,b(),this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var k=this.getPlayheadTime();void 0!==k&&(this.data.player_playhead_time=k,b(),this._updateMaxPlayheadPosition())}},L.default=I},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(){var _=this;if(!this.disableRebufferTracking){var b=void 0,k=function(){b&&((0,D.default)(_.data,"view_rebuffer_duration",_.data.viewer_time-b),b=_.data.viewer_time),_.data.view_watch_time>=0&&_.data.view_rebuffer_count>0&&(_.data.view_rebuffer_frequency=_.data.view_rebuffer_count/_.data.view_watch_time,_.data.view_rebuffer_percentage=_.data.view_rebuffer_duration/_.data.view_watch_time)};this.on("playbackheartbeat",function(){return k()}),this.on("rebufferstart",function(){b||((0,D.default)(_.data,"view_rebuffer_count",1),b=_.data.viewer_time,_.one("rebufferend",function(){k(),b=void 0}))})}};var _,D=(_=F(3))&&_.__esModule?_:{default:_}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(2))&&_.__esModule?_:{default:_},D=function(){this.disableRebufferTracking||this.disablePlayheadRebufferTracking||(this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",function(){this._cleanupRebufferTracker(null,{viewer_time:R.default.now()})}))};D.prototype._checkIfRebuffering=function(_,b){return this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing?void this._cleanupRebufferTracker(_,b):null===this._lastCheckedTime?void this._prepareRebufferTrackerState(b.viewer_time):this._lastPlayheadTime!==this.data.player_playhead_time?void this._cleanupRebufferTracker(_,b,!0):(b.viewer_time-this._lastPlayheadTimeUpdatedTime>=this.sustainedRebufferThreshold&&(this._rebuffering||(this._rebuffering=!0,this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}))),void(this._lastCheckedTime=b.viewer_time))},D.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},D.prototype._prepareRebufferTrackerState=function(_){this._lastCheckedTime=_,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=_},D.prototype._cleanupRebufferTracker=function(_,b){var k=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._rebuffering)this._rebuffering=!1,this.emit("rebufferend",{viewer_time:b.viewer_time});else{if(null===this._lastCheckedTime)return;var x=this.data.player_playhead_time-this._lastPlayheadTime,T=b.viewer_time-this._lastPlayheadTimeUpdatedTime;x>0&&T-x>this.minimumRebufferDuration&&(this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+T-x}))}k?this._prepareRebufferTrackerState(b.viewer_time):this._clearRebufferTrackerState()},L.default=D},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var _,R=(_=F(2))&&_.__esModule?_:{default:_},D=function(){this.on("viewinit",function(){var _=this.data,b=_.view_id;if(!_.view_program_changed){var k=function(x,T){var C=T.viewer_time;"playing"===x.type&&void 0===this.data.view_time_to_first_frame?this.calculateTimeToFirstFrame(C||R.default.now(),b):"adplaying"!==x.type||void 0!==this.data.view_time_to_first_frame&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(C||R.default.now(),b)};this.one("playing",k),this.one("adplaying",k),this.one("viewend",function(){this.off("playing",k),this.off("adplaying",k)})}})};D.prototype.calculateTimeToFirstFrame=function(_,b){b===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:_}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},L.default=D},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(){var _=this;this.on("viewinit",function(){this._lastPlayheadPosition=-1}),["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach(function(x){_.on(x,function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var T=this.data.player_playhead_time-this._lastPlayheadPosition;if(T<0)return void(this._lastPlayheadPosition=-1);var C=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),E=Math.max(0,C-1),o=Math.max(0,1-C);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,E),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,o),(0,D.default)(this.data,"view_total_content_playback_time",T),(0,D.default)(this.data,"view_total_upscaling",E*T),(0,D.default)(this.data,"view_total_downscaling",o*T)}this._lastPlayheadPosition=-1})}),["playing","hb"].forEach(function(x){_.on(x,function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height})})};var _,D=(_=F(3))&&_.__esModule?_:{default:_}},function(U,L,F){"use strict";function I(C){return C&&C.__esModule?C:{default:C}}Object.defineProperty(L,"__esModule",{value:!0}),L.default=function R(){this.isSeeking=!1,this.on("seeking",function(C,E){(0,T.default)(this.data,E),this._lastSeekingTime=_.default.now(),!1===this.isSeeking&&(this.isSeeking=!0,this.send("seeking"))}),this.on("seeked",function(){this.isSeeking=!1;var C=this._lastSeekingTime||_.default.now(),E=_.default.now()-C;(0,k.default)(this.data,"view_seek_count",1),(0,k.default)(this.data,"view_seek_duration",E),this.data.view_max_seek_time=Math.max(this.data.view_max_seek_time||0,E)}),this.on("viewend",function(){this.isSeeking=!1})};var _=I(F(2)),k=I(F(3)),T=I(F(1))},function(U,L,F){"use strict";function I(o){return o&&o.__esModule?o:{default:o}}Object.defineProperty(L,"__esModule",{value:!0});var R=function(g,f){if(Array.isArray(g))return g;if(Symbol.iterator in Object(g))return function o(g,f){var u=[],A=!0,v=!1,a=void 0;try{for(var s,h=g[Symbol.iterator]();!(A=(s=h.next()).done)&&(u.push(s.value),!f||u.length!==f);A=!0);}catch(m){v=!0,a=m}finally{try{!A&&h.return&&h.return()}finally{if(v)throw a}}return u}(g,f);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_=I(F(3)),b=F(5),x=I(F(1)),T=function(o,g){o.push(g),o.sort(function(f,u){return f.viewer_time-u.viewer_time})},C=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],E=function(){var o=this;this.on("viewinit",function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0}),C.forEach(function(f){return o.on(f,o._updateAdData)});var g=function(){o.isAdBreak=!1};this.on("adbreakstart",function(){this.isAdBreak=!0}),this.on("play",g),this.on("playing",g),this.on("viewend",g),this.on("adrequest",function(f,u){u=(0,x.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},u),T(this._adRequests,u),(0,_.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,_.default)(this.data,"view_preroll_request_count"))}),this.on("adresponse",function(f,u){u=(0,x.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},u),T(this._adResponses,u);var A=this.findAdRequest(u.ad_request_id);A&&(0,_.default)(this.data,"view_ad_request_time",Math.max(0,u.viewer_time-A.viewer_time))}),this.on("adplay",function(f,u){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,_.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,u.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,u.viewer_time-this.data.view_start)),this._prerollPlayTime=u.viewer_time)}),this.on("adplaying",function(f,u){this.inPrerollPosition()&&void 0===this.data.view_preroll_load_time&&void 0!==this._prerollPlayTime&&(this.data.view_preroll_load_time=u.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=u.viewer_time-this._prerollPlayTime)}),this.on("adended",function(){this._wouldBeNewAdPlay=!0}),this.on("aderror",function(){this._wouldBeNewAdPlay=!0})};E.prototype.inPrerollPosition=function(){return void 0===this.data.view_content_playback_time||this.data.view_content_playback_time<=1e3},E.prototype.findAdRequest=function(o){for(var g=0;g<this._adRequests.length;g++)if(this._adRequests[g].ad_request_id===o)return this._adRequests[g]},E.prototype._updateAdData=function(o,g){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&g.ad_tag_url){var f=(0,b.extractHostnameAndDomain)(g.ad_tag_url),u=R(f,2),A=u[0];this.data.view_preroll_ad_tag_domain=u[1],this.data.view_preroll_ad_tag_hostname=A}if(!this.data.view_preroll_ad_asset_hostname&&g.ad_asset_url){var a=(0,b.extractHostnameAndDomain)(g.ad_asset_url),s=R(a,2),h=s[0];this.data.view_preroll_ad_asset_domain=s[1],this.data.view_preroll_ad_asset_hostname=h}}},L.default=E},function(U,L,F){"use strict";function I(x){return x&&x.__esModule?x:{default:x}}Object.defineProperty(L,"__esModule",{value:!0}),L.default=function R(){var x=this,T=void 0,C=void 0,o=function(){x.disableRebufferTracking||T&&((0,k.default)(x.data,"view_waiting_rebuffer_duration",_.default.now()-T),T=!1,window.clearInterval(C))},g=!1,u=function(){g=!1,o()};this.on("waiting",function(){g&&(x.disableRebufferTracking||((0,k.default)(x.data,"view_waiting_rebuffer_count",1),T=_.default.now(),C=window.setInterval(function(){if(T){var A=_.default.now();(0,k.default)(x.data,"view_waiting_rebuffer_duration",A-T),T=A}},250)))}),this.on("playing",function(){o(),g=!0}),this.on("pause",u),this.on("seeking",u)};var _=I(F(2)),k=I(F(3))},function(U,L,F){"use strict";function I(C){return C&&C.__esModule?C:{default:C}}Object.defineProperty(L,"__esModule",{value:!0}),L.default=function R(){var C=this;this.one("playbackheartbeat",x),this.on("playbackheartbeatend",function(){C.off("before*",T),C.one("playbackheartbeat",x)})};var _=I(F(1)),k=I(F(2)),x=function(){this.lastWallClockTime=k.default.now(),this.on("before*",T)},T=function(C){var E=k.default.now(),o=this.lastWallClockTime;this.lastWallClockTime=E,E-o>3e4&&(this.emit("devicesleep",{viewer_time:o}),(0,_.default)(this.data,{viewer_time:o}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:E}),(0,_.default)(this.data,{viewer_time:E}),this.send("devicewake"))}},function(U,L,F){"use strict";function I(S){return S&&S.__esModule?S:{default:S}}Object.defineProperty(L,"__esModule",{value:!0});var R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(S){return typeof S}:function(S){return S&&"function"==typeof Symbol&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},_=I(F(0)),b=F(40),x=I(F(4)),C=I(F(53)),o=I(F(12)),f=I(F(54)),A=I(F(17)),a=I(F(55)),h=I(F(1)),m=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],c=["viewstart","error","ended","viewend"],d=function(S,y){var P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.mux=S,this.envKey=y,this.eventQueue=new a.default((0,C.default)(y,P)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=P.sampleRate,this.disableCookies=P.disableCookies,this.respectDoNotTrack=P.respectDoNotTrack;var M=P.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:M.name,viewer_application_version:M.version,viewer_application_engine:M.layout,viewer_device_name:M.product,viewer_device_category:"",viewer_device_manufacturer:M.manufacturer,viewer_os_family:M.os&&M.os.family,viewer_os_architecture:M.os&&M.os.architecture,viewer_os_version:M.os&&M.os.version};var B=(0,f.default)();B&&(this.pageLevelData=(0,h.default)(this.pageLevelData,{viewer_connection_type:B})),void 0!==_.default&&_.default.location&&_.default.location.href&&(this.pageLevelData.page_url=_.default.location.href),this.viewerData=this.disableCookies?{}:(0,b.getAndUpdateViewerData)()};d.prototype.send=function(S,y){if(S){if(this.respectDoNotTrack&&(0,o.default)())return x.default.info("Not sending `"+S+"` because Do Not Track is enabled");if(!y||"object"!==(void 0===y?"undefined":R(y)))return x.default.error("A data object was expected in send() but was not provided");var P=this.disableCookies?{}:(0,b.getAndUpdateSessionData)(),M={};(0,h.default)(M,this.pageLevelData),(0,h.default)(M,y),(0,h.default)(M,P),(0,h.default)(M,this.viewerData),M.event=S,M.env_key=this.envKey,M.user_id&&(M.viewer_user_id=M.user_id,delete M.user_id);var B=M.mux_sample_number>=this.sampleRate,G=this._deduplicateBeaconData(S,M),N=(0,A.default)(G);if(this.lastEventTime=this.mux.utils.now(),B)return x.default.info("Not sending event due to sample rate restriction",S,M,N);if(this.envKey||x.default.info("Missing environment key (envKey) - beacons will be dropped if the video source is not a valid mux video URL",S,M,N),!this.rateLimited)if(x.default.info("Sending event",S,M,N),this.rateLimited=!this.eventQueue.queueEvent(S,N),this.mux.WINDOW_UNLOADING&&"viewend"===S)this.eventQueue.destroy(!0);else if((c.indexOf(S)>=0||!1===this.mux.WINDOW_VISIBLE&&"hb"===S)&&this.eventQueue.flushEvents(),this.rateLimited)return M.event="eventrateexceeded",N=(0,A.default)(M),this.eventQueue.queueEvent(M.event,N),x.default.error("Beaconing disabled due to rate limit.")}},d.prototype.destroy=function(){this.eventQueue.destroy(!1)};d.prototype._deduplicateBeaconData=function(S,y){var P=this,M={},B=y.view_id;if(!B||"viewstart"===S||"viewend"===S||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)M=(0,h.default)({},y),B&&(this.previousBeaconData=M),B&&"viewend"===S&&(this.previousBeaconData=null);else{var G=0===S.indexOf("request");Object.keys(y).forEach(function(N){var q=y[N];(q!==P.previousBeaconData[N]||m.indexOf(N)>-1||function(S,y,P,M){return!(!S||0!==y.indexOf("request_")||"request_response_headers"!==y&&"object"===(void 0===P?"undefined":R(P))&&"object"===(void 0===M?"undefined":R(M))&&Object.keys(P||{}).length===Object.keys(M||{}).length)}(G,N,q,P.previousBeaconData[N])||function(S,y){return"renditionchange"===S&&0===y.indexOf("video_source_")}(S,N))&&(M[N]=q,P.previousBeaconData[N]=q)})}return M},L.default=d},function(U,L,F){"use strict";function I(f){return f&&f.__esModule?f:{default:f}}Object.defineProperty(L,"__esModule",{value:!0}),L.getAndUpdateSessionData=L.getAndUpdateViewerData=void 0;var D=I(F(15)),b=I(F(52)),k=F(6),T=I(F(2)),C=function(){var f=void 0;try{f=D.default.parse(b.default.get("muxData")||"")}catch{f={}}return f},E=function(f){try{b.default.set("muxData",D.default.stringify(f),{expires:7300})}catch{}};L.getAndUpdateViewerData=function(){var f=C();return f.mux_viewer_id=f.mux_viewer_id||(0,k.generateUUID)(),f.msn=f.msn||Math.random(),E(f),{mux_viewer_id:f.mux_viewer_id,mux_sample_number:f.msn}},L.getAndUpdateSessionData=function(){var f=C(),u=T.default.now();return f.session_start&&(f.sst=f.session_start,delete f.session_start),f.session_id&&(f.sid=f.session_id,delete f.session_id),f.session_expires&&(f.sex=f.session_expires,delete f.session_expires),(!f.sex||f.sex<u)&&(f.sid=(0,k.generateUUID)(),f.sst=u),f.sex=u+15e5,E(f),{session_id:f.sid,session_start:f.sst,session_expires:f.sex}}},function(U,L,F){"use strict";var I=F(42),R=F(16),D=F(10),_=Object.prototype.hasOwnProperty,b={brackets:function(a){return a+"[]"},comma:"comma",indices:function(a,s){return a+"["+s+"]"},repeat:function(a){return a}},k=Array.isArray,x=String.prototype.split,T=Array.prototype.push,C=function(a,s){T.apply(a,k(s)?s:[s])},E=Date.prototype.toISOString,o=D.default,g={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:R.encode,encodeValuesOnly:!1,format:o,formatter:D.formatters[o],indices:!1,serializeDate:function(a){return E.call(a)},skipNulls:!1,strictNullHandling:!1},u={},A=function a(s,h,m,c,d,n,p,S,y,P,M,B,G,N,q){for(var H=s,V=q,Y=0,X=!1;void 0!==(V=V.get(u))&&!X;){var Z=V.get(s);if(Y+=1,void 0!==Z){if(Z===Y)throw new RangeError("Cyclic object value");X=!0}void 0===V.get(u)&&(Y=0)}if("function"==typeof p?H=p(h,H):H instanceof Date?H=P(H):"comma"===m&&k(H)&&(H=R.maybeMap(H,function(oe){return oe instanceof Date?P(oe):oe})),null===H){if(c)return n&&!G?n(h,g.encoder,N,"key",M):h;H=""}if(function(a){return"string"==typeof a||"number"==typeof a||"boolean"==typeof a||"symbol"==typeof a||"bigint"==typeof a}(H)||R.isBuffer(H)){if(n){var te=G?h:n(h,g.encoder,N,"key",M);if("comma"===m&&G){for(var re=x.call(String(H),","),ne="",he=0;he<re.length;++he)ne+=(0===he?"":",")+B(n(re[he],g.encoder,N,"value",M));return[B(te)+"="+ne]}return[B(te)+"="+B(n(H,g.encoder,N,"value",M))]}return[B(h)+"="+B(String(H))]}var me,be=[];if(void 0===H)return be;if("comma"===m&&k(H))me=[{value:H.length>0?H.join(",")||null:void 0}];else if(k(p))me=p;else{var ye=Object.keys(H);me=S?ye.sort(S):ye}for(var Te=0;Te<me.length;++Te){var Ce=me[Te],ue="object"==typeof Ce&&void 0!==Ce.value?Ce.value:H[Ce];if(!d||null!==ue){var ae=k(H)?"function"==typeof m?m(h,Ce):h:h+(y?"."+Ce:"["+Ce+"]");q.set(s,Y);var ce=I();ce.set(u,q),C(be,a(ue,ae,m,c,d,n,p,S,y,P,M,B,G,N,ce))}}return be};U.exports=function(a,s){var h,c=a,d=function(a){if(!a)return g;if(null!=a.encoder&&"function"!=typeof a.encoder)throw new TypeError("Encoder has to be a function.");var s=a.charset||g.charset;if(void 0!==a.charset&&"utf-8"!==a.charset&&"iso-8859-1"!==a.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var h=D.default;if(void 0!==a.format){if(!_.call(D.formatters,a.format))throw new TypeError("Unknown format option provided.");h=a.format}var m=D.formatters[h],c=g.filter;return("function"==typeof a.filter||k(a.filter))&&(c=a.filter),{addQueryPrefix:"boolean"==typeof a.addQueryPrefix?a.addQueryPrefix:g.addQueryPrefix,allowDots:void 0===a.allowDots?g.allowDots:!!a.allowDots,charset:s,charsetSentinel:"boolean"==typeof a.charsetSentinel?a.charsetSentinel:g.charsetSentinel,delimiter:void 0===a.delimiter?g.delimiter:a.delimiter,encode:"boolean"==typeof a.encode?a.encode:g.encode,encoder:"function"==typeof a.encoder?a.encoder:g.encoder,encodeValuesOnly:"boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:g.encodeValuesOnly,filter:c,format:h,formatter:m,serializeDate:"function"==typeof a.serializeDate?a.serializeDate:g.serializeDate,skipNulls:"boolean"==typeof a.skipNulls?a.skipNulls:g.skipNulls,sort:"function"==typeof a.sort?a.sort:null,strictNullHandling:"boolean"==typeof a.strictNullHandling?a.strictNullHandling:g.strictNullHandling}}(s);"function"==typeof d.filter?c=(0,d.filter)("",c):k(d.filter)&&(h=d.filter);var n=[];if("object"!=typeof c||null===c)return"";var S=b[s&&s.arrayFormat in b?s.arrayFormat:s&&"indices"in s?s.indices?"indices":"repeat":"indices"];h||(h=Object.keys(c)),d.sort&&h.sort(d.sort);for(var y=I(),P=0;P<h.length;++P){var M=h[P];d.skipNulls&&null===c[M]||C(n,A(c[M],M,S,d.strictNullHandling,d.skipNulls,d.encode?d.encoder:null,d.filter,d.sort,d.allowDots,d.serializeDate,d.format,d.formatter,d.encodeValuesOnly,d.charset,y))}var B=n.join(d.delimiter),G=!0===d.addQueryPrefix?"?":"";return d.charsetSentinel&&(G+="iso-8859-1"===d.charset?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),B.length>0?G+B:""}},function(U,L,F){"use strict";var I=F(8),R=F(47),D=F(49),_=I("%TypeError%"),b=I("%WeakMap%",!0),k=I("%Map%",!0),x=R("WeakMap.prototype.get",!0),T=R("WeakMap.prototype.set",!0),C=R("WeakMap.prototype.has",!0),E=R("Map.prototype.get",!0),o=R("Map.prototype.set",!0),g=R("Map.prototype.has",!0),f=function(a,s){for(var h,m=a;null!==(h=m.next);m=h)if(h.key===s)return m.next=h.next,h.next=a.next,a.next=h,h};U.exports=function(){var a,s,h,m={assert:function(c){if(!m.has(c))throw new _("Side channel does not contain "+D(c))},get:function(c){if(b&&c&&("object"==typeof c||"function"==typeof c)){if(a)return x(a,c)}else if(k){if(s)return E(s,c)}else if(h)return function(a,s){var h=f(a,s);return h&&h.value}(h,c)},has:function(c){if(b&&c&&("object"==typeof c||"function"==typeof c)){if(a)return C(a,c)}else if(k){if(s)return g(s,c)}else if(h)return function(a,s){return!!f(a,s)}(h,c);return!1},set:function(c,d){b&&c&&("object"==typeof c||"function"==typeof c)?(a||(a=new b),T(a,c,d)):k?(s||(s=new k),o(s,c,d)):(h||(h={key:{},next:null}),function(a,s,h){var m=f(a,s);m?m.value=h:a.next={key:s,next:a.next,value:h}}(h,c,d))}};return m}},function(U,L,F){"use strict";var I=typeof Symbol<"u"&&Symbol,R=F(44);U.exports=function(){return"function"==typeof I&&"function"==typeof Symbol&&"symbol"==typeof I("foo")&&"symbol"==typeof Symbol("bar")&&R()}},function(U,L,F){"use strict";U.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var I={},R=Symbol("test"),D=Object(R);if("string"==typeof R||"[object Symbol]"!==Object.prototype.toString.call(R)||"[object Symbol]"!==Object.prototype.toString.call(D))return!1;for(R in I[R]=42,I)return!1;if("function"==typeof Object.keys&&0!==Object.keys(I).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(I).length)return!1;var _=Object.getOwnPropertySymbols(I);if(1!==_.length||_[0]!==R||!Object.prototype.propertyIsEnumerable.call(I,R))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var b=Object.getOwnPropertyDescriptor(I,R);if(42!==b.value||!0!==b.enumerable)return!1}return!0}},function(U,L,F){"use strict";var I=Array.prototype.slice,R=Object.prototype.toString;U.exports=function(D){var _=this;if("function"!=typeof _||"[object Function]"!==R.call(_))throw new TypeError("Function.prototype.bind called on incompatible "+_);for(var b,k=I.call(arguments,1),T=Math.max(0,_.length-k.length),C=[],E=0;E<T;E++)C.push("$"+E);if(b=Function("binder","return function ("+C.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof b){var g=_.apply(this,k.concat(I.call(arguments)));return Object(g)===g?g:this}return _.apply(D,k.concat(I.call(arguments)))}),_.prototype){var o=function(){};o.prototype=_.prototype,b.prototype=new o,o.prototype=null}return b}},function(U,L,F){"use strict";var I=F(9);U.exports=I.call(Function.call,Object.prototype.hasOwnProperty)},function(U,L,F){"use strict";var I=F(8),R=F(48),D=R(I("String.prototype.indexOf"));U.exports=function(_,b){var k=I(_,!!b);return"function"==typeof k&&D(_,".prototype.")>-1?R(k):k}},function(U,L,F){"use strict";var I=F(9),R=F(8),D=R("%Function.prototype.apply%"),_=R("%Function.prototype.call%"),b=R("%Reflect.apply%",!0)||I.call(_,D),k=R("%Object.getOwnPropertyDescriptor%",!0),x=R("%Object.defineProperty%",!0),T=R("%Math.max%");if(x)try{x({},"a",{value:1})}catch{x=null}U.exports=function(E){var o=b(I,_,arguments);return k&&x&&k(o,"length").configurable&&x(o,"length",{value:1+T(0,E.length-(arguments.length-1))}),o};var C=function(){return b(I,D,arguments)};x?x(U.exports,"apply",{value:C}):U.exports.apply=C},function(U,L,F){function I($,le){if($===1/0||$===-1/0||$!=$||$&&$>-1e3&&$<1e3||_e.call(/e/,le))return le;var je=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof $){var Fe=$<0?-Ne(-$):Ne($);if(Fe!==$){var Be=String(Fe),qe=oe.call(le,Be.length+1);return ee.call(Be,je,"$&_")+"."+ee.call(ee.call(qe,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ee.call(le,je,"$&_")}function R($,le,je){var Fe="double"===(je.quoteStyle||le)?'"':"'";return Fe+$+Fe}function D($){return ee.call(String($),/"/g,"&quot;")}function _($){return!("[object Array]"!==u($)||He&&"object"==typeof $&&He in $)}function o($){if(We)return $&&"object"==typeof $&&$ instanceof Symbol;if("symbol"==typeof $)return!0;if(!$||"object"!=typeof $||!Ue)return!1;try{return Ue.call($),!0}catch{}return!1}function f($,le){return it.call($,le)}function u($){return ue.call($)}function v($,le){if($.indexOf)return $.indexOf(le);for(var je=0,Fe=$.length;je<Fe;je++)if($[je]===le)return je;return-1}function n($,le){if($.length>le.maxStringLength){var je=$.length-le.maxStringLength,Fe="... "+je+" more character"+(je>1?"s":"");return n(oe.call($,0,le.maxStringLength),le)+Fe}return R(ee.call(ee.call($,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,p),"single",le)}function p($){var le=$.charCodeAt(0),je={8:"b",9:"t",10:"n",12:"f",13:"r"}[le];return je?"\\"+je:"\\x"+(le<16?"0":"")+de.call(le.toString(16))}function S($){return"Object("+$+")"}function y($){return $+" { ? }"}function P($,le,je,Fe){return $+" ("+le+") {"+(Fe?G(je,Fe):Ae.call(je,", "))+"}"}function G($,le){if(0===$.length)return"";var je="\n"+le.prev+le.base;return je+Ae.call($,","+je)+"\n"+le.prev}function N($,le){var je=_($),Fe=[];if(je){Fe.length=$.length;for(var Be=0;Be<$.length;Be++)Fe[Be]=f($,Be)?le($[Be],$):""}var qe,Pe="function"==typeof Oe?Oe($):[];if(We){qe={};for(var lt=0;lt<Pe.length;lt++)qe["$"+Pe[lt]]=Pe[lt]}for(var Ve in $)f($,Ve)&&(je&&String(Number(Ve))===Ve&&Ve<$.length||We&&qe["$"+Ve]instanceof Symbol||(_e.call(/[^\w$]/,Ve)?Fe.push(le(Ve,$)+": "+le($[Ve],$)):Fe.push(Ve+": "+le($[Ve],$))));if("function"==typeof Oe)for(var ct=0;ct<Pe.length;ct++)Ze.call($,Pe[ct])&&Fe.push("["+le(Pe[ct])+"]: "+le($[Pe[ct]],$));return Fe}var q="function"==typeof Map&&Map.prototype,H=Object.getOwnPropertyDescriptor&&q?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,V=q&&H&&"function"==typeof H.get?H.get:null,Y=q&&Map.prototype.forEach,X="function"==typeof Set&&Set.prototype,Z=Object.getOwnPropertyDescriptor&&X?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,te=X&&Z&&"function"==typeof Z.get?Z.get:null,re=X&&Set.prototype.forEach,he="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,me="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,Te="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,Ce=Boolean.prototype.valueOf,ue=Object.prototype.toString,ae=Function.prototype.toString,ce=String.prototype.match,oe=String.prototype.slice,ee=String.prototype.replace,de=String.prototype.toUpperCase,pe=String.prototype.toLowerCase,_e=RegExp.prototype.test,Ie=Array.prototype.concat,Ae=Array.prototype.join,Re=Array.prototype.slice,Ne=Math.floor,Me="function"==typeof BigInt?BigInt.prototype.valueOf:null,Oe=Object.getOwnPropertySymbols,Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,We="function"==typeof Symbol&&"object"==typeof Symbol.iterator,He="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol,1)?Symbol.toStringTag:null,Ze=Object.prototype.propertyIsEnumerable,Ye=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function($){return $.__proto__}:null),Qe=F(50).custom,tt=Qe&&o(Qe)?Qe:null;U.exports=function $(le,je,Fe,Be){function qe(kt,Mt,fr){if(Mt&&(Be=Re.call(Be)).push(Mt),fr){var sr={depth:Pe.depth};return f(Pe,"quoteStyle")&&(sr.quoteStyle=Pe.quoteStyle),$(kt,sr,Fe+1,Be)}return $(kt,Pe,Fe+1,Be)}var Pe=je||{};if(f(Pe,"quoteStyle")&&"single"!==Pe.quoteStyle&&"double"!==Pe.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(f(Pe,"maxStringLength")&&("number"==typeof Pe.maxStringLength?Pe.maxStringLength<0&&Pe.maxStringLength!==1/0:null!==Pe.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var lt=!f(Pe,"customInspect")||Pe.customInspect;if("boolean"!=typeof lt&&"symbol"!==lt)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(f(Pe,"indent")&&null!==Pe.indent&&"\t"!==Pe.indent&&!(parseInt(Pe.indent,10)===Pe.indent&&Pe.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(f(Pe,"numericSeparator")&&"boolean"!=typeof Pe.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ve=Pe.numericSeparator;if(void 0===le)return"undefined";if(null===le)return"null";if("boolean"==typeof le)return le?"true":"false";if("string"==typeof le)return n(le,Pe);if("number"==typeof le){if(0===le)return 1/0/le>0?"0":"-0";var ct=String(le);return Ve?I(le,ct):ct}if("bigint"==typeof le){var ht=String(le)+"n";return Ve?I(le,ht):ht}var gt=void 0===Pe.depth?5:Pe.depth;if(void 0===Fe&&(Fe=0),Fe>=gt&&gt>0&&"object"==typeof le)return _(le)?"[Array]":"[Object]";var Je=function B($,le){var je;if("\t"===$.indent)je="\t";else{if(!("number"==typeof $.indent&&$.indent>0))return null;je=Ae.call(Array($.indent+1)," ")}return{base:je,prev:Ae.call(Array(le+1),je)}}(Pe,Fe);if(void 0===Be)Be=[];else if(v(Be,le)>=0)return"[Circular]";if("function"==typeof le){var It=function A($){if($.name)return $.name;var le=ce.call(ae.call($),/^function\s*([\w$]+)/);return le?le[1]:null}(le),ft=N(le,qe);return"[Function"+(It?": "+It:" (anonymous)")+"]"+(ft.length>0?" { "+Ae.call(ft,", ")+" }":"")}if(o(le)){var Et=We?ee.call(String(le),/^(Symbol\(.*\))_[^)]*$/,"$1"):Ue.call(le);return"object"!=typeof le||We?Et:S(Et)}if(function d($){return!(!$||"object"!=typeof $)&&(typeof HTMLElement<"u"&&$ instanceof HTMLElement||"string"==typeof $.nodeName&&"function"==typeof $.getAttribute)}(le)){for(var mt="<"+pe.call(String(le.nodeName)),Rt=le.attributes||[],Tt=0;Tt<Rt.length;Tt++)mt+=" "+Rt[Tt].name+"="+R(D(Rt[Tt].value),"double",Pe);return mt+=">",le.childNodes&&le.childNodes.length&&(mt+="..."),mt+"</"+pe.call(String(le.nodeName))+">"}if(_(le)){if(0===le.length)return"[]";var Ot=N(le,qe);return Je&&!function M($){for(var le=0;le<$.length;le++)if(v($[le],"\n")>=0)return!1;return!0}(Ot)?"["+G(Ot,Je)+"]":"[ "+Ae.call(Ot,", ")+" ]"}if(function x($){return!("[object Error]"!==u($)||He&&"object"==typeof $&&He in $)}(le)){var yt=N(le,qe);return"cause"in le&&!Ze.call(le,"cause")?"{ ["+String(le)+"] "+Ae.call(Ie.call("[cause]: "+qe(le.cause),yt),", ")+" }":0===yt.length?"["+String(le)+"]":"{ ["+String(le)+"] "+Ae.call(yt,", ")+" }"}if("object"==typeof le&&lt){if(tt&&"function"==typeof le[tt])return le[tt]();if("symbol"!==lt&&"function"==typeof le.inspect)return le.inspect()}if(function a($){if(!V||!$||"object"!=typeof $)return!1;try{V.call($);try{te.call($)}catch{return!0}return $ instanceof Map}catch{}return!1}(le)){var Pt=[];return Y.call(le,function(kt,Mt){Pt.push(qe(Mt,le,!0)+" => "+qe(kt,le))}),P("Map",V.call(le),Pt,Je)}if(function m($){if(!te||!$||"object"!=typeof $)return!1;try{te.call($);try{V.call($)}catch{return!0}return $ instanceof Set}catch{}return!1}(le)){var St=[];return re.call(le,function(kt){St.push(qe(kt,le))}),P("Set",te.call(le),St,Je)}if(function s($){if(!he||!$||"object"!=typeof $)return!1;try{he.call($,he);try{me.call($,me)}catch{return!0}return $ instanceof WeakMap}catch{}return!1}(le))return y("WeakMap");if(function c($){if(!me||!$||"object"!=typeof $)return!1;try{me.call($,me);try{he.call($,he)}catch{return!0}return $ instanceof WeakSet}catch{}return!1}(le))return y("WeakSet");if(function h($){if(!Te||!$||"object"!=typeof $)return!1;try{return Te.call($),!0}catch{}return!1}(le))return y("WeakRef");if(function C($){return!("[object Number]"!==u($)||He&&"object"==typeof $&&He in $)}(le))return S(qe(Number(le)));if(function g($){if(!$||"object"!=typeof $||!Me)return!1;try{return Me.call($),!0}catch{}return!1}(le))return S(qe(Me.call(le)));if(function E($){return!("[object Boolean]"!==u($)||He&&"object"==typeof $&&He in $)}(le))return S(Ce.call(le));if(function T($){return!("[object String]"!==u($)||He&&"object"==typeof $&&He in $)}(le))return S(qe(String(le)));if(!function b($){return!("[object Date]"!==u($)||He&&"object"==typeof $&&He in $)}(le)&&!function k($){return!("[object RegExp]"!==u($)||He&&"object"==typeof $&&He in $)}(le)){var ut=N(le,qe),rr=Ye?Ye(le)===Object.prototype:le instanceof Object||le.constructor===Object,Vt=le instanceof Object?"":"null prototype",ir=!rr&&He&&Object(le)===le&&He in le?oe.call(u(le),8,-1):Vt?"Object":"",ar=(rr||"function"!=typeof le.constructor?"":le.constructor.name?le.constructor.name+" ":"")+(ir||Vt?"["+Ae.call(Ie.call([],ir||[],Vt||[]),": ")+"] ":"");return 0===ut.length?ar+"{}":Je?ar+"{"+G(ut,Je)+"}":ar+"{ "+Ae.call(ut,", ")+" }"}return String(le)};var it=Object.prototype.hasOwnProperty||function($){return $ in this}},function(U,L){},function(U,L,F){"use strict";var I=F(16),R=Object.prototype.hasOwnProperty,D=Array.isArray,_={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:I.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},b=function(o){return o.replace(/&#(\d+);/g,function(g,f){return String.fromCharCode(parseInt(f,10))})},k=function(o,g){return o&&"string"==typeof o&&g.comma&&o.indexOf(",")>-1?o.split(","):o},C=function(o,g,f,u){if(o){var A=f.allowDots?o.replace(/\.([^.[]+)/g,"[$1]"):o,a=/(\[[^[\]]*])/g,s=f.depth>0&&/(\[[^[\]]*])/.exec(A),h=s?A.slice(0,s.index):A,m=[];if(h){if(!f.plainObjects&&R.call(Object.prototype,h)&&!f.allowPrototypes)return;m.push(h)}for(var c=0;f.depth>0&&null!==(s=a.exec(A))&&c<f.depth;){if(c+=1,!f.plainObjects&&R.call(Object.prototype,s[1].slice(1,-1))&&!f.allowPrototypes)return;m.push(s[1])}return s&&m.push("["+A.slice(s.index)+"]"),function(o,g,f,u){for(var A=u?g:k(g,f),v=o.length-1;v>=0;--v){var a,s=o[v];if("[]"===s&&f.parseArrays)a=[].concat(A);else{a=f.plainObjects?Object.create(null):{};var h="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,m=parseInt(h,10);f.parseArrays||""!==h?!isNaN(m)&&s!==h&&String(m)===h&&m>=0&&f.parseArrays&&m<=f.arrayLimit?(a=[])[m]=A:"__proto__"!==h&&(a[h]=A):a={0:A}}A=a}return A}(m,g,f,u)}};U.exports=function(o,g){var f=function(o){if(!o)return _;if(null!=o.decoder&&"function"!=typeof o.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==o.charset&&"utf-8"!==o.charset&&"iso-8859-1"!==o.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");return{allowDots:void 0===o.allowDots?_.allowDots:!!o.allowDots,allowPrototypes:"boolean"==typeof o.allowPrototypes?o.allowPrototypes:_.allowPrototypes,allowSparse:"boolean"==typeof o.allowSparse?o.allowSparse:_.allowSparse,arrayLimit:"number"==typeof o.arrayLimit?o.arrayLimit:_.arrayLimit,charset:void 0===o.charset?_.charset:o.charset,charsetSentinel:"boolean"==typeof o.charsetSentinel?o.charsetSentinel:_.charsetSentinel,comma:"boolean"==typeof o.comma?o.comma:_.comma,decoder:"function"==typeof o.decoder?o.decoder:_.decoder,delimiter:"string"==typeof o.delimiter||I.isRegExp(o.delimiter)?o.delimiter:_.delimiter,depth:"number"==typeof o.depth||!1===o.depth?+o.depth:_.depth,ignoreQueryPrefix:!0===o.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof o.interpretNumericEntities?o.interpretNumericEntities:_.interpretNumericEntities,parameterLimit:"number"==typeof o.parameterLimit?o.parameterLimit:_.parameterLimit,parseArrays:!1!==o.parseArrays,plainObjects:"boolean"==typeof o.plainObjects?o.plainObjects:_.plainObjects,strictNullHandling:"boolean"==typeof o.strictNullHandling?o.strictNullHandling:_.strictNullHandling}}(g);if(""===o||null==o)return f.plainObjects?Object.create(null):{};for(var u="string"==typeof o?function(o,g){var f,u={},a=(g.ignoreQueryPrefix?o.replace(/^\?/,""):o).split(g.delimiter,g.parameterLimit===1/0?void 0:g.parameterLimit),s=-1,h=g.charset;if(g.charsetSentinel)for(f=0;f<a.length;++f)0===a[f].indexOf("utf8=")&&("utf8=%E2%9C%93"===a[f]?h="utf-8":"utf8=%26%2310003%3B"===a[f]&&(h="iso-8859-1"),s=f,f=a.length);for(f=0;f<a.length;++f)if(f!==s){var m,c,d=a[f],n=d.indexOf("]="),p=-1===n?d.indexOf("="):n+1;-1===p?(m=g.decoder(d,_.decoder,h,"key"),c=g.strictNullHandling?null:""):(m=g.decoder(d.slice(0,p),_.decoder,h,"key"),c=I.maybeMap(k(d.slice(p+1),g),function(S){return g.decoder(S,_.decoder,h,"value")})),c&&g.interpretNumericEntities&&"iso-8859-1"===h&&(c=b(c)),d.indexOf("[]=")>-1&&(c=D(c)?[c]:c),u[m]=R.call(u,m)?I.combine(u[m],c):c}return u}(o,f):o,A=f.plainObjects?Object.create(null):{},v=Object.keys(u),a=0;a<v.length;++a){var s=v[a],h=C(s,u[s],f,"string"==typeof o);A=I.merge(A,h,f)}return!0===f.allowSparse?A:I.compact(A)}},function(U,L,F){"use strict";var I,R,D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _};!function(_){var b=!1;if(void 0!==(R="function"==typeof(I=_)?I.call(L,F,L,U):I)&&(U.exports=R),b=!0,"object"===D(L)&&(U.exports=_(),b=!0),!b){var k=window.Cookies,x=window.Cookies=_();x.noConflict=function(){return window.Cookies=k,x}}}(function(){var b=function(){for(var k=0,x={};k<arguments.length;k++){var T=arguments[k];for(var C in T)x[C]=T[C]}return x};return function _(k){function x(T,C,E){var o;if(typeof document<"u"){if(arguments.length>1){if("number"==typeof(E=b({path:"/"},x.defaults,E)).expires){var g=new Date;g.setMilliseconds(g.getMilliseconds()+864e5*E.expires),E.expires=g}try{o=JSON.stringify(C),/^[\{\[]/.test(o)&&(C=o)}catch{}return C=k.write?k.write(C,T):encodeURIComponent(String(C)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),T=(T=(T=encodeURIComponent(String(T))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[T,"=",C,E.expires?"; expires="+E.expires.toUTCString():"",E.path?"; path="+E.path:"",E.domain?"; domain="+E.domain:"",E.secure?"; secure":""].join("")}T||(o={});for(var f=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,A=0;A<f.length;A++){var v=f[A].split("="),a=v.slice(1).join("=");'"'===a.charAt(0)&&(a=a.slice(1,-1));try{var s=v[0].replace(u,decodeURIComponent);if(a=k.read?k.read(a,s):k(a,s)||a.replace(u,decodeURIComponent),this.json)try{a=JSON.parse(a)}catch{}if(T===s){o=a;break}T||(o[s]=a)}catch{}}return o}}return x.set=x,x.get=function(T){return x.call(x,T)},x.getJSON=function(){return x.apply({json:!0},[].slice.call(arguments))},x.defaults={},x.remove=function(T,C){x(T,"",b(C,{expires:-1}))},x.withConverter=_,x}(function(){})})},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(R,D){var _=D.beaconCollectionDomain;if(_)return"https://"+_;var k=D.beaconDomain||"litix.io";return(R=R||"inferred").match(/^[a-z0-9]+$/)?"https://"+R+"."+k:"https://img.litix.io/a.gif"}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var b,R=(b=F(0))&&b.__esModule?b:{default:b},_=function(){var b=R.default.navigator,k=b&&(b.connection||b.mozConnection||b.webkitConnection);return k&&k.type};L.default=function(){var b=void 0;switch(_()){case"cellular":b="cellular";break;case"ethernet":b="wired";break;case"wifi":b="wifi";break;case void 0:break;default:b="other"}return b}},function(U,L,F){"use strict";function I(s){return s&&s.__esModule?s:{default:s}}Object.defineProperty(L,"__esModule",{value:!0});var D=I(F(0)),b=I(F(4)),x=I(F(56)),C=I(F(1)),o=I(F(17)),f=I(F(2)),u=!!D.default.XMLHttpRequest&&"withCredentials"in new D.default.XMLHttpRequest,A={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:1e4,maxPayloadKBSize:500},v=["hb","requestcompleted","requestfailed","requestcanceled"],a=function(s,h){this._beaconUrl=s||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,C.default)({},A,h)};a.prototype.queueEvent=function(s,h){var m=(0,C.default)({},h);return u?(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===s)&&(this._eventQueue.push(m),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(x.default.send(this._beaconUrl,m),!0)},a.prototype.flushEvents=function(){u&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},a.prototype.destroy=function(){var s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,s?this._clearBeaconQueue():this.flushEvents(),D.default.clearTimeout(this._sendTimeout)},a.prototype._clearBeaconQueue=function(){var s=D.default.navigator,h=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,m=this._eventQueue.slice(h);h>0&&(0,C.default)(m[m.length-1],(0,o.default)({mux_view_message:"event queue truncated"}));var c=this._createPayload(m);if(s.sendBeacon)s.sendBeacon(this._beaconUrl,c);else if(D.default.XMLHttpRequest){var d=new D.default.XMLHttpRequest;d.open("POST",this._beaconUrl),d.setRequestHeader("Content-Type","application/json"),d.send(c)}else x.default.send(this._beaconUrl,m[m.length-1])},a.prototype._sendBeaconQueue=function(){var s=this;if(D.default.XMLHttpRequest&&!this._postInFlight){var h=new D.default.XMLHttpRequest,m=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,h.onreadystatechange=function(){4===h.readyState&&(200!==h.status?(s._eventQueue=m.concat(s._eventQueue),s._failureCount+=1,b.default.info("Error sending beacon: "+h.status),b.default.info(h.responseText)):s._failureCount=0,s._roundTripTime=f.default.now()-d,s._postInFlight=!1)},h.open("POST",this._beaconUrl),h.setRequestHeader("Content-Type","application/json");var c=this._createPayload(m),d=f.default.now();h.send(c)}},a.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var s=Math.pow(2,this._failureCount-1);return(1+(s*=Math.random()))*this._options.baseTimeBetweenBeacons},a.prototype._startBeaconSending=function(){var s=this;D.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=D.default.setTimeout(function(){s._eventQueue.length&&s._sendBeaconQueue(),s._startBeaconSending()},this._getNextBeaconTime()))},a.prototype._createPayload=function(s){var h=this,m={transmission_timestamp:Math.round(f.default.now())};this._roundTripTime&&(m.rtt_ms=Math.round(this._roundTripTime));var c=void 0,d=void 0,n=void 0,p=function(){c=JSON.stringify({metadata:m,events:d||s}),n=c.length/1024},S=function(){return n<=h._options.maxPayloadKBSize};return p(),S()||(b.default.info("Payload size is too big ("+n+" kb). Removing unnecessary events."),d=s.filter(function(y){return-1===v.indexOf(y.e)}),p()),S()||(b.default.info("Payload size still too big ("+n+" kb). Cropping fields.."),d.forEach(function(y){for(var P in y){var M=y[P];"string"==typeof M&&M.length>51200&&(y[P]=M.substring(0,51200))}}),p()),c},L.default=a},function(U,L,F){"use strict";function I(x){return x&&x.__esModule?x:{default:x}}Object.defineProperty(L,"__esModule",{value:!0});var D=I(F(15)),b=I(F(0));L.default={send:function(x,T){function C(){E.src=g+(o?"&rc="+o:"")}var E=new Image,o=0,g=x+"?"+D.default.stringify(T);return E.addEventListener("error",function(){o>3||b.default.setTimeout(function(){o++,C()},5e3*o)}),C(),E}}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(){var b=0,k=0,x=0,T=0,C=0,E=0,o=0;this.on("requestcompleted",function R(g,f){var u=f.request_start,A=f.request_response_start,v=f.request_response_end,a=f.request_bytes_loaded;T++;var s=void 0,h=void 0;A?(s=A-u,h=v-A):h=v-u,h>0&&a>0&&(C++,k+=a,x+=h,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,a/h*8e3),this.data.view_average_request_throughput=k/x*8e3,this.data.view_request_count=T,s>0&&(b+=s,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,s),this.data.view_average_request_latency=b/C))}),this.on("requestfailed",function D(g,f){T++,E++,this.data.view_request_count=T,this.data.view_request_failed_count=E}),this.on("requestcanceled",function _(g,f){T++,o++,this.data.view_request_count=T,this.data.view_request_canceled_count=o})}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0});var R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(C){return typeof C}:function(C){return C&&"function"==typeof Symbol&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},D=function(E,o){if(Array.isArray(E))return E;if(Symbol.iterator in Object(E))return function C(E,o){var g=[],f=!0,u=!1,A=void 0;try{for(var v,a=E[Symbol.iterator]();!(f=(v=a.next()).done)&&(g.push(v.value),!o||g.length!==o);f=!0);}catch(s){u=!0,A=s}finally{try{!f&&a.return&&a.return()}finally{if(u)throw A}}return g}(E,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")};L.default=function I(C,E,o){var g=(0,k.findMediaElement)(E),f=D(g,3),u=f[0],A=f[1],v=f[2],a=C.log,s=C.utils.getComputedStyle,h=C.utils.secondsToMs;if(!u)return a.error("No element was found with the `"+A+"` query selector.");if("video"!==v&&"audio"!==v)return a.error("The element of `"+A+"` was not a media element.");(o=(0,b.default)({automaticErrorTracking:!0},o)).data=(0,b.default)({player_software:"HTML5 Video Element",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.9.1"},o.data),o.getPlayheadTime=function(){return h(u.currentTime)},o.getStateData=function(){var d=this.hlsjs&&this.hlsjs.url,n=this.dashjs&&R("function"===this.dashjs.getSource)&&this.dashjs.getSource(),p={player_is_paused:u.paused,player_playhead_time:h(u.currentTime),player_width:parseInt(s(u,"width")),player_height:parseInt(s(u,"height")),player_autoplay_on:u.autoplay,player_preload_on:u.preload,video_poster_url:u.poster,video_source_url:d||n||u.currentSrc,video_source_duration:h(u.duration),video_source_height:u.videoHeight,video_source_width:u.videoWidth},S=o.getPlayheadTime();if(u.getStartDate&&S>0){var y=u.getStartDate();if(y&&"function"==typeof y.getTime&&y.getTime()){var P=y.getTime();if(p.player_program_time=P+S,u.seekable.length>0){var M=P+u.seekable.end(u.seekable.length-1);p.player_live_edge_program_time=M}}}return p},u.mux=u.mux||{},u.mux.deleted=!1,u.mux.emit=function(d,n){C.emit(A,d,n)};var c=function(){a.error("The monitor for this video element has already been destroyed.")};u.mux.destroy=function(){Object.keys(u.mux.listeners).forEach(function(d){u.removeEventListener(d,u.mux.listeners[d],!1)}),delete u.mux.listeners,u.mux.destroy=c,u.mux.swapElement=c,u.mux.emit=c,u.mux.addHLSJS=c,u.mux.addDashJS=c,u.mux.removeHLSJS=c,u.mux.removeDashJS=c,u.mux.deleted=!0,C.emit(A,"destroy")},u.mux.swapElement=function(d){var n=(0,k.findMediaElement)(d),p=D(n,3),S=p[0],y=p[1],P=p[2];return S?"video"!==P&&"audio"!==P?C.log.error("The element of `"+y+"` was not a media element."):(S.muxId=u.muxId,delete u.muxId,S.mux=S.mux||{},S.mux.listeners=(0,b.default)({},u.mux.listeners),delete u.mux.listeners,Object.keys(S.mux.listeners).forEach(function(M){u.removeEventListener(M,S.mux.listeners[M],!1),S.addEventListener(M,S.mux.listeners[M],!1)}),S.mux.swapElement=u.mux.swapElement,S.mux.destroy=u.mux.destroy,delete u.mux,void(u=S)):C.log.error("No element was found with the `"+y+"` query selector.")},u.mux.addHLSJS=function(d){C.addHLSJS(A,d)},u.mux.addDashJS=function(d){C.addDashJS(A,d)},u.mux.removeHLSJS=function(){C.removeHLSJS(A)},u.mux.removeDashJS=function(){C.removeDashJS(A)},C.init(A,o),C.emit(A,"playerready"),u.paused||(C.emit(A,"play"),u.readyState>2&&C.emit(A,"playing")),u.mux.listeners={},x.forEach(function(d){("error"!==d||o.automaticErrorTracking)&&(u.mux.listeners[d]=function(){var n={};if("error"===d){if(!u.error||1===u.error.code)return;n.player_error_code=u.error.code,n.player_error_message=T[u.error.code]||u.error.message}C.emit(A,d,n)},u.addEventListener(d,u.mux.listeners[d],!1))})};var C,b=(C=F(1))&&C.__esModule?C:{default:C},k=F(11),x=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],T={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(U,L,F){"use strict";function I(m){return m&&m.__esModule?m:{default:m}}Object.defineProperty(L,"__esModule",{value:!0});var D=I(F(60)),b=I(F(3)),x=I(F(61)),C=I(F(62)),o=I(F(1)),f=I(F(7)),u=F(5),v=I(F(2)),s=I(F(63)),h={};h.safeCall=D.default,h.safeIncrement=b.default,h.getComputedStyle=x.default,h.secondsToMs=C.default,h.assign=o.default,h.headersStringToObject=f.default,h.extractHostnameAndDomain=u.extractHostnameAndDomain,h.extractHostname=u.extractHostname,h.now=v.default.now,h.manifestParser=s.default,L.default=h},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(_,b,k,x){var T=x;if(_&&"function"==typeof _[b])try{T=_[b].apply(_,k)}catch(C){D.default.info("safeCall error",C)}return T};var _,D=(_=F(4))&&_.__esModule?_:{default:_}},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(b,k){if(b&&k&&D.default&&"function"==typeof D.default.getComputedStyle){var x=void 0;return _&&_.has(b)&&(x=_.get(b)),x||(x=D.default.getComputedStyle(b,null),_&&_.set(b,x)),x.getPropertyValue(k)}};var b,D=(b=F(0))&&b.__esModule?b:{default:b},_=void 0;D.default&&D.default.WeakMap&&(_=new WeakMap)},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default=function I(R){return Math.floor(1e3*R)}},function(U,L,F){"use strict";function I(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(L,"__esModule",{value:!0});var D=I(F(1)),b=I(F(14)),k_TARGET_DURATION="#EXT-X-TARGETDURATION",k_PART_INF="#EXT-X-PART-INF",k_SERVER_CONTROL="#EXT-X-SERVER-CONTROL",k_INF="#EXTINF",k_PROGRAM_DATE_TIME="#EXT-X-PROGRAM-DATE-TIME",k_VERSION="#EXT-X-VERSION",k_SESSION_DATA="#EXT-X-SESSION-DATA",x=function(v){return this.buffer="",this.manifest={segments:[],serverControl:{},sessionData:{}},this.currentUri={},this.process(v),this.manifest};x.prototype.process=function(v){var a=void 0;for(this.buffer+=v,a=this.buffer.indexOf("\n");a>-1;a=this.buffer.indexOf("\n"))this.processLine(this.buffer.substring(0,a)),this.buffer=this.buffer.substring(a+1)},x.prototype.processLine=function(v){var a=v.indexOf(":"),s=u(v,a),h=s[0],m=2===s.length?E(s[1]):void 0;if("#"!==h[0])this.currentUri.uri=h,this.manifest.segments.push(this.currentUri),!this.manifest.targetDuration||"duration"in this.currentUri||(this.currentUri.duration=this.manifest.targetDuration),this.currentUri={};else switch(h){case k_TARGET_DURATION:if(!isFinite(m)||m<0)return;this.manifest.targetDuration=m,this.setHoldBack();break;case k_PART_INF:T(this.manifest,s),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),this.setHoldBack();break;case k_SERVER_CONTROL:T(this.manifest,s),this.setHoldBack();break;case k_INF:0===m?this.currentUri.duration=.01:m>0&&(this.currentUri.duration=m);break;case k_PROGRAM_DATE_TIME:var c=m,d=new Date(c);this.manifest.dateTimeString||(this.manifest.dateTimeString=c,this.manifest.dateTimeObject=d),this.currentUri.dateTimeString=c,this.currentUri.dateTimeObject=d;break;case k_VERSION:T(this.manifest,s);break;case k_SESSION_DATA:var n=A(s[1]),p=(0,b.default)(n);(0,D.default)(this.manifest.sessionData,p)}},x.prototype.setHoldBack=function(){var v=this.manifest,a=v.serverControl,s=v.targetDuration,h=v.partTargetDuration;if(a){var m="holdBack",c="partHoldBack",d=s&&3*s,n=h&&2*h;s&&!a.hasOwnProperty(m)&&(a[m]=d),d&&a[m]<d&&(a[m]=d),h&&!a.hasOwnProperty(c)&&(a[c]=3*h),h&&a[c]<n&&(a[c]=n)}};var T=function(v,a){var s=C(a[0].replace("#EXT-X-","")),h=void 0;f(a[1])?(h={},h=(0,D.default)(g(a[1]),h)):h=E(a[1]),v[s]=h},C=function(v){return v.toLowerCase().replace(/-(\w)/g,function(a){return a[1].toUpperCase()})},E=function(v){if("yes"===v.toLowerCase()||"no"===v.toLowerCase())return"yes"===v.toLowerCase();var a=-1!==v.indexOf(":")?v:parseFloat(v);return isNaN(a)?v:a},o=function(v){var a={},s=v.split("=");return s.length>1&&(a[C(s[0])]=E(s[1])),a},g=function(v){for(var a=v.split(","),s={},h=0;a.length>h;h++){var c=o(a[h]);s=(0,D.default)(c,s)}return s},f=function(v){return v.indexOf("=")>-1},u=function(v,a){return-1===a?[v]:[v.substring(0,a),v.substring(a+1)]},A=function(v){var a={};if(v){var s=v.search(",");return[v.slice(0,s),v.slice(s+1)].forEach(function(h,m){for(var c=h.replace(/['"]+/g,"").split("="),d=0;d<c.length;d++)"DATA-ID"===c[d]&&(a["DATA-ID"]=c[1-d]),"VALUE"===c[d]&&(a.VALUE=c[1-d])}),{data:a}}};L.default=x},function(U,L,F){"use strict";Object.defineProperty(L,"__esModule",{value:!0}),L.default={PLAYER_READY:"playerready",VIEW_INIT:"viewinit",VIDEO_CHANGE:"videochange",PLAY:"play",PAUSE:"pause",PLAYING:"playing",TIME_UPDATE:"timeupdate",SEEKING:"seeking",SEEKED:"seeked",REBUFFER_START:"rebufferstart",REBUFFER_END:"rebufferend",ERROR:"error",ENDED:"ended",RENDITION_CHANGE:"renditionchange",ORIENTATION_CHANGE:"orientationchange",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_BREAK_START:"adbreakstart",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_FIRST_QUARTILE:"adfirstquartile",AD_MID_POINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile",AD_ENDED:"adended",AD_BREAK_END:"adbreakend",AD_ERROR:"aderror",REQUEST_COMPLETED:"requestcompleted",REQUEST_FAILED:"requestfailed",REQUEST_CANCELLED:"requestcanceled"}}])},Q.exports=L()},function(Q,K,j){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.default=function U(R,D){var _=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return{}},x=!1;R.on("adstart",function(){x=!0}),R.on("adend",function(){x=!1}),R.on("adserror",function(){x=!1});var T=function(){var C=I(D.currentTime()),E=function g(){var f=F.default.utils.now(),u=I(D.currentTime());if(x){if(u>C){var A=k();A.viewer_time=f-Math.max(0,u-C),D.off("timeupdate",g),R.mux.emit("adplaying",A)}}else D.off("timeupdate",g)};D.on("timeupdate",E);var o=function g(){D.off("timeupdate",E),_.forEach(function(f){D.off(f,g)})};_.forEach(function(g){D.on(g,o)})};b.forEach(function(C){D.on(C,T)})};var R,F=(R=j(0))&&R.__esModule?R:{default:R},I=F.default.utils.secondsToMs},function(Q,K,j){"use strict";function U(n){return n&&n.__esModule?n:{default:n}}function F(n){(n.registerPlugin||n.plugin||function(){_.default.log.error("No valid method to register videojs plugin available.")})("mux",function L(n){var p=n;return function(S){if(p.IS_IE8)return!1;var y=this,P=y.id();(S=s({automaticErrorTracking:!0},S)).data=s({player_software_name:"Video.js",player_software_version:p.VERSION||"< 4.11",player_mux_plugin_name:"videojs-mux",player_mux_plugin_version:"4.6.6"},S.data),S.getPlayheadTime=function(){return c(y.currentTime())},S.getStateData=function(){var q=h(y,"videoHeight"),H=h(y,"videoWidth");if(void 0===H||void 0===q){var V=y.el().firstChild;V&&"VIDEO"===V.nodeName.toUpperCase()&&(q=V.videoHeight,H=V.videoWidth)}return{player_is_paused:h(y,"paused"),player_is_fullscreen:h(y,"isFullscreen"),player_autoplay_on:!!h(y,"autoplay"),player_preload_on:h(y,"preload"),player_width:m(y.el(),"width"),player_height:m(y.el(),"height"),player_language_code:h(y,"language"),video_poster_url:h(y,"poster"),video_source_url:h(y,"currentSrc"),video_source_mime_type:h(y,"currentType")&&h(y,"currentType").toLowerCase(),video_source_duration:c(h(y,"duration")||0),video_source_is_live:y.duration()===1/0,video_source_height:q,video_source_width:H}},y.mux=function(){a.error("[videojs-mux] The plugin was initialized more than once.")},y.mux.emit=function(q,H){_.default.emit(P,q,H)},y.mux.addHLSJS=function(q){_.default.addHLSJS(P,q)},y.mux.log=a,y.mux.utils=_.default.utils,_.default.init(P,S);var M=!1,B=function(){M||y.mux.emit("playerready"),M=!0};y.ready(function(){y.addClass("vjs-mux"),k.default.setTimeout(B,0)});var G=!1;y.one("play",B),d.forEach(function(q){("error"!==q||S.automaticErrorTracking)&&y.on(q,function(){if(!G){var H={};if("error"===q){var V=h(y,"error");if(V&&1===V.code)return;H.player_error_code=V&&V.code,H.player_error_message=V&&V.message}y.mux.emit(q,H)}})});var N=!1;y.on("play",function(){N=!0}),y.on("pause",function(){N=!1}),y.on("adstart",function(){G=!0,N&&y.mux.emit("pause"),y.mux.emit("adbreakstart")}),y.on("adend",function(){y.mux.emit("adbreakend"),G=!1,h(y,"paused")||(y.mux.emit("play"),N=!0,y.onceux&&y.mux.emit("playing"))}),y.ima&&(0,T.default)(y),y.onceux&&(0,u.default)(y),y.ima3&&"function"==typeof y.ima3.ready&&(0,E.default)(y),y.FreeWheelPlugin&&y.FreeWheelPlugin.VERSION&&(0,g.default)(y),y.on("dispose",function(){y.mux.emit("destroy")})}}(n)),(0,v.default)(n)}Object.defineProperty(K,"__esModule",{value:!0}),K.register=F;var R=U(j(3)),_=U(j(0)),k=U(j(4)),T=U(j(6)),E=U(j(7)),g=U(j(8)),u=U(j(9)),v=U(j(10)),a=_.default.log,s=_.default.utils.assign,h=_.default.utils.safeCall,m=_.default.utils.getComputedStyle,c=_.default.utils.secondsToMs,d=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"];F(R.default)},function(Q,K){Q.exports=Se},function(Q,K,j){(function(U){var L;L=typeof window<"u"?window:void 0!==U?U:typeof self<"u"?self:{},Q.exports=L}).call(K,j(5))},function(Q,K){var j;j=function(){return this}();try{j=j||Function("return this")()||(0,eval)("this")}catch{"object"==typeof window&&(j=window)}Q.exports=j},function(Q,K,j){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.default=function U(L){var F=function(C){var E="function"==typeof(C=C||{}).getAdData?C.getAdData():{},o="function"==typeof C.getAd?C.getAd():{},g="function"==typeof o.getMediaUrl?o.getMediaUrl():E.mediaUrl,f=L.ima.settings||{},u={};return g&&(u.ad_asset_url=g),f.adTagUrl&&(u.ad_tag_url=f.adTagUrl),u},I=void 0,R=void 0,D=void 0,_=void 0,b=void 0,k=void 0;try{var x=window.google.ima.AdEvent.Type;I=x.LOADED,R=x.STARTED,D=x.COMPLETE,_=x.PAUSED,b=x.RESUMED,k=x.SKIPPED}catch{I="loaded",R="start",D="complete",_="pause",b="resume",k="skip"}var T=0;L.mux.triggerAdRequest=function(){T++,L.mux.emit("adrequest",F())},L.on("adsready",function(){var C=L.ima.addEventListener||function(){};C(I,function(E){var o=F(E);T>0&&(T--,L.mux.emit("adresponse",o)),L.mux.emit("adplay",o)}),C(R,function(E){var o=F(E);L.mux.emit("adplaying",o)}),C(b,function(E){var o=F(E);L.mux.emit("adplay",o),L.mux.emit("adplaying",o)}),C(_,function(E){var o=F(E);L.mux.emit("adpause",o)}),C(D,function(E){var o=F(E);L.mux.emit("adended",o)}),C(k,function(E){var o=F(E);L.mux.emit("adended",o)}),L.on("adserror",function(){T>0&&(T--,L.mux.emit("adresponse")),L.mux.emit("aderror")})})}},function(Q,K,j){"use strict";function U(R){if("string"!=typeof R)return!1;var D=R.split(".").map(function(k){return parseInt(k)}),_=D[0];return _>2||2===_&&D[1]>=3}Object.defineProperty(K,"__esModule",{value:!0}),K.brightcoveImaAdsEventsSupported=U,K.default=function L(R){var D=function(){var k=R.ima3.currentAd,x=R.ima3.settings,T={};return k&&(T.ad_asset_url=k.mediaUrl),x&&(T.ad_tag_url=x.serverUrl),T};if(U(R.ima3.version)){var _=0,b=function(){_>0&&(_--,R.mux.emit("adresponse",D()))};R.on("ads-request",function(){_++,R.mux.emit("adrequest",D())}),R.on("ads-load",function(){b(),R.mux.emit("adplay",D())}),R.on("adserror",function(){b(),R.mux.emit("aderror")}),R.on("ads-play",function(){R.mux.emit("adplay",D())}),R.on("ads-pause",function(){R.mux.emit("adpause",D())}),R.on("ads-ad-ended",function(){R.mux.emit("adended",D())})}R.ima3.ready(function(){R.ima3.adPlayer?(U(R.ima3.version)||(R.ima3.adPlayer.on("play",function(){R.mux.emit("adplay")}),R.ima3.adPlayer.on("pause",function(){R.mux.emit("adpause")}),R.ima3.adPlayer.on("ended",function(){R.mux.emit("adended")})),(0,I.default)(R,R.ima3.adPlayer,["pause","ended","adserror"],["play"],D)):(R.mux.log("Legacy IMA3 plugin found, ad events may not track correctly."),R.on("ads-ad-started",function(){R.mux.emit("adplaying",D())}),R.on("ads-play",function(){R.mux.emit("adplaying",D())}))})};var R,I=(R=j(1))&&R.__esModule?R:{default:R}},function(Q,K,j){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.default=function U(L){var F=function(I){var R=L.FreeWheelPlugin,D={};switch(I){case"adplay":case"adplaying":case"adpause":D.ad_asset_url=L.currentSrc()}return R&&(D.ad_tag_url="html5"===R.tech.toLowerCase()?R.settings.Html5.serverUrl:R.settings.Flash.serverUrl),D};L.on("ads-request",function(){L.mux.emit("adrequest",F("adrequest"))}),L.on("ads-load",function(){L.mux.emit("adresponse",F("adresponse"))}),L.on("adserror",function(){L.mux.emit("aderror")}),L.on("ads-ad-started",function(){L.mux.emit("adplay",F("adplay")),L.mux.emit("adplaying",F("adplaying"))}),L.on("ads-play",function(){L.mux.emit("adplay",F("adplay")),L.mux.emit("adplaying",F("adplaying"))}),L.on("ads-pause",function(){L.mux.emit("adpause",F("adpause"))}),L.on("ads-ad-ended",function(){L.mux.emit("adended",F("adended"))}),L.on("adend",function(){L.mux.emit("play")})}},function(Q,K,j){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.default=function U(I){(0,F.default)(I,I,["onceux-linearad-pause","onceux-linearad-skipped","onceux-linearad-complete","adserror"],["adstart","onceux-linearad-resume"]),I.on("adstart",function(){I.mux.emit("adplay")}),I.on("onceux-linearad-start",function(_){_.linearAd&&_.linearAd.index>0&&(I.mux.emit("adplay"),I.mux.emit("adplaying"))}),I.on("onceux-linearad-resume",function(){I.mux.emit("adplay")}),I.on("onceux-linearad-pause",function(){I.mux.emit("adpause")}),I.on("onceux-linearad-complete",function(){I.mux.emit("adended")}),I.on("onceux-linearad-skipped",function(){I.mux.emit("adended")})};var I,F=(I=j(1))&&I.__esModule?I:{default:I}},function(Q,K,j){"use strict";Object.defineProperty(K,"__esModule",{value:!0});var L=function(b,k){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return function _(b,k){var x=[],T=!0,C=!1,E=void 0;try{for(var o,g=b[Symbol.iterator]();!(T=(o=g.next()).done)&&(x.push(o.value),!k||x.length!==k);T=!0);}catch(f){C=!0,E=f}finally{try{!T&&g.return&&g.return()}finally{if(C)throw E}}return x}(b,k);throw new TypeError("Invalid attempt to destructure non-iterable instance")};K.default=function U(_){if(!D.get(_)&&(D.set(_,"video.js "+_.VERSION+" initialized"),"function"==typeof _.getTech))for(var k=(_.getTech("Html5")||{}).sourceHandlers,x=0;x<k.length;x++)!function(T){var C=k[T],E=C.handleSource;C.handleSource=function(o,g){var u=E(o,g,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(u&&"function"==typeof u.xhr)try{var A=_.VERSION.split("."),v=L(A,2),a=v[0],s=v[1];a=parseInt(a),s=parseInt(s);var h=a>=7&&s>=4?u.player().id():u.player_.el_.parentNode.id;(0,I.default)(_(h),u.xhr),(0,R.trackRenditionChanges)(_(h))}catch{}return u}}(x)};var _,I=(_=j(11))&&_.__esModule?_:{default:_},R=j(13),D=new Map},function(Q,K,j){"use strict";function U(_){return _&&_.__esModule?_:{default:_}}Object.defineProperty(K,"__esModule",{value:!0}),K.default=function L(_,b){var T,x=function(T){return function(C){var E=D.default.utils.now();try{T(C)}catch{}try{C.onreadystatechange=function(T,C,E){var o=(0,I.default)(_,T,C);return function(){try{o()}catch{}try{E()}catch{}}}(C,E,C.onreadystatechange||function(){})}catch{}}};b.beforeRequest=(T=b.beforeRequest||function(T){return T},function(C){var E=T(C);return E.beforeSend=x(E.beforeSend||function(){}),E})};var I=U(j(12)),D=U(j(0))},function(Q,K,j){"use strict";Object.defineProperty(K,"__esModule",{value:!0});var L=function(D,_){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return function R(D,_){var b=[],k=!0,x=!1,T=void 0;try{for(var C,E=D[Symbol.iterator]();!(k=(C=E.next()).done)&&(b.push(C.value),!_||b.length!==_);k=!0);}catch(o){x=!0,T=o}finally{try{!k&&E.return&&E.return()}finally{if(x)throw T}}return b}(D,_);throw new TypeError("Invalid attempt to destructure non-iterable instance")};K.default=function U(R,D,_){var b=R.mux.utils.extractHostnameAndDomain,k=R.mux.utils.headersStringToObject,T=0;return function(){var C=D.readyState;if(C>=2){if(T=T||I.default.utils.now(),4!==C)return;if(D.status>=200&&D.status<300){var E=I.default.utils.now(),o="arraybuffer"===D.responseType?D.response.byteLength:D.responseText.length,g=b(D.responseURL),u=L(g,1)[0],A=k(D.getAllResponseHeaders?D.getAllResponseHeaders():""),v=function(C){var E=C["content-type"];return E?E.match(/^audio\/mpegurl/i)?"manifest":E.match(/^audio.*/i)?"audio":E.match(/^video.*/)?"video":E.match(/^application\/x-mpegurl/i)||E.match(/^application\/vnd.apple.mpegurl/i)||E.match(/^application\/dash+xml/i)?"manifest":"unknown":"unknown"}(A);R.mux.emit("requestcompleted",{request_start:_,request_response_start:T,request_response_end:E,request_bytes_loaded:o,request_hostname:u,request_response_headers:A,request_type:v})}else R.mux.emit("requestfailed")}}};var R,I=(R=j(0))&&R.__esModule?R:{default:R}},function(Q,K,j){"use strict";Object.defineProperty(K,"__esModule",{value:!0});var U=function(F){for(var I=F.textTracks(),R=void 0,D=0;D<I.length;D++)"segment-metadata"===I[D].label&&(R=I[D]);return R};K.getSegmentMetadataTrack=U,K.trackRenditionChanges=function(F){var I=U(F),R=void 0;I&&I.on&&I.on("cuechange",function(){try{var D=F.tech({IWillNotUseThisInPlugins:!0}),b=(D.vhs||D.hls).playlists.media().attributes.BANDWIDTH;R!==b&&F.mux.emit("renditionchange",{video_source_bitrate:b}),R=b}catch(k){F.mux&&F.mux.log&&F.mux.log.warn&&F.mux.log.warn("Cannot retrieve BANDWIDTH information from player: "+k)}})}}]))},497:(ge,Le,Ee)=>{var ke=Ee(697),Se=ge.exports={WebVTT:Ee(13),VTTCue:Ee(190),VTTRegion:Ee(146)};ke.vttjs=Se,ke.WebVTT=Se.WebVTT;var Q=Se.VTTCue,K=Se.VTTRegion,j=ke.VTTCue,U=ke.VTTRegion;Se.shim=function(){ke.VTTCue=Q,ke.VTTRegion=K},Se.restore=function(){ke.VTTCue=j,ke.VTTRegion=U},ke.VTTCue||Se.shim()},13:(ge,Le,Ee)=>{var ke=Ee(675),Se=Object.create||function(){function s(){}return function(h){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return s.prototype=h,new s}}();function Q(s,h){this.name="ParsingError",this.code=s.code,this.message=h||s.message}function K(s){function h(c,d,n,p){return 3600*(0|c)+60*(0|d)+(0|n)+(0|p)/1e3}var m=s.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return m?m[3]?h(m[1],m[2],m[3].replace(":",""),m[4]):m[1]>59?h(m[1],m[2],0,m[4]):h(0,m[1],m[2],m[4]):null}function j(){this.values=Se(null)}function U(s,h,m,c){var d=c?s.split(c):[s];for(var n in d)if("string"==typeof d[n]){var p=d[n].split(m);2===p.length&&h(p[0].trim(),p[1].trim())}}function L(s,h,m){var c=s;function d(){var S=K(s);if(null===S)throw new Q(Q.Errors.BadTimeStamp,"Malformed timestamp: "+c);return s=s.replace(/^[^\sa-zA-Z-]+/,""),S}function p(){s=s.replace(/^\s+/,"")}if(p(),h.startTime=d(),p(),"--\x3e"!==s.substr(0,3))throw new Q(Q.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+c);s=s.substr(3),p(),h.endTime=d(),p(),function n(S,y){var P=new j;U(S,function(M,B){switch(M){case"region":for(var G=m.length-1;G>=0;G--)if(m[G].id===B){P.set(M,m[G].region);break}break;case"vertical":P.alt(M,B,["rl","lr"]);break;case"line":var N=B.split(","),q=N[0];P.integer(M,q),P.percent(M,q)&&P.set("snapToLines",!1),P.alt(M,q,["auto"]),2===N.length&&P.alt("lineAlign",N[1],["start","center","end"]);break;case"position":N=B.split(","),P.percent(M,N[0]),2===N.length&&P.alt("positionAlign",N[1],["start","center","end"]);break;case"size":P.percent(M,B);break;case"align":P.alt(M,B,["start","center","end","left","right"])}},/:/,/\s/),y.region=P.get("region",null),y.vertical=P.get("vertical","");try{y.line=P.get("line","auto")}catch{}y.lineAlign=P.get("lineAlign","start"),y.snapToLines=P.get("snapToLines",!0),y.size=P.get("size",100);try{y.align=P.get("align","center")}catch{y.align=P.get("align","middle")}try{y.position=P.get("position","auto")}catch{y.position=P.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},y.align)}y.positionAlign=P.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},y.align)}(s,h)}(Q.prototype=Se(Error.prototype)).constructor=Q,Q.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},j.prototype={set:function(s,h){!this.get(s)&&""!==h&&(this.values[s]=h)},get:function(s,h,m){return m?this.has(s)?this.values[s]:h[m]:this.has(s)?this.values[s]:h},has:function(s){return s in this.values},alt:function(s,h,m){for(var c=0;c<m.length;++c)if(h===m[c]){this.set(s,h);break}},integer:function(s,h){/^-?\d+$/.test(h)&&this.set(s,parseInt(h,10))},percent:function(s,h){return!!(h.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(h=parseFloat(h),h>=0&&h<=100))&&(this.set(s,h),!0)}};var F=ke.createElement&&ke.createElement("textarea"),I={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},R={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},D={v:"title",lang:"lang"},_={rt:"ruby"};function b(s,h){function m(){if(!h)return null;var H=h.match(/^([^<]*)(<[^>]*>?)?/);return function q(V){return h=h.substr(V.length),V}(H[1]?H[1]:H[2])}function c(q){return F.innerHTML=q,q=F.textContent,F.textContent="",q}function n(q,H){var V=I[q];if(!V)return null;var Y=s.document.createElement(V),X=D[q];return X&&H&&(Y[X]=H.trim()),Y}for(var y,p=s.document.createElement("div"),S=p,P=[];null!==(y=m());)if("<"!==y[0])S.appendChild(s.document.createTextNode(c(y)));else{if("/"===y[1]){P.length&&P[P.length-1]===y.substr(2).replace(">","")&&(P.pop(),S=S.parentNode);continue}var B,M=K(y.substr(1,y.length-2));if(M){B=s.document.createProcessingInstruction("timestamp",M),S.appendChild(B);continue}var G=y.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!G||!(B=n(G[1],G[3]))||_[(H=B).localName]&&_[H.localName]!==S.localName)continue;if(G[2]){var N=G[2].split(".");N.forEach(function(q){var H=/^bg_/.test(q),V=H?q.slice(3):q;R.hasOwnProperty(V)&&(B.style[H?"background-color":"color"]=R[V])}),B.className=N.join(" ")}P.push(G[1]),S.appendChild(B),S=B}var H;return p}var k=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function x(s){for(var h=0;h<k.length;h++){var m=k[h];if(s>=m[0]&&s<=m[1])return!0}return!1}function T(s){var h=[],m="";if(!s||!s.childNodes)return"ltr";function d(S,y){for(var P=y.childNodes.length-1;P>=0;P--)S.push(y.childNodes[P])}function n(S){if(!S||!S.length)return null;var y=S.pop(),P=y.textContent||y.innerText;if(P){var M=P.match(/^.*(\n|\r)/);return M?(S.length=0,M[0]):P}return"ruby"===y.tagName?n(S):y.childNodes?(d(S,y),n(S)):void 0}for(d(h,s);m=n(h);)for(var p=0;p<m.length;p++)if(x(m.charCodeAt(p)))return"rtl";return"ltr"}function E(){}function o(s,h,m){E.call(this),this.cue=h,this.cueDiv=b(s,h.text);var c={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===h.vertical?"horizontal-tb":"lr"===h.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(c,this.cueDiv),this.div=s.document.createElement("div"),c={direction:T(this.cueDiv),writingMode:""===h.vertical?"horizontal-tb":"lr"===h.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===h.align?"center":h.align,font:m.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(c),this.div.appendChild(this.cueDiv);var d=0;switch(h.positionAlign){case"start":d=h.position;break;case"center":d=h.position-h.size/2;break;case"end":d=h.position-h.size}this.applyStyles(""===h.vertical?{left:this.formatStyle(d,"%"),width:this.formatStyle(h.size,"%")}:{top:this.formatStyle(d,"%"),height:this.formatStyle(h.size,"%")}),this.move=function(n){this.applyStyles({top:this.formatStyle(n.top,"px"),bottom:this.formatStyle(n.bottom,"px"),left:this.formatStyle(n.left,"px"),right:this.formatStyle(n.right,"px"),height:this.formatStyle(n.height,"px"),width:this.formatStyle(n.width,"px")})}}function g(s){var h,m,c,d;if(s.div){m=s.div.offsetHeight,c=s.div.offsetWidth,d=s.div.offsetTop;var n=(n=s.div.childNodes)&&(n=n[0])&&n.getClientRects&&n.getClientRects();s=s.div.getBoundingClientRect(),h=n?Math.max(n[0]&&n[0].height||0,s.height/n.length):0}this.left=s.left,this.right=s.right,this.top=s.top||d,this.height=s.height||m,this.bottom=s.bottom||d+(s.height||m),this.width=s.width||c,this.lineHeight=void 0!==h?h:s.lineHeight}function f(s,h,m,c){var n=new g(h),p=h.cue,S=function C(s){if("number"==typeof s.line&&(s.snapToLines||s.line>=0&&s.line<=100))return s.line;if(!s.track||!s.track.textTrackList||!s.track.textTrackList.mediaElement)return-1;for(var h=s.track,m=h.textTrackList,c=0,d=0;d<m.length&&m[d]!==h;d++)"showing"===m[d].mode&&c++;return-1*++c}(p),y=[];if(p.snapToLines){var P;switch(p.vertical){case"":y=["+y","-y"],P="height";break;case"rl":y=["+x","-x"],P="width";break;case"lr":y=["-x","+x"],P="width"}var M=n.lineHeight,B=M*Math.round(S),G=m[P]+M,N=y[0];Math.abs(B)>G&&(B=B<0?-1:1,B*=Math.ceil(G/M)*M),S<0&&(B+=""===p.vertical?m.height:m.width,y=y.reverse()),n.move(N,B)}else{var q=n.lineHeight/m.height*100;switch(p.lineAlign){case"center":S-=q/2;break;case"end":S-=q}switch(p.vertical){case"":h.applyStyles({top:h.formatStyle(S,"%")});break;case"rl":h.applyStyles({left:h.formatStyle(S,"%")});break;case"lr":h.applyStyles({right:h.formatStyle(S,"%")})}y=["+y","-x","+x","-y"],n=new g(h)}var H=function d(V,Y){for(var X,Z=new g(V),te=1,re=0;re<Y.length;re++){for(;V.overlapsOppositeAxis(m,Y[re])||V.within(m)&&V.overlapsAny(c);)V.move(Y[re]);if(V.within(m))return V;var ne=V.intersectPercentage(m);te>ne&&(X=new g(V),te=ne),V=new g(Z)}return X||Z}(n,y);h.move(H.toCSSCompatValues(m))}function u(){}E.prototype.applyStyles=function(s,h){for(var m in h=h||this.div,s)s.hasOwnProperty(m)&&(h.style[m]=s[m])},E.prototype.formatStyle=function(s,h){return 0===s?0:s+h},(o.prototype=Se(E.prototype)).constructor=o,g.prototype.move=function(s,h){switch(h=void 0!==h?h:this.lineHeight,s){case"+x":this.left+=h,this.right+=h;break;case"-x":this.left-=h,this.right-=h;break;case"+y":this.top+=h,this.bottom+=h;break;case"-y":this.top-=h,this.bottom-=h}},g.prototype.overlaps=function(s){return this.left<s.right&&this.right>s.left&&this.top<s.bottom&&this.bottom>s.top},g.prototype.overlapsAny=function(s){for(var h=0;h<s.length;h++)if(this.overlaps(s[h]))return!0;return!1},g.prototype.within=function(s){return this.top>=s.top&&this.bottom<=s.bottom&&this.left>=s.left&&this.right<=s.right},g.prototype.overlapsOppositeAxis=function(s,h){switch(h){case"+x":return this.left<s.left;case"-x":return this.right>s.right;case"+y":return this.top<s.top;case"-y":return this.bottom>s.bottom}},g.prototype.intersectPercentage=function(s){return Math.max(0,Math.min(this.right,s.right)-Math.max(this.left,s.left))*Math.max(0,Math.min(this.bottom,s.bottom)-Math.max(this.top,s.top))/(this.height*this.width)},g.prototype.toCSSCompatValues=function(s){return{top:this.top-s.top,bottom:s.bottom-this.bottom,left:this.left-s.left,right:s.right-this.right,height:this.height,width:this.width}},g.getSimpleBoxPosition=function(s){var h=s.div?s.div.offsetHeight:s.tagName?s.offsetHeight:0,m=s.div?s.div.offsetWidth:s.tagName?s.offsetWidth:0,c=s.div?s.div.offsetTop:s.tagName?s.offsetTop:0;return{left:(s=s.div?s.div.getBoundingClientRect():s.tagName?s.getBoundingClientRect():s).left,right:s.right,top:s.top||c,height:s.height||h,bottom:s.bottom||c+(s.height||h),width:s.width||m}},u.StringDecoder=function(){return{decode:function(s){if(!s)return"";if("string"!=typeof s)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(s))}}},u.convertCueToDOMTree=function(s,h){return s&&h?b(s,h):null},u.processCues=function(s,h,m){if(!s||!h||!m)return null;for(;m.firstChild;)m.removeChild(m.firstChild);var c=s.document.createElement("div");if(c.style.position="absolute",c.style.left="0",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.margin="1.5%",m.appendChild(c),function d(M){for(var B=0;B<M.length;B++)if(M[B].hasBeenReset||!M[B].displayState)return!0;return!1}(h)){var p=[],S=g.getSimpleBoxPosition(c),P={font:Math.round(.05*S.height*100)/100+"px sans-serif"};!function(){for(var M,B,G=0;G<h.length;G++)M=new o(s,B=h[G],P),c.appendChild(M.div),f(0,M,S,p),B.displayState=M.div,p.push(g.getSimpleBoxPosition(M))}()}else for(var n=0;n<h.length;n++)c.appendChild(h[n].displayState)},(u.Parser=function(s,h,m){m||(m=h,h={}),h||(h={}),this.window=s,this.vttjs=h,this.state="INITIAL",this.buffer="",this.decoder=m||new TextDecoder("utf8"),this.regionList=[]}).prototype={reportOrThrowError:function(s){if(!(s instanceof Q))throw s;this.onparsingerror&&this.onparsingerror(s)},parse:function(s){var M,h=this;function m(){for(var M=h.buffer,B=0;B<M.length&&"\r"!==M[B]&&"\n"!==M[B];)++B;var G=M.substr(0,B);return"\r"===M[B]&&++B,"\n"===M[B]&&++B,h.buffer=M.substr(B),G}s&&(h.buffer+=h.decoder.decode(s,{stream:!0}));try{var p;if("INITIAL"===h.state){if(!/\r\n|\n/.test(h.buffer))return this;var S=(p=m()).match(/^WEBVTT([ \t].*)?$/);if(!S||!S[0])throw new Q(Q.Errors.BadSignature);h.state="HEADER"}for(var y=!1;h.buffer;){if(!/\r\n|\n/.test(h.buffer))return this;switch(y?y=!1:p=m(),h.state){case"HEADER":/:/.test(p)?(M=p).match(/X-TIMESTAMP-MAP/)?U(M,function(B,G){"X-TIMESTAMP-MAP"===B&&function d(M){var B=new j;U(M,function(G,N){switch(G){case"MPEGT":B.integer(G+"S",N);break;case"LOCA":B.set(G+"L",K(N))}},/[^\d]:/,/,/),h.ontimestampmap&&h.ontimestampmap({MPEGTS:B.get("MPEGTS"),LOCAL:B.get("LOCAL")})}(G)},/=/):U(M,function(B,G){"Region"===B&&function c(M){var B=new j;if(U(M,function(N,q){switch(N){case"id":B.set(N,q);break;case"width":B.percent(N,q);break;case"lines":B.integer(N,q);break;case"regionanchor":case"viewportanchor":var H=q.split(",");if(2!==H.length)break;var V=new j;if(V.percent("x",H[0]),V.percent("y",H[1]),!V.has("x")||!V.has("y"))break;B.set(N+"X",V.get("x")),B.set(N+"Y",V.get("y"));break;case"scroll":B.alt(N,q,["up"])}},/=/,/\s/),B.has("id")){var G=new(h.vttjs.VTTRegion||h.window.VTTRegion);G.width=B.get("width",100),G.lines=B.get("lines",3),G.regionAnchorX=B.get("regionanchorX",0),G.regionAnchorY=B.get("regionanchorY",100),G.viewportAnchorX=B.get("viewportanchorX",0),G.viewportAnchorY=B.get("viewportanchorY",100),G.scroll=B.get("scroll",""),h.onregion&&h.onregion(G),h.regionList.push({id:B.get("id"),region:G})}}(G)},/:/):p||(h.state="ID");continue;case"NOTE":p||(h.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(p)){h.state="NOTE";break}if(!p)continue;h.cue=new(h.vttjs.VTTCue||h.window.VTTCue)(0,0,"");try{h.cue.align="center"}catch{h.cue.align="middle"}if(h.state="CUE",-1===p.indexOf("--\x3e")){h.cue.id=p;continue}case"CUE":try{L(p,h.cue,h.regionList)}catch(M){h.reportOrThrowError(M),h.cue=null,h.state="BADCUE";continue}h.state="CUETEXT";continue;case"CUETEXT":var P=-1!==p.indexOf("--\x3e");if(!p||P&&(y=!0)){h.oncue&&h.oncue(h.cue),h.cue=null,h.state="ID";continue}h.cue.text&&(h.cue.text+="\n"),h.cue.text+=p.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":p||(h.state="ID");continue}}}catch(M){h.reportOrThrowError(M),"CUETEXT"===h.state&&h.cue&&h.oncue&&h.oncue(h.cue),h.cue=null,h.state="INITIAL"===h.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var s=this;try{if(s.buffer+=s.decoder.decode(),(s.cue||"HEADER"===s.state)&&(s.buffer+="\n\n",s.parse()),"INITIAL"===s.state)throw new Q(Q.Errors.BadSignature)}catch(h){s.reportOrThrowError(h)}return s.onflush&&s.onflush(),this}},ge.exports=u},190:ge=>{var Le="auto",Ee={"":1,lr:1,rl:1},ke={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function Q(j){return"string"==typeof j&&!!ke[j.toLowerCase()]&&j.toLowerCase()}function K(j,U,L){this.hasBeenReset=!1;var F="",I=!1,R=j,D=U,_=L,b=null,k="",x=!0,T="auto",C="start",E="auto",o="auto",g=100,f="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return F},set:function(u){F=""+u}},pauseOnExit:{enumerable:!0,get:function(){return I},set:function(u){I=!!u}},startTime:{enumerable:!0,get:function(){return R},set:function(u){if("number"!=typeof u)throw new TypeError("Start time must be set to a number.");R=u,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return D},set:function(u){if("number"!=typeof u)throw new TypeError("End time must be set to a number.");D=u,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return _},set:function(u){_=""+u,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return b},set:function(u){b=u,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return k},set:function(u){var A=function Se(j){return"string"==typeof j&&!!Ee[j.toLowerCase()]&&j.toLowerCase()}(u);if(!1===A)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");k=A,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return x},set:function(u){x=!!u,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return T},set:function(u){if("number"!=typeof u&&u!==Le)throw new SyntaxError("Line: an invalid number or illegal string was specified.");T=u,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return C},set:function(u){var A=Q(u);A?(C=A,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return E},set:function(u){if(u<0||u>100)throw new Error("Position must be between 0 and 100.");E=u,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return o},set:function(u){var A=Q(u);A?(o=A,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return g},set:function(u){if(u<0||u>100)throw new Error("Size must be between 0 and 100.");g=u,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return f},set:function(u){var A=Q(u);if(!A)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");f=A,this.hasBeenReset=!0}}}),this.displayState=void 0}K.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},ge.exports=K},146:ge=>{var Le={"":!0,up:!0};function ke(Q){return"number"==typeof Q&&Q>=0&&Q<=100}ge.exports=function Se(){var Q=100,K=3,j=0,U=100,L=0,F=100,I="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return Q},set:function(R){if(!ke(R))throw new Error("Width must be between 0 and 100.");Q=R}},lines:{enumerable:!0,get:function(){return K},set:function(R){if("number"!=typeof R)throw new TypeError("Lines must be set to a number.");K=R}},regionAnchorY:{enumerable:!0,get:function(){return U},set:function(R){if(!ke(R))throw new Error("RegionAnchorX must be between 0 and 100.");U=R}},regionAnchorX:{enumerable:!0,get:function(){return j},set:function(R){if(!ke(R))throw new Error("RegionAnchorY must be between 0 and 100.");j=R}},viewportAnchorY:{enumerable:!0,get:function(){return F},set:function(R){if(!ke(R))throw new Error("ViewportAnchorY must be between 0 and 100.");F=R}},viewportAnchorX:{enumerable:!0,get:function(){return L},set:function(R){if(!ke(R))throw new Error("ViewportAnchorX must be between 0 and 100.");L=R}},scroll:{enumerable:!0,get:function(){return I},set:function(R){var D=function Ee(Q){return"string"==typeof Q&&!!Le[Q.toLowerCase()]&&Q.toLowerCase()}(R);!1===D?console.warn("Scroll: an invalid or illegal string was specified."):I=D}}})}},18:(ge,Le,Ee)=>{ge.exports=Ee(393).default},393:(ge,Le,Ee)=>{"use strict";Ee.d(Le,{default:()=>Ce});var ke=Ee(207),Se=Ee.n(ke),Q=Ee(675),K=Ee.n(Q);function U(ue){if(void 0===ue)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ue}var L=function ue(ae){var ce=this;if(Se().browser.IS_IE8)for(var oe in ce=K().createElement("custom"),ue.prototype)"constructor"!==oe&&(ce[oe]=ue.prototype[oe]);return ce.id=ae.id,ce.label=ce.id,ce.width=ae.width,ce.height=ae.height,ce.bitrate=ae.bandwidth,ce.enabled_=ae.enabled,Object.defineProperty(ce,"enabled",{get:function(){return ce.enabled_()},set:function(ee){ce.enabled_(ee)}}),ce},F=function(ue){function ae(){var oe,ee=U(U(oe=ue.call(this)||this));if(Se().browser.IS_IE8)for(var de in ee=K().createElement("custom"),ae.prototype)"constructor"!==de&&(ee[de]=ae.prototype[de]);return ee.levels_=[],ee.selectedIndex_=-1,Object.defineProperty(ee,"selectedIndex",{get:function(){return ee.selectedIndex_}}),Object.defineProperty(ee,"length",{get:function(){return ee.levels_.length}}),ee||U(oe)}!function j(ue,ae){ue.prototype=Object.create(ae.prototype),ue.prototype.constructor=ue,ue.__proto__=ae}(ae,ue);var ce=ae.prototype;return ce.addQualityLevel=function(oe){var ee=this.getQualityLevelById(oe.id);if(ee)return ee;var de=this.levels_.length;return ee=new L(oe),""+de in this||Object.defineProperty(this,de,{get:function(){return this.levels_[de]}}),this.levels_.push(ee),this.trigger({qualityLevel:ee,type:"addqualitylevel"}),ee},ce.removeQualityLevel=function(oe){for(var ee=null,de=0,pe=this.length;de<pe;de++)if(this[de]===oe){ee=this.levels_.splice(de,1)[0],this.selectedIndex_===de?this.selectedIndex_=-1:this.selectedIndex_>de&&this.selectedIndex_--;break}return ee&&this.trigger({qualityLevel:oe,type:"removequalitylevel"}),ee},ce.getQualityLevelById=function(oe){for(var ee=0,de=this.length;ee<de;ee++){var pe=this[ee];if(pe.id===oe)return pe}return null},ce.dispose=function(){this.selectedIndex_=-1,this.levels_.length=0},ae}(Se().EventTarget);for(var I in F.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"},F.prototype.allowedEvents_)F.prototype["on"+I]=null;var R="2.1.0",b=function(ue){return function(ue,ae){var ce=ue.qualityLevels,oe=new F;return ue.on("dispose",function de(){oe.dispose(),ue.qualityLevels=ce,ue.off("dispose",de)}),ue.qualityLevels=function(){return oe},ue.qualityLevels.VERSION=R,oe}(this,Se().mergeOptions({},ue))};function T(ue,ae){ue.prototype=Object.create(ae.prototype),ue.prototype.constructor=ue,ue.__proto__=ae}function C(ue){if(void 0===ue)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ue}(Se().registerPlugin||Se().plugin)("qualityLevels",b),b.VERSION=R;var E=Se().getComponent("MenuItem"),o=Se().getComponent("Component"),g=function(ue){function ae(oe,ee){return ee.selectable=!0,ee.multiSelectable=!1,ue.call(this,oe,ee)||this}T(ae,ue);var ce=ae.prototype;return ce.handleClick=function(){var oe=this.options_;console.log("Changing quality to:",oe.label),ue.prototype.handleClick.call(this);for(var ee=this.player().qualityLevels(),de=0;de<ee.length;de++)ee[de].enabled=oe.index==ee.length||oe.index==de},ce.update=function(){var oe=this.player().qualityLevels().selectedIndex;this.selected(this.options_.index==oe)},ae}(E);o.registerComponent("SourceMenuItem",g);var f=Se().getComponent("MenuButton"),u=function(ue){function ae(oe,ee){var de;de=ue.call(this,oe,ee)||this,f.apply(C(de),arguments);var pe=de.player().qualityLevels();if(ee&&ee.default)if("low"==ee.default)for(var _e=0;_e<pe.length;_e++)pe[_e].enabled=0==_e;else if(ee.default="high")for(_e=0;_e<pe.length;_e++)pe[_e].enabled=_e==pe.length-1;return de.player().qualityLevels().on(["change","addqualitylevel"],Se().bind(C(de),de.update)),de}T(ae,ue);var ce=ae.prototype;return ce.createEl=function(){return Se().dom.createEl("div",{className:"vjs-http-source-selector vjs-menu-button vjs-menu-button-popup vjs-control vjs-button"})},ce.buildCSSClass=function(){return f.prototype.buildCSSClass.call(this)+" vjs-icon-cog"},ce.update=function(){return f.prototype.update.call(this)},ce.createItems=function(){for(var oe=[],ee=this.player().qualityLevels(),de=[],pe=0;pe<ee.length;pe++){var _e=ee.length-(pe+1),Ie=_e===ee.selectedIndex,Ae=""+_e,Re=_e;ee[_e].height?(Ae=ee[_e].height+"p",Re=parseInt(ee[_e].height,10)):ee[_e].bitrate&&(Ae=Math.floor(ee[_e].bitrate/1e3)+" kbps",Re=parseInt(ee[_e].bitrate,10)),!(de.indexOf(Ae)>=0)&&(de.push(Ae),oe.push(new g(this.player_,{label:Ae,index:_e,selected:Ie,sortVal:Re})))}return ee.length>1&&oe.push(new g(this.player_,{label:"Auto",index:ee.length,selected:!1,sortVal:99999})),oe.sort(function(Ne,Me){return Ne.options_.sortVal<Me.options_.sortVal?1:Ne.options_.sortVal>Me.options_.sortVal?-1:0}),oe},ae}(f),A={},s=function(ue){var ae=this;this.ready(function(){!function(ue,ae){if(ue.addClass("vjs-http-source-selector"),console.log("videojs-http-source-selector initialized!"),console.log("player.techName_:"+ue.techName_),"Html5"!=ue.techName_)return!1;ue.on(["loadedmetadata"],function(ce){if(ue.qualityLevels(),Se().log("loadmetadata event"),"undefined"==ue.videojs_http_source_selector_initialized||1==ue.videojs_http_source_selector_initialized)console.log("player.videojs_http_source_selector_initialized == true");else{console.log("player.videojs_http_source_selector_initialized == false"),ue.videojs_http_source_selector_initialized=!0;var ee=ue.controlBar,de=ee.getChild("fullscreenToggle").el();ee.el().insertBefore(ee.addChild("SourceMenuButton").el(),de)}})}(ae,Se().mergeOptions(A,ue))}),Se().registerComponent("SourceMenuButton",u),Se().registerComponent("SourceMenuItem",g)};(Se().registerPlugin||Se().plugin)("httpSourceSelector",s),s.VERSION="1.1.6";var m=Ee(199),c=Ee.n(m),d=Object.defineProperty,n=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,y=(ue,ae,ce)=>ae in ue?d(ue,ae,{enumerable:!0,configurable:!0,writable:!0,value:ce}):ue[ae]=ce,M=(ue,ae,ce)=>(y(ue,"symbol"!=typeof ae?ae+"":ae,ce),ce);class B{constructor(ae,ce,oe={}){const ee=Se().getTech("Tech").prototype.error;this.source=ae,this.tech=ce,this.player=Se().getPlayer(this.tech.options().playerId),this._html5TechError=this.tech.error,this.tech.error=ee,this.el=ce.el(),this.hls=new(c())(((ue,ae)=>{for(var ce in ae||(ae={}))p.call(ae,ce)&&y(ue,ce,ae[ce]);if(n)for(var ce of n(ae))S.call(ae,ce)&&y(ue,ce,ae[ce]);return ue})({backBufferLength:30,liveDurationInfinity:!0},oe.hls)),this.tech.hlsjs=this.hls,this.player.qualityLevels&&this.setupQualityLevels(),this.setupEventHandlers(),this.setupHls(),this.mediaElErrorHandler_=()=>this.tech.error(this.el.error)}dispose(){this.el.removeEventListener("error",this.mediaElErrorHandler_),this.tech.error=this._html5TechError,this.hls.destroy(),delete this.tech.hlsjs}setupEventHandlers(){const ce={[c().ErrorTypes.NETWORK_ERROR]:2,[c().ErrorTypes.MEDIA_ERROR]:3,[c().ErrorTypes.MUX_ERROR]:3,[c().ErrorTypes.KEY_SYSTEM_ERROR]:5,DEFAULT:0};Object.values(c().Events).forEach(oe=>{oe!==c().Events.ERROR?this.hls.on(oe,(ee,de)=>{this.tech.trigger(oe,de)}):this.hls.on(oe,(ee,de)=>{var pe;const{type:_e,fatal:Ie}=de;if(!Ie)return;const Ae=null!=(pe=ce[_e])?pe:ce.DEFAULT;this.tech.error({code:Ae,hlsError:de})})}),this.el.addEventListener("error",this.mediaElErrorHandler_)}setupHls(){c().isSupported()?(this.hls.attachMedia(this.el),this.hls.loadSource(this.source.src)):this.el.canPlayType("application/vnd.apple.mpegurl")?this.el.src=this.source.src:console.log("[videojs-mux-kit] Error: browser does not support MSE nor Hls natively")}setupQualityLevels(){const ae=this.player.qualityLevels();let ce;const oe=()=>{let _e;for(_e=ce.length-1;_e>0&&!ce[_e];_e--);return _e},ee=()=>oe()===this.hls.levels.length-1,de=(_e,Ie)=>{const Ae=oe();this.hls.autoLevelCapping=ee()?-1:Ae,Ie&&this.hls.currentLevel!==_e&&(this.hls.currentLevel=_e,pe())},pe=(_e,Ie)=>{let Ae=this.hls.currentLevel;ae.selectedIndex_=Ae,ae.trigger({type:"change",selectedIndex:Ae})};this.tech.on(c().Events.MANIFEST_LOADED,(_e,Ie)=>{if(ce=new Array(this.hls.levels.length).fill(!0),-1!==this.hls.autoLevelCapping)for(let Ae=this.hls.maxAutoLevel;Ae<this.hls.levels.length;Ae++)ce[Ae]=!1;this.hls.levels.forEach((Ae,Re)=>{ae.addQualityLevel({id:Re,width:Ae.width,height:Ae.height,bitrate:Ae.bitrate,enabled:Ne=>{ce[Re]=Ne,de(Re,Ne)}})}),ae.selectedIndex_=this.hls.currentLevel,ae.trigger({type:"change",selectedIndex:this.hls.currentLevel})}),this.tech.on(c().Events.LEVEL_SWITCHED,pe)}}M(B,"hlsTypeRE",/^application\/(x-mpegURL|vnd\.apple\.mpegURL)$/i),M(B,"hlsExtRE",/\.m3u8/i);const G={canHandleSource:ue=>ue.skipHlsJs?"":B.hlsTypeRE.test(ue.type)?"probably":B.hlsExtRE.test(ue.src)?"maybe":"",handleSource:(ue,ae,ce={})=>new B(ue,ae,ce),canPlayType:ue=>B.hlsTypeRE.test(ue)?"probably":""};Se().getTech("Html5").registerSourceHandler(G,0);const q={i8:"0.11.4"};function X(ue){var ae;return ue.plugins.mux.data.player_software_name="vjs-mux-kit-"+(null==(ae=Se())?void 0:ae.VERSION.split(".")[0])+("function"==typeof c()?"-hlsjs":"-vhs"),ue.plugins.mux.data.player_software_version=q.i8,ue}Ee(288);const te={},re={},ne=Se().registerPlugin||Se().plugin;class me{constructor(ae,ce){return this.player=ae,this.options=ce,this.listenForDurationChange(),this.initializeThumbnails(),this.registeredEvents={},this}src(ae){this.resetPlugin(),this.options.src=ae,this.initializeThumbnails()}detach(){this.resetPlugin()}resetPlugin(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&(this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove)),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle}listenForDurationChange(){this.player.on("durationchange",()=>{})}initializeThumbnails(){if(!this.options.src)return;const ae=this.getBaseUrl(),ce=this.getFullyQualifiedUrl(this.options.src,ae);this.getVttFile(ce).then(oe=>{this.vttData=this.processVtt(oe),this.setupThumbnailElement()})}getBaseUrl(){return[window.location.protocol,"//",window.location.hostname,window.location.port?":"+window.location.port:"",window.location.pathname].join("").split(/([^\/]*)$/gi).shift()}getVttFile(ae){return new Promise((ce,oe)=>{const ee=new XMLHttpRequest;ee.data={resolve:ce},ee.addEventListener("load",this.vttFileLoaded),ee.open("GET",ae),ee.overrideMimeType("text/plain; charset=utf-8"),ee.send()})}vttFileLoaded(){this.data.resolve(this.responseText)}setupThumbnailElement(ae){let ce=null;this.options.showTimestamp||(ce=this.player.$(".vjs-mouse-display"));const oe=document.createElement("div");oe.setAttribute("class","vjs-vtt-thumbnail-display"),this.progressBar=this.player.$(".vjs-progress-control"),this.progressBar.appendChild(oe),this.thumbnailHolder=oe,ce&&!this.options.showTimestamp&&ce.classList.add("vjs-hidden"),this.registeredEvents.progressBarMouseEnter=()=>this.onBarMouseenter(),this.registeredEvents.progressBarMouseLeave=()=>this.onBarMouseleave(),this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)}onBarMouseenter(){this.mouseMoveCallback=ae=>{this.onBarMousemove(ae)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()}onBarMouseleave(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()}getXCoord(ae,ce){const oe=ae.getBoundingClientRect(),ee=document.documentElement;return ce-(oe.left+(window.pageXOffset||ee.scrollLeft||0))}onBarMousemove(ae){this.updateThumbnailStyle(Se().dom.getPointerPosition(this.progressBar,ae).x,this.progressBar.offsetWidth)}getStyleForTime(ae){for(let ce=0;ce<this.vttData.length;++ce){const oe=this.vttData[ce];if(ae>=oe.start&&ae<oe.end){if(oe.css.url&&!re[oe.css.url]){const ee=new Image;ee.src=oe.css.url,re[oe.css.url]=ee}return oe.css}}}showThumbnailHolder(){this.thumbnailHolder.style.opacity="1"}hideThumbnailHolder(){this.thumbnailHolder.style.opacity="0"}updateThumbnailStyle(ae,ce){const oe=this.player.duration(),de=this.getStyleForTime(ae*oe);if(!de)return this.hideThumbnailHolder();const pe=ae*ce,_e=parseInt(de.width,10),Ie=_e>>1,Ae=ce-(pe+Ie),Re=pe-Ie;if(Re>0&&Ae>0?this.thumbnailHolder.style.transform="translateX("+(pe-Ie)+"px)":Re<=0?this.thumbnailHolder.style.transform="translateX(0px)":Ae<=0&&(this.thumbnailHolder.style.transform="translateX("+(ce-_e)+"px)"),!this.lastStyle||this.lastStyle!==de){this.lastStyle=de;for(const Ne in de)de.hasOwnProperty(Ne)&&(this.thumbnailHolder.style[Ne]=de[Ne])}}processVtt(ae){const ce=[];return ae.split(/[\r\n][\r\n]/i).forEach(oe=>{if(oe.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){const ee=oe.split(/[\r\n]/i),de=ee[0].split(/ ?--> ?/i),pe=de[0],_e=de[1],Ae=this.getVttCss(ee[1]);ce.push({start:this.getSecondsFromTimestamp(pe),end:this.getSecondsFromTimestamp(_e),css:Ae})}}),ce}getFullyQualifiedUrl(ae,ce){return ae.indexOf("//")>=0?ae:0===ce.indexOf("//")?[ce.replace(/\/$/gi,""),this.trim(ae,"/")].join("/"):ce.indexOf("//")>0?[this.trim(ce,"/"),this.trim(ae,"/")].join("/"):ae}getPropsFromDef(ae){const ce=ae.split(/#xywh=/i),oe=ce[0],ee=ce[1].match(/[0-9]+/gi);return{x:ee[0],y:ee[1],w:ee[2],h:ee[3],image:oe}}getVttCss(ae){const ce={};let oe;if(oe=this.options.src.indexOf("//")>=0?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),!(ae=this.getFullyQualifiedUrl(ae,oe)).match(/#xywh=/i))return ce.background='url("'+ae+'")',ce;const ee=this.getPropsFromDef(ae);return ce.background='url("'+ee.image+'") no-repeat -'+ee.x+"px -"+ee.y+"px",ce.width=ee.w+"px",ce.height=ee.h+"px",ce.url=ee.image,ce}deconstructTimestamp(ae){const ce=ae.split("."),oe=ce[0].split(":");return{milliseconds:parseInt(ce[1],10)||0,seconds:parseInt(oe.pop(),10)||0,minutes:parseInt(oe.pop(),10)||0,hours:parseInt(oe.pop(),10)||0}}getSecondsFromTimestamp(ae){const ce=this.deconstructTimestamp(ae);return parseInt(3600*ce.hours+60*ce.minutes+ce.seconds+ce.milliseconds/1e3,10)}trim(ae,ce){let oe=[" ","\n","\r","\t","\f","\v","\xa0","\u2000","\u2001","\u2002","\u2003","\u2004","\u2005","\u2006","\u2007","\u2008","\u2009","\u200a","\u200b","\u2028","\u2029","\u3000"].join(""),ee=0,de=0;for(ae+="",ce&&(oe=(ce+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),ee=ae.length,de=0;de<ee;de++)if(-1===oe.indexOf(ae.charAt(de))){ae=ae.substring(de);break}for(ee=ae.length,de=ee-1;de>=0;de--)if(-1===oe.indexOf(ae.charAt(de))){ae=ae.substring(0,de+1);break}return-1===oe.indexOf(ae.charAt(0))?ae:""}}ne("vttThumbnails",function(ue){this.ready(()=>{((ue,ae)=>{ue.addClass("vjs-vtt-thumbnails"),ue.vttThumbnails=new me(ue,ae)})(this,Se().mergeOptions(te,ue))})}),Se().hook("beforesetup",function(ue,ae){return ae=function Y(ue,ae){var ce,oe,ee,de,pe;if(null!=(ce=ue?.dataset)&&ce.setup){let _e=ue.dataset.setup;_e=JSON.parse(_e),_e&&null!=(ee=null==(oe=_e?.plugins)?void 0:oe.mux)&&ee.data&&(_e=X(_e),_e=JSON.stringify(_e),ue.dataset.setup=_e)}return null!=(pe=null==(de=ae?.plugins)?void 0:de.mux)&&pe.data&&(ae=X(ae)),ae}(ue,ae),ae}),Se().hook("setup",function(ue){(function Te(ue){ue.timelineHoverPreviews=function(ae){let oe=ae?.src||null;return ae?.enabled||"function"!=typeof ue.vttThumbnails.detach?"function"==typeof ue.vttThumbnails&&null!==oe?(ue.vttThumbnails({src:oe}),void(ue.options().timelineHoverPreviewsUrl=oe)):"function"==typeof ue.vttThumbnails.src&&null!==oe?(ue.vttThumbnails.src(oe),void(ue.options().timelineHoverPreviewsUrl=oe)):void 0:(ue.vttThumbnails.detach(),void(ue.options().timelineHoverPreviewsUrl=null))}})(ue),ue.options().timelineHoverPreviewsUrl&&ue.timelineHoverPreviews({enabled:!0,src:ue.options().timelineHoverPreviewsUrl})}),Se().use("video/mux",ue=>({setSource({src:ae},ce){if(ue.options().timelineHoverPreviews){let oe=`https://image.mux.com/${ae.split("?",1)[0]}/storyboard.vtt`;ue.timelineHoverPreviews({enabled:!0,src:oe})}ce(null,{src:`https://stream.mux.com/${ae}`,type:"application/x-mpegurl"}),ue.mux&&ue.mux.addHLSJS&&function V(ue){var ae,ce;null!=(ce=null==(ae=ue.tech_)?void 0:ae.sourceHandler_)&&ce.hls&&ue.mux.addHLSJS({hlsjs:ue.tech_.sourceHandler_.hls,Hls:c()})}(ue),function Z(ue){var ae,ce;null==(ce=null==(ae=ue.tech_)?void 0:ae.sourceHandler_)||ce.hls.on(c().Events.MANIFEST_LOADED,function(oe,ee){if(ee.subtitles){let de;for(de=0;de<ee.subtitles.length;de++)ue.addRemoteTextTrack({kind:ee.subtitles[de].type,label:ee.subtitles[de].name,srclang:ee.subtitles[de].lang,default:ee.subtitles[de].default},!1)}}),ue.remoteTextTracks().addEventListener("change",oe=>{let de,ee=ue.remoteTextTracks(),pe=!1;for(de=0;de<ee.length;de++)"showing"===ee[de].mode&&(ue.tech_.sourceHandler_.hls.subtitleTrack=de,pe=!0);!0!==pe&&(ue.tech_.sourceHandler_.hls.subtitleTrack=-1)})}(ue)}}));const Ce=Se()},893:()=>{},104:ge=>{ge.exports=function Le(Ee){if(void 0===Ee)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Ee},ge.exports.__esModule=!0,ge.exports.default=ge.exports},271:(ge,Le,Ee)=>{var ke=Ee(985),Se=Ee(651);function Q(K,j,U){return Se()?(ge.exports=Q=Reflect.construct.bind(),ge.exports.__esModule=!0,ge.exports.default=ge.exports):(ge.exports=Q=function(L,F,I){var R=[null];R.push.apply(R,F);var _=new(Function.bind.apply(L,R));return I&&ke(_,I.prototype),_},ge.exports.__esModule=!0,ge.exports.default=ge.exports),Q.apply(null,arguments)}ge.exports=Q,ge.exports.__esModule=!0,ge.exports.default=ge.exports},110:ge=>{function Le(){return ge.exports=Le=Object.assign?Object.assign.bind():function(Ee){for(var ke=1;ke<arguments.length;ke++){var Se=arguments[ke];for(var Q in Se)Object.prototype.hasOwnProperty.call(Se,Q)&&(Ee[Q]=Se[Q])}return Ee},ge.exports.__esModule=!0,ge.exports.default=ge.exports,Le.apply(this,arguments)}ge.exports=Le,ge.exports.__esModule=!0,ge.exports.default=ge.exports},169:(ge,Le,Ee)=>{var ke=Ee(985);ge.exports=function Se(Q,K){if("function"!=typeof K&&null!==K)throw new TypeError("Super expression must either be null or a function");Q.prototype=Object.create(K&&K.prototype,{constructor:{value:Q,writable:!0,configurable:!0}}),Object.defineProperty(Q,"prototype",{writable:!1}),K&&ke(Q,K)},ge.exports.__esModule=!0,ge.exports.default=ge.exports},721:(ge,Le,Ee)=>{var ke=Ee(985);ge.exports=function Se(Q,K){Q.prototype=Object.create(K.prototype),Q.prototype.constructor=Q,ke(Q,K)},ge.exports.__esModule=!0,ge.exports.default=ge.exports},651:ge=>{ge.exports=function Le(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}},ge.exports.__esModule=!0,ge.exports.default=ge.exports},985:ge=>{function Le(Ee,ke){return ge.exports=Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Se,Q){return Se.__proto__=Q,Se},ge.exports.__esModule=!0,ge.exports.default=ge.exports,Le(Ee,ke)}ge.exports=Le,ge.exports.__esModule=!0,ge.exports.default=ge.exports}},Ft={};function At(ge){var Le=Ft[ge];if(void 0!==Le)return Le.exports;var Ee=Ft[ge]={exports:{}};return Mr[ge].call(Ee.exports,Ee,Ee.exports,At),Ee.exports}return At.n=ge=>{var Le=ge&&ge.__esModule?()=>ge.default:()=>ge;return At.d(Le,{a:Le}),Le},At.d=(ge,Le)=>{for(var Ee in Le)At.o(Le,Ee)&&!At.o(ge,Ee)&&Object.defineProperty(ge,Ee,{enumerable:!0,get:Le[Ee]})},At.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch{if("object"==typeof window)return window}}(),At.o=(ge,Le)=>Object.prototype.hasOwnProperty.call(ge,Le),At(18)})()});